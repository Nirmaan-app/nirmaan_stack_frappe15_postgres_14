[
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 0,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": null,
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-02-19 13:15:13.143402",
  "module": "Nirmaan Stack",
  "name": "Test Format",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 0,
  "default_print_language": null,
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": "{\"header\":\"<div class=\\\"document-header\\\">\\n\\t<h3>Procurement Orders</h3>\\n\\t<p>{{ doc.name }}</p>\\n</div>\",\"sections\":[{\"label\":\"Links\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Project\",\"fieldname\":\"project\",\"fieldtype\":\"Link\",\"options\":\"Projects\"},{\"label\":\"Vendor\",\"fieldname\":\"vendor\",\"fieldtype\":\"Link\",\"options\":\"Vendors\"},{\"label\":\"Procurement Request\",\"fieldname\":\"procurement_request\",\"fieldtype\":\"Link\",\"options\":\"Procurement Requests\"},{\"label\":\"Category\",\"fieldname\":\"category\",\"fieldtype\":\"Link\",\"options\":\"Category\"},{\"label\":\"Merged\",\"fieldname\":\"merged\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true},{\"label\":\"Procurement Order Details\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Attachment\",\"fieldname\":\"attachment\",\"fieldtype\":\"Data\"},{\"label\":\"Project Name\",\"fieldname\":\"project_name\",\"fieldtype\":\"Data\"},{\"label\":\"Project Address\",\"fieldname\":\"project_address\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor Name\",\"fieldname\":\"vendor_name\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor Address\",\"fieldname\":\"vendor_address\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor GST\",\"fieldname\":\"vendor_gst\",\"fieldtype\":\"Data\"},{\"label\":\"Order List\",\"fieldname\":\"order_list\",\"fieldtype\":\"JSON\"},{\"label\":\"Category List\",\"fieldname\":\"category_list\",\"fieldtype\":\"JSON\",\"options\":\"Category\"}]}],\"has_fields\":true},{\"label\":\"Payment Details \",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Advance\",\"fieldname\":\"advance\",\"fieldtype\":\"Data\"},{\"label\":\"Loading Charges\",\"fieldname\":\"loading_charges\",\"fieldtype\":\"Data\"},{\"label\":\"Freight Charges\",\"fieldname\":\"freight_charges\",\"fieldtype\":\"Data\"},{\"label\":\"Notes\",\"fieldname\":\"notes\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true},{\"label\":\"Tracking Details\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Status\",\"fieldname\":\"status\",\"fieldtype\":\"Data\"},{\"label\":\"Delivery Contact\",\"fieldname\":\"delivery_contact\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true}]}",
  "html": null,
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-02-19 13:15:41.095080",
  "module": "Nirmaan Stack",
  "name": "Test 2",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 1,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: PO Nirmaan (Revised)\n    DocType: Procurement Order\n#}\n\n{# --- Company Details (Customized) --- #}\n{%- set company_details = {\n    \"name\": \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"logo_url\": \"https://s3.ap-south-1.amazonaws.com/nirmaan-stack-test-bucket/test/2025/05/19/File/Z3C3GD6J_logo-svg.svg\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": \"Bengaluru\",\n        \"06ABFCS9095N1ZH\": \"Gurugram\"\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park Cowarking Space, Mehrauli Gurugram Rd, Tower D, Sikanderpur, Gurugram, Haryana - 122002\"\n    },\n    \"default_address\": \"Company address details missing or project GST not set.\",\n    \"phone_no\": \"YOUR_COMPANY_PHONE\",\n    \"email\": \"YOUR_COMPANY_EMAIL\",\n    \"website\": \"YOUR_COMPANY_WEBSITE\"\n} -%}\n\n{# Determine current company address and GST based on PO's project_gst #}\n{%- set current_company_gst = doc.project_gst if doc.project_gst in company_details.gst_numbers else None -%}\n{%- set current_company_address = company_details.addresses[current_company_gst] if current_company_gst else company_details.default_address -%}\n{%- set currency_symbol = \"₹\" -%}\n{# {%- set company_currency = frappe.db.get_default(\"currency\") or \"INR\" -%} #}\n{# {%- set currency_symbol  = frappe.utils.get_currency_symbol(company_currency) -%} #}\n\n{# ----------- 1. Macro – Address formatter --------------------- #}\n{% macro format_address(addr_name) -%}\n    {%- if not addr_name -%}N/A\n    {%- else -%}\n        {%- set ad = frappe.get_doc(\"Address\", addr_name) -%}\n        {%- set parts = [] -%}\n        {%- if ad.address_line1        %}{% set parts = parts + [ad.address_line1]        %}{% endif -%}\n        {%- if ad.address_line2        %}{% set parts = parts + [ad.address_line2]        %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if ad.city                 %}{% set csp = csp + [ad.city]                     %}{% endif -%}\n        {%- if ad.state                %}{% set csp = csp + [ad.state]                    %}{% endif -%}\n        {%- if ad.pincode              %}{% set csp = csp + [ad.pincode]                  %}{% endif -%}\n        {%- if csp                     %}{% set parts = parts + [csp | join(\" \")]         %}{% endif -%}\n        {%- if ad.country              %}{% set parts = parts + [ad.country]              %}{% endif -%}\n        {{ parts | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{%- set project_doc = frappe.get_doc(\"Projects\", doc.project) if doc.project else None -%}\n{%- set vendor_doc = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n\n{# ----------- 3. Pre-rendered HTML blocks ----------------------- #}\n{% set vendor_address_html  = format_address(vendor_doc.vendor_address)\n                                  if vendor_doc else \"N/A\" %}\n{% set project_address_html = format_address(project_doc.project_address)\n                                  if project_doc else \"N/A\" %}\n\n{# Helper to parse the first value from the advance string #}\n{%- macro get_first_advance_value(advance_string) -%}\n    {%- if advance_string and advance_string is string -%}\n        {%- set parts = advance_string.split(',') -%}\n        {%- if parts and parts[0] -%}\n            {{- (parts[0] | trim | float) if parts[0] | trim else 0 -}}\n        {%- else -%}\n            0\n        {%- endif -%}\n    {%- else -%}\n        {{- (advance_string | float) if advance_string is number else 0 -}} {# Handle if it's already a number or None #}\n    {%- endif -%}\n{%- endmacro -%}\n{%- set advance_paid_value = get_first_advance_value(doc.advance) -%}\n\n\n<style>\n    body { font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif; font-size: 10px; color: #333; margin: 0; padding: 0; }\n    /*.invoice-container { width: 100%; max-width: 800px; margin: 0 auto; padding: 0 15px 15px 15px; }*/\n    \n    @page {\n        size: A4;\n        margin: 45mm 12mm 20mm 12mm;   /* top, right, bottom, left */\n    }\n    \n    .header img.logo { max-width: 140px; max-height: 40px; margin-bottom: 8px; float: left; }\n    .company-info-header { float: right; text-align: right; }\n    .company-info-header p { margin: 0 0 2px 0; font-size: 9.5px; }\n    .document-title {\n        font-size: 20px; font-weight: bold; color: #1a1a1a; text-transform: uppercase;\n        margin-bottom: 15px; text-align: center; clear: both; padding-top: 10px;\n        border-bottom: 2px solid #333; padding-bottom: 10px;\n    }\n    .po-details { margin-bottom: 15px; overflow: hidden; }\n    .po-details .left, .po-details .right { width: 49%; float: left; font-size: 9.5px; }\n    .po-details .right { float: right; text-align: right; }\n    .po-details p, .address-section p { margin: 0 0 3px 0; line-height: 1.4; }\n    .address-section { margin-bottom: 15px; overflow: hidden; }\n    .address-section .billed-to, .address-section .shipped-to {\n        width: 49%; float: left; min-height: 80px; font-size: 9.5px;\n    }\n    .address-section .shipped-to { float: right; }\n    .address-section h4 {\n        font-size: 10px; font-weight: bold; text-transform: uppercase; color: #555;\n        margin-top: 0; margin-bottom: 6px;\n    }\n    .address-block       { margin-bottom:15px; overflow:hidden; }\n    .address-block__col  { width:48%; float:left; font-size:9.5px; }\n    .address-block__col + .address-block__col { float:right; }\n    .items-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }\n    .items-table th, .items-table td { border: 1px solid #ddd; padding: 5px 7px; text-align: left; }\n    .items-table th { background-color: #f0f0f0; font-weight: bold; font-size: 9.5px; text-transform: uppercase; }\n    .items-table td { font-size: 9.5px; }\n    .items-table .text-right { text-align: right; }\n    .items-table .text-center { text-align: center; }\n    .totals-section { width: 100%; margin-top: 15px; overflow: hidden; }\n    .totals-section .notes-terms { width: 58%; float: left; font-size: 9.5px; }\n    .totals-section .summary { width: 40%; float: right; }\n    .totals-section .summary table { width: 100%; font-size: 9.5px; }\n    .totals-section .summary td { padding: 3px 0; }\n    .totals-section .summary td:first-child { font-weight: bold; color: #444; }\n    .totals-section .summary .grand-total td {\n        font-weight: bold; font-size: 11px; border-top: 1px solid #333; border-bottom: 1px solid #333;\n        padding-top: 6px; padding-bottom: 6px;\n    }\n    .footer-notes {\n        margin-top: 25px; font-size: 8.5px; color: #777; border-top: 1px dashed #ccc;\n        padding-top: 8px; text-align: center;\n    }\n    .signature-area { margin-top: 40px; text-align: right; }\n    .signature-area .line { width: 180px; border-top: 1px solid #333; margin-left: auto; margin-bottom: 5px; }\n    .signature-area p { font-size: 9.5px; margin:0; }\n</style>\n\n{# -----------------  HEADER – will repeat on every page  ----------------- #}\n<div id=\"header-html\" style=\"display: none\">       {# must be OUTSIDE .print-format #}\n  <table style=\"width:100%; font-family:Helvetica,Arial,sans-serif; font-size:9.5px\">\n    <tr>\n      <td style=\"width:40%\">\n        <img src=\"{{ company_details.logo_url }}\" style=\"max-width:140px; max-height:38px\">\n      </td>\n      <td style=\"text-align:right; font-size:11px\">\n        <strong>{{ company_details.name }}</strong><br>\n        {{ current_company_address }}<br>\n        {% if current_company_gst %}\n          <strong>GSTIN:</strong> {{ current_company_gst }}\n        {% endif %}\n      </td>\n    </tr>\n  </table>\n</div>\n\n{# -------------  FOOTER (optional) – also repeats on every page --------- #}\n<div id=\"footer-html\" style=\"display:none\">\n  <div style=\"width:100%; text-align:center; font-size:8.5px;\">\n    Page <span class=\"page\"></span> of <span class=\"topage\"></span>\n  </div>\n</div>\n    \n<div class=\"print-format\">\n\n<!--<div class=\"invoice-container\">-->\n    <div class=\"document-title\">Purchase Order</div>\n    <!--<h2 style=\"text-align:center; margin:0 0 12px 0;\">Purchase Order</h2>-->\n    <div class=\"po-details\">\n        <div class=\"left\">\n            <p><strong>PO Number:</strong> {{ doc.name }}</p>\n            <p><strong>PO Date:</strong> {{ frappe.utils.formatdate(doc.creation, \"dd-MM-yyyy\") }}</p>\n            {% if doc.procurement_request %}\n            <p><strong>PR Reference:</strong> {{ doc.procurement_request }}</p>\n            {% endif %}\n        </div>\n        <div class=\"right\">\n            <p><strong>Status:</strong> <span style=\"font-weight:bold; color: #007bff;\">{{ doc.status }}</span></p>\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n\n    {# In the address display section: #}\n    <div class=\"address-block\">\n      <div class=\"address-block__col\">\n          <h4>VENDOR DETAILS</h4>\n          <p><strong>{{ vendor_doc.vendor_name if vendor_doc else doc.vendor }}</strong></p>\n          {{ vendor_address_html }}\n          {% if vendor_doc and vendor_doc.vendor_gst %}\n            <p><strong>GSTIN:</strong> {{ vendor_doc.vendor_gst }}</p>\n          {% endif %}\n      </div>\n\n      <div class=\"address-block__col\">\n          <h4>SHIP-TO / PROJECT DETAILS</h4>\n          <p><strong>{{ project_doc.project_name if project_doc else doc.project }}</strong></p>\n          {{ project_address_html }}\n          {% if doc.delivery_contact %}\n            <p><strong>Site Contact:</strong> {{ doc.delivery_contact }}</p>\n          {% endif %}\n      </div>\n  </div>\n<div style=\"clear:both;\"></div>\n\n<table class=\"items-table\">\n    <thead>\n        <tr>\n            <th style=\"width:5%;\">Sr.</th>\n            <th style=\"width:35%;\">Item Description</th>\n            <th style=\"width:10%;\" class=\"text-center\">Make</th>\n            <th style=\"width:8%;\" class=\"text-center\">Qty</th>\n            <th style=\"width:8%;\" class=\"text-center\">Unit</th>\n            <th style=\"width:12%;\" class=\"text-right\">Rate ({{ currency_symbol }})</th>\n            <th style=\"width:10%;\" class=\"text-right\">Tax %</th>\n            <th style=\"width:12%;\" class=\"text-right\">Amount ({{ currency_symbol }})</th>\n        </tr>\n    </thead>\n    <tbody>\n        {% set total_qty = namespace(value=0.0) %}\n        {% set subtotal = namespace(value=0.0) %}\n        {% set total_tax_amount_on_items = namespace(value=0.0) %}\n\n        {# Initialize items_to_loop variable #}\n        {% set items_to_loop = [] %}\n\n        {# Attempt to parse if doc.order_list is a string #}\n        {% if doc.order_list and doc.order_list is string %}\n            {% set parsed_data = json.loads(doc.order_list) %}\n            {% if parsed_data is mapping and parsed_data.list is defined and parsed_data.list is iterable %}\n                {% set items_to_loop = parsed_data.list %}\n            {% endif %}\n        {# Else, if it's already a dictionary with a list #}\n        {% elif doc.order_list is mapping and doc.order_list.list is defined and doc.order_list.list is iterable %}\n            {% set items_to_loop = doc.order_list.list %}\n        {% endif %}\n\n        {% if items_to_loop | length > 0 %}\n            {% for item in items_to_loop %}\n                {% if item is mapping %}\n                    <tr>\n                        <td class=\"text-center\">{{ loop.index }}</td>\n                        <td>\n                            {{ item.get(\"item\", \"N/A\") }}\n                            {% if item.get(\"comment\") %}<br><small><em>Note: {{ item.get(\"comment\") }}</em></small>{% endif %}\n                        </td>\n                        <td class=\"text-center\">{{ item.get(\"make\", \"-\") }}</td>\n                        {%- set current_item_quantity = (item.get(\"quantity\") | float(0)) -%}\n                        <td class=\"text-center\">{{ current_item_quantity | round(2) }}</td>\n                        {%- set total_qty.value = total_qty.value + current_item_quantity -%}\n                        <td class=\"text-center\">{{ item.get(\"unit\", \"N/A\") }}</td>\n                        {%- set current_item_quote = (item.get(\"quote\") | float(0)) -%}\n                        <td class=\"text-right\">{{ \"%.2f\" | format(current_item_quote) }}</td>\n                        {%- set current_item_tax_percent = (item.get(\"tax\") | float(0)) if item.get(\"tax\") is not none else 0.0 -%}\n                        <td class=\"text-right\">{{ current_item_tax_percent }}%</td>\n\n                        {%- set item_base_amount = current_item_quantity * current_item_quote -%}\n                        {%- set current_item_tax_amount = item_base_amount * current_item_tax_percent / 100.0 -%}\n                        {%- set item_total_amount = item_base_amount + current_item_tax_amount -%}\n                        <td class=\"text-right\">{{ \"%.2f\" | format(item_total_amount | float ) }}</td>\n\n                        {%- set subtotal.value = subtotal.value + item_base_amount -%}\n                        {%- set total_tax_amount_on_items.value = total_tax_amount_on_items.value + current_item_tax_amount -%}\n                    </tr>\n                {% else %}\n                    <tr><td colspan=\"8\" style=\"color:red; text-align:center;\">Malformed item data found in order_list (item not a dict)</td></tr>\n                {% endif %}\n            {% endfor %}\n        {% else %}\n            <tr><td colspan=\"8\" style=\"text-align:center; padding: 20px;\">No items found in this order or order_list is invalid.</td></tr>\n        {% endif %}\n    </tbody>\n</table>\n\n    <div class=\"totals-section\">\n        <div class=\"notes-terms\">\n            <p><strong>Total Quantity:</strong> {{ (total_qty.value | float) | round(2) }}</p>\n            <br>\n            {# Corrected all values in final_grand_total calculation to use | float #}\n            {% set final_grand_total = (subtotal.value | float) + (total_tax_amount_on_items.value | float) + ((doc.loading_charges or 0) | float) + ((doc.freight_charges or 0) | float) - (advance_paid_value | float(0)) %}\n            <p><strong>Amount in Words:</strong><br>\n                {{ frappe.utils.money_in_words(final_grand_total, \"INR\") }} {# Assuming INR or use system default #}\n            </p>\n            {% if doc.notes %}\n            <div style=\"margin-top:10px;\">\n                <h4 style=\"font-size:10px; font-weight:bold; margin-bottom:3px;\">NOTES & TERMS:</h4>\n                <div style=\"font-size:9px; white-space: pre-wrap;\">{{ doc.notes }}</div>\n            </div>\n            {% endif %}\n        </div>\n\n        <div class=\"summary\">\n            <table>\n                <tr>\n                    <td>Subtotal:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(subtotal.value | float) }}</td>\n                </tr>\n                <tr>\n                    <td>Total Item Tax:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(total_tax_amount_on_items.value | float) }}</td>\n                </tr>\n                {% if doc.loading_charges and (doc.loading_charges | string | trim != \"\") and ((doc.loading_charges or 0) | float) > 0 %}\n                <tr>\n                    <td>Loading Charges:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format((doc.loading_charges or 0) | float) }}</td>\n                </tr>\n                {% endif %}\n                {% if doc.freight_charges and (doc.freight_charges | string | trim != \"\") and ((doc.freight_charges or 0) | float) > 0 %}\n                <tr>\n                    <td>Freight Charges:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format((doc.freight_charges or 0) | float) }}</td>\n                </tr>\n                {% endif %}\n                {% if (advance_paid_value | float(0)) > 0 %}\n                <tr>\n                    <td>Advance Paid:</td>\n                    <td class=\"text-right\" style=\"color:green;\">- {{ currency_symbol }} {{ \"%.2f\" | format(advance_paid_value | float) }}</td>\n                </tr>\n                {% endif %}\n                <tr class=\"grand-total\">\n                    <td>GRAND TOTAL:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(final_grand_total | float) }}</td>\n                </tr>\n            </table>\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n\n    <div class=\"footer-notes\">\n        This is a computer-generated Purchase Order.\n        <p>For detailed terms and conditions, please visit our website or refer to the master agreement.</p>\n    </div>\n\n    <div class=\"signature-area\">\n        <div class=\"line\"></div>\n        <p>For <strong>{{ company_details.name }}</strong></p>\n        <p>(Authorized Signatory)</p>\n    </div>\n</div>\n<!--</div>-->",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-05-20 13:46:48.216386",
  "module": "Nirmaan Stack",
  "name": "PO Invoice",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Service Requests",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format : SR Tax Invoice – single-line grid, no background\n    DocType      : Service Requests\n#}\n\n{# ──────────────────────────────────────────────────────────────\n   0 . Company / project / customer / vendor variables\n   ────────────────────────────────────────────────────────────── #}\n{%- set nirmaan_company_details = {\n    \"name\"      : \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": {\"name\": \"Karnataka\", \"code\": \"29\"},\n        \"06ABFCS9095N1ZH\": {\"name\": \"Haryana\",   \"code\": \"06\"},\n        \"09ABFCS9095N1ZB\": {\"name\": \"Noida\", \"code\":\"09\"}\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru 560102\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\",\n        \"09ABFCS9095N1ZB\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"\n    },\n    \"default_address\": \"Nirmaan address not set\"\n} -%}\n\n{%- set n_key         = doc.project_gst if doc.project_gst in nirmaan_company_details.gst_numbers else None -%}\n{%- set n_addr        = nirmaan_company_details.addresses.get(n_key, nirmaan_company_details.default_address) -%}\n{%- set n_gstin       = n_key -%}\n{%- set n_state_name  = nirmaan_company_details.gst_numbers[n_key].name if n_key else \"N/A\" -%}\n{%- set n_state_code  = nirmaan_company_details.gst_numbers[n_key].code if n_key else \"N/A\" -%}\n\n{%- set project_doc   = frappe.get_doc(\"Projects\",  doc.project)  if doc.project else None -%}\n{%- set vendor_doc    = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n{%- set customer_doc  = frappe.get_doc(\"Customers\", project_doc.customer) if project_doc and project_doc.customer else None -%}\n\n{%- set is_gst_applicable = doc.gst == \"true\" -%}\n{%- set gst_rate = 18.0 -%}\n\n{% macro format_address(addr) -%}\n    {%- if not addr -%}N/A{%- else -%}\n        {%- set a = frappe.get_doc(\"Address\", addr) -%}\n        {%- set p = [] -%}\n        {%- if a.address_line1 %}{% set p = p + [a.address_line1] %}{% endif -%}\n        {%- if a.address_line2 %}{% set p = p + [a.address_line2] %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if a.city    %}{% set csp = csp + [a.city]    %}{% endif -%}\n        {%- if a.state   %}{% set csp = csp + [a.state]   %}{% endif -%}\n        {%- if a.pincode %}{% set csp = csp + [a.pincode] %}{% endif -%}\n        {%- if csp %}{% set p = p + [csp | join(\" \")] %}{% endif -%}\n        {%- if a.country %}{% set p = p + [a.country] %}{% endif -%}\n        {{ p | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{%- set project_addr_html = format_address(project_doc.project_address) if project_doc and project_doc.project_address else \"N/A\" -%}\n{%- set vendor_addr_html = format_address(vendor_doc.vendor_address) if vendor_doc and vendor_doc.vendor_address else \"N/A\" -%}\n{%- set vendor_gstin = vendor_doc.vendor_gst if vendor_doc else \"N/A\" -%}\n{%- set vendor_state_name = frappe.get_doc(\"Address\", vendor_doc.vendor_address).state if vendor_doc and vendor_doc.vendor_address else \"N/A\" -%}\n{%- set vendor_state_code = vendor_gstin[0:2] if vendor_gstin and vendor_gstin != \"N/A\" else \"N/A\" -%}\n{%- set currency_symbol= \"₹\" -%}\n\n{# ──────────────────────────────────────────────────────────────\n   1 . Styles (unified 1-px grid, no colour fills)\n   ────────────────────────────────────────────────────────────── #}\n<style>\n    body      { font-family:\"Roboto\",Arial,sans-serif; font-size:8.5pt; margin:0; color:#000; }\n    table     { width:100%; border-collapse:collapse; }\n    tr        { page-break-inside:avoid; }\n    td,th     { border:1px solid #555; padding:2px 3px; vertical-align:top; font-size:8.5pt; }\n    th        { font-weight:bold; text-align:center; }\n\n    .w-50     { width:50%; }\n\n    /* outer grids */\n    .section-table td { padding:2px 3px; }\n\n    /* nested info-table : inner lines only */\n    /* .info-table        { width:100%; border-collapse:collapse; }\n    .info-table td     { border:1px solid #555; padding:1.5px 3px; }\n    .info-table        { border:none; }\n    .info-table tr:first-child  td { border-top:0; }\n    .info-table tr:last-child   td { border-bottom:0; }\n    .info-table tr td:first-child{ border-left:0; }\n    .info-table tr td:last-child { border-right:0; } */\n\n    .info-table td { border:1px solid #555; padding:1.5px 3px; font-size:7.5pt; vertical-align: top;}\n    .info-table { border:none; } /* Remove outer border of the nested table */\n    .info-table tr:first-child td  { border-top:0; }\n    .info-table tr:last-child td   { border-bottom:0; }\n    .info-table tr td:first-child  { border-left:0; }\n    .info-table tr td:last-child   { border-right:0; }\n\n    /* .label-cell { width:50%; font-weight:normal; border-bottom:0; padding-bottom:0; }\n    .value-cell { width:50%; font-weight:bold;   border-top:0;   padding-top:.5px; }\n    .terms-cell { border-top:1px solid #555; } */\n\n    .label-cell { width:50%; font-weight:normal; border-bottom:0; padding-bottom:0; text-align:left; }\n    .value-cell { width:50%; font-weight:bold;   border-top:0;   padding-top:.5px; text-align:left; min-height: 10px; word-wrap: break-word; }\n\n    .text-center{ text-align:center; }\n    .text-right { text-align:right;  }\n    .font-bold  { font-weight:bold;  }\n    .font-small { font-size: 7pt; } /* For labels like \"Buyer (Bill to)\" */\n\n    @page { size:A4; margin:30mm 8mm 18mm 8mm; }\n\n    #header-html h2 { margin:0 0 12px 0; text-align:center; }\n    #footer-html    { font-size:7.5pt; text-align:center; font-family:\"Roboto\",Arial,sans-serif; }\n</style>\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Header / Footer\n   ────────────────────────────────────────────────────────────── #}\n<div id=\"header-html\" style=\"display:none;\">\n    <h2>Tax Invoice</h2>\n</div>\n\n<div id=\"footer-html\" style=\"display:none;\">\n    This is a Computer Generated Invoice  |  Page <span class=\"page\"></span> of <span class=\"topage\"></span>\n</div>\n\n{# ──────────────────────────────────────────────────────────────\n   3 . Main document\n   ────────────────────────────────────────────────────────────── #}\n<div class=\"print-format\">\n\n<!-- SECTION 1 : Vendor vs Invoice quick info -->\n<table class=\"section-table\">\n  <tr>\n    <td class=\"w-50\">\n        <p class=\"font-bold\" style=\"font-size:9.5pt;\">\n            {{ vendor_doc.vendor_name if vendor_doc else \"Vendor N/A\" }}\n        </p>\n        {{ vendor_addr_html }}<br>\n        <!-- {% if vendor_gstin and vendor_gstin != \"N/A\" %}\n           <strong>GSTIN/UIN:</strong> {{ vendor_gstin }}<br>\n        {% endif %}\n        State Name : {{ vendor_state_name }}, Code : {{ vendor_state_code }} -->\n    </td>\n\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Invoice No.</td><td class=\"label-cell\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ doc.invoice_no if doc.invoice_no else \"-\" }}</td><td class=\"value-cell\">{{ frappe.utils.formatdate(doc.invoice_date,\"dd-MMM-yy\") if doc.invoice_date else \"-\" }}</td></tr>\n\n            <!-- <tr><td class=\"label-cell\">Delivery Note</td><td class=\"label-cell\">Mode/Terms of Payment</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_delivery_note_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_payment_terms\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\">Reference No. & Date</td><td class=\"label-cell\">Other References</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_reference_no_date\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_other_references\") or \"-\" }}</td></tr> -->\n        </table>\n    </td>\n  </tr>\n</table>\n\n<!-- SECTION 2 : Consignee / Buyer / Dispatch -->\n<table style=\"margin-top:3px;\">\n  <!-- <tr>\n    <td class=\"w-50\">\n        <span style=\"font-size:7.5pt;\">Consignee (Ship to)</span><br>\n        <span class=\"font-bold\">{{ project_doc.project_name if project_doc else \"Project N/A\" }}</span><br>\n        {{ project_addr_html }}<br>\n        {% if project_doc and project_doc.project_city %}\n          City : {{ project_doc.project_city }}<br>\n        {% endif %}\n        {% if project_doc and project_doc.project_state %}\n          State : {{ project_doc.project_state }}\n        {% endif %}\n    </td>\n\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td><td class=\"label-cell\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_buyers_order_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_buyers_order_date\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\">Dispatch Doc No.</td><td class=\"label-cell\">Delivery Note Date</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_dispatch_doc_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_delivery_note_date\") or \"-\" }}</td></tr>\n        </table>\n    </td>\n  </tr> -->\n\n  <tr>\n    <td class=\"w-50\">\n        <span style=\"font-size:7.5pt;\">Buyer (Bill to)</span><br>\n        <span class=\"font-bold\">{{ nirmaan_company_details.name }}</span><br>\n        {{ n_addr }}<br>\n        {% if n_gstin %}\n          <strong>GSTIN/UIN:</strong> {{ n_gstin }}<br>\n          State Name : {{ n_state_name }}, Code : {{ n_state_code }}\n        {% endif %}\n    </td>\n\n    <!-- <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Dispatched through</td><td class=\"label-cell\">Destination</td></tr>\n            <tr>\n                <td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_dispatched_through\") or \"-\" }}</td>\n                <td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_destination\") or project_doc.project_city if project_doc and project_doc.project_city else '-' }}</td>\n            </tr>\n\n                        <tr><td colspan=\"2\" class=\"label-cell terms-cell\">Terms of Delivery</td></tr>\n            <tr><td colspan=\"2\" class=\"value-cell\" style=\"border-top:0;\">{{ frappe.form_dict.get(\"custom_terms_of_delivery\") or \"-\" }}</td></tr>\n        </table>\n    </td> -->\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td><td class=\"label-cell\">Project</td></tr>\n            <tr><td class=\"value-cell\">{{ doc.name or \"-\" }}</td><td class=\"value-cell\">{{ project_doc.project_name if project_doc else \"-\" }}</td></tr>\n\n            <!--<tr><td class=\"label-cell\">Project</td></tr>-->\n            <!--<tr><td class=\"value-cell\">{{ project_doc.project_name if project_doc else \"-\" }}</td></tr>-->\n        </table>\n    </td>\n    <!-- <td class=\"w-50\"> {# Buyer's Order No & Date (from client input if provided) #}\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td></tr>\n            <tr><td class=\"value-cell\" style=\"padding-bottom:5px;\">{{ frappe.form_dict.get(\"custom_buyers_order_no\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\" style=\"border-top:1px solid #555;\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.utils.formatdate(project_doc.project_start_date,\"dd-MMM-yy\") if project_doc and project_doc.expected_start_date else \"-\" }}</td></tr>\n        </table>\n    </td> -->\n  </tr>\n</table>\n\n <!--SECTION 3 : Item grid -->\n<table style=\"margin-top:3px;\">\n   <thead>\n     <tr>\n       <th style=\"width:5%;\">Sl&nbsp;No.</th>\n       <th style=\"width:{% if is_gst_applicable %}48%{% else %}58%{% endif %};\">Particulars</th>\n       <th style=\"width:8%;\" class=\"text-center\">Quantity</th>\n       <th style=\"width:8%;\" class=\"text-center\">Rate&nbsp;per</th>\n       {% if is_gst_applicable %}\n       <th style=\"width:8%;\" class=\"text-center\">GST</th>\n       {% endif %}\n       <th style=\"width:{% if is_gst_applicable %}23%{% else %}21%{% endif %};\" class=\"text-right\">Amount</th>\n     </tr>\n   </thead>\n   <tbody>\n     {% set subtotal = namespace(value=0.0) %}\n     {% set total_tax = namespace(value=0.0) %}\n     {% set grand_total = namespace(value=0.0) %}\n\n     {# build items array the same way you did earlier #}\n     {% set items = [] %}\n     {% if doc.service_order_list and doc.service_order_list is string %}\n         {% set parsed = json.loads(doc.service_order_list) %}\n         {% if parsed is mapping and parsed.list is defined %}{% set items = parsed.list %}{% endif %}\n     {% elif doc.service_order_list is mapping and doc.service_order_list.list is defined %}\n         {% set items = doc.service_order_list.list %}\n     {% endif %}\n\n     {% if items|length %}\n       {% for it in items %}\n         {% set qty   = (it.quantity  or 0)|float %}\n         {% set rate  = (it.rate      or 0)|float %}\n         {% set amt   = qty * rate %}\n         {% set subtotal.value = subtotal.value + amt %}\n         \n         {% if is_gst_applicable %}\n             {% set tax_amount = amt * (gst_rate / 100) %}\n             {% set total_tax.value = total_tax.value + tax_amount %}\n             {% set item_total = amt + tax_amount %}\n         {% else %}\n             {% set item_total = amt %}\n         {% endif %}\n         \n         {% set grand_total.value = grand_total.value + item_total %}\n         <tr>\n           <td class=\"text-center\">{{ loop.index }}</td>\n           <td>{{ it.description }}</td>\n           <td class=\"text-center\">{{ qty if qty else \"-\" }} {{ it.uom if qty else \"\" }}</td>\n           <td class=\"text-right\">{{ rate and ('%.2f'|format(rate)) or '-' }}</td>\n           {% if is_gst_applicable %}\n           <td class=\"text-center\">{{ gst_rate }}%</td>\n           {% endif %}\n           <td class=\"text-right\">{{ currency_symbol }} {{ '%.2f'|format(amt) }}</td>\n         </tr>\n       {% endfor %}\n     {% else %}\n       <tr><td colspan=\"{{ 6 if is_gst_applicable else 5 }}\" class=\"text-center\" style=\"padding:12px;\">No service items found</td></tr>\n     {% endif %}\n\n     <tr>\n        <td colspan=\"{% if is_gst_applicable %}4{% else %}3{% endif %}\" class=\"font-bold text-right\">Total</td>\n        <td {% if is_gst_applicable %}{% else %}colspan=\"1\"{% endif %}></td>\n        <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(subtotal.value) }}</td>\n     </tr>\n\n     {% if is_gst_applicable %}\n        <tr>\n            <td colspan=\"4\" class=\"font-bold text-right\">Add: GST @ {{ gst_rate }}%</td>\n            <td></td>\n            <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(total_tax.value) }}</td>\n        </tr>\n     {% endif %}\n\n     <tr>\n        <td colspan=\"{% if is_gst_applicable %}4{% else %}3{% endif %}\" class=\"font-bold text-right\">Grand Total</td>\n        <td {% if is_gst_applicable %}{% else %}colspan=\"1\"{% endif %}></td>\n        <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(grand_total.value) }}</td>\n     </tr>\n   </tbody>\n</table>\n\n<!-- SECTION 4 : Amount in words / taxable summary -->\n<table style=\"margin-top:3px;\">\n  <tr>\n    <td style=\"width:70%; border-right:0;\">\n        Amount Chargeable (in words)<br>\n        <span class=\"font-bold\">\n           {{ frappe.utils.money_in_words(grand_total.value,\"INR\") if grand_total.value else \"INR Zero Only\" }}\n        </span>\n    </td>\n\n    <td style=\"width:30%; border-left:0;\">\n        <table class=\"info-table\">\n             <tr>\n              <td class=\"label-cell\" style=\"border-top:0;\"></td>\n              <td class=\"label-cell\" style=\"border-top:0; text-align:right;\">Taxable Value</td>\n              {% if is_gst_applicable %}\n              <td class=\"label-cell\" style=\"border-top:0; text-align:right;\">Tax Amount</td>\n              {% endif %}\n          </tr>\n          \n          <tr>\n              <td class=\"value-cell\"></td>\n              <td class=\"value-cell text-right\">{{ '%.2f'|format(subtotal.value) }}</td>\n              {% if is_gst_applicable %}\n              <td class=\"value-cell text-right\">{{ '%.2f'|format(total_tax.value) }}</td>\n              {% endif %}\n          </tr>\n          \n          <tr>\n              <td class=\"font-bold\">Total</td>\n              <td class=\"font-bold text-right\">{{ currency_symbol }} {{ '%.2f'|format(subtotal.value) }}</td>\n              {% if is_gst_applicable %}\n              <td class=\"font-bold text-right\">{{ currency_symbol }} {{ '%.2f'|format(total_tax.value) }}</td>\n              {% endif %}\n          </tr>\n        </table>\n    </td>\n  </tr>\n\n  <!--<tr>-->\n  <!--  <td colspan=\"2\" style=\"border-right:0;\">-->\n  <!--      Tax Amount (in words) : -->\n  <!--      <span class=\"font-bold\">-->\n  <!--          {% if is_gst_applicable and total_tax.value > 0 %}-->\n  <!--          {{ frappe.utils.money_in_words(total_tax.value,\"INR\") }}-->\n  <!--          {% else %}-->\n  <!--          NIL-->\n  <!--          {% endif %}-->\n  <!--      </span>-->\n  <!--  </td>-->\n  <!--</tr>-->\n\n  <tr>\n    <td colspan=\"2\" style=\"font-size:7pt; text-align:right; border-left:0; border-bottom:0;\">\n        E. &amp; O.E\n    </td>\n  </tr>\n</table>\n\n<!-- SECTION 5 : Signature -->\n<table style=\"margin-top:25px; height:50px;\">\n  <tr>\n     <td style=\"width:60%; vertical-align:bottom;\">Customer's Seal and Signature</td>\n     <td style=\"width:40%; text-align:center; vertical-align:bottom;\" class=\"font-bold\">\n         for {{ vendor_doc.vendor_name if vendor_doc else \"Vendor\" }}\n         <br><br><br>\n         Authorised Signatory\n     </td>\n  </tr>\n</table>\n\n</div> ",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-10-14 18:29:52.529101",
  "module": "Nirmaan Stack",
  "name": "SR Invoice",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Project Payments",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format : Payments - Simple Voucher with Authorization (Final)\n    DocType      : Project Payments\n#}\n\n{# MACRO REMOVED: Rely on direct frappe.get_doc calls to prevent 'str object' error #}\n\n{# ──────────────────────────────────────────────────────────────\n   0 . Dynamic Variables\n   ────────────────────────────────────────────────────────────── #}\n{%- set nirmaan_company_details = {\n    \"name\"      : \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": {\"name\": \"Karnataka\", \"code\": \"29\", \"address\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru 560102\"},\n        \"06ABFCS9095N1ZH\": {\"name\": \"Haryana\",   \"code\": \"06\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\"},\n        \"09ABFCS9095N1ZB\": {\"name\": \"Noida\", \"code\":\"09\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"}\n    }\n} -%}\n\n{# --------------------------------------------------------------------------------- #}\n{# FIX 1: Robust Document Retrieval Logic #}\n{%- set source_doc = frappe.get_doc(doc.document_type, doc.document_name) if doc.document_type and doc.document_name else none -%}\n{%- set project_id_to_fetch = source_doc.project if source_doc and source_doc.project else doc.project or None -%}\n{%- set vendor_id_to_fetch  = source_doc.vendor if source_doc and source_doc.vendor else doc.vendor or None -%}\n{%- set project_doc   = frappe.get_doc(\"Projects\", project_id_to_fetch) if project_id_to_fetch else none -%}\n{%- set vendor_doc    = frappe.get_doc(\"Vendors\", vendor_id_to_fetch) if vendor_id_to_fetch else none -%}\n{# --------------------------------------------------------------------------------- #}\n\n\n{# Nirmaan Details #}\n{%- set n_key         = project_doc.project_gst if project_doc and project_doc.project_gst in nirmaan_company_details.gst_numbers else \"29ABFCS9095N1Z9\" -%}\n{%- set n_info        = nirmaan_company_details.gst_numbers.get(n_key, nirmaan_company_details.gst_numbers['29ABFCS9095N1Z9']) -%}\n{%- set n_reg_address = n_info.address -%}\n{%- set n_gstin       = n_key -%}\n{%- set n_state_name  = n_info.name -%}\n{%- set n_state_code  = n_info.code -%}\n\n{%- set currency_symbol= \"₹\" -%}\n{%- set paid_amount = (doc.amount or 0) | float -%}\n\n{# ──────────────────────────────────────────────────────────────\n   1 . Styles\n   ────────────────────────────────────────────────────────────── #}\n<style>\n    /* RESET/GENERAL STYLES */\n    body { \n        font-family: 'Arial', sans-serif; \n        font-size: 10pt; \n        line-height: 1.5; \n        color: #333; \n        margin: 0;\n    }\n    table { width: 100%; border-collapse: collapse; }\n    \n    /* MAIN CONTAINER: FIX: Removed min-height to prevent extra page */\n    .print-format {\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n        /* min-height removed */\n    }\n    \n    .content-wrapper {\n        flex-grow: 1;\n        padding: 0 5mm; \n        position: relative; /* ADDED FOR WATERMARK POSITIONING */\n    }\n    .watermark {\n        position: absolute;\n        top: 35%;\n        left: 50%;\n        /* Changed rotation to 45deg for bottom-left to top-right orientation */\n        \n        /* ADDED VENDOR PREFIXES FOR MAX COMPATIBILITY IN PRINT/PDF ENGINES */\n        -webkit-transform: translate(-50%, -50%) rotate(-45deg); /* WebKit (for PDF engines) */\n        -ms-transform: translate(-50%, -50%) rotate(-45deg);     /* IE */\n        transform: translate(-50%, -50%) rotate(-45deg);         /* Standard */\n        \n        /* Font size slightly reduced for better fitting on the page */\n        font-size: 120pt; \n        font-weight: 900;\n        /* Changed to Green color with 5% opacity (very light) */\n        color: rgba(0, 128, 0, 0.03); \n        pointer-events: none; /* Allows text selection underneath */\n        z-index: 10; /* Ensures it's above normal content but below anything crucial */\n        text-transform: uppercase;\n    }\n\n    /* HEADER FIX: Use float for top row, clear for title/subtitle */\n    .header {\n        margin-bottom: 20px;\n        border-bottom: 2px solid #000; \n        padding-bottom: 10px; \n    }\n    \n    .header-top-row {\n        overflow: auto; /* Clears floats */\n        margin-bottom: 5px;\n        width: 100%;\n        display: block; /* Ensure block behaviour for print */\n    }\n\n    .company-info-left {\n        float: left;\n        text-align: left;\n        font-size: 14pt; \n        font-weight: bold; \n        color: #CC0000; \n        padding-top: 5px; /* Aligns with logo's top/center */\n    }\n\n    .logo-right {\n        float: right;\n        text-align: right;\n    }\n\n    .logo { \n        max-height: 50px; \n        max-width: 180px; \n        display: block;\n    } \n    .seal-container {\n       display: inline-block; \n       \n    }\n    .company-seal {\n    max-width: 120px; /* Size of the seal */\n    max-height: 120px;\n    margin-left:50px;\n    \n    }\n\n    .title { \n        clear: both; /* Ensures title goes below floats */\n        font-size: 20pt; \n        font-weight: 800; \n        color: #000; \n        text-align: center;\n        margin-top: 15px; /* Space after logo row */\n    }\n    .subtitle { \n        font-size: 10pt; \n        color: #000; \n        text-align: center;\n        margin-bottom: 5px; \n    }\n\n    /* DATA TABLE - PROFESSIONAL STYLE */\n    .data-table { border: 1px solid #000; margin-bottom: 20px; }\n    .data-table td { padding: 8px 10px; border: 1px solid #000; }\n    .data-label { \n        width: 30%; \n        font-weight: bold; \n        color: #333; \n        background-color: transparent;\n        border-right: 1px solid #000;\n    }\n    .data-value { width: 70%; }\n\n    /* TERMS */\n    .terms-heading { font-weight: bold; margin-top: 15px; margin-bottom: 5px; }\n    .terms-list { margin-left: 15px; padding-left: 0; font-size: 9pt; }\n    .terms-list li { margin-bottom: 3px; }\n\n    /* AUTHORIZATION - IMAGE MATCH LOOK */\n    .auth-table { \n        width: 100%; \n        margin-top: 200px; \n        border-collapse: collapse;\n        border: 1px solid #000; /* Outer border for the whole block */\n    }\n    .auth-table td { \n        height: 120px; \n        border: none;\n        padding: 15px; \n        vertical-align: top; \n        font-size: 10pt;\n        font-weight: normal;\n        position: relative; \n    }\n\n    .vendor-sig-cell {\n        width: 40%;\n        border-right: 1px solid #000; \n    }\n\n    .nirmaan-text-top {\n        font-size: 10pt;\n        text-align: center;\n        margin-top: 0;\n    }\n\n    .sig-container {\n        position: absolute; \n        bottom: 15px; \n        width: calc(100% - 30px); \n        left: 60px;\n        text-align: center;\n    }\n\n    .sig-line {\n        border-top: 1px solid #000;\n        width: 75%; /* Line width */\n        margin: 0 auto; \n    }\n\n    .sig-label {\n        padding-top: 5px;\n        font-weight: bold;\n        font-size: 9pt;\n    }\n\n    /* FOOTER (Pushed to bottom) */\n    .footer-address { \n        padding: 10px 0; \n        border-top: 2px solid #000; \n        font-size: 8pt; \n        text-align: center; \n        color: #666; \n        width: 100%;\n        margin-top: 0mm; /* Increased margin to push further down */\n    }\n    .footer-address span { font-weight: bold; color: #333; }\n\n    @page { \n        size:A4; \n        margin: 15mm 15mm 15mm 15mm; \n    }\n</style>\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Header / Footer\n   ────────────────────────────────────────────────────────────── #}\n<div id=\"header-html\" style=\"display:none;\">\n    <div class=\"header\">\n            <div class=\"header-top-row\">\n                {# LEFT SIDE: Company Name (The Payer) #}\n                <div class=\"company-info-left\">\n                    <img class=\"logo\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" alt=\"Nirmaan Logo\">\n                    <div class=\"\" style=\"color: #CC0008;\">Stratos Infra Technologies Pvt.Ltd</div>\n                </div>\n                \n                {# RIGHT SIDE: Logo #}\n                <div class=\"logo-right\">\n                   \n                    <!---->\n                </div>\n            </div>\n            \n            {# TITLE BLOCK (Clear float and center) #}\n            <div class=\"title\">PAYMENT VOUCHER</div>\n            <div class=\"subtitle\">Here is the payment voucher with details</div>\n        </div>\n</div>\n\n<div id=\"footer-html\" style=\"display:none;\">\n    <div class=\"footer-address\">\n        Regd. Office: <span>{{ nirmaan_company_details.name }}</span>, {{ n_reg_address }}<br>\n        <span>GSTN:</span> {{ n_gstin }} | <span>State:</span> {{ n_state_name }} | <span>Code:</span> {{ n_state_code }}\n    </div>\n</div>\n\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Main Content\n   ────────────────────────────────────────────────────────────── #}\n<div class=\"print-format\">\n    <div class=\"content-wrapper\">\n        \n       <div class=\"watermark\">PAID</div>\n        <table class=\"data-table\">\n            <tr>\n                <td class=\"data-label\">Payment ID</td>\n                <td class=\"data-value\">{{ doc.name or 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Vendor Name</td>\n                <td class=\"data-value\">{{ vendor_doc.vendor_name if vendor_doc else 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Project Name</td>\n                <td class=\"data-value\">{{ project_doc.project_name if project_doc else 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">{{ doc.document_type or 'Ref Doc Type' }} No.</td>\n                <td class=\"data-value\">{{ doc.document_name or 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Payment date</td>\n                <td class=\"data-value\">{{ frappe.utils.formatdate(doc.payment_date, \"dd-MMM-yyyy\") if doc.payment_date else 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Payment mode</td>\n                <td class=\"data-value\">\n                    {{ doc.mode_of_payment or 'Online' }}\n                </td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Paid Amount (INR)</td>\n                <td class=\"data-value\">{{ currency_symbol }} {{ \"%.2f\"|format(paid_amount) }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">UTR No.</td>\n                <td class=\"data-value\">{{ doc.utr or doc.reference_no or 'N/A' }}</td>\n            </tr>\n        </table>\n\n        <!--<div class=\"terms-heading\">Terms and Conditions</div>-->\n        <!--<ul class=\"terms-list\">-->\n        <!--    <li>Payment posting to your account is subject to credit settlement by your bank and will get the same posted within next 2-working days (maximum).</li>-->\n        <!--    <li>The above amount is inclusive of applicable taxes.</li>-->\n        <!--    <li>All claims subject to exclusive jurisdiction of courts as per registered office location.</li>-->\n        <!--</ul>-->\n\n        <table class=\"auth-table\">\n            <tr>\n                {# LEFT CELL: Vendor Signature/Seal (Header Left, Line/Label Centered Low) #}\n                <td class=\"vendor-sig-cell\">\n                    <span style=\"font-weight: bold;\">{{ vendor_doc.vendor_name if vendor_doc else 'N/A' }} (Received by)</span>\n                    \n                    <div class=\"sig-container\">\n                        <div class=\"sig-line\"></div>\n                        <div class=\"sig-label\">Vendor Signature</div>\n                    </div>\n                </td>\n                \n                {# RIGHT CELL: Nirmaan Authorised Signatory (Header Centered/Wrapped, Line/Label Centered Low) #}\n                <td class=\"nirmaan-sig-cell\">\n                    <span style=\"font-weight: bold;\">\n                        Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\n                    </span>\n                     <div class=\"seal-container\">\n                        <img class=\"company-seal\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/NIRMAAN-SEAL-D2HgrCMb.jpeg\" alt=\"Company Seal\">\n                    </div>\n                    \n                    <div class=\"sig-container\">\n                        <div class=\"sig-line\"></div>\n                        <div class=\"sig-label\">Authorised Signatory</div>\n                    </div>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    \n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-10-15 17:51:33.988658",
  "module": "Nirmaan Stack",
  "name": "SR Payment",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Project Progress Reports",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: Milestone Report (Production Ready)\n    Features:\n    - Fixed SVG Location Icon (Namespace corrected)\n    - Fixed GST Logic (Handles String vs Object)\n    - SORTED HEADERS by Order (Robust 0 handling)\n    - SORTED MILESTONES by work_milestone_order (Robust 0 handling + Whitespace Trim)\n    - WEIGHTED PROGRESS CALCULATION using milestone weightage\n    - Page Breaks for every major section\n    - Text-based Progress (No Circles)\n#}\n\n{# --- 1. FETCH DATA --- #}\n{%- set project_doc = frappe.get_doc(\"Projects\", doc.project) if doc.project else none -%}\n\n{# --- FETCH MANAGER (Nirmaan Users) --- #}\n{# We check if the document exists first to avoid errors #}\n{%- set owner_doc = frappe.get_doc(\"Nirmaan Users\", doc.owner) if (doc.owner and frappe.db.exists(\"Nirmaan Users\", doc.owner)) else none -%}\n\n{# Fetch Work Header Orders for Sorting #}\n{%- set header_list = frappe.get_all(\"Work Headers\", fields=[\"name\", \"order\"]) -%}\n{%- set header_order_map = {} -%}\n{%- for h in header_list -%}\n    {%- set h_order = h.order -%}\n    {%- if h_order is none -%}{%- set h_order = 999 -%}{%- endif -%}\n    {%- set _ = header_order_map.update({(h.name or \"\")|trim: h_order | int}) -%}\n{%- endfor -%}\n\n{# Fetch Work Milestone Orders and Weightage for Sorting and Weighted Progress #}\n{%- set milestone_list = frappe.get_all(\"Work Milestones\", fields=[\"work_milestone_name\", \"work_milestone_order\", \"work_header\", \"weightage\"]) -%}\n{%- set milestone_order_map = {} -%}\n{%- set milestone_weightage_map = {} -%}\n{%- for m in milestone_list -%}\n    {# Ensure Key matches the Usage fallback and trim spaces #}\n    {%- set h_key = (m.work_header or \"General\")|trim -%}\n    {%- set m_name = (m.work_milestone_name or \"\")|trim -%}\n    {%- set key = m_name ~ \"||\" ~ h_key -%}\n\n    {# Handle Order 0 correctly #}\n    {%- set m_order = m.work_milestone_order -%}\n    {%- if m_order is none -%}{%- set m_order = 9999 -%}{%- endif -%}\n    {%- set _ = milestone_order_map.update({key: m_order | int}) -%}\n\n    {# Handle Weightage - default to 1.0 if not set #}\n    {%- set m_weight = m.weightage -%}\n    {%- if m_weight is none -%}{%- set m_weight = 1.0 -%}{%- endif -%}\n    {%- set _ = milestone_weightage_map.update({key: m_weight | float}) -%}\n{%- endfor -%}\n\n{# --- 2. CONFIG: ADDRESS MAP --- #}\n{%- set nirmaan_gst_map = {\n    \"29ABFCS9095N1Z9\": {\"state\": \"Karnataka\", \"code\": \"29\", \"address\": \"First floor, 234, 9th Main, 16th Cross Rd, Sector 6, HSR Layout, Bengaluru, Karnataka 560102\"},\n    \"06ABFCS9095N1ZH\": {\"state\": \"Haryana\",   \"code\": \"06\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\"},\n    \"09ABFCS9095N1ZB\": {\"state\": \"Uttar Pradesh\", \"code\":\"09\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305\"}\n} -%}\n\n{# --- 3. LOGIC: ROBUST GST EXTRACTION --- #}\n{%- set default_gst = \"29ABFCS9095N1Z9\" -%}\n{%- set final_gst = default_gst -%}\n\n{%- if project_doc and project_doc.project_gst_number -%}\n    {%- set raw_gst = project_doc.project_gst_number -%}\n    {%- if raw_gst is string -%}\n        {%- set gst_data = json.loads(raw_gst) -%}\n    {%- else -%}\n        {%- set gst_data = raw_gst -%}\n    {%- endif -%}\n\n    {%- if gst_data and gst_data.list and gst_data.list|length > 0 -%}\n        {%- set extracted_gst = gst_data.list[0].gst -%}\n        {%- if extracted_gst in nirmaan_gst_map -%}\n            {%- set final_gst = extracted_gst -%}\n        {%- endif -%}\n    {%- endif -%}\n{%- endif -%}\n\n{%- set company_info = nirmaan_gst_map[final_gst] -%}\n\n{# --- 4. HEADER TOGGLE --- #}\n{%- set show_header = (frappe.form_dict.show_header != '0') -%}\n\n{# ==================== MACROS ==================== #}\n{% macro header_block() %}\n    <div class=\"nirmaan-header\">\n        <div class=\"brand-row\">\n            <img class=\"logo\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" alt=\"Nirmaan Logo\">\n        </div>\n        <div class=\"legal-name\">Nirmaan(Stratos Infra Technologies Pvt. Ltd.)</div>\n        <div class=\"address-line\">{{ company_info.address }}</div>\n        <div class=\"header-divider\"></div>\n    </div>\n{% endmacro %}\n\n<style>\n    /* GLOBAL SETTINGS */\n    body { font-family: \"Inter\", Helvetica, Arial, sans-serif; font-size: 11px; color: #1f2937; line-height: 1.35; margin: 0; padding: 0; }\n    @media print {\n        @page { size: A4; margin: 8mm; }\n        .page-break-before { page-break-before: always; }\n        .avoid-break { page-break-inside: avoid !important; }\n        * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }\n    }\n    .w-100 { width: 100%; } .text-right { text-align: right; } .text-center { text-align: center; } .text-left { text-align: left; }\n    .mb-5 { margin-bottom: 5px; } .mb-10 { margin-bottom: 10px; } .mb-15 { margin-bottom: 15px; } .mb-20 { margin-bottom: 20px; } .mt-10 { margin-top: 10px; }\n    .text-red { color: #dc2626; } .text-green { color: #16a34a; } .bg-gray-light { background-color: #f9fafb; }\n    .nirmaan-header { width: 100%; margin-bottom: 12px; }\n    .brand-row { margin-bottom: 4px; display: block; } .logo { height: 32px; vertical-align: middle; margin-right: 8px; }\n    .legal-name { font-size: 14px; font-weight: 800; color: #000; margin-bottom: 2px; }\n    .address-line { font-size: 10px; color: #6B7280; margin-bottom: 5px; }\n    .header-divider { border-bottom: 2px solid #000; width: 100%; margin-top: 5px; margin-bottom: 15px; }\n    .info-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; } .info-table td { padding: 3px 0; font-size: 11px; vertical-align: top; }\n    .section-title { font-size: 12px; font-weight: 800; color: #374151; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #e5e7eb; padding-bottom: 3px; }\n    .data-table { width: 100%; border-collapse: collapse; } .data-table th { background-color: #f9fafb; border: 1px solid #e5e7eb; padding: 6px 8px; font-size: 10px; font-weight: 700; text-transform: uppercase; color: #374151; } .data-table td { border: 1px solid #e5e7eb; padding: 6px 8px; vertical-align: middle; }\n    .group-header-box { background-color: #f9fafb; border: 1px solid #e5e7eb; border-radius: 4px; padding: 0; margin-top: 8px; height: 40px; overflow: hidden; }\n    .progress-table { width: 100%; height: 40px; border-collapse: collapse; } .progress-table td { vertical-align: middle; padding: 0; }\n    .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 9px; font-weight: 600; min-width: 60px; text-align: center; }\n    .bg-g { background-color: #d1fae5; color: #065f46; } .bg-y { background-color: #fffbeb; color: #d97706; } .bg-r { background-color: #fef2f2; color: #dc2626; } .bg-gy { background-color: #f3f4f6; color: #4b5563; }\n    .remarks-bubble { font-size: 9px; color: #d97706; background-color: #fffbeb; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 2px; border: 1px solid #fef3c7; }\n    .image-table { width: 100%; border-collapse: separate; border-spacing: 10px; } .image-cell { width: 50%; border: 1px solid #e5e7eb; background: #fff; vertical-align: top; padding: 0; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }\n    .image-container { height: 210px; width: 100%; background-color: #f3f4f6; text-align: center; overflow: hidden; line-height: 210px; } .image-actual { max-width: 100%; max-height: 100%; vertical-align: middle; }\n    .image-meta { padding: 10px; min-height: 60px; } .image-loc { margin-bottom: 5px; font-weight: 600; font-size: 10px; line-height: 1.3; color: #111; word-wrap: break-word; } .image-rem { padding: 5px; font-size: 9px; color: #854d0e; background-color: #fef9c3; border-radius: 4px; line-height: 1.3; word-wrap: break-word; }\n</style>\n\n<div class=\"main-container\">\n\n    {# ==================== PAGE 1: OVERVIEW & MANPOWER ==================== #}\n    <div>\n        {% if show_header %}{{ header_block() }}{% else %}<div style=\"height:20px;\"></div>{% endif %}\n        {% set zone_val = doc.report_zone or \"\" %}\n        {% if zone_val %}{% set zone_val =  zone_val  %}{% endif %}\n        <table class=\"info-table\">\n            <tr>\n                <td style=\"width:15%; font-weight:700;\">Project:</td>\n                <td style=\"width:40%;\">{{ project_doc.project_name }}</td>\n                <td style=\"width:15%; font-weight:700;\">Zone Name:</td>\n                <td style=\"width:40%;\">{{ zone_val }}</td>\n            </tr>\n            <tr>\n                <td style=\"width:15%; font-weight:700;\">Report Date:</td>\n                <td style=\"width:40%;\">{{ frappe.utils.formatdate(doc.report_date, \"dd-MMM-yyyy\") }}</td>\n                <td style=\"width:15%; font-weight:700;\">Start Date:</td>\n                <td style=\"width:30%;\">{{ frappe.utils.formatdate(project_doc.project_start_date, \"dd-MMM-yyyy\") if project_doc.project_start_date else \"--\" }}</td>\n            </tr>\n            <tr>\n                <td style=\"font-weight:700;\">Manager:</td>\n                <td>{{ owner_doc.full_name if owner_doc else doc.owner }}</td>\n\n            </tr>\n\n        </table>\n\n        {% set active_manpower = [] %}\n        {% for mp in doc.manpower %}\n            {% if (mp.count | float) > 0 %}{% set _ = active_manpower.append(mp) %}{% endif %}\n        {% endfor %}\n        {% if active_manpower %}\n            <div class=\"section-title\">MANPOWER</div>\n            <table class=\"data-table mb-15\" style=\"width: 100%;\">\n                {% for chunk in active_manpower | batch(2) %}\n                <tr>\n                    {% for mp in chunk %}\n                        <td class=\"bg-gray-light\" style=\"width:30%; font-weight:600;\">{{ mp.label }}</td>\n                        <td style=\"width:20%; font-weight:700; text-align:right;\">{{ mp.count }}</td>\n                    {% endfor %}\n                    {% if chunk|length == 1 %}<td colspan=\"2\" style=\"border:none;\"></td>{% endif %}\n                </tr>\n                {% endfor %}\n            </table>\n            {% if doc.manpower_remarks %}\n            <div class=\"mb-15\" style=\"background:#f9fafb; padding:8px; border:1px solid #e5e7eb; font-size:10px; color:#4b5563;\">\n                <strong style=\"color:#111;\">Remarks:</strong> {{ doc.manpower_remarks }}\n            </div>\n            {% endif %}\n        {% endif %}\n    </div>\n\n    {# ==================== PAGE 2: PLANNED WORK ==================== #}\n    {% set ns = namespace(wp_grouped={}) %}\n    {% for m in doc.milestones %}\n        {% set status = (m.status or \"\") | lower | trim %}\n        {% if status in [\"wip\", \"in progress\", \"not started\", \"todo\", \"on hold\", \"pending\"] %}\n            {% set raw_plan = m.work_plan or \"\" %}\n            {% set clean_raw = raw_plan.replace('$#,,,', '\\n') %}\n            {% set plan_lines = clean_raw.split('\\n') %}\n            {% set valid_parts = [] %}\n            {% for line in plan_lines %}{% if line and line|trim|length > 0 %}{% set _ = valid_parts.append(line|trim) %}{% endif %}{% endfor %}\n\n            {% if valid_parts %}\n                {% set h = (m.work_header or \"General\")|trim %}\n                {% if h not in ns.wp_grouped %}{% set _ = ns.wp_grouped.update({h: []}) %}{% endif %}\n                {% set m_key = (m.work_milestone_name or \"\")|trim ~ \"||\" ~ h %}\n                {% set m_order = milestone_order_map.get(m_key, 9999) %}\n                {% set _ = ns.wp_grouped[h].append({'name': m.work_milestone_name, 'status': m.status, 'lines': valid_parts, 'order': m_order}) %}\n            {% endif %}\n        {% endif %}\n    {% endfor %}\n\n    {% if ns.wp_grouped %}\n    <div class=\"page-break-before\">\n        {% if show_header %}{{ header_block() }}{% endif %}\n        <div class=\"section-title mt-10\">PLANNED WORK</div>\n\n        {% set sorted_plan_headers = [] %}\n        {% for h_name in ns.wp_grouped %}\n            {% set _ = sorted_plan_headers.append({'name': h_name, 'order': header_order_map.get(h_name, 9999)}) %}\n        {% endfor %}\n\n        {% for h_obj in sorted_plan_headers | sort(attribute='order') %}\n            {% set header = h_obj.name %}\n            <div class=\"avoid-break {% if not loop.last %}mb-15{% endif %}\">\n                <div class=\"group-header-box\">\n                    <table class=\"progress-table\">\n                        <tr>\n                            <td style=\"width: 10px; background-color: #dc2626; padding: 0;\"></td>\n                            <td class=\"text-left\" style=\"padding-left: 10px;\">\n                                <span style=\"font-weight:700; font-size:14px; color:#000;\">{{ header }} ({{ ns.wp_grouped[header]|length }})</span>\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n                {% for item in ns.wp_grouped[header] | sort(attribute='order') %}\n                <div class=\"mb-10\" style=\"padding-left:5px;\">\n                    <div style=\"margin-bottom:2px;\">\n                        <span style=\"font-weight:700; font-size:11px;\">{{ item.name }}</span>\n                        <span style=\"font-size:10px; color:#d97706; margin-left:4px;\">({{ item.status }})</span>\n                    </div>\n                    <ul style=\"margin:0; padding-left:18px; font-size:11px; color:#374151;\">\n                        {% for line in item.lines %}<li>{{ line }}</li>{% endfor %}\n                    </ul>\n                </div>\n                {% endfor %}\n            </div>\n        {% endfor %}\n    </div>\n    {% endif %}\n\n    {# ==================== PAGE 3: WORK PROGRESS ==================== #}\n    {% set prog_grouped = {} %}\n    {% for m in doc.milestones %}\n        {% if m.status and m.status != \"Not Applicable\" %}\n            {% set h = (m.work_header or \"General\")|trim %}\n            {% if h not in prog_grouped %}{% set _ = prog_grouped.update({h: []}) %}{% endif %}\n            {% set _ = prog_grouped[h].append(m) %}\n        {% endif %}\n    {% endfor %}\n\n    {% if prog_grouped %}\n    <div class=\"page-break-before\">\n        {% if show_header %}{{ header_block() }}{% endif %}\n        <div class=\"section-title mt-10\">WORK PROGRESS</div>\n\n        {% set sorted_prog_headers = [] %}\n        {% for h_name in prog_grouped %}\n            {% set _ = sorted_prog_headers.append({'name': h_name, 'order': header_order_map.get(h_name, 9999)}) %}\n        {% endfor %}\n\n        {% for h_obj in sorted_prog_headers | sort(attribute='order') %}\n            {% set header = h_obj.name %}\n            {% set group_ms = prog_grouped[header] %}\n\n            {# Calculate weighted overall progress #}\n            {% set prog_ns = namespace(sum_eff_weight=0, weighted_progress=0) %}\n            {% for m in group_ms %}\n                {% set m_name = (m.work_milestone_name or \"\")|trim %}\n                {% set h_name = (m.work_header or \"General\")|trim %}\n                {% set key = m_name ~ \"||\" ~ h_name %}\n                {% set weightage = milestone_weightage_map.get(key, 1.0) %}\n                {% set eff_weight = 0 if m.status == \"Not Applicable\" else weightage %}\n                {% set prog_ns.sum_eff_weight = prog_ns.sum_eff_weight + eff_weight %}\n            {% endfor %}\n\n            {% if prog_ns.sum_eff_weight > 0 %}\n                {% for m in group_ms %}\n                    {% set m_name = (m.work_milestone_name or \"\")|trim %}\n                    {% set h_name = (m.work_header or \"General\")|trim %}\n                    {% set key = m_name ~ \"||\" ~ h_name %}\n                    {% set weightage = milestone_weightage_map.get(key, 1.0) %}\n                    {% set eff_weight = 0 if m.status == \"Not Applicable\" else weightage %}\n                    {% set progress = m.progress | float %}\n                    {% set eff_progress = (eff_weight * 100 / prog_ns.sum_eff_weight) * (progress / 100) %}\n                    {% set prog_ns.weighted_progress = prog_ns.weighted_progress + eff_progress %}\n                {% endfor %}\n                {% set avg_p = prog_ns.weighted_progress | round | int %}\n            {% else %}\n                {% set avg_p = 0 %}\n            {% endif %}\n\n            {% set color_p = \"#dc2626\" %}\n            {% if avg_p == 100 %}{% set color_p = \"#16a34a\" %}{% elif avg_p >= 50 %}{% set color_p = \"#d97706\" %}{% endif %}\n\n            <div class=\"avoid-break {% if not loop.last %}mb-20{% endif %}\">\n                <div class=\"group-header-box\">\n                    <table class=\"progress-table\">\n                        <tr>\n                            <td style=\"width: 10px; background-color: #dc2626; padding: 0;\"></td>\n                            <td class=\"text-left\" style=\"padding-left: 10px;\">\n                                <span style=\"font-weight:700; font-size:14px; color:#000;\">{{ header }} ({{ group_ms|length }})</span>\n                            </td>\n                            <td class=\"text-right\" style=\"width: 170px; white-space: nowrap; padding-right: 10px;\">\n                                <span style=\"font-weight:700; font-size:11px; color:#000; text-transform:uppercase;\">Overall Progress:</span>\n                                <span style=\"font-weight:800; font-size:14px; color:{{ color_p }}; margin-left: 5px;\">{{ avg_p }}%</span>\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n\n                <table class=\"data-table\">\n                    <thead>\n                        <tr>\n                            <th class=\"text-left\" style=\"width:40%;\">Work</th>\n                            <th class=\"text-center\" style=\"width:20%;\">Status</th>\n                            <th class=\"text-center\" style=\"width:20%;\">Progress</th>\n                            <th class=\"text-center\" style=\"width:20%;\">Est. Date</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {% set sorted_group_ms = [] %}\n                        {% for m in group_ms %}\n                            {% set m_name = (m.work_milestone_name or \"\")|trim %}\n                            {% set h_name = (m.work_header or \"General\")|trim %}\n                            {% set key = m_name ~ \"||\" ~ h_name %}\n                            {% set m_order = milestone_order_map.get(key, 9999) %}\n                            {% set _ = sorted_group_ms.append({'data': m, 'order': m_order}) %}\n                        {% endfor %}\n\n                        {% for wrapper in sorted_group_ms | sort(attribute='order') %}\n                        {% set m = wrapper.data %}\n                        <tr>\n                            <td>\n                                <div style=\"font-weight:600; font-size:11px;\">{{ m.work_milestone_name }}</div>\n                                {% if m.remarks %}<div class=\"remarks-bubble\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-messages-square-icon lucide-messages-square\"><path d=\"M16 10a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 14.286V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\"/><path d=\"M20 9a2 2 0 0 1 2 2v10.286a.71.71 0 0 1-1.212.502l-2.202-2.202A2 2 0 0 0 17.172 19H10a2 2 0 0 1-2-2v-1\"/></svg> {{ m.remarks }}</div>{% endif %}\n                            </td>\n                            <td class=\"text-center\">\n                                {% set s_cls = \"bg-gy\" %}\n                                {% if m.status == \"Completed\" %}{% set s_cls = \"bg-g\" %}{% elif m.status == \"WIP\" %}{% set s_cls = \"bg-y\" %}{% elif m.status == \"Not Started\" %}{% set s_cls = \"bg-r\" %}{% endif %}\n                                <span class=\"badge {{ s_cls }}\">{{ m.status }}</span>\n                            </td>\n                            <td class=\"text-center\">\n                                {% set p_val = m.progress | int %}\n                                {% set p_col = \"#16a34a\" %}\n                                {% if p_val < 50 %}{% set p_col = \"#dc2626\" %}{% elif p_val < 90 %}{% set p_col = \"#d97706\" %}{% endif %}\n                                <span style=\"font-weight:700; color:{{ p_col }}; font-size:12px;\">{{ p_val }}%</span>\n                            </td>\n                            <td class=\"text-center text-sm\">\n                                {% if m.status == \"Not Started\" %}\n                                    <span class=\"text-red\">{{ frappe.utils.formatdate(m.expected_starting_date, \"dd-MMM-YYYY\") if m.expected_starting_date else \"-\" }}</span>\n                                {% else %}\n                                    <span class=\"text-green\">{{ frappe.utils.formatdate(m.expected_completion_date, \"dd-MMM-YYYY\") if m.expected_completion_date else \"-\" }}</span>\n                                {% endif %}\n                            </td>\n                        </tr>\n                        {% endfor %}\n                    </tbody>\n                </table>\n            </div>\n        {% endfor %}\n    </div>\n    {% endif %}\n\n    {# ==================== PAGE 4: SITE IMAGES ==================== #}\n    {% set attachment_list = doc.attachments or doc.photos or [] %}\n    {% if attachment_list %}\n    <div class=\"page-break-before\">\n        {% if show_header %}{{ header_block() }}{% endif %}\n        <div class=\"section-title mt-10\">WORK IMAGES</div>\n        <table class=\"image-table\">\n            {% for i in range(0, attachment_list|length, 2) %}\n            <tr>\n                {% for k in [i, i+1] %}\n                    {% if k < attachment_list|length %}\n                        {% set att = attachment_list[k] %}\n                        <td class=\"image-cell\">\n                            {% set img_url = frappe.call(\"nirmaan_stack.api.frappe_s3_attachment.get_s3_temp_url\", file_url=(att.file_url or att.image_link or att.image)) %}\n                            {% if img_url %}\n                            <div class=\"image-container\">\n                                <img src=\"{{ img_url }}\" class=\"image-actual\" alt=\"Site Photo\">\n                            </div>\n                            <div class=\"image-meta\">\n                                {% set loc_text = att.location_name or att.location or att.site_location or \"\" %}\n                                {% if loc_text %}\n                                    <div class=\"image-loc\">\n                                        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" fill=\"#dc2626\" style=\"vertical-align: middle; margin-right: 4px;\">\n                                          <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/>\n                                        </svg>\n                                        {{ loc_text }}\n                                    </div>\n                                {% else %}\n                                    <div style=\"color:#999;font-size:10px;\">Loc N/A</div>\n                                {% endif %}\n                                {% set rem_text = att.remarks or att.description or att.note or \"\" %}\n                                {% if rem_text %}\n                                    <div class=\"image-rem\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-messages-square-icon lucide-messages-square\"><path d=\"M16 10a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 14.286V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\"/><path d=\"M20 9a2 2 0 0 1 2 2v10.286a.71.71 0 0 1-1.212.502l-2.202-2.202A2 2 0 0 0 17.172 19H10a2 2 0 0 1-2-2v-1\"/></svg>\n                                        {{ rem_text }}</div>\n                                {% endif %}\n                            </div>\n                            {% else %}<div style=\"padding:40px; text-align:center; color:#999; font-size:10px;\">Img N/A</div>{% endif %}\n                        </td>\n                    {% else %}<td class=\"image-cell\" style=\"border:none; background:none; box-shadow:none;\"></td>{% endif %}\n                    {% if loop.first %}<td style=\"width:15px; border:none;\"></td>{% endif %}\n                {% endfor %}\n            </tr>\n            {% if i + 2 < attachment_list|length %}<tr><td colspan=\"3\" style=\"height:15px; border:none;\"></td></tr>{% endif %}\n            {% endfor %}\n        </table>\n    </div>\n    {% endif %}\n\n</div>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-12-22 21:51:37.355487",
  "module": "Nirmaan Stack",
  "name": "Milestone Report",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Project Design Tracker",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!-- \n    PRINT FORMAT: Nirmaan Custom Header + Wide Note Column\n    UPDATED: \n    1. Fixed \"NoneType\" Sort Error by handling empty deadlines safely.\n    2. Sorts tasks with deadlines first (ASC), then tasks without deadlines.\n-->\n\n<style>\n    /* 1. PDF PAGE SETTINGS */\n    @page {\n        size: A4;\n        margin: 10mm;\n        padding: 0;\n    }\n\n    /* 2. RESET & GLOBAL */\n    html, body, .print-format {\n        font-family: 'Inter', Helvetica, Arial, sans-serif;\n        font-size: 11px;\n        color: #1F2937;\n        line-height: 1.4;\n        background-color: #fff;\n        margin: 0;\n        padding: 0;\n    }\n\n    /* --- 3. CUSTOM HEADER STYLES --- */\n    .nirmaan-header {\n        width: 100%;\n        margin-bottom: 25px;\n    }\n    \n    .brand-row {\n        margin-bottom: 5px;\n        display: block; \n    }\n\n    .brand-logo-img {\n        height: 35px;\n        vertical-align: middle;\n        margin-right: 8px;\n    }\n\n    .brand-title {\n        color: #D1383E;\n        font-size: 28px;\n        font-weight: 700;\n        vertical-align: middle;\n        display: inline-block;\n    }\n\n    .legal-name {\n        font-size: 16px;\n        font-weight: 800;\n        color: #000;\n        margin-bottom: 4px;\n    }\n\n    .address-line {\n        font-size: 12px;\n        font-weight: 700;\n        color: #6B7280;\n        margin-bottom: 8px;\n    }\n\n    .header-divider {\n        border-bottom: 2px solid #000;\n        width: 100%;\n        margin-top: 5px;\n        margin-bottom: 20px;\n    }\n\n    /* --- 4. OVERVIEW TABLE --- */\n    .overview-table {\n        width: 100%;\n        border: 1px solid #E5E7EB;\n        border-radius: 8px;\n        border-spacing: 0;\n        margin-bottom: 25px;\n        table-layout: fixed;\n    }\n    \n    .overview-table td {\n        padding: 15px;\n        vertical-align: top;\n        border-right: 1px solid #F3F4F6;\n    }\n    .overview-table td:last-child { border-right: none; }\n\n    .overview-label {\n        font-size: 9px;\n        text-transform: uppercase;\n        color: #6B7280;\n        font-weight: 700;\n        margin-bottom: 5px;\n        letter-spacing: 0.5px;\n    }\n    \n    .overview-value {\n        font-size: 12px;\n        font-weight: 600;\n        color: #111827;\n        word-wrap: break-word;\n    }\n\n    /* --- 5. HEADINGS & PAGE BREAK LOGIC --- */\n    .main-section-title {\n        font-size: 16px;\n        font-weight: 700;\n        margin-top: 0;\n        margin-bottom: 15px;\n        color: #111827;\n        border-bottom: 2px solid #eee;\n        padding-bottom: 5px;\n    }\n\n    /* \n       UPDATED: WRAPPER FOR GROUPING \n       Removed 'page-break-inside: avoid' so long tables can flow to next page.\n    */\n    .category-block {\n        display: block;\n        margin-bottom: 20px;\n    }\n\n    /* \n       HEADER STYLE (Gray Box + Red Bar)\n       Kept 'page-break-after: avoid' so header glues to the first row.\n    */\n    .category-header {\n        background-color: #F9FAFB;      \n        border: 1px solid #E5E7EB;      \n        border-left: 6px solid #D1383E; \n        padding: 10px 15px;             \n        \n        font-size: 13px;\n        font-weight: 700;\n        color: #111827;\n        \n        margin-bottom: 0; \n        border-bottom: none; \n        border-top-left-radius: 4px;\n        border-top-right-radius: 4px;\n        \n        page-break-after: avoid; /* Keeps header attached to first row */\n        break-after: avoid;\n    }\n\n    /* --- 6. DATA TABLES --- */\n    .custom-table {\n        width: 100%;\n        border-collapse: separate; \n        border-spacing: 0;\n        border: 1px solid #E5E7EB;\n        table-layout: fixed;\n        \n        margin-top: 0;\n        border-top: 1px solid #E5E7EB; \n        \n        border-bottom-left-radius: 4px;\n        border-bottom-right-radius: 4px;\n    }\n\n    .custom-table th {\n        background-color: #fff; \n        color: #4B5563;\n        font-size: 9px;\n        font-weight: 700;\n        text-transform: uppercase;\n        text-align: left;\n        padding: 8px 6px;\n        border-bottom: 1px solid #E5E7EB;\n        border-right: 1px solid #F3F4F6;\n    }\n    .custom-table th:last-child { border-right: none; }\n    \n    thead { display: table-header-group; }\n\n    .custom-table td {\n        padding: 8px 6px;\n        border-bottom: 1px solid #F3F4F6;\n        border-right: 1px solid #F3F4F6;\n        vertical-align: top; \n        font-size: 10px;\n        word-wrap: break-word; \n    }\n    .custom-table td:last-child { border-right: none; }\n    \n    .custom-table tr:last-child td { border-bottom: none; }\n    \n    /* \n       Keeps content within a single row together, \n       but allows the table to break between rows. \n    */\n    tr { \n        page-break-inside: avoid; \n        break-inside: avoid; \n    }\n\n    /* --- 7. BADGES & UTILS --- */\n    .badge {\n        display: block;\n        width: 100%;\n        box-sizing: border-box;\n        padding: 4px 2px;\n        border-radius: 12px;\n        font-size: 8px;\n        font-weight: 600;\n        text-align: center;\n        white-space: normal; \n        line-height: 1.1;\n        border: 1px solid transparent;\n    }\n    \n    .badge-progress { background-color: #DBEAFE; color: #1E40AF; border-color: #93C5FD; }\n    .badge-completed { background-color: #D1FAE5; color: #065F46; border-color: #6EE7B7; }\n    .badge-hold { background-color: #FEF3C7; color: #92400E; border-color: #FCD34D; }\n    .badge-na { background-color: #F3F4F6; color: #4B5563; border-color: #D1D5DB; }\n    \n    .badge-sub { background-color: #F9FAFB; color: #6B7280; border: 1px solid #E5E7EB; }\n    .badge-sub-red { background-color: #FEF2F2; color: #991B1B; border: 1px solid #FECACA; }\n\n    .designer-list { margin: 0; padding-left: 10px; }\n    .designer-list li { margin-bottom: 3px; font-size: 9px; }\n\n    .text-link { color: #2563EB; text-decoration: none; font-weight: 600; font-size: 9px; }\n    \n    .note-text {\n        font-size: 10px;\n        color: #374151;\n        line-height: 1.35;\n        word-break: break-word; \n        white-space: pre-wrap;\n    }\n</style>\n\n<div class=\"print-format\">\n\n    <!-- HEADER -->\n    <div class=\"nirmaan-header\">\n        <div class=\"brand-row\">\n            <img class=\"logo\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" alt=\"Nirmaan Logo\">\n        </div>\n        <div class=\"legal-name\">\n            Nirmaan(Stratos Infra Technologies Pvt. Ltd.)\n        </div>\n        <div class=\"address-line\">\n            First floor, 234, 9th Main, 16th Cross Rd, Sector 6, HSR Layout, Bengaluru, Karnataka 560102\n        </div>\n        <div class=\"header-divider\"></div>\n    </div>\n\n    <!-- OVERVIEW -->\n    <h3 class=\"main-section-title\">Project Overview</h3>\n    <table class=\"overview-table\">\n        <tr>\n            <td style=\"width: 25%;\">\n                <div class=\"overview-label\">Project Name</div>\n                <div class=\"overview-value\">{{ doc.project_name }}</div>\n            </td>\n            <td style=\"width: 15%;\">\n                <div class=\"overview-label\">Created On</div>\n                <div class=\"overview-value\">{{ frappe.utils.formatdate(doc.creation, \"dd-MM-yyyy\") }}</div>\n            </td>\n            <td style=\"width: 20%;\">\n                <div class=\"overview-label\">Status</div>\n                <div class=\"overview-value\">\n                    <span style=\"background: #FEF2F2; color: #991B1B; border: 1px solid #FECACA; padding: 2px 8px; border-radius: 10px; font-size: 10px;\">{{ doc.status }}</span>\n                </div>\n            </td>\n            <td style=\"width: 20%;\">\n                <div class=\"overview-label\">Deadline</div>\n                <div class=\"overview-value\">{{ frappe.utils.formatdate(doc.overall_deadline, \"dd-MM-yyyy\") if doc.overall_deadline else \"-\" }}</div>\n            </td>\n        </tr>\n    </table>\n\n    <!-- TASKS -->\n    <h3 class=\"main-section-title\">On-Boarding</h3>\n\n    {% if doc.design_tracker_task %}\n\n        {# --- FILTER: Exclude 'Not Applicable' tasks --- #}\n        {% set valid_tasks = [] %}\n        {% for t in doc.design_tracker_task %}\n            {% if t.task_status != \"Not Applicable\" %}\n                {% set _ = valid_tasks.append(t) %}\n            {% endif %}\n        {% endfor %}\n        \n        {% if valid_tasks|length > 0 %}\n            \n            {# --- Use the filtered 'valid_tasks' list for grouping --- #}\n            {% set grouped_tasks = valid_tasks | sort(attribute='design_category') | groupby('design_category') %}\n\n            {% for category, tasks in grouped_tasks %}\n                \n                <div class=\"category-block\">\n                    \n                    <div class=\"category-header\">\n                        {{ category or \"Uncategorized\" }} ({{ tasks | length }})\n                    </div>\n\n                    <table class=\"custom-table\">\n                        <thead>\n                            <tr>\n                                <th style=\"width: 16%;\">Task Name</th>\n                                <th style=\"width: 16%;\">Assigned Designer</th>\n                                <th style=\"width: 12%;\">Deadline</th>\n                                <th style=\"width: 11%;\">Status</th>\n                                <th style=\"width: 13%;\">Sub-Status</th>\n                                <th style=\"width: 22%;\">Note</th>\n                                <th style=\"width: 8%; text-align:center;\">Link</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <!-- \n                                SORTING LOGIC FIXED:\n                                1. Separate tasks with deadlines and without deadlines.\n                                2. Sort the ones with deadlines.\n                                3. Combine them (Deadlines first, No Deadlines last).\n                            -->\n                            {% set tasks_with_date = [] %}\n                            {% set tasks_no_date = [] %}\n                            \n                            {% for t in tasks %}\n                                {% if t.deadline %}\n                                    {% set _ = tasks_with_date.append(t) %}\n                                {% else %}\n                                    {% set _ = tasks_no_date.append(t) %}\n                                {% endif %}\n                            {% endfor %}\n                            \n                            <!-- Combine: Sorted Dates + No Dates -->\n                            {% set sorted_tasks = (tasks_with_date | sort(attribute='deadline')) + tasks_no_date %}\n\n                            {% for row in sorted_tasks %}\n                            <tr>\n                                <!-- Task Name -->\n                                <td style=\"font-weight: 600; color: #111;\">{{ row.task_name }}</td>\n\n                                <!-- Designer Logic -->\n                                <td>\n                                    {% if row.assigned_designers %}\n                                        {% set raw_data = row.assigned_designers %}\n                                        {% set final_list = [] %}\n                                        {% if raw_data is string and (raw_data.startswith('{') or raw_data.startswith('[')) %}\n                                            {% set raw_data = frappe.parse_json(raw_data) %}\n                                        {% endif %}\n                                        {% if raw_data is mapping and raw_data.list %}\n                                            {% set final_list = raw_data.list %}\n                                        {% elif raw_data is iterable and raw_data is not string and raw_data is not mapping %}\n                                            {% set final_list = raw_data %}\n                                        {% endif %}\n\n                                        {% if final_list|length > 0 %}\n                                            <ul class=\"designer-list\">\n                                            {% for item in final_list %}\n                                                <li>{{ item.userName or item.name or item }}</li>\n                                            {% endfor %}\n                                            </ul>\n                                        {% else %}\n                                            <span class=\"text-muted\">-</span>\n                                        {% endif %}\n                                    {% else %}\n                                        <span class=\"text-muted\">-</span>\n                                    {% endif %}\n                                </td>\n\n                                <!-- Deadline -->\n                                <td>{{ frappe.utils.formatdate(row.deadline, \"dd-MM-yyyy\") if row.deadline else \"-\" }}</td>\n\n                                <!-- Status -->\n                                <td style=\"vertical-align: middle;\">\n                                    {% set status_class = \"badge-na\" %}\n                                    {% set s = row.task_status %}\n                                    {% if s == \"Completed\" %} {% set status_class = \"badge-completed\" %}\n                                    {% elif s == \"In Progress\" %} {% set status_class = \"badge-progress\" %}\n                                    {% elif s == \"On Hold\" %} {% set status_class = \"badge-hold\" %}\n                                    {% endif %}\n                                    <span class=\"badge {{ status_class }}\">{{ row.task_status or \"N/A\" }}</span>\n                                </td>\n\n                                <!-- Sub-Status -->\n                                <td style=\"vertical-align: middle;\">\n                                    {% if row.task_sub_status %}\n                                        {% set sub_class = \"badge-sub\" %}\n                                        {% if \"Clarification\" in row.task_sub_status or \"Issue\" in row.task_sub_status %}\n                                            {% set sub_class = \"badge-sub-red\" %}\n                                        {% endif %}\n                                        <span class=\"badge {{ sub_class }}\">{{ row.task_sub_status }}</span>\n                                    {% else %}\n                                        <span class=\"badge badge-sub\">...</span>\n                                    {% endif %}\n                                </td>\n\n                                <!-- Note -->\n                                <td>\n                                    {% if row.comments and row.comments|trim != \"\" %}\n                                        <div class=\"note-text\">{{ row.comments }}</div>\n                                    {% else %}\n                                        <span style=\"color:#999;\">-</span>\n                                    {% endif %}\n                                </td>\n\n                                <!-- Link -->\n                                <td style=\"text-align: center; vertical-align: middle;\">\n                                    {% if row.file_link and row.file_link|trim != \"\" %}\n                                        <a href=\"{{ row.file_link }}\" target=\"_blank\" class=\"text-link\">View</a>\n                                    {% else %}\n                                        <span style=\"color:#999;\">-</span>\n                                    {% endif %}\n                                </td>\n                            </tr>\n                            {% endfor %}\n                        </tbody>\n                    </table>\n                </div>\n\n            {% endfor %}\n        \n        {% else %}\n            <p style=\"text-align: center; color: #777;\">No active tasks found (All tasks are Not Applicable).</p>\n        {% endif %}\n        \n    {% else %}\n        <p style=\"text-align: center; color: #777;\">No tasks found.</p>\n    {% endif %}\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-12-17 19:40:27.962392",
  "module": "Nirmaan Stack",
  "name": "Project Design Tracker",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 }
]