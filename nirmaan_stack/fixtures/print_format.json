[
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 0,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": null,
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-02-19 13:15:13.143402",
  "module": "Nirmaan Stack",
  "name": "Test Format",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 0,
  "default_print_language": null,
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": "{\"header\":\"<div class=\\\"document-header\\\">\\n\\t<h3>Procurement Orders</h3>\\n\\t<p>{{ doc.name }}</p>\\n</div>\",\"sections\":[{\"label\":\"Links\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Project\",\"fieldname\":\"project\",\"fieldtype\":\"Link\",\"options\":\"Projects\"},{\"label\":\"Vendor\",\"fieldname\":\"vendor\",\"fieldtype\":\"Link\",\"options\":\"Vendors\"},{\"label\":\"Procurement Request\",\"fieldname\":\"procurement_request\",\"fieldtype\":\"Link\",\"options\":\"Procurement Requests\"},{\"label\":\"Category\",\"fieldname\":\"category\",\"fieldtype\":\"Link\",\"options\":\"Category\"},{\"label\":\"Merged\",\"fieldname\":\"merged\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true},{\"label\":\"Procurement Order Details\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Attachment\",\"fieldname\":\"attachment\",\"fieldtype\":\"Data\"},{\"label\":\"Project Name\",\"fieldname\":\"project_name\",\"fieldtype\":\"Data\"},{\"label\":\"Project Address\",\"fieldname\":\"project_address\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor Name\",\"fieldname\":\"vendor_name\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor Address\",\"fieldname\":\"vendor_address\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor GST\",\"fieldname\":\"vendor_gst\",\"fieldtype\":\"Data\"},{\"label\":\"Order List\",\"fieldname\":\"order_list\",\"fieldtype\":\"JSON\"},{\"label\":\"Category List\",\"fieldname\":\"category_list\",\"fieldtype\":\"JSON\",\"options\":\"Category\"}]}],\"has_fields\":true},{\"label\":\"Payment Details \",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Advance\",\"fieldname\":\"advance\",\"fieldtype\":\"Data\"},{\"label\":\"Loading Charges\",\"fieldname\":\"loading_charges\",\"fieldtype\":\"Data\"},{\"label\":\"Freight Charges\",\"fieldname\":\"freight_charges\",\"fieldtype\":\"Data\"},{\"label\":\"Notes\",\"fieldname\":\"notes\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true},{\"label\":\"Tracking Details\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Status\",\"fieldname\":\"status\",\"fieldtype\":\"Data\"},{\"label\":\"Delivery Contact\",\"fieldname\":\"delivery_contact\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true}]}",
  "html": null,
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-02-19 13:15:41.095080",
  "module": "Nirmaan Stack",
  "name": "Test 2",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 1,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: PO Nirmaan (Final - Fixed Layout & Human Numbers)\n    DocType: Procurement Order\n#}\n\n{# --- Company Details --- #}\n{%- set company_details = {\n    \"name\": \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"logo_url\": \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\",\n    \"nirmaan_seal\": \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/NIRMAAN-SEAL-D2HgrCMb.jpeg\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": \"Bengaluru\",\n        \"06ABFCS9095N1ZH\": \"Gurugram\",\n        \"09ABFCS9095N1ZB\": \"Noida\"\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park Cowarking Space, Mehrauli Gurugram Rd, Tower D, Sikanderpur, Gurugram, Haryana - 122002\",\n        \"09ABFCS9095N1ZB\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305\"\n    },\n    \"default_address\": \"Company address details missing or project GST not set.\"\n} -%}\n\n{# Determine current company address and GST #}\n{%- set current_company_gst = doc.project_gst if doc.project_gst in company_details.gst_numbers else None -%}\n{%- set current_company_address = company_details.addresses[current_company_gst] if current_company_gst else company_details.default_address -%}\n{%- set currency_symbol = \"₹\" -%}\n\n{# ----------- Macro: Address Formatter --------------------- #}\n{% macro format_address(addr_name) -%}\n    {%- if not addr_name -%}N/A\n    {%- else -%}\n        {%- set ad = frappe.get_doc(\"Address\", addr_name) -%}\n        {%- set parts = [] -%}\n        {%- if ad.address_line1 %}{% set parts = parts + [ad.address_line1] %}{% endif -%}\n        {%- if ad.address_line2 %}{% set parts = parts + [ad.address_line2] %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if ad.city %}{% set csp = csp + [ad.city] %}{% endif -%}\n        {%- if ad.state %}{% set csp = csp + [ad.state] %}{% endif -%}\n        {%- if ad.pincode %}{% set csp = csp + [ad.pincode] %}{% endif -%}\n        {%- if csp %}{% set parts = parts + [csp | join(\" \")] %}{% endif -%}\n        {%- if ad.country %}{% set parts = parts + [ad.country] %}{% endif -%}\n        {{ parts | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{# ----------- Macro: Render Header --------------------- #}\n{% macro render_header() -%}\n  <table style=\"width:100%; font-family:Helvetica,Arial,sans-serif; font-size:9.5px; border-bottom: 4px solid #000; padding-bottom: 8px; margin-bottom: 15px;\">\n    <tr>\n      <td style=\"width:40%; vertical-align:top;\">\n        <img src=\"{{ company_details.logo_url }}\" style=\"max-width:140px; max-height:38px\">\n      </td>\n      <td style=\"text-align:right; font-size:11px; vertical-align:top;\">\n        <strong>{{ company_details.name }}</strong><br>\n        {{ current_company_address }}<br>\n        {% if current_company_gst %}<strong>GSTIN:</strong> {{ current_company_gst }}{% endif %}\n      </td>\n    </tr>\n  </table>\n{%- endmacro %}\n\n{%- set project_doc = frappe.get_doc(\"Projects\", doc.project) if doc.project else None -%}\n{%- set vendor_doc = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n\n{# ----------- Pre-rendered HTML blocks ----------------------- #}\n{% set vendor_address_html  = format_address(vendor_doc.vendor_address) if vendor_doc else \"N/A\" %}\n{% set project_address_html = format_address(project_doc.project_address) if project_doc else \"N/A\" %}\n\n<style>\n    body { font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif; font-size: 10px; color: #333; margin: 0; padding: 0; }\n    \n    @page {\n        size: A4;\n        margin: 10mm 12mm 15mm 12mm;\n    }\n    \n    /* HEADER STYLES */\n    .header img.logo { max-width: 140px; max-height: 40px; margin-bottom: 8px; float: left; }\n    \n    /* New Styles for Top Section Layout */\n    .po-header-wrapper {\n        width: 100%;\n        overflow: hidden;\n        /* [FIX 1] Added Border Bottom */\n        border-bottom: 2px solid #333; \n        padding-bottom: 10px;\n        margin-bottom: 15px;\n        margin-top: 10px;\n    }\n    \n    .po-header-left-title {\n        float: left;\n        width: 50%;\n        font-size: 22px; \n        font-weight: bold; \n        color: #1a1a1a; \n        text-transform: uppercase;\n        padding-top: 5px; \n    }\n    \n    .po-header-right-details {\n        float: right;\n        width: 49%;\n        text-align: right;\n    }\n\n    .po-header-right-details p {\n        margin: 2px 0;\n        line-height: 1.4;\n        font-size: 10px;\n    }\n    \n    /* INFO BLOCKS */\n    .address-block { margin-bottom:15px; overflow:hidden; }\n    .address-block__col { width:48%; float:left; font-size:9.5px; }\n    .address-block__col + .address-block__col { float:right; }\n    .address-block h4 { font-size: 10px; font-weight: bold; text-transform: uppercase; color: #555; margin: 0 0 6px 0; }\n\n    /* ITEMS TABLE */\n    .items-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }\n    .items-table th, .items-table td { border: 1px solid #ddd; padding: 5px 7px; text-align: left; }\n    .items-table th { background-color: #f0f0f0; font-weight: bold; font-size: 9.5px; text-transform: uppercase; }\n    .items-table td { font-size: 9.5px; }\n    .text-right { text-align: right; } .text-center { text-align: center; }\n\n    /* TOTALS SECTION */\n    .totals-section { width: 100%; margin-top: 15px; overflow: hidden; }\n    .totals-section .notes-terms { width: 58%; float: left; font-size: 9.5px; }\n    .totals-section .summary { width: 40%; float: right; }\n    .totals-section .summary table { width: 100%; font-size: 9.5px; }\n    .totals-section .summary td { padding: 3px 0; }\n    .totals-section .summary .grand-total td {\n        font-weight: bold; font-size: 11px; border-top: 1px solid #333; border-bottom: 1px solid #333;\n        padding-top: 6px; padding-bottom: 6px;\n    }\n\n    /* TERMS AND CONDITIONS STYLES */\n    .tc-container { page-break-before: always; width: 100%; }\n    \n    .tc-header-gst-row { \n        border-bottom: 1px solid #666; \n        padding-bottom: 5px; \n        margin-bottom: 20px; \n        font-size: 10px; \n        overflow: hidden; \n    }\n    \n    .tc-content { padding: 0 5px; }\n\n    .tc-content h1 { \n        font-size: 16px; \n        font-weight: bold; \n        text-transform: uppercase; \n        margin-top: 20px; \n        margin-bottom: 15px; \n        text-align: center; \n        text-decoration: underline;\n    }\n    \n    .tc-content h2 { \n        font-size: 12px;\n        font-weight: bold; \n        margin-top: 20px; \n        margin-bottom: 10px; \n        color: #222; \n        text-transform: uppercase;\n    }\n    \n    .tc-content ol { \n        padding-left: 25px; \n        margin: 0; \n    }\n    \n    .tc-content li { \n        font-size: 11.5px; \n        line-height: 1.6;  \n        margin-bottom: 8px; \n        text-align: justify; \n        color: #333;\n    }\n\n    /* ATTACHMENT DISPLAY */\n    .section-title { font-size: 11px; font-weight: 800; color: #374151; margin-bottom: 5px; text-transform: uppercase; border-bottom: 1px solid #e5e7eb; padding-bottom: 3px; margin-top: 20px; }\n    .converted-image-container { text-align: center; margin-top: 0px; page-break-inside: avoid; }\n    .converted-image-container img { max-width: 100%;display: block; margin: 0 auto; }\n\n    /* FOOTER */\n    .footer-notes { margin-top: 25px; font-size: 8.5px; color: #777; border-top: 1px dashed #ccc; padding-top: 8px; text-align: center; }\n    \n    /* SIGNATURE AREA UPDATED */\n    .signature-area { margin-top: 40px; text-align: right; }\n    .signature-area img.seal { max-width: 90px; max-height: 90px; display: block; margin-left: auto; margin-bottom: 5px; }\n    .signature-area .line { width: 180px; border-top: 1px solid #333; margin-left: auto; margin-bottom: 5px; }\n    .signature-area p { font-size: 9.5px; margin:0; }\n    \n    \n</style>\n\n<div class=\"print-format\">\n\n    {# --- HEADER FOR PAGE 1 --- #}\n    {{ render_header() }}\n\n    {# --- PAGE 1: PO DETAILS --- #}\n    <div class=\"po-header-wrapper\">\n        <div class=\"po-header-left-title\">Purchase Order</div>\n        <div class=\"po-header-right-details\">\n            <p><strong>PO Number:</strong> {{ doc.name }}</p>\n            <p><strong>PO Date:</strong> {{ frappe.utils.formatdate(doc.creation, \"dd-MM-yyyy\") }}</p>\n        </div>\n    </div>\n\n    <div class=\"address-block\">\n        <div class=\"address-block__col\">\n            <h4>VENDOR DETAILS</h4>\n            <p><strong>{{ vendor_doc.vendor_name if vendor_doc else doc.vendor }}</strong></p>\n            {{ vendor_address_html }}\n            {% if vendor_doc and vendor_doc.vendor_gst %}<p><strong>GSTIN:</strong> {{ vendor_doc.vendor_gst }}</p>{% endif %}\n        </div>\n        <div class=\"address-block__col\">\n            <h4>SHIP-TO / PROJECT DETAILS</h4>\n            <p><strong>{{ project_doc.project_name if project_doc else doc.project }}</strong></p>\n            {{ project_address_html }}\n            {% if doc.delivery_contact %}<p><strong>Site Contact:</strong> {{ doc.delivery_contact }}</p>{% endif %}\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n\n    {# --- ITEMS TABLE --- #}\n    <table class=\"items-table\">\n        <thead>\n            <tr>\n                <th style=\"width:5%;\">Sr.</th>\n                <th style=\"width:35%;\">Item Description</th>\n                <th style=\"width:10%;\" class=\"text-center\">Make</th>\n                <th style=\"width:8%;\" class=\"text-center\">Qty</th>\n                <th style=\"width:8%;\" class=\"text-center\">Unit</th>\n                <th style=\"width:12%;\" class=\"text-right\">Rate</th>\n                <th style=\"width:10%;\" class=\"text-right\">Tax %</th>\n                <th style=\"width:12%;\" class=\"text-right\">Amount</th>\n            </tr>\n        </thead>\n        <tbody>\n            {% set total_qty = namespace(value=0.0) %}\n            {% set subtotal = namespace(value=0.0) %}\n            {% set total_tax_amount_on_items = namespace(value=0.0) %}\n\n            {% if doc.items and doc.items | length > 0 %}\n                {% for item in doc.items %}\n                    <tr>\n                        <td class=\"text-center\">{{ loop.index }}</td>\n                        <td>\n                            {{ item.item or item.item_name }}\n                            {% if item.comment %}<br><small><em>Note: {{ item.comment }}</em></small>{% endif %}\n                        </td>\n                        <td class=\"text-center\">{{ item.make or \"-\" }}</td>\n                        {%- set current_item_quantity = (item.quantity | default(0) | float) -%}\n                        <td class=\"text-center\">{{ current_item_quantity | round(2) }}</td>\n                        <td class=\"text-center\">{{ item.unit or \"N/A\" }}</td>\n                        \n                        {%- set current_item_quote = (item.quote | default(0) | float) -%}\n                        \n                        {# [FIX 2] Human Readable Rate (Commas) #}\n                        <td class=\"text-right\">{{ frappe.utils.fmt_money(current_item_quote, precision=2) }}</td>\n                        \n                        {%- set current_item_tax_percent = (item.tax | default(0) | float) -%}\n                        <td class=\"text-right\">{{ current_item_tax_percent }}%</td>\n\n                        {%- set item_base_amount = current_item_quantity * current_item_quote -%}\n                        {%- set current_item_tax_amount = item_base_amount * current_item_tax_percent / 100.0 -%}\n                        \n                        {# [FIX 2] Human Readable Amount (Commas) #}\n                        <td class=\"text-right\">{{ frappe.utils.fmt_money(item_base_amount, precision=2) }}</td>\n\n                        {%- set total_qty.value = total_qty.value + current_item_quantity -%}\n                        {%- set subtotal.value = subtotal.value + item_base_amount -%}\n                        {%- set total_tax_amount_on_items.value = total_tax_amount_on_items.value + current_item_tax_amount -%}\n                    </tr>\n                {% endfor %}\n            {% else %}\n                <tr><td colspan=\"8\" style=\"text-align:center; padding: 20px;\">No items found.</td></tr>\n            {% endif %}\n        </tbody>\n    </table>\n    \n    {# --- TOTALS --- #}\n    <div class=\"totals-section\">\n        {% set freight_val = doc.freight_charges | default(0) | float %}\n        {% set loading_val = doc.loading_charges | default(0) | float %}\n        {% set exact_grand_total = subtotal.value + total_tax_amount_on_items.value + freight_val + loading_val %}\n        {% set rounded_grand_total = exact_grand_total | round | int %}\n        {% set round_off_val = rounded_grand_total - exact_grand_total %}\n\n        <div class=\"notes-terms\">\n            <p><strong>Total Quantity:</strong> {{ (total_qty.value | float) | round(2) }}</p>\n            <br>\n            <p><strong>Amount in Words:</strong><br>\n                {{ frappe.utils.money_in_words(rounded_grand_total, \"INR\") }}\n            </p>\n            {% if doc.notes %}\n            <div style=\"margin-top:10px;\">\n                <h4 style=\"font-size:10px; font-weight:bold; margin-bottom:3px;\">NOTES & TERMS:</h4>\n                <div style=\"font-size:9px; white-space: pre-wrap;\">{{ doc.notes }}</div>\n            </div>\n            {% endif %}\n        </div>\n\n        <div class=\"summary\">\n            <table>\n                {# [FIX 2] Human Readable Totals (Commas) #}\n                <tr><td>Sub-Total:</td><td class=\"text-right\">{{ currency_symbol }} {{ frappe.utils.fmt_money(subtotal.value, precision=2) }}</td></tr>\n                <tr><td>Total Tax(GST):</td><td class=\"text-right\">{{ currency_symbol }} {{ frappe.utils.fmt_money(total_tax_amount_on_items.value, precision=2) }}</td></tr>\n                \n                <tr><td>Round Off:</td><td class=\"text-right\">{{ currency_symbol }} {{ frappe.utils.fmt_money(round_off_val, precision=2) }}</td></tr>\n                \n                <tr class=\"grand-total\"><td>GRAND TOTAL:</td><td class=\"text-right\">{{ currency_symbol }} {{ frappe.utils.fmt_money(rounded_grand_total, precision=0) }}</td></tr>\n            </table>\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n    \n    {# --- PAYMENT TERMS SECTION --- #}\n    {% if doc.payment_terms %}\n        <div style=\"margin-top: 20px; font-size: 9.5px; border-top: 1px dashed #ccc; padding-top: 8px;\">\n            <span style=\"font-weight: bold; color: #555;\">PAYMENT:</span>\n            <div style=\"margin-top: 3px; line-height: 1.4;\">\n                {% set p_terms = [] %}\n                {% for term in doc.payment_terms %}\n                    {% if (term.percentage | default(0) | float) > 0 %}\n                        {% set p_text = \"%.2f\"|format(term.percentage|float) ~ \"% -- \" ~ (term.label or term.payment_term) %}\n                        {% set _ = p_terms.append(p_text) %}\n                    {% endif %}\n                {% endfor %}\n                {{ p_terms | join(\", \") }}\n            </div>\n        </div>\n    {% endif %}\n    \n    {# --- SIGNATURE AREA WITH SEAL --- #}\n    <div class=\"signature-area\">\n        {% if company_details.nirmaan_seal %}\n            <img src=\"{{ company_details.nirmaan_seal }}\" class=\"seal\" alt=\"Seal\">\n        {% endif %}\n        <div class=\"line\"></div>\n        <p>For <strong>{{ company_details.name }}</strong></p>\n        <p>(Authorized Signatory)</p>\n    </div>\n\n    {# ========================================================================= #}\n    {# ================= TERMS AND CONDITIONS PAGE (NEW PAGE) ================== #}\n    {# ========================================================================= #}\n    <div class=\"tc-container\">\n        \n        {# --- HEADER FOR T&C PAGE 1 --- #}\n        {{ render_header() }}\n        \n        <div class=\"tc-content\">\n            <h1>Terms and Conditions</h1>\n\n            <h2>1. Invoicing:</h2>\n            <ol>\n                <li>All invoices shall be submitted in original and shall be tax invoices showing the breakup of tax structure/value payable at the prevailing rate and a clear description of goods.</li>\n                <li>All invoices submitted shall have Delivery Challan/E-waybill for supply items.</li>\n                <li>All Invoices shall have the tax registration numbers mentioned thereon. The invoices shall be raised in the name of \"Stratos Infra Technologies Pvt Ltd, Bangalore\".</li>\n                <li>Payments shall be only entertained after receipt of the correct invoice.</li>\n                <li>In case of advance request, Advance payment shall be paid after the submission of an advance receipt (as suggested under GST law).</li>\n            </ol>\n\n            <h2>2. Payment:</h2>\n            <ol>\n                <li>Payment shall be done through RTGS/NEFT.</li>\n                <li>A retention amount shall be deducted as per PO payment terms and:\n                    <ol type=\"a\" style=\"margin-top:2px;\">\n                        <li>In case the vendor is not completing the task assigned by Nirmaan a suitable amount, as decided by Nirmaan, shall be deducted from the retention amount.</li>\n                        <li>The adjusted amount shall be paid on completion of the defect liability period.</li>\n                        <li>Vendors are expected to pay GST as per the prevailing rules. In case the vendor is not making GST payments to the tax authority, Nirmaan shall deduct the appropriated amount from the invoice payment of the vendor.</li>\n                        <li>Nirmaan shall deduct the following amounts from the final bills:\n                            <ol type=\"i\">\n                                <li>Amount pertaining to unfinished supply.</li>\n                                <li>Amount pertaining to Liquidated damages and other fines, as mentioned in the documents.</li>\n                                <li>Any agreed amount between the vendor and Nirmaan.</li>\n                            </ol>\n                        </li>\n                    </ol>\n                </li>\n            </ol>\n\n            <h2>3. Technical Specifications of the Work:</h2>\n            <ol>\n                <li>All goods delivered shall conform to the technical specifications mentioned in the vendor's quote referred to in this PO or as detailed in Annexure 1 to this PO.</li>\n                <li>Supply of goods or services shall be strictly as per Annexure - 1 or the Vendor's quote/PI in case of the absence of Annexure - I.</li>\n                <li>Any change in line items or quantities shall be duly approved by Nirmaan with rate approval prior to supply. Any goods supplied by the agency without obtaining due approvals shall be subject to the acceptance or rejection from Nirmaan.</li>\n                <li>Any damaged/faulty material supplied needs to be replaced with a new item free of cost, without extending the completion dates.</li>\n                <li>Material supplied in excess and not required by the project shall be taken back by the vendor at no cost to Nirmaan.</li>\n            </ol>\n\n            {# --- GENERAL TERMS WITH HEADER --- #}\n            <div style=\"page-break-before: always;\"></div>\n            \n            {# [FIX 3] Header Added for General Terms Page #}\n            {{ render_header() }}\n\n            <h1 style=\"margin-top: 20px;\">General Terms & Conditions for Purchase Order</h1>\n            <ol>\n                <li>\n                    <div style=\"font-weight: bold; margin-bottom: 2px;\">Liquidity Damages:</div>\n                    Liquidity damages shall be applied at 2.5% of the order value for every day of delay.\n                </li>\n                <li>\n                    <div style=\"font-weight: bold; margin-bottom: 2px;\">Termination/Cancellation:</div>\n                    If Nirmaan reasonably determines that it can no longer continue business with the vendor in accordance with applicable legal, regulatory, or professional obligations, Nirmaan shall have the right to terminate/cancel this PO immediately.\n                </li>\n                <li>\n                    <div style=\"font-weight: bold; margin-bottom: 2px;\">Other General Conditions:</div>\n                     <ol type=\"a\">\n                        <li>Insurance: All required insurance including, but not limited to, Contractors' All Risk (CAR) Policy, FLEXA cover, and Workmen's Compensation (WC) policy are in the vendor's scope. Nirmaan in any case shall not be made liable for providing these insurance. All required insurances are required prior to the commencement of the work at the site.</li>\n                        <li>Safety: The safety and security of all men deployed and materials placed by the Vendor or its agents for the project shall be at the risk and responsibility of the Vendor. Vendor shall ensure compliance with all safety norms at the site. Nirmaan shall have no obligation or responsibility on any safety, security & compensation related matters for the resources & material deployed by the Vendor or its agent.</li>\n                        <li>Notice: Any notice or other communication required or authorized under this PO shall be in writing and given to the party for whom it is intended at the address given in this PO or such other address as shall have been notified to the other party for that purpose, through registered post, courier, facsimile or electronic mail.</li>\n                        <li>Force Majeure: Neither party shall be liable for any delay or failure to perform if such delay or failure arises from an act of God or of the public enemy, an act of civil disobedience, epidemic, war, insurrection, labor action, or governmental action.</li>\n                        <li>Name use: Vendor shall not use, or permit the use of, the name, trade name, service marks, trademarks, or logo of Nirmaan in any form of publicity, press release, advertisement, or otherwise without Nirmaan's prior written consent.</li>\n                        <li>Arbitration: Any dispute arising out of or in connection with the order shall be settled by Arbitration in accordance with the Arbitration and Conciliation Act,1996 (As amended in 2015). The arbitration proceedings shall be conducted in English in Bangalore by the sole arbitrator appointed by the Purchaser.</li>\n                        <li>The law governing: All disputes shall be governed as per the laws of India and subject to the exclusive jurisdiction of the court in Karnataka.</li>\n                     </ol>\n                </li>\n            </ol>\n        </div>\n         <div class=\"footer-notes\">\n        This is a computer-generated Purchase Order.\n    </div>\n    </div>\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2026-01-02 16:55:54.107377",
  "module": "Nirmaan Stack",
  "name": "PO Invoice",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Service Requests",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format : SR Tax Invoice – single-line grid, no background\n    DocType      : Service Requests\n#}\n\n{# ──────────────────────────────────────────────────────────────\n   0 . Company / project / customer / vendor variables\n   ────────────────────────────────────────────────────────────── #}\n{%- set nirmaan_company_details = {\n    \"name\"      : \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": {\"name\": \"Karnataka\", \"code\": \"29\"},\n        \"06ABFCS9095N1ZH\": {\"name\": \"Haryana\",   \"code\": \"06\"},\n        \"09ABFCS9095N1ZB\": {\"name\": \"Noida\", \"code\":\"09\"}\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru 560102\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\",\n        \"09ABFCS9095N1ZB\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"\n    },\n    \"default_address\": \"Nirmaan address not set\"\n} -%}\n\n{%- set n_key         = doc.project_gst if doc.project_gst in nirmaan_company_details.gst_numbers else None -%}\n{%- set n_addr        = nirmaan_company_details.addresses.get(n_key, nirmaan_company_details.default_address) -%}\n{%- set n_gstin       = n_key -%}\n{%- set n_state_name  = nirmaan_company_details.gst_numbers[n_key].name if n_key else \"N/A\" -%}\n{%- set n_state_code  = nirmaan_company_details.gst_numbers[n_key].code if n_key else \"N/A\" -%}\n\n{%- set project_doc   = frappe.get_doc(\"Projects\",  doc.project)  if doc.project else None -%}\n{%- set vendor_doc    = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n{%- set customer_doc  = frappe.get_doc(\"Customers\", project_doc.customer) if project_doc and project_doc.customer else None -%}\n\n{%- set is_gst_applicable = doc.gst == \"true\" -%}\n{%- set gst_rate = 18.0 -%}\n\n{% macro format_address(addr) -%}\n    {%- if not addr -%}N/A{%- else -%}\n        {%- set a = frappe.get_doc(\"Address\", addr) -%}\n        {%- set p = [] -%}\n        {%- if a.address_line1 %}{% set p = p + [a.address_line1] %}{% endif -%}\n        {%- if a.address_line2 %}{% set p = p + [a.address_line2] %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if a.city    %}{% set csp = csp + [a.city]    %}{% endif -%}\n        {%- if a.state   %}{% set csp = csp + [a.state]   %}{% endif -%}\n        {%- if a.pincode %}{% set csp = csp + [a.pincode] %}{% endif -%}\n        {%- if csp %}{% set p = p + [csp | join(\" \")] %}{% endif -%}\n        {%- if a.country %}{% set p = p + [a.country] %}{% endif -%}\n        {{ p | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{%- set project_addr_html = format_address(project_doc.project_address) if project_doc and project_doc.project_address else \"N/A\" -%}\n{%- set vendor_addr_html = format_address(vendor_doc.vendor_address) if vendor_doc and vendor_doc.vendor_address else \"N/A\" -%}\n{%- set vendor_gstin = vendor_doc.vendor_gst if vendor_doc else \"N/A\" -%}\n{%- set vendor_state_name = frappe.get_doc(\"Address\", vendor_doc.vendor_address).state if vendor_doc and vendor_doc.vendor_address else \"N/A\" -%}\n{%- set vendor_state_code = vendor_gstin[0:2] if vendor_gstin and vendor_gstin != \"N/A\" else \"N/A\" -%}\n{%- set currency_symbol= \"₹\" -%}\n\n{# ──────────────────────────────────────────────────────────────\n   1 . Styles (unified 1-px grid, no colour fills)\n   ────────────────────────────────────────────────────────────── #}\n<style>\n    body      { font-family:\"Roboto\",Arial,sans-serif; font-size:8.5pt; margin:0; color:#000; }\n    table     { width:100%; border-collapse:collapse; }\n    tr        { page-break-inside:avoid; }\n    td,th     { border:1px solid #555; padding:2px 3px; vertical-align:top; font-size:8.5pt; }\n    th        { font-weight:bold; text-align:center; }\n\n    .w-50     { width:50%; }\n\n    /* outer grids */\n    .section-table td { padding:2px 3px; }\n\n    /* nested info-table : inner lines only */\n    /* .info-table        { width:100%; border-collapse:collapse; }\n    .info-table td     { border:1px solid #555; padding:1.5px 3px; }\n    .info-table        { border:none; }\n    .info-table tr:first-child  td { border-top:0; }\n    .info-table tr:last-child   td { border-bottom:0; }\n    .info-table tr td:first-child{ border-left:0; }\n    .info-table tr td:last-child { border-right:0; } */\n\n    .info-table td { border:1px solid #555; padding:1.5px 3px; font-size:7.5pt; vertical-align: top;}\n    .info-table { border:none; } /* Remove outer border of the nested table */\n    .info-table tr:first-child td  { border-top:0; }\n    .info-table tr:last-child td   { border-bottom:0; }\n    .info-table tr td:first-child  { border-left:0; }\n    .info-table tr td:last-child   { border-right:0; }\n\n    /* .label-cell { width:50%; font-weight:normal; border-bottom:0; padding-bottom:0; }\n    .value-cell { width:50%; font-weight:bold;   border-top:0;   padding-top:.5px; }\n    .terms-cell { border-top:1px solid #555; } */\n\n    .label-cell { width:50%; font-weight:normal; border-bottom:0; padding-bottom:0; text-align:left; }\n    .value-cell { width:50%; font-weight:bold;   border-top:0;   padding-top:.5px; text-align:left; min-height: 10px; word-wrap: break-word; }\n\n    .text-center{ text-align:center; }\n    .text-right { text-align:right;  }\n    .font-bold  { font-weight:bold;  }\n    .font-small { font-size: 7pt; } /* For labels like \"Buyer (Bill to)\" */\n\n    @page { size:A4; margin:30mm 8mm 18mm 8mm; }\n\n    #header-html h2 { margin:0 0 12px 0; text-align:center; }\n    #footer-html    { font-size:7.5pt; text-align:center; font-family:\"Roboto\",Arial,sans-serif; }\n</style>\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Header / Footer\n   ────────────────────────────────────────────────────────────── #}\n<div id=\"header-html\" style=\"display:none;\">\n    <h2>Tax Invoice</h2>\n</div>\n\n<div id=\"footer-html\" style=\"display:none;\">\n    This is a Computer Generated Invoice  |  Page <span class=\"page\"></span> of <span class=\"topage\"></span>\n</div>\n\n{# ──────────────────────────────────────────────────────────────\n   3 . Main document\n   ────────────────────────────────────────────────────────────── #}\n<div class=\"print-format\">\n\n<!-- SECTION 1 : Vendor vs Invoice quick info -->\n<table class=\"section-table\">\n  <tr>\n    <td class=\"w-50\">\n        <p class=\"font-bold\" style=\"font-size:9.5pt;\">\n            {{ vendor_doc.vendor_name if vendor_doc else \"Vendor N/A\" }}\n        </p>\n        {{ vendor_addr_html }}<br>\n        <!-- {% if vendor_gstin and vendor_gstin != \"N/A\" %}\n           <strong>GSTIN/UIN:</strong> {{ vendor_gstin }}<br>\n        {% endif %}\n        State Name : {{ vendor_state_name }}, Code : {{ vendor_state_code }} -->\n    </td>\n\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Invoice No.</td><td class=\"label-cell\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ doc.invoice_no if doc.invoice_no else \"-\" }}</td><td class=\"value-cell\">{{ frappe.utils.formatdate(doc.invoice_date,\"dd-MMM-yy\") if doc.invoice_date else \"-\" }}</td></tr>\n\n            <!-- <tr><td class=\"label-cell\">Delivery Note</td><td class=\"label-cell\">Mode/Terms of Payment</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_delivery_note_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_payment_terms\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\">Reference No. & Date</td><td class=\"label-cell\">Other References</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_reference_no_date\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_other_references\") or \"-\" }}</td></tr> -->\n        </table>\n    </td>\n  </tr>\n</table>\n\n<!-- SECTION 2 : Consignee / Buyer / Dispatch -->\n<table style=\"margin-top:3px;\">\n  <!-- <tr>\n    <td class=\"w-50\">\n        <span style=\"font-size:7.5pt;\">Consignee (Ship to)</span><br>\n        <span class=\"font-bold\">{{ project_doc.project_name if project_doc else \"Project N/A\" }}</span><br>\n        {{ project_addr_html }}<br>\n        {% if project_doc and project_doc.project_city %}\n          City : {{ project_doc.project_city }}<br>\n        {% endif %}\n        {% if project_doc and project_doc.project_state %}\n          State : {{ project_doc.project_state }}\n        {% endif %}\n    </td>\n\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td><td class=\"label-cell\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_buyers_order_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_buyers_order_date\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\">Dispatch Doc No.</td><td class=\"label-cell\">Delivery Note Date</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_dispatch_doc_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_delivery_note_date\") or \"-\" }}</td></tr>\n        </table>\n    </td>\n  </tr> -->\n\n  <tr>\n    <td class=\"w-50\">\n        <span style=\"font-size:7.5pt;\">Buyer (Bill to)</span><br>\n        <span class=\"font-bold\">{{ nirmaan_company_details.name }}</span><br>\n        {{ n_addr }}<br>\n        {% if n_gstin %}\n          <strong>GSTIN/UIN:</strong> {{ n_gstin }}<br>\n          State Name : {{ n_state_name }}, Code : {{ n_state_code }}\n        {% endif %}\n    </td>\n\n    <!-- <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Dispatched through</td><td class=\"label-cell\">Destination</td></tr>\n            <tr>\n                <td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_dispatched_through\") or \"-\" }}</td>\n                <td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_destination\") or project_doc.project_city if project_doc and project_doc.project_city else '-' }}</td>\n            </tr>\n\n                        <tr><td colspan=\"2\" class=\"label-cell terms-cell\">Terms of Delivery</td></tr>\n            <tr><td colspan=\"2\" class=\"value-cell\" style=\"border-top:0;\">{{ frappe.form_dict.get(\"custom_terms_of_delivery\") or \"-\" }}</td></tr>\n        </table>\n    </td> -->\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td><td class=\"label-cell\">Project</td></tr>\n            <tr><td class=\"value-cell\">{{ doc.name or \"-\" }}</td><td class=\"value-cell\">{{ project_doc.project_name if project_doc else \"-\" }}</td></tr>\n\n            <!--<tr><td class=\"label-cell\">Project</td></tr>-->\n            <!--<tr><td class=\"value-cell\">{{ project_doc.project_name if project_doc else \"-\" }}</td></tr>-->\n        </table>\n    </td>\n    <!-- <td class=\"w-50\"> {# Buyer's Order No & Date (from client input if provided) #}\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td></tr>\n            <tr><td class=\"value-cell\" style=\"padding-bottom:5px;\">{{ frappe.form_dict.get(\"custom_buyers_order_no\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\" style=\"border-top:1px solid #555;\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.utils.formatdate(project_doc.project_start_date,\"dd-MMM-yy\") if project_doc and project_doc.expected_start_date else \"-\" }}</td></tr>\n        </table>\n    </td> -->\n  </tr>\n</table>\n\n <!--SECTION 3 : Item grid -->\n<table style=\"margin-top:3px;\">\n   <thead>\n     <tr>\n       <th style=\"width:5%;\">Sl&nbsp;No.</th>\n       <th style=\"width:{% if is_gst_applicable %}48%{% else %}58%{% endif %};\">Particulars</th>\n       <th style=\"width:8%;\" class=\"text-center\">Quantity</th>\n       <th style=\"width:8%;\" class=\"text-center\">Rate&nbsp;per</th>\n       {% if is_gst_applicable %}\n       <th style=\"width:8%;\" class=\"text-center\">GST</th>\n       {% endif %}\n       <th style=\"width:{% if is_gst_applicable %}23%{% else %}21%{% endif %};\" class=\"text-right\">Amount</th>\n     </tr>\n   </thead>\n   <tbody>\n     {% set subtotal = namespace(value=0.0) %}\n     {% set total_tax = namespace(value=0.0) %}\n     {% set grand_total = namespace(value=0.0) %}\n\n     {# build items array the same way you did earlier #}\n     {% set items = [] %}\n     {% if doc.service_order_list and doc.service_order_list is string %}\n         {% set parsed = json.loads(doc.service_order_list) %}\n         {% if parsed is mapping and parsed.list is defined %}{% set items = parsed.list %}{% endif %}\n     {% elif doc.service_order_list is mapping and doc.service_order_list.list is defined %}\n         {% set items = doc.service_order_list.list %}\n     {% endif %}\n\n     {% if items|length %}\n       {% for it in items %}\n         {% set qty   = (it.quantity  or 0)|float %}\n         {% set rate  = (it.rate      or 0)|float %}\n         {% set amt   = qty * rate %}\n         {% set subtotal.value = subtotal.value + amt %}\n         \n         {% if is_gst_applicable %}\n             {% set tax_amount = amt * (gst_rate / 100) %}\n             {% set total_tax.value = total_tax.value + tax_amount %}\n             {% set item_total = amt + tax_amount %}\n         {% else %}\n             {% set item_total = amt %}\n         {% endif %}\n         \n         {% set grand_total.value = grand_total.value + item_total %}\n         <tr>\n           <td class=\"text-center\">{{ loop.index }}</td>\n           <td>{{ it.description }}</td>\n           <td class=\"text-center\">{{ qty if qty else \"-\" }} {{ it.uom if qty else \"\" }}</td>\n           <td class=\"text-right\">{{ rate and ('%.2f'|format(rate)) or '-' }}</td>\n           {% if is_gst_applicable %}\n           <td class=\"text-center\">{{ gst_rate }}%</td>\n           {% endif %}\n           <td class=\"text-right\">{{ currency_symbol }} {{ '%.2f'|format(amt) }}</td>\n         </tr>\n       {% endfor %}\n     {% else %}\n       <tr><td colspan=\"{{ 6 if is_gst_applicable else 5 }}\" class=\"text-center\" style=\"padding:12px;\">No service items found</td></tr>\n     {% endif %}\n\n     <tr>\n        <td colspan=\"{% if is_gst_applicable %}4{% else %}3{% endif %}\" class=\"font-bold text-right\">Total</td>\n        <td {% if is_gst_applicable %}{% else %}colspan=\"1\"{% endif %}></td>\n        <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(subtotal.value) }}</td>\n     </tr>\n\n     {% if is_gst_applicable %}\n        <tr>\n            <td colspan=\"4\" class=\"font-bold text-right\">Add: GST @ {{ gst_rate }}%</td>\n            <td></td>\n            <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(total_tax.value) }}</td>\n        </tr>\n     {% endif %}\n\n     <tr>\n        <td colspan=\"{% if is_gst_applicable %}4{% else %}3{% endif %}\" class=\"font-bold text-right\">Grand Total</td>\n        <td {% if is_gst_applicable %}{% else %}colspan=\"1\"{% endif %}></td>\n        <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(grand_total.value) }}</td>\n     </tr>\n   </tbody>\n</table>\n\n<!-- SECTION 4 : Amount in words / taxable summary -->\n<table style=\"margin-top:3px;\">\n  <tr>\n    <td style=\"width:70%; border-right:0;\">\n        Amount Chargeable (in words)<br>\n        <span class=\"font-bold\">\n           {{ frappe.utils.money_in_words(grand_total.value,\"INR\") if grand_total.value else \"INR Zero Only\" }}\n        </span>\n    </td>\n\n    <td style=\"width:30%; border-left:0;\">\n        <table class=\"info-table\">\n             <tr>\n              <td class=\"label-cell\" style=\"border-top:0;\"></td>\n              <td class=\"label-cell\" style=\"border-top:0; text-align:right;\">Taxable Value</td>\n              {% if is_gst_applicable %}\n              <td class=\"label-cell\" style=\"border-top:0; text-align:right;\">Tax Amount</td>\n              {% endif %}\n          </tr>\n          \n          <tr>\n              <td class=\"value-cell\"></td>\n              <td class=\"value-cell text-right\">{{ '%.2f'|format(subtotal.value) }}</td>\n              {% if is_gst_applicable %}\n              <td class=\"value-cell text-right\">{{ '%.2f'|format(total_tax.value) }}</td>\n              {% endif %}\n          </tr>\n          \n          <tr>\n              <td class=\"font-bold\">Total</td>\n              <td class=\"font-bold text-right\">{{ currency_symbol }} {{ '%.2f'|format(subtotal.value) }}</td>\n              {% if is_gst_applicable %}\n              <td class=\"font-bold text-right\">{{ currency_symbol }} {{ '%.2f'|format(total_tax.value) }}</td>\n              {% endif %}\n          </tr>\n        </table>\n    </td>\n  </tr>\n\n  <!--<tr>-->\n  <!--  <td colspan=\"2\" style=\"border-right:0;\">-->\n  <!--      Tax Amount (in words) : -->\n  <!--      <span class=\"font-bold\">-->\n  <!--          {% if is_gst_applicable and total_tax.value > 0 %}-->\n  <!--          {{ frappe.utils.money_in_words(total_tax.value,\"INR\") }}-->\n  <!--          {% else %}-->\n  <!--          NIL-->\n  <!--          {% endif %}-->\n  <!--      </span>-->\n  <!--  </td>-->\n  <!--</tr>-->\n\n  <tr>\n    <td colspan=\"2\" style=\"font-size:7pt; text-align:right; border-left:0; border-bottom:0;\">\n        E. &amp; O.E\n    </td>\n  </tr>\n</table>\n\n<!-- SECTION 5 : Signature -->\n<table style=\"margin-top:25px; height:50px;\">\n  <tr>\n     <td style=\"width:60%; vertical-align:bottom;\">Customer's Seal and Signature</td>\n     <td style=\"width:40%; text-align:center; vertical-align:bottom;\" class=\"font-bold\">\n         for {{ vendor_doc.vendor_name if vendor_doc else \"Vendor\" }}\n         <br><br><br>\n         Authorised Signatory\n     </td>\n  </tr>\n</table>\n\n</div> ",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-10-14 18:29:52.529101",
  "module": "Nirmaan Stack",
  "name": "SR Invoice",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Project Payments",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format : Payments - Simple Voucher with Authorization (Final)\n    DocType      : Project Payments\n#}\n\n{# MACRO REMOVED: Rely on direct frappe.get_doc calls to prevent 'str object' error #}\n\n{# ──────────────────────────────────────────────────────────────\n   0 . Dynamic Variables\n   ────────────────────────────────────────────────────────────── #}\n{%- set nirmaan_company_details = {\n    \"name\"      : \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": {\"name\": \"Karnataka\", \"code\": \"29\", \"address\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru 560102\"},\n        \"06ABFCS9095N1ZH\": {\"name\": \"Haryana\",   \"code\": \"06\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\"},\n        \"09ABFCS9095N1ZB\": {\"name\": \"Noida\", \"code\":\"09\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"}\n    }\n} -%}\n\n{# --------------------------------------------------------------------------------- #}\n{# FIX 1: Robust Document Retrieval Logic #}\n{%- set source_doc = frappe.get_doc(doc.document_type, doc.document_name) if doc.document_type and doc.document_name else none -%}\n{%- set project_id_to_fetch = source_doc.project if source_doc and source_doc.project else doc.project or None -%}\n{%- set vendor_id_to_fetch  = source_doc.vendor if source_doc and source_doc.vendor else doc.vendor or None -%}\n{%- set project_doc   = frappe.get_doc(\"Projects\", project_id_to_fetch) if project_id_to_fetch else none -%}\n{%- set vendor_doc    = frappe.get_doc(\"Vendors\", vendor_id_to_fetch) if vendor_id_to_fetch else none -%}\n{# --------------------------------------------------------------------------------- #}\n\n\n{# Nirmaan Details #}\n{%- set n_key         = project_doc.project_gst if project_doc and project_doc.project_gst in nirmaan_company_details.gst_numbers else \"29ABFCS9095N1Z9\" -%}\n{%- set n_info        = nirmaan_company_details.gst_numbers.get(n_key, nirmaan_company_details.gst_numbers['29ABFCS9095N1Z9']) -%}\n{%- set n_reg_address = n_info.address -%}\n{%- set n_gstin       = n_key -%}\n{%- set n_state_name  = n_info.name -%}\n{%- set n_state_code  = n_info.code -%}\n\n{%- set currency_symbol= \"₹\" -%}\n{%- set paid_amount = (doc.amount or 0) | float -%}\n\n{# ──────────────────────────────────────────────────────────────\n   1 . Styles\n   ────────────────────────────────────────────────────────────── #}\n<style>\n    /* RESET/GENERAL STYLES */\n    body { \n        font-family: 'Arial', sans-serif; \n        font-size: 10pt; \n        line-height: 1.5; \n        color: #333; \n        margin: 0;\n    }\n    table { width: 100%; border-collapse: collapse; }\n    \n    /* MAIN CONTAINER: FIX: Removed min-height to prevent extra page */\n    .print-format {\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n        /* min-height removed */\n    }\n    \n    .content-wrapper {\n        flex-grow: 1;\n        padding: 0 5mm; \n        position: relative; /* ADDED FOR WATERMARK POSITIONING */\n    }\n    .watermark {\n        position: absolute;\n        top: 35%;\n        left: 50%;\n        /* Changed rotation to 45deg for bottom-left to top-right orientation */\n        \n        /* ADDED VENDOR PREFIXES FOR MAX COMPATIBILITY IN PRINT/PDF ENGINES */\n        -webkit-transform: translate(-50%, -50%) rotate(-45deg); /* WebKit (for PDF engines) */\n        -ms-transform: translate(-50%, -50%) rotate(-45deg);     /* IE */\n        transform: translate(-50%, -50%) rotate(-45deg);         /* Standard */\n        \n        /* Font size slightly reduced for better fitting on the page */\n        font-size: 120pt; \n        font-weight: 900;\n        /* Changed to Green color with 5% opacity (very light) */\n        color: rgba(0, 128, 0, 0.03); \n        pointer-events: none; /* Allows text selection underneath */\n        z-index: 10; /* Ensures it's above normal content but below anything crucial */\n        text-transform: uppercase;\n    }\n\n    /* HEADER FIX: Use float for top row, clear for title/subtitle */\n    .header {\n        margin-bottom: 20px;\n        border-bottom: 2px solid #000; \n        padding-bottom: 10px; \n    }\n    \n    .header-top-row {\n        overflow: auto; /* Clears floats */\n        margin-bottom: 5px;\n        width: 100%;\n        display: block; /* Ensure block behaviour for print */\n    }\n\n    .company-info-left {\n        float: left;\n        text-align: left;\n        font-size: 14pt; \n        font-weight: bold; \n        color: #CC0000; \n        padding-top: 5px; /* Aligns with logo's top/center */\n    }\n\n    .logo-right {\n        float: right;\n        text-align: right;\n    }\n\n    .logo { \n        max-height: 50px; \n        max-width: 180px; \n        display: block;\n    } \n    .seal-container {\n       display: inline-block; \n       \n    }\n    .company-seal {\n    max-width: 120px; /* Size of the seal */\n    max-height: 120px;\n    margin-left:50px;\n    \n    }\n\n    .title { \n        clear: both; /* Ensures title goes below floats */\n        font-size: 20pt; \n        font-weight: 800; \n        color: #000; \n        text-align: center;\n        margin-top: 15px; /* Space after logo row */\n    }\n    .subtitle { \n        font-size: 10pt; \n        color: #000; \n        text-align: center;\n        margin-bottom: 5px; \n    }\n\n    /* DATA TABLE - PROFESSIONAL STYLE */\n    .data-table { border: 1px solid #000; margin-bottom: 20px; }\n    .data-table td { padding: 8px 10px; border: 1px solid #000; }\n    .data-label { \n        width: 30%; \n        font-weight: bold; \n        color: #333; \n        background-color: transparent;\n        border-right: 1px solid #000;\n    }\n    .data-value { width: 70%; }\n\n    /* TERMS */\n    .terms-heading { font-weight: bold; margin-top: 15px; margin-bottom: 5px; }\n    .terms-list { margin-left: 15px; padding-left: 0; font-size: 9pt; }\n    .terms-list li { margin-bottom: 3px; }\n\n    /* AUTHORIZATION - IMAGE MATCH LOOK */\n    .auth-table { \n        width: 100%; \n        margin-top: 200px; \n        border-collapse: collapse;\n        border: 1px solid #000; /* Outer border for the whole block */\n    }\n    .auth-table td { \n        height: 120px; \n        border: none;\n        padding: 15px; \n        vertical-align: top; \n        font-size: 10pt;\n        font-weight: normal;\n        position: relative; \n    }\n\n    .vendor-sig-cell {\n        width: 40%;\n        border-right: 1px solid #000; \n    }\n\n    .nirmaan-text-top {\n        font-size: 10pt;\n        text-align: center;\n        margin-top: 0;\n    }\n\n    .sig-container {\n        position: absolute; \n        bottom: 15px; \n        width: calc(100% - 30px); \n        left: 60px;\n        text-align: center;\n    }\n\n    .sig-line {\n        border-top: 1px solid #000;\n        width: 75%; /* Line width */\n        margin: 0 auto; \n    }\n\n    .sig-label {\n        padding-top: 5px;\n        font-weight: bold;\n        font-size: 9pt;\n    }\n\n    /* FOOTER (Pushed to bottom) */\n    .footer-address { \n        padding: 10px 0; \n        border-top: 2px solid #000; \n        font-size: 8pt; \n        text-align: center; \n        color: #666; \n        width: 100%;\n        margin-top: 0mm; /* Increased margin to push further down */\n    }\n    .footer-address span { font-weight: bold; color: #333; }\n\n    @page { \n        size:A4; \n        margin: 15mm 15mm 15mm 15mm; \n    }\n</style>\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Header / Footer\n   ────────────────────────────────────────────────────────────── #}\n<div id=\"header-html\" style=\"display:none;\">\n    <div class=\"header\">\n            <div class=\"header-top-row\">\n                {# LEFT SIDE: Company Name (The Payer) #}\n                <div class=\"company-info-left\">\n                    <img class=\"logo\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" alt=\"Nirmaan Logo\">\n                    <div class=\"\" style=\"color: #CC0008;\">Stratos Infra Technologies Pvt.Ltd</div>\n                </div>\n                \n                {# RIGHT SIDE: Logo #}\n                <div class=\"logo-right\">\n                   \n                    <!---->\n                </div>\n            </div>\n            \n            {# TITLE BLOCK (Clear float and center) #}\n            <div class=\"title\">PAYMENT VOUCHER</div>\n            <div class=\"subtitle\">Here is the payment voucher with details</div>\n        </div>\n</div>\n\n<div id=\"footer-html\" style=\"display:none;\">\n    <div class=\"footer-address\">\n        Regd. Office: <span>{{ nirmaan_company_details.name }}</span>, {{ n_reg_address }}<br>\n        <span>GSTN:</span> {{ n_gstin }} | <span>State:</span> {{ n_state_name }} | <span>Code:</span> {{ n_state_code }}\n    </div>\n</div>\n\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Main Content\n   ────────────────────────────────────────────────────────────── #}\n<div class=\"print-format\">\n    <div class=\"content-wrapper\">\n        \n       <div class=\"watermark\">PAID</div>\n        <table class=\"data-table\">\n            <tr>\n                <td class=\"data-label\">Payment ID</td>\n                <td class=\"data-value\">{{ doc.name or 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Vendor Name</td>\n                <td class=\"data-value\">{{ vendor_doc.vendor_name if vendor_doc else 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Project Name</td>\n                <td class=\"data-value\">{{ project_doc.project_name if project_doc else 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">{{ doc.document_type or 'Ref Doc Type' }} No.</td>\n                <td class=\"data-value\">{{ doc.document_name or 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Payment date</td>\n                <td class=\"data-value\">{{ frappe.utils.formatdate(doc.payment_date, \"dd-MMM-yyyy\") if doc.payment_date else 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Payment mode</td>\n                <td class=\"data-value\">\n                    {{ doc.mode_of_payment or 'Online' }}\n                </td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Paid Amount (INR)</td>\n                <td class=\"data-value\">{{ currency_symbol }} {{ \"%.2f\"|format(paid_amount) }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">UTR No.</td>\n                <td class=\"data-value\">{{ doc.utr or doc.reference_no or 'N/A' }}</td>\n            </tr>\n        </table>\n\n        <!--<div class=\"terms-heading\">Terms and Conditions</div>-->\n        <!--<ul class=\"terms-list\">-->\n        <!--    <li>Payment posting to your account is subject to credit settlement by your bank and will get the same posted within next 2-working days (maximum).</li>-->\n        <!--    <li>The above amount is inclusive of applicable taxes.</li>-->\n        <!--    <li>All claims subject to exclusive jurisdiction of courts as per registered office location.</li>-->\n        <!--</ul>-->\n\n        <table class=\"auth-table\">\n            <tr>\n                {# LEFT CELL: Vendor Signature/Seal (Header Left, Line/Label Centered Low) #}\n                <td class=\"vendor-sig-cell\">\n                    <span style=\"font-weight: bold;\">{{ vendor_doc.vendor_name if vendor_doc else 'N/A' }} (Received by)</span>\n                    \n                    <div class=\"sig-container\">\n                        <div class=\"sig-line\"></div>\n                        <div class=\"sig-label\">Vendor Signature</div>\n                    </div>\n                </td>\n                \n                {# RIGHT CELL: Nirmaan Authorised Signatory (Header Centered/Wrapped, Line/Label Centered Low) #}\n                <td class=\"nirmaan-sig-cell\">\n                    <span style=\"font-weight: bold;\">\n                        Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\n                    </span>\n                     <div class=\"seal-container\">\n                        <img class=\"company-seal\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/NIRMAAN-SEAL-D2HgrCMb.jpeg\" alt=\"Company Seal\">\n                    </div>\n                    \n                    <div class=\"sig-container\">\n                        <div class=\"sig-line\"></div>\n                        <div class=\"sig-label\">Authorised Signatory</div>\n                    </div>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    \n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-10-15 17:51:33.988658",
  "module": "Nirmaan Stack",
  "name": "SR Payment",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Project Progress Reports",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: Milestone Report (Refactored)\n    Features:\n    - Categorized Photos (Drawing, Site, Work)\n    - Fixed SVG Location Icon\n    - Fixed GST Logic\n    - Sorted Headers & Milestones\n    - Text-based Progress\n    - Clean White UI (No Backgrounds)\n#}\n\n{# --- 1. FETCH DATA --- #}\n{%- set project_doc = frappe.get_doc(\"Projects\", doc.project) if doc.project else none -%}\n{%- set owner_doc = frappe.get_doc(\"Nirmaan Users\", doc.owner) if (doc.owner and frappe.db.exists(\"Nirmaan Users\", doc.owner)) else none -%}\n\n{# Sort Headers #}\n{%- set header_list = frappe.get_all(\"Work Headers\", fields=[\"name\", \"order\"]) -%}\n{%- set header_order_map = {} -%}\n{%- for h in header_list -%}\n    {%- set h_order = h.order if h.order is not none else 999 -%}\n    {%- set _ = header_order_map.update({(h.name or \"\")|trim: h_order | int}) -%}\n{%- endfor -%}\n\n{# Sort Milestones #}\n{%- set milestone_list = frappe.get_all(\"Work Milestones\", fields=[\"work_milestone_name\", \"work_milestone_order\", \"work_header\", \"weightage\"]) -%}\n{%- set milestone_order_map = {} -%}\n{%- set milestone_weightage_map = {} -%}\n{%- for m in milestone_list -%}\n    {%- set h_key = (m.work_header or \"General\")|trim -%}\n    {%- set m_name = (m.work_milestone_name or \"\")|trim -%}\n    {# Key for ordering (legacy structure in this file) #}\n    {%- set order_key = m_name ~ \"||\" ~ h_key -%}\n    {# Key for weightage (robust structure) #}\n    {%- set weight_key = m_name|lower -%}\n    \n    {%- set m_order = m.work_milestone_order if m.work_milestone_order is not none else 9999 -%}\n    {%- set _ = milestone_order_map.update({order_key: m_order | int}) -%}\n    {%- set _ = milestone_weightage_map.update({weight_key: m.weightage|float if m.weightage else 1.0}) -%}\n{%- endfor -%}\n\n{# --- 2. CONFIG: ADDRESS MAP --- #}\n{%- set nirmaan_gst_map = {\n    \"29ABFCS9095N1Z9\": {\"state\": \"Karnataka\", \"code\": \"29\", \"address\": \"First floor, 234, 9th Main, 16th Cross Rd, Sector 6, HSR Layout, Bengaluru, Karnataka 560102\"},\n    \"06ABFCS9095N1ZH\": {\"state\": \"Haryana\",   \"code\": \"06\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\"},\n    \"09ABFCS9095N1ZB\": {\"state\": \"Uttar Pradesh\", \"code\":\"09\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305\"}\n} -%}\n\n{# --- 3. ROBUST GST EXTRACTION --- #}\n{%- set default_gst = \"29ABFCS9095N1Z9\" -%}\n{%- set final_gst = default_gst -%}\n{%- if project_doc and project_doc.project_gst_number -%}\n    {%- set raw_gst = project_doc.project_gst_number -%}\n    {%- if raw_gst is string -%}{%- set gst_data = json.loads(raw_gst) -%}{%- else -%}{%- set gst_data = raw_gst -%}{%- endif -%}\n    {%- if gst_data and gst_data.list and gst_data.list|length > 0 -%}\n        {%- set extracted_gst = gst_data.list[0].gst -%}\n        {%- if extracted_gst in nirmaan_gst_map -%}{%- set final_gst = extracted_gst -%}{%- endif -%}\n    {%- endif -%}\n{%- endif -%}\n{%- set company_info = nirmaan_gst_map[final_gst] -%}\n\n{# --- 4. HEADER TOGGLE --- #}\n{%- set show_header = (frappe.form_dict.show_header != '0') -%} \n\n{# --- 5. CATEGORIZE PHOTOS --- #}\n{%- set attachment_list = doc.attachments or doc.photos or [] -%}\n{%- set drawing_photos = [] -%}\n{%- set site_photos = [] -%}\n{%- set work_photos = [] -%}\n\n{%- for att in attachment_list -%}\n    {%- if att.attach_type == 'Drawing' -%}\n        {%- set _ = drawing_photos.append(att) -%}\n    {%- elif att.attach_type == 'Site' -%}\n        {%- set _ = site_photos.append(att) -%}\n    {%- elif att.attach_type == 'Work' -%}\n        {%- set _ = work_photos.append(att) -%}\n    {%- endif -%}\n{%- endfor -%}\n\n{# ==================== MACROS ==================== #}\n{% macro header_block() %}\n    <div class=\"nirmaan-header\">\n        <div class=\"brand-row\">\n            <img class=\"logo\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" alt=\"Nirmaan Logo\">\n        </div>\n        <div class=\"legal-name\">Nirmaan(Stratos Infra Technologies Pvt. Ltd.)</div>\n        <div class=\"address-line\">{{ company_info.address }}</div>\n        <div class=\"header-divider\"></div>\n    </div>\n{% endmacro %}\n\n{% macro render_photos(photo_list) %}\n    {% if photo_list %}\n        <div class=\"image-grid\">\n            {% for att in photo_list %}\n                <div class=\"image-item\">\n                    {% set img_url = frappe.call(\"nirmaan_stack.api.frappe_s3_attachment.get_s3_temp_url\", file_url=(att.file_url or att.image_link or att.image)) %}\n                    {% if img_url %}\n                        <div class=\"image-container\">\n                            <img src=\"{{ img_url }}\" class=\"image-actual\" alt=\"Photo\">\n                        </div>\n                        <div class=\"image-meta\">\n                            {% set loc_text = att.location_name or att.location or att.site_location or \"\" %}\n                            {% if loc_text %}\n                                <div class=\"image-loc\">\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" fill=\"#dc2626\" style=\"vertical-align: middle; margin-right: 4px;\">\n                                      <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/>\n                                    </svg>\n                                    {{ loc_text }}\n                                </div>\n                            {% endif %}\n                            {% set rem_text = att.remarks or att.description or att.note or \"\" %}\n                            {% if rem_text %}\n                                <div class=\"image-rem\">\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-messages-square-icon lucide-messages-square\" style=\"color:#666;\"><path d=\"M16 10a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 14.286V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\"/><path d=\"M20 9a2 2 0 0 1 2 2v10.286a.71.71 0 0 1-1.212.502l-2.202-2.202A2 2 0 0 0 17.172 19H10a2 2 0 0 1-2-2v-1\"/></svg>\n                                    {{ rem_text }}\n                                </div>\n                            {% endif %}\n                        </div>\n                    {% else %}\n                        <div style=\"padding:40px; text-align:center; color:#999; font-size:10px;\">Img N/A</div>\n                    {% endif %}\n                </div>\n            {% endfor %}\n        </div>\n    {% endif %}\n{% endmacro %}\n\n\n<style>\n    /* GLOBAL SETTINGS */\n    body { font-family: \"Inter\", Helvetica, Arial, sans-serif; font-size: 11px; color: #1f2937; line-height: 1.35; margin: 0; padding: 0; }\n    @media print {\n        @page { size: A4; margin: 8mm; }\n        .page-break-before { page-break-before: always; }\n        .avoid-break { page-break-inside: avoid !important; }\n        * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }\n    }\n    .w-100 { width: 100%; } .text-right { text-align: right; } .text-center { text-align: center; } .text-left { text-align: left; }\n    .mb-5 { margin-bottom: 5px; } .mb-10 { margin-bottom: 10px; } .mb-15 { margin-bottom: 15px; } .mt-10 { margin-top: 10px; }\n    .text-red { color: #dc2626; } .text-green { color: #16a34a; } .bg-gray-light { background-color: #f9fafb; }\n    .nirmaan-header { width: 100%; margin-bottom: 12px; }\n    .brand-row { margin-bottom: 4px; display: block; } .logo { height: 32px; vertical-align: middle; margin-right: 8px; }\n    .legal-name { font-size: 14px; font-weight: 800; color: #000; margin-bottom: 2px; }\n    .address-line { font-size: 10px; color: #6B7280; margin-bottom: 5px; }\n    .header-divider { border-bottom: 2px solid #000; width: 100%; margin-top: 5px; margin-bottom: 15px; }\n    .info-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; } .info-table td { padding: 3px 0; font-size: 11px; vertical-align: top; }\n    .section-title { font-size: 12px; font-weight: 800; color: #374151; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #e5e7eb; padding-bottom: 3px; }\n    .data-table { width: 100%; border-collapse: collapse; } .data-table th { background-color: #f9fafb; border: 1px solid #e5e7eb; padding: 6px 8px; font-size: 10px; font-weight: 700; text-transform: uppercase; color: #374151; } .data-table td { border: 1px solid #e5e7eb; padding: 6px 8px; vertical-align: middle; }\n    .group-header-box { background-color: #f9fafb; border: 1px solid #e5e7eb; border-radius: 4px; padding: 0; margin-top: 8px; height: 40px; overflow: hidden; }\n    .progress-table { width: 100%; height: 40px; border-collapse: collapse; } .progress-table td { vertical-align: middle; padding: 0; }\n    .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 9px; font-weight: 600; min-width: 60px; text-align: center; }\n    .bg-g { background-color: #d1fae5; color: #065f46; } .bg-y { background-color: #fffbeb; color: #d97706; } .bg-r { background-color: #fef2f2; color: #dc2626; } .bg-gy { background-color: #f3f4f6; color: #4b5563; }\n    .remarks-bubble { font-size: 9px; color: #555; background-color: #fff; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-top: 2px; border: 1px solid #ddd; }\n    \n    /* Image Grid Styling */\n    .image-grid { font-size: 0; width: 100%; }\n    .image-item { \n        display: inline-block; \n        width: 49%; \n        border: 1px solid #e5e7eb; \n        background: #fff; \n        vertical-align: top; \n        border-radius: 6px;\n        overflow: hidden;\n        page-break-inside: avoid;\n        break-inside: avoid;\n        margin-bottom: 12px;\n        font-size: 11px; /* Reset font size */\n    }\n    .image-item:nth-child(odd) { margin-right: 2%; }\n    \n    .image-container { \n        height: 220px; \n        width: 100%; \n        background-color: #fff; /* White Background */\n        text-align: center; \n        overflow: hidden; \n        display: block;\n        border-bottom: 1px solid #f3f4f6;\n    }\n    .image-actual { \n        width: 100%; \n        height: 100%; \n        object-fit: contain; /* Correct aspect ratio */\n        vertical-align: middle; \n    }\n    .image-meta { padding: 5px 8px; min-height: 0px; }\n    \n    .image-loc { margin-bottom: 2px; font-weight: 600; font-size: 10px; color: #111; word-wrap: break-word; }\n    /* CLEAN REMARKS: White bg, gray text */\n    .image-rem { \n        padding: 4px 6px; \n        font-size: 10px; \n        color: #4b5563; \n        background-color: #fff; \n        border: 1px solid #e5e7eb; \n        border-radius: 4px; \n        line-height: 1.3; \n        word-wrap: break-word; \n    }\n</style>\n\n<div class=\"main-container\">\n\n    {# ==================== PAGE 1: OVERVIEW & MANPOWER ==================== #}\n    <div> \n        {% if show_header %}{{ header_block() }}{% else %}<div style=\"height:20px;\"></div>{% endif %}\n        {% set zone_val = doc.report_zone or \"\" %}\n        <table class=\"info-table\">\n            <tr>\n                <td style=\"width:15%; font-weight:700;\">Project:</td><td style=\"width:40%;\">{{ project_doc.project_name }}</td>\n                <td style=\"width:15%; font-weight:700;\">Zone Name:</td><td style=\"width:40%;\">{{ zone_val }}</td>\n            </tr>\n            <tr>\n                <td style=\"width:15%; font-weight:700;\">Report Date:</td><td style=\"width:40%;\">{{ frappe.utils.formatdate(doc.report_date, \"dd-MMM-yyyy\") }}</td>\n                <td style=\"width:15%; font-weight:700;\">Start Date:</td><td style=\"width:30%;\">{{ frappe.utils.formatdate(project_doc.project_start_date, \"dd-MMM-yyyy\") if project_doc.project_start_date else \"--\" }}</td>\n            </tr>\n            <tr>\n                <td style=\"font-weight:700;\">Manager:</td><td>{{ owner_doc.full_name if owner_doc else doc.owner }}</td>\n            </tr>\n        </table>\n        \n        {% set active_manpower = [] %}\n        {% for mp in doc.manpower %}{% if (mp.count | float) > 0 %}{% set _ = active_manpower.append(mp) %}{% endif %}{% endfor %}\n        {% if active_manpower %}\n            <div class=\"section-title\">MANPOWER</div>\n            <table class=\"data-table mb-15\" style=\"width: 100%;\">\n                {% for chunk in active_manpower | batch(2) %}\n                <tr>\n                    {% for mp in chunk %}\n                        <td class=\"bg-gray-light\" style=\"width:30%; font-weight:600;\">{{ mp.label }}</td>\n                        <td style=\"width:20%; font-weight:700; text-align:right;\">{{ mp.count }}</td>\n                    {% endfor %}\n                    {% if chunk|length == 1 %}<td colspan=\"2\" style=\"border:none;\"></td>{% endif %}\n                </tr>\n                {% endfor %}\n            </table>\n            {% if doc.manpower_remarks %}\n            <div class=\"mb-15\" style=\"background:#fff; padding:8px; border:1px solid #e5e7eb; border-radius:4px; font-size:10px; color:#4b5563;\">\n                <strong style=\"color:#111;\">Remarks:</strong> {{ doc.manpower_remarks }}\n            </div>\n            {% endif %}\n        {% endif %}\n    </div>\n    \n    {# ==================== CLIENT / CLEARANCE ISSUES ==================== #}\n    {% if doc.drawing_remarks or doc.site_remarks or drawing_photos or site_photos %}\n    <div class=\"avoid-break\" style=\"\">\n        <div class=\"section-title\">CLIENT / CLEARANCE ISSUES</div>\n        \n        {# Drawing Remarks & Photos - CLEAN UI #}\n        {% if (doc.drawing_remarks and doc.drawing_remarks|trim != \"\") or drawing_photos %}\n            <div class=\"mb-15\" style=\"background:#fff; padding:10px; border:1px solid #fed7aa; border-radius:6px; border-left: 4px solid #f97316;\">\n                <strong style=\"color:#c2410c; font-size:11px; display:block; margin-bottom:5px;\">Drawing Remarks</strong>\n                {% if doc.drawing_remarks %}\n                {% set drawing_items = doc.drawing_remarks.split('$#,,,') %}\n                <ul style=\"margin:0 0 10px 0; padding-left:18px; font-size:10px; color:#333;\">\n                    {% for item in drawing_items %}{% if item and item|trim|length > 0 %}<li style=\"margin-bottom:3px;\">{{ item|trim }}</li>{% endif %}{% endfor %}\n                </ul>\n                {% endif %}\n                \n                {% if drawing_photos %}\n                    <div style=\"margin-top:5px;\">\n                        {{ render_photos(drawing_photos) }}\n                    </div>\n                {% endif %}\n            </div>\n        {% endif %}\n        \n        {# Site Remarks & Photos - CLEAN UI #}\n        {% if (doc.site_remarks and doc.site_remarks|trim != \"\") or site_photos %}\n            <div class=\"mb-15\" style=\"background:#fff; padding:10px; border:1px solid #fecaca; border-radius:6px; border-left: 4px solid #ef4444;\">\n                <strong style=\"color:#dc2626; font-size:11px; display:block; margin-bottom:5px;\">Site Remarks</strong>\n                {% if doc.site_remarks %}\n                {% set site_items = doc.site_remarks.split('$#,,,') %}\n                <ul style=\"margin:0 0 10px 0; padding-left:18px; font-size:10px; color:#333;\">\n                    {% for item in site_items %}{% if item and item|trim|length > 0 %}<li style=\"margin-bottom:3px;\">{{ item|trim }}</li>{% endif %}{% endfor %}\n                </ul>\n                {% endif %}\n                \n                 {% if site_photos %}\n                    <div style=\"margin-top:5px;\">\n                        {{ render_photos(site_photos) }}\n                    </div>\n                {% endif %}\n            </div>\n        {% endif %}\n    </div>\n    {% endif %}\n\n    {# ==================== PAGE 2: PLANNED WORK ==================== #}\n    {% set ns = namespace(wp_grouped={}) %}\n    {% for m in doc.milestones %}\n        {% set status = (m.status or \"\") | lower | trim %}\n        {% if status in [\"wip\", \"in progress\", \"not started\", \"todo\", \"on hold\", \"pending\"] %}\n            {% set raw_plan = m.work_plan or \"\" %}\n            {% set valid_parts = [] %}\n            {% for line in raw_plan.replace('$#,,,', '\\n').split('\\n') %}{% if line and line|trim|length > 0 %}{% set _ = valid_parts.append(line|trim) %}{% endif %}{% endfor %}\n            {% if valid_parts %}\n                {% set h = (m.work_header or \"General\")|trim %}\n                {% if h not in ns.wp_grouped %}{% set _ = ns.wp_grouped.update({h: []}) %}{% endif %}\n                {% set m_key = (m.work_milestone_name or \"\")|trim ~ \"||\" ~ h %}\n                {% set m_order = milestone_order_map.get(m_key, 9999) %}\n                {% set _ = ns.wp_grouped[h].append({'name': m.work_milestone_name, 'status': m.status, 'lines': valid_parts, 'order': m_order}) %}\n            {% endif %}\n        {% endif %}\n    {% endfor %}\n    \n    {% if ns.wp_grouped %}\n    <div class=\"page-break-before\">\n        <div class=\"section-title mt-10\">PLANNED WORK</div>\n        {% set sorted_plan_headers = [] %}\n        {% for h_name in ns.wp_grouped %}{% set _ = sorted_plan_headers.append({'name': h_name, 'order': header_order_map.get(h_name, 9999)}) %}{% endfor %}\n        \n        {% for h_obj in sorted_plan_headers | sort(attribute='order') %}\n            {% set header = h_obj.name %}\n            <div class=\"avoid-break {% if not loop.last %}mb-15{% endif %}\">\n                <div class=\"group-header-box\">\n                    <table class=\"progress-table\">\n                        <tr><td style=\"width: 10px; background-color: #dc2626; padding: 0;\"></td><td class=\"text-left\" style=\"padding-left: 10px;\"><span style=\"font-weight:700; font-size:14px; color:#000;\">{{ header }} ({{ ns.wp_grouped[header]|length }})</span></td></tr>\n                    </table>\n                </div>\n                {% for item in ns.wp_grouped[header] | sort(attribute='order') %}\n                <div class=\"mb-10\" style=\"padding-left:5px;\">\n                    <div style=\"margin-bottom:2px;\"><span style=\"font-weight:700; font-size:11px;\">{{ item.name }}</span><span style=\"font-size:10px; color:#d97706; margin-left:4px;\">({{ item.status }})</span></div>\n                    <ul style=\"margin:0; padding-left:18px; font-size:11px; color:#374151;\">\n                        {% for line in item.lines %}<li>{{ line }}</li>{% endfor %}\n                    </ul>\n                </div>\n                {% endfor %}\n            </div>\n        {% endfor %}\n    </div>\n    {% endif %}\n\n    {# ==================== PAGE 3: WORK PROGRESS ==================== #}\n    {% set prog_grouped = {} %}\n    {% for m in doc.milestones %}\n        {% if m.status and m.status != \"Not Applicable\" %}\n            {% set h = (m.work_header or \"General\")|trim %}\n            {% if h not in prog_grouped %}{% set _ = prog_grouped.update({h: []}) %}{% endif %}\n            {% set _ = prog_grouped[h].append(m) %}\n        {% endif %}\n    {% endfor %}\n\n    {% if prog_grouped %}\n    <div class=\"page-break-before\">\n        {% if show_header %}{{ header_block() }}{% endif %}\n        <div class=\"section-title mt-10\">WORK PROGRESS</div>\n        {% set sorted_prog_headers = [] %}\n        {% for h_name in prog_grouped %}{% set _ = sorted_prog_headers.append({'name': h_name, 'order': header_order_map.get(h_name, 9999)}) %}{% endfor %}\n        {% for h_obj in sorted_prog_headers | sort(attribute='order') %}\n            {% set header = h_obj.name %}\n            {% set group_ms = prog_grouped[header] %}\n            \n            {# Calculate Weighted Average #}\n            {% set ns = namespace(total_prog=0, total_weight=0) %}\n            {% for m in group_ms %}\n                {# Get Weightage #}\n                {% set w_key = (m.work_milestone_name or \"\")|trim|lower %}\n                {% set w = milestone_weightage_map.get(w_key, 1.0)|float %}\n                \n                {# Get Robust Progress #}\n                {% set p_raw = m.progress | string | replace(\"%\", \"\") | trim %}\n                {% set p_val = p_raw | float if p_raw else 0 %}\n                \n                {% set ns.total_weight = ns.total_weight + w %}\n                {% set ns.total_prog = ns.total_prog + (p_val * w) %}\n            {% endfor %}\n            \n            {% set avg_p = (ns.total_prog / ns.total_weight) | round | int if ns.total_weight > 0 else 0 %}\n            {% set color_p = \"#16a34a\" if avg_p == 100 else (\"#d97706\" if avg_p >= 50 else \"#dc2626\") %}\n            \n            <div class=\"avoid-break {% if not loop.last %}mb-20{% endif %}\">\n                <div class=\"group-header-box\">\n                    <table class=\"progress-table\"><tr><td style=\"width: 10px; background-color: #dc2626; padding: 0;\"></td><td class=\"text-left\" style=\"padding-left: 10px;\"><span style=\"font-weight:700; font-size:14px; color:#000;\">{{ header }} ({{ group_ms|length }})</span></td><td class=\"text-right\" style=\"width: 170px; white-space: nowrap; padding-right: 10px;\"><span style=\"font-weight:700; font-size:11px; color:#000; text-transform:uppercase;\">Overall Progress:</span><span style=\"font-weight:800; font-size:14px; color:{{ color_p }}; margin-left: 5px;\">{{ avg_p }}%</span></td></tr></table>\n                </div>\n                <table class=\"data-table\">\n                    <thead><tr><th class=\"text-left\" style=\"width:40%;\">Work</th><th class=\"text-center\" style=\"width:20%;\">Status</th><th class=\"text-center\" style=\"width:20%;\">Progress</th><th class=\"text-center\" style=\"width:20%;\">Est. Date</th></tr></thead>\n                    <tbody>\n                        {% set sorted_group_ms = [] %}\n                        {% for m in group_ms %}\n                            {% set key = (m.work_milestone_name or \"\")|trim ~ \"||\" ~ (m.work_header or \"General\")|trim %}\n                            {% set _ = sorted_group_ms.append({'data': m, 'order': milestone_order_map.get(key, 9999)}) %}\n                        {% endfor %}\n                        {% for wrapper in sorted_group_ms | sort(attribute='order') %}\n                        {% set m = wrapper.data %}\n                        <tr>\n                            <td><div style=\"font-weight:600; font-size:11px;\">{{ m.work_milestone_name }}</div>{% if m.remarks %}<div class=\"remarks-bubble\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-messages-square-icon lucide-messages-square\"><path d=\"M16 10a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 14.286V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\"/><path d=\"M20 9a2 2 0 0 1 2 2v10.286a.71.71 0 0 1-1.212.502l-2.202-2.202A2 2 0 0 0 17.172 19H10a2 2 0 0 1-2-2v-1\"/></svg> {{ m.remarks }}</div>{% endif %}</td>\n                            <td class=\"text-center\"><span class=\"badge {% if m.status == 'Completed' %}bg-g{% elif m.status == 'WIP' %}bg-y{% elif m.status == 'Not Started' %}bg-r{% else %}bg-gy{% endif %}\">{{ m.status }}</span></td>\n                            <td class=\"text-center\"><span style=\"font-weight:700; color:{% if (m.progress|string|replace('%','')|trim|float|int) < 50 %}#dc2626{% elif (m.progress|string|replace('%','')|trim|float|int) < 90 %}#d97706{% else %}#16a34a{% endif %}; font-size:12px;\">{{ m.progress|string|replace('%','')|trim|float|int }}%</span></td>\n                            <td class=\"text-center text-sm\">\n    {% if m.status == \"Not Started\" %}\n        <span class=\"text-red\">{{ frappe.utils.formatdate(m.expected_starting_date, \"dd-MMM-YYYY\") if m.expected_starting_date else \"-\" }}</span>\n    {% elif m.status == \"Completed\" %}\n        <span class=\"text-gray-500\">N/A</span>\n    {% else %}\n        <span class=\"text-green\">{{ frappe.utils.formatdate(m.expected_completion_date, \"dd-MMM-YYYY\") if m.expected_completion_date else \"-\" }}</span>\n    {% endif %}\n</td>\n                        </tr>\n                        {% endfor %}\n                    </tbody>\n                </table>\n            </div>\n        {% endfor %}\n    </div>\n    {% endif %}\n\n    {# ==================== PAGE 4: WORK IMAGES (FILTERED) ==================== #}\n    {% if work_photos %}\n    <div class=\"page-break-before\">\n        {% if show_header %}{{ header_block() }}{% endif %}\n        <div class=\"section-title mt-10\">WORK IMAGES</div>\n        {{ render_photos(work_photos) }}\n    </div>\n    {% endif %}\n\n</div>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2026-01-19 13:56:10.456315",
  "module": "Nirmaan Stack",
  "name": "Milestone Report",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Project Design Tracker",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!-- \n    PRINT FORMAT: Nirmaan Design Tracker (Final Version)\n    Features:\n    - DATA: Fetches linked Project Doc to get GST/Address logic.\n    - HEADER: Standardized Nirmaan Header (Dynamic Address + Logo).\n    - TITLE: Big 24px Bold Title + Date.\n    - CONTENT: Design Tracker Logic (Red/Green/Amber Badges, Zones).\n-->\n\n<!-- ========================================== -->\n<!-- 1. SERVER-SIDE DATA LOGIC                  -->\n<!-- ========================================== -->\n\n<!-- Zone Parameter -->\n{%- set req_zone = frappe.form_dict.zone or frappe.request.args.zone -%}\n{%- set target_zone = req_zone | string | trim -%}\n\n<!-- Company & GST Configuration (Dynamic Address) -->\n{%- set nirmaan_gst_map = {\n    \"29ABFCS9095N1Z9\": {\"state\": \"Karnataka\", \"address\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\"},\n    \"06ABFCS9095N1ZH\": {\"state\": \"Haryana\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram - 122002, Haryana\"},\n    \"09ABFCS9095N1ZB\": {\"state\": \"Uttar Pradesh\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"}\n} -%}\n{%- set default_gst = \"29ABFCS9095N1Z9\" -%}\n{%- set final_gst = default_gst -%}\n\n<!-- Logic to pick address based on Linked Project GST -->\n{%- if doc.project -%}\n    <!-- Fetch the full Project Document using the ID -->\n    {%- set project_doc = frappe.get_doc(\"Projects\", doc.project) -%}\n    \n    {%- if project_doc and project_doc.project_gst_number -%}\n        {%- set raw_gst = project_doc.project_gst_number -%}\n        \n        <!-- Handle JSON Parsing -->\n        {%- if raw_gst is string -%}\n            {%- set gst_data = json.loads(raw_gst) -%}\n        {%- else -%}\n            {%- set gst_data = raw_gst -%}\n        {%- endif -%}\n\n        <!-- Extract GST and Match with Map -->\n        {%- if gst_data and gst_data.list and gst_data.list|length > 0 -%}\n            {%- set extracted_gst = gst_data.list[0].gst -%}\n            {%- if extracted_gst in nirmaan_gst_map -%}\n                {%- set final_gst = extracted_gst -%}\n            {%- endif -%}\n        {%- endif -%}\n    {%- endif -%}\n{%- endif -%}\n\n{%- set company_info = nirmaan_gst_map[final_gst] -%}\n{%- set company_name = \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\" -%}\n{%- set logo_url = \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" -%}\n\n\n<!-- ========================================== -->\n<!-- 2. CSS STYLING                             -->\n<!-- ========================================== -->\n<style>\n    @page { size: A4 portrait; margin: 10mm; }\n    \n    html, body {\n        font-family: 'Inter', Helvetica, Arial, sans-serif;\n        font-size: 10px; /* Base font size */\n        color: #111;\n        background-color: #fff;\n        -webkit-print-color-adjust: exact !important; \n        print-color-adjust: exact !important;\n    }\n\n    /* --- HEADER STYLES --- */\n    .header-wrapper { width: 100%; margin-bottom: 20px; }\n    .logo-img { height: 40px; display: block; margin-bottom: 8px; }\n    .company-name-lg { font-size: 14px; font-weight: bold; color: #000; margin-bottom: 4px; }\n    .company-addr-lg { font-size: 10px; color: #555; margin-bottom: 12px; }\n    .header-border { border-bottom: 3px solid #000; margin-bottom: 15px; }\n\n    /* --- REPORT META --- */\n    .report-meta-table { width: 100%; margin-bottom: 10px; border-bottom: 1px solid #e5e7eb; }\n    .report-title-lg { font-size: 18px; font-weight: bold; color: #000; padding-bottom: 8px; }\n    .report-date-lg { font-size: 11px; font-weight: bold; color: #000; text-align: right; padding-bottom: 8px; text-transform: uppercase; }\n\n    /* --- DESIGN TRACKER SPECIFIC STYLES --- */\n    \n    /* Overview Table */\n    .overview-table { width: 100%; border: 1px solid #E5E7EB; border-radius: 8px; border-spacing: 0; margin-bottom: 25px; table-layout: fixed; }\n    .overview-table td { padding: 10px 15px; vertical-align: top; border-right: 1px solid #F3F4F6; }\n    .overview-table td:last-child { border-right: none; }\n    .overview-label { font-size: 9px; text-transform: uppercase; color: #6B7280; font-weight: 700; margin-bottom: 5px; letter-spacing: 0.5px; }\n    .overview-value { font-size: 12px; font-weight: 600; color: #111827; word-wrap: break-word; }\n\n    /* Section Title */\n    .main-section-title { \n        font-size: 16px; \n        font-weight: 700; \n        margin-top: 0; \n        margin-bottom: 15px; \n        color: #111827; \n        border-bottom: 2px solid #eee; \n        padding-bottom: 5px; \n    }\n\n    /* Category Headers */\n    .category-block { display: block; margin-bottom: 20px; page-break-inside: avoid; }\n    .category-block:last-child { margin-bottom: 0; }\n    .category-header { background-color: #F9FAFB; border: 1px solid #E5E7EB; border-left: 6px solid #D1383E; padding: 8px 10px; font-size: 12px; font-weight: 700; color: #111827; margin-bottom: 0; border-bottom: none; border-top-left-radius: 4px; border-top-right-radius: 4px; page-break-after: avoid; break-after: avoid; }\n\n    /* Task Table */\n    .custom-table { width: 100%; border-collapse: separate; border-spacing: 0; border: 1px solid #E5E7EB; table-layout: fixed; margin-top: 0; border-top: 1px solid #E5E7EB; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; }\n    .custom-table th { background-color: #fff; color: #4B5563; font-size: 9px; font-weight: 700; text-transform: uppercase; text-align: left; padding: 8px 6px; border-bottom: 1px solid #E5E7EB; border-right: 1px solid #F3F4F6; }\n    .custom-table th:last-child { border-right: none; }\n    thead { display: table-header-group; }\n    .custom-table td { padding: 8px 6px; border-bottom: 1px solid #F3F4F6; border-right: 1px solid #F3F4F6; vertical-align: top; font-size: 10px; word-wrap: break-word; }\n    .custom-table td:last-child { border-right: none; }\n    .custom-table tr:last-child td { border-bottom: none; }\n    tr { page-break-inside: avoid; break-inside: avoid; }\n\n    /* Badges */\n    .badge { \n        display: block; \n        width: 100%; \n        box-sizing: border-box; \n        padding: 3px 2px; \n        border-radius: 12px; \n        font-size: 8px; \n        font-weight: 600; \n        text-align: center; \n        white-space: normal; \n        line-height: 1.1; \n        border: 1px solid transparent; \n    }\n    .badge-gray { background-color: #F3F4F6; color: #374151; border-color: #D1D5DB; }\n    .badge-red { background-color: #FEE2E2; color: #B91C1C; border-color: #EF4444; }\n    .badge-green-light { background-color: #DCFCE7; color: #15803D; border-color: #22C55E; }\n    .badge-green-dark { background-color: #86EFAC; color: #14532D; border-color: #22C55E; }\n    .badge-amber { background-color: #FEF3C7; color: #B45309; border-color: #F59E0B; }\n\n    .zone-badge {\n        display: inline-block;\n        background-color: #F3F4F6; color: #374151;\n        padding: 1px 4px; border-radius: 3px;\n        font-size: 8px; font-weight: 700;\n        border: 1px solid #E5E7EB; margin-top: 3px;\n    }\n\n    .text-link { color: #2563EB; text-decoration: none; font-weight: 600; font-size: 9px; }\n    .note-text { font-size: 9px; color: #374151; line-height: 1.35; word-break: break-word; white-space: pre-wrap; }\n\n</style>\n\n<!-- ========================================== -->\n<!-- 3. HTML CONTENT                            -->\n<!-- ========================================== -->\n<div class=\"print-format\">\n\n    <!-- 1. HEADER Section (Standardized) -->\n    <div class=\"header-wrapper\">\n        <img src=\"{{ logo_url }}\" class=\"logo-img\">\n        <div class=\"company-name-lg\">{{ company_name }}</div>\n        <div class=\"company-addr-lg\">{{ company_info.address }}</div>\n        <div class=\"header-border\"></div>\n    </div>\n\n    <!-- 2. TITLE & DATE (Standardized) -->\n    <table class=\"report-meta-table\">\n        <tr>\n            <td class=\"report-title-lg\">Design Tracker</td>\n            <td class=\"report-date-lg\">REPORT DATE : {{ frappe.utils.formatdate(frappe.utils.nowdate(), \"dd-MM-yyyy\") }}</td>\n        </tr>\n    </table> \n\n    <!-- 3. PROJECT DETAILS TABLE -->\n    <table class=\"overview-table\">\n        <tr>\n            <td style=\"width: 25%;\">\n                <div class=\"overview-label\">Project Name</div>\n                <div class=\"overview-value\">{{ doc.project_name }}</div>\n            </td>\n            <td style=\"width: 15%;\">\n                <div class=\"overview-label\">Zone</div>\n                <div class=\"overview-value\" style=\"color: #D1383E;\">\n                    {% if req_zone and target_zone != 'All' %}\n                        {{ req_zone }}\n                    {% else %}\n                        All Zones\n                    {% endif %}\n                </div>\n            </td>\n            <td style=\"width: 15%;\">\n                <div class=\"overview-label\">Start Date</div>\n                <div class=\"overview-value\">\n                    {{ frappe.utils.formatdate(doc.start_date, \"dd-MM-yyyy\") }}\n                </div>\n            </td>\n            <td style=\"width: 20%;\">\n                <div class=\"overview-label\">Deadline</div>\n                <div class=\"overview-value\">{{ frappe.utils.formatdate(doc.overall_deadline, \"dd-MM-yyyy\") if doc.overall_deadline else \"-\" }}</div>\n            </td>\n        </tr>\n    </table>\n\n    <!-- 4. TASK LIST CONTENT -->\n    <h3 class=\"main-section-title\">Task List</h3>\n\n    {% if doc.design_tracker_task %}\n\n        {# --- FILTERING LOGIC --- #}\n        {% set valid_tasks = [] %}\n        \n        {% for t in doc.design_tracker_task %}\n            {% if t.task_status != \"Not Applicable\" %}\n                {% set task_zone_val = t.task_zone | string | trim %}\n                {% if (not req_zone) or (target_zone == 'All') or (task_zone_val == target_zone) %}\n                    {% set _ = valid_tasks.append(t) %}\n                {% endif %}\n            {% endif %}\n        {% endfor %}\n        \n        {% if valid_tasks|length > 0 %}\n            \n            {% set grouped_tasks = valid_tasks | groupby('design_category') %}\n\n            {% for category, tasks in grouped_tasks %}\n                \n                <div class=\"category-block\">\n                    <div class=\"category-header\">\n                        {{ category or \"Uncategorized\" }} ({{ tasks | length }})\n                    </div>\n\n                    <table class=\"custom-table\">\n                        <thead>\n                            <tr>\n                                <th style=\"width: 20%;\">Task Name</th>\n                                <th style=\"width: 12%;\">Deadline</th>\n                                <th style=\"width: 12%;\">Last Sub. Date</th>\n                                <th style=\"width: 11%;\">Status</th>\n                                <th style=\"width: 14%;\">Sub-Status</th>\n                                <th style=\"width: 23%;\">Note</th>\n                                <th style=\"width: 8%; text-align:center;\">Link</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <!-- SORTING -->\n                            {% set tasks_with_date = [] %}\n                            {% set tasks_no_date = [] %}\n                            {% for t in tasks %}\n                                {% if t.deadline %}\n                                    {% set _ = tasks_with_date.append(t) %}\n                                {% else %}\n                                    {% set _ = tasks_no_date.append(t) %}\n                                {% endif %}\n                            {% endfor %}\n                            \n                            {% set sorted_tasks = (tasks_with_date | sort(attribute='deadline')) + tasks_no_date %}\n\n                            {% for row in sorted_tasks %}\n                            <tr>\n                                <!-- Task Name -->\n                                <td style=\"font-weight: 600; color: #111;\">\n                                    {{ row.task_name }}\n                                    {% if (not req_zone) or (target_zone == 'All') %}\n                                        {% if row.task_zone %}\n                                            <div><span class=\"zone-badge\">{{ row.task_zone }}</span></div>\n                                        {% endif %}\n                                    {% endif %}\n                                </td>\n\n                                <!-- Deadline -->\n                                <td>{{ frappe.utils.formatdate(row.deadline, \"dd-MM-yyyy\") if row.deadline else \"-\" }}</td>\n\n                                <!-- Last Submitted -->\n                                <td>\n                                    {{ frappe.utils.formatdate(row.last_submitted, \"dd-MM-yyyy\") if row.last_submitted else \"-\" }}\n                                </td>\n\n                                <!-- STATUS -->\n                                <td style=\"vertical-align: middle;\">\n                                    {% set s_raw = row.task_status or \"\" %}\n                                    {% set s_lower = s_raw | lower %}\n                                    {% set status_class = \"badge-amber\" %} {# Default Amber #}\n\n                                    {% if \"not applicable\" in s_lower %}\n                                        {% set status_class = \"badge-gray\" %}\n                                    {% elif \"not started\" in s_lower %}\n                                        {% set status_class = \"badge-red\" %}\n                                    {% elif \"submitted\" in s_lower %}\n                                        {% set status_class = \"badge-green-light\" %}\n                                    {% elif \"approved\" in s_lower %}\n                                        {% set status_class = \"badge-green-dark\" %}\n                                    {% endif %}\n                                    \n                                    <span class=\"badge {{ status_class }}\">{{ s_raw or \"N/A\" }}</span>\n                                </td>\n\n                                <!-- SUB STATUS -->\n                                <td style=\"vertical-align: middle;\">\n                                    {% if row.task_sub_status %}\n                                        {% set sub_raw = row.task_sub_status %}\n                                        {% set sub_lower = sub_raw | lower %}\n                                        {% set sub_class = \"badge-gray\" %}\n\n                                        {# Check for Clarification, Rework, or Sub-status 1 -> Amber #}\n                                        {% if \"clarification\" in sub_lower or \"rework\" in sub_lower or \"sub-status 1\" in sub_lower %}\n                                            {% set sub_class = \"badge-amber\" %}\n                                        {% endif %}\n                                        \n                                        <span class=\"badge {{ sub_class }}\">{{ sub_raw }}</span>\n                                    {% else %}\n                                        <span class=\"badge badge-gray\">...</span>\n                                    {% endif %}\n                                </td>\n\n                                <!-- Note -->\n                                <td>\n                                    {% if row.comments and row.comments|trim != \"\" %}\n                                        <div class=\"note-text\">{{ row.comments }}</div>\n                                    {% else %}\n                                        <span style=\"color:#999;\">-</span>\n                                    {% endif %}\n                                </td>\n\n                                <!-- Link -->\n                                <td style=\"text-align: center; vertical-align: middle;\">\n                                    {% if row.file_link and row.file_link|trim != \"\" %}\n                                        <a href=\"{{ row.file_link }}\" target=\"_blank\" class=\"text-link\">View</a>\n                                    {% else %}\n                                        <span style=\"color:#999;\">-</span>\n                                    {% endif %}\n                                </td>\n                            </tr>\n                            {% endfor %}\n                        </tbody>\n                    </table>\n                </div>\n            {% endfor %}\n        \n        {% else %}\n            <p style=\"text-align: center; color: #777; margin-top:30px;\">\n                No active tasks found.\n            </p>\n        {% endif %}\n        \n    {% else %}\n        <p style=\"text-align: center; color: #777;\">No tasks found.</p>\n    {% endif %}\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-12-31 13:21:05.204745",
  "module": "Nirmaan Stack",
  "name": "Project Design Tracker",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Service Requests",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: Service Request (Work Order from JSON)\n    DocType: Service Requests\n#}\n\n{# --- 1. DETERMINE GST STATUS --- #}\n{# This is the master switch. If doc.gst is not \"true\", tax is 0 and hidden. #}\n{%- set gst_enabled = (doc.gst == \"true\") -%}\n\n{# --- Company Details --- #}\n{%- set company_details = {\n    \"name\": \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"logo_url\": \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\",\n    \"nirmaan_seal\": \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/NIRMAAN-SEAL-D2HgrCMb.jpeg\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": \"Bengaluru\",\n        \"06ABFCS9095N1ZH\": \"Gurugram\",\n        \"09ABFCS9095N1ZB\": \"Noida\"\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park Cowarking Space, Mehrauli Gurugram Rd, Tower D, Sikanderpur, Gurugram, Haryana - 122002\",\n        \"09ABFCS9095N1ZB\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"\n    },\n    \"default_address\": \"Company address details missing or project GST not set.\"\n} -%}\n\n{# --- 2. PARSE THE JSON DATA --- #}\n{%- set raw_json = doc.service_order_list -%}\n{%- if raw_json and raw_json is string -%}\n    {%- set service_data = frappe.parse_json(raw_json) -%}\n{%- else -%}\n    {%- set service_data = raw_json -%}\n{%- endif -%}\n\n{%- set items = service_data.list if service_data and service_data.list else [] -%}\n\n{# --- Determine current company address and GST --- #}\n{%- set current_company_gst = doc.project_gst if doc.project_gst in company_details.gst_numbers else None -%}\n{%- set current_company_address = company_details.addresses[current_company_gst] if current_company_gst else company_details.default_address -%}\n{%- set currency_symbol = \"₹\" -%}\n\n{# ----------- Macro: Address Formatter --------------------- #}\n{% macro format_address(addr_name) -%}\n    {%- if not addr_name -%}N/A\n    {%- else -%}\n        {%- set ad = frappe.get_doc(\"Address\", addr_name) -%}\n        {%- set parts = [] -%}\n        {%- if ad.address_line1 %}{% set parts = parts + [ad.address_line1] %}{% endif -%}\n        {%- if ad.address_line2 %}{% set parts = parts + [ad.address_line2] %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if ad.city %}{% set csp = csp + [ad.city] %}{% endif -%}\n        {%- if ad.state %}{% set csp = csp + [ad.state] %}{% endif -%}\n        {%- if ad.pincode %}{% set csp = csp + [ad.pincode] %}{% endif -%}\n        {%- if csp %}{% set parts = parts + [csp | join(\" \")] %}{% endif -%}\n        {%- if ad.country %}{% set parts = parts + [ad.country] %}{% endif -%}\n        {{ parts | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{%- set project_doc = frappe.get_doc(\"Projects\", doc.project) if doc.project else None -%}\n{%- set vendor_doc = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n\n{% set vendor_address_html  = format_address(vendor_doc.vendor_address) if vendor_doc else \"N/A\" %}\n{% set project_address_html = format_address(project_doc.project_address) if project_doc else \"N/A\" %}\n\n\n<style>\n    body { font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif; font-size: 10px; color: #333; margin: 0; padding: 0; }\n    \n    @page { size: A4; margin: 45mm 12mm 20mm 12mm; }\n    \n    /* HEADER STYLES */\n    .header img.logo { max-width: 140px; max-height: 40px; margin-bottom: 8px; float: left; }\n    \n    /* Layout */\n    .po-header-wrapper { width: 100%; overflow: hidden; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 15px; margin-top: 10px; }\n    .po-header-left-title { float: left; width: 50%; font-size: 22px; font-weight: bold; color: #1a1a1a; text-transform: uppercase; padding-top: 5px; }\n    .po-header-right-details { float: right; width: 49%; text-align: right; }\n    .po-header-right-details p { margin: 2px 0; line-height: 1.4; font-size: 10px; }\n    \n    /* INFO BLOCKS */\n    .address-block { margin-bottom:15px; overflow:hidden; }\n    .address-block__col { width:48%; float:left; font-size:9.5px; }\n    .address-block__col + .address-block__col { float:right; }\n    .address-block h4 { font-size: 10px; font-weight: bold; text-transform: uppercase; color: #555; margin: 0 0 6px 0; }\n\n    /* ITEMS TABLE */\n    .items-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; table-layout: fixed; }\n    .items-table th, .items-table td { border: 1px solid #ddd; padding: 5px 7px; text-align: left; vertical-align: top; word-wrap: break-word; }\n    .items-table th { background-color: #f0f0f0; font-weight: bold; font-size: 9.5px; text-transform: uppercase; }\n    .items-table td { font-size: 9.5px; }\n    .text-right { text-align: right; } .text-center { text-align: center; }\n\n    /* TOTALS SECTION */\n    .totals-section { width: 100%; margin-top: 15px; overflow: hidden; page-break-inside: avoid; }\n    .totals-section .notes-terms { width: 58%; float: left; font-size: 9.5px; }\n    .totals-section .summary { width: 40%; float: right; }\n    .totals-section .summary table { width: 100%; font-size: 9.5px; }\n    .totals-section .summary td { padding: 3px 0; }\n    .totals-section .summary .grand-total td { font-weight: bold; font-size: 11px; border-top: 1px solid #333; border-bottom: 1px solid #333; padding-top: 6px; padding-bottom: 6px; }\n\n    /* TERMS & FOOTER */\n    .tc-container { page-break-before: always; width: 100%; }\n    .tc-content h1 { font-size: 16px; font-weight: bold; text-transform: uppercase; margin-top: 20px; margin-bottom: 15px; text-align: center; text-decoration: underline; }\n    .tc-content h2 { font-size: 12px; font-weight: bold; margin-top: 20px; margin-bottom: 10px; color: #222; text-transform: uppercase; }\n    .tc-content ol { padding-left: 25px; margin: 0; }\n    .tc-content li { font-size: 11.5px; line-height: 1.6; margin-bottom: 8px; text-align: justify; color: #333; }\n    .footer-notes { margin-top: 25px; font-size: 8.5px; color: #777; border-top: 1px dashed #ccc; padding-top: 8px; text-align: center; }\n    \n    /* SIGNATURE */\n    .signature-area { margin-top: 40px; text-align: right; page-break-inside: avoid; }\n    .signature-area img.seal { max-width: 90px; max-height: 90px; display: block; margin-left: auto; margin-bottom: 5px; }\n    .signature-area .line { width: 180px; border-top: 1px solid #333; margin-left: auto; margin-bottom: 5px; }\n</style>\n\n{# -----------------  HEADER (PDF ENGINE) ----------------- #}\n<div id=\"header-html\" style=\"display: none\">\n  <table style=\"width:100%; font-family:Helvetica,Arial,sans-serif; font-size:9.5px; border-bottom: 4px solid #000; padding-bottom: 8px; margin-bottom: 5px;\">\n    <tr>\n      <td style=\"width:40%; vertical-align:top;\">\n        <img src=\"{{ company_details.logo_url }}\" style=\"max-width:140px; max-height:38px\">\n      </td>\n      <td style=\"text-align:right; font-size:11px; vertical-align:top;\">\n        <strong>{{ company_details.name }}</strong><br>\n        {{ current_company_address }}<br>\n        {% if current_company_gst %}<strong>GSTIN:</strong> {{ current_company_gst }}{% endif %}\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div class=\"print-format\">\n\n    {# --- PAGE 1: HEADER --- #}\n    <div class=\"po-header-wrapper\">\n        <div class=\"po-header-left-title\">Work Order</div>\n        <div class=\"po-header-right-details\">\n            <p><strong>WO Number:</strong> {{ doc.name }}</p>\n            <p><strong>WO Date:</strong> {{ frappe.utils.formatdate(doc.creation, \"dd-MM-yyyy\") }}</p>\n        </div>\n    </div>\n\n    <div class=\"address-block\">\n        <div class=\"address-block__col\">\n            <h4>VENDOR DETAILS</h4>\n            <p><strong>{{ vendor_doc.vendor_name if vendor_doc else doc.vendor }}</strong></p>\n            {{ vendor_address_html }}\n            {% if vendor_doc and vendor_doc.vendor_gst %}<p><strong>GSTIN:</strong> {{ vendor_doc.vendor_gst }}</p>{% endif %}\n        </div>\n        <div class=\"address-block__col\">\n            <h4>SERVICE LOCATION</h4>\n            <p><strong>{{ project_doc.project_name if project_doc else doc.project }}</strong></p>\n            {{ project_address_html }}\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n\n    {# --- ITEMS TABLE --- #}\n    <table class=\"items-table\">\n        <thead>\n            <tr>\n                <th style=\"width:5%;\">Sr.</th>\n                <th style=\"width:40%;\">Service Description</th>\n                <th style=\"width:10%;\" class=\"text-center\">Unit</th>\n                <th style=\"width:10%;\" class=\"text-center\">Qty</th>\n                <th style=\"width:12%;\" class=\"text-right\">Rate</th>\n                \n                {# CONDITIONAL HEADER: Only show Tax if GST is enabled #}\n                {% if gst_enabled %}\n                    <th style=\"width:10%;\" class=\"text-right\">Tax (18%)</th>\n                {% endif %}\n                \n                <th style=\"width:13%;\" class=\"text-right\">Amount</th>\n            </tr>\n        </thead>\n        <tbody>\n            {# Define Variables for Totals #}\n            {% set total_qty = namespace(value=0.0) %}\n            {% set subtotal = namespace(value=0.0) %}\n            {% set total_tax = namespace(value=0.0) %}\n            \n            {% if items | length > 0 %}\n                {% for item in items %}\n                    <tr>\n                        <td class=\"text-center\">{{ loop.index }}</td>\n                        <td>\n                            <strong>{{ item.category }}</strong>\n                            {% if item.description %}\n                                <br><span style=\"white-space: pre-wrap; font-size: 9px; color: #555;\">{{ item.description }}</span>\n                            {% endif %}\n                        </td>\n                        <td class=\"text-center\">{{ item.uom or item.unit or \"-\" }}</td>\n                        \n                        {# Parse Strings to Floats safely #}\n                        {%- set qty = (item.quantity | default(0) | float) -%}\n                        {%- set rate = (item.rate | default(0) | float) -%}\n                        \n                        <td class=\"text-center\">{{ qty }}</td>\n                        <td class=\"text-right\">{{ \"%.2f\" | format(rate) }}</td>\n                        \n                        {# Calculations #}\n                        {%- set item_base_amount = qty * rate -%}\n                        \n                        {# CONDITIONAL CALCULATION #}\n                        {# If GST is NOT enabled, Tax is forced to 0 #}\n                        {%- if gst_enabled -%}\n                             {%- set tax_amount = item_base_amount * 0.18 -%} \n                        {%- else -%}\n                             {%- set tax_amount = 0.0 -%}\n                        {%- endif -%}\n                        \n                        {# CONDITIONAL COLUMN: Only show Tax cell if GST is enabled #}\n                        {% if gst_enabled %}\n                            <td class=\"text-right\">{{ \"%.2f\" | format(tax_amount) }}</td>\n                        {% endif %}\n                        \n                        <td class=\"text-right\">{{ \"%.2f\" | format(item_base_amount) }}</td>\n\n                        {# Accumulate Totals #}\n                        {%- set total_qty.value = total_qty.value + qty -%}\n                        {%- set subtotal.value = subtotal.value + item_base_amount -%}\n                        {%- set total_tax.value = total_tax.value + tax_amount -%}\n                    </tr>\n                {% endfor %}\n            {% else %}\n                {# Adjust colspan based on GST Status #}\n                <tr><td colspan=\"{{ '7' if gst_enabled else '6' }}\" style=\"text-align:center; padding: 20px;\">No service items found in JSON data.</td></tr>\n            {% endif %}\n        </tbody>\n    </table>\n    \n    {# --- TOTALS --- #}\n    <div class=\"totals-section\">\n        {# \n           Logic:\n           If GST is OFF: total_tax.value is 0.0.\n           Exact Total = Subtotal + 0.\n        #}\n        {% set exact_grand_total = subtotal.value + total_tax.value %}\n        {% set rounded_grand_total = exact_grand_total | round | int %}\n        {% set round_off_val = rounded_grand_total - exact_grand_total %}\n\n        <div class=\"notes-terms\">\n            <p><strong>Amount in Words:</strong><br>\n                {{ frappe.utils.money_in_words(rounded_grand_total, \"INR\") }}\n            </p>\n            \n            {% if doc.notes %}\n            <div style=\"margin-top:15px;\">\n                <h4 style=\"font-size:10px; font-weight:bold; margin-bottom:3px; color: #777;\">NOTES:</h4>\n                <ol style=\"padding-left: 20px; margin: 0; font-size: 9.5px;\">\n                    {% for note in doc.notes %}\n                        <li>{{ note.note if note.note else note }}</li>\n                    {% endfor %}\n                </ol>\n            </div>\n            {% endif %}\n        </div>\n\n        <div class=\"summary\">\n            <table>\n                <tr><td>Sub-Total:</td><td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(subtotal.value) }}</td></tr>\n                \n                {# CONDITIONAL SUMMARY: Only show Tax row if GST is enabled #}\n                {% if gst_enabled %}\n                    <tr><td>Total Tax (GST 18%):</td><td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(total_tax.value) }}</td></tr>\n                {% endif %}\n                \n                <tr><td>Round Off:</td><td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(round_off_val) }}</td></tr>\n                \n                <tr class=\"grand-total\"><td>GRAND TOTAL:</td><td class=\"text-right\">{{ currency_symbol }} {{ \"%.0f\" | format(rounded_grand_total) }}</td></tr>\n            </table>\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n    \n    {# --- SIGNATURE AREA --- #}\n    <div class=\"signature-area\">\n        {% if company_details.nirmaan_seal %}\n            <img src=\"{{ company_details.nirmaan_seal }}\" class=\"seal\" alt=\"Seal\">\n        {% endif %}\n        <div class=\"line\"></div>\n        <p>For <strong>{{ company_details.name }}</strong></p>\n        <p>(Authorized Signatory)</p>\n    </div>\n\n    {# --- TERMS AND CONDITIONS --- #}\n    <div class=\"tc-container\">\n        <div class=\"tc-content\">\n            <h1>Terms and Conditions</h1>\n\n            <h2>1. Invoicing:</h2>\n            <ol>\n                <li>All invoices shall be submitted in original and shall be tax invoices showing the breakup of tax structure/value payable at the prevailing rate and a clear description of goods.</li>\n                <li>All invoices submitted shall have Delivery Challan/E-waybill for supply items.</li>\n                <li>All Invoices shall have the tax registration numbers mentioned thereon. The invoices shall be raised in the name of \"Stratos Infra Technologies Pvt Ltd, Bangalore\".</li>\n                <li>Payments shall be only entertained after receipt of the correct invoice.</li>\n                <li>In case of advance request, Advance payment shall be paid after the submission of an advance receipt (as suggested under GST law).</li>\n            </ol>\n\n            <h2>2. Payment:</h2>\n            <ol>\n                <li>Payment shall be done through RTGS/NEFT.</li>\n                <li>A retention amount shall be deducted as per PO payment terms and:\n                    <ol type=\"a\" style=\"margin-top:2px;\">\n                        <li>In case the vendor is not completing the task assigned by Nirmaan a suitable amount, as decided by Nirmaan, shall be deducted from the retention amount.</li>\n                        <li>The adjusted amount shall be paid on completion of the defect liability period.</li>\n                        <li>Vendors are expected to pay GST as per the prevailing rules. In case the vendor is not making GST payments to the tax authority, Nirmaan shall deduct the appropriated amount from the invoice payment of the vendor.</li>\n                        <li>Nirmaan shall deduct the following amounts from the final bills:\n                            <ol type=\"i\">\n                                <li>Amount pertaining to unfinished supply.</li>\n                                <li>Amount pertaining to Liquidated damages and other fines, as mentioned in the documents.</li>\n                                <li>Any agreed amount between the vendor and Nirmaan.</li>\n                            </ol>\n                        </li>\n                    </ol>\n                </li>\n            </ol>\n\n            <h2>3. Technical Specifications of the Work:</h2>\n            <ol>\n                <li>All goods delivered shall conform to the technical specifications mentioned in the vendor's quote referred to in this PO or as detailed in Annexure 1 to this PO.</li>\n                <li>Supply of goods or services shall be strictly as per Annexure - 1 or the Vendor's quote/PI in case of the absence of Annexure - I.</li>\n                <li>Any change in line items or quantities shall be duly approved by Nirmaan with rate approval prior to supply. Any goods supplied by the agency without obtaining due approvals shall be subject to the acceptance or rejection from Nirmaan.</li>\n                <li>Any damaged/faulty material supplied needs to be replaced with a new item free of cost, without extending the completion dates.</li>\n                <li>Material supplied in excess and not required by the project shall be taken back by the vendor at no cost to Nirmaan.</li>\n            </ol>\n\n            <h1 style=\"page-break-before: always; margin-top: 40px;\">General Terms & Conditions for Purchase Order</h1>\n            <ol>\n                <li>\n                    <div style=\"font-weight: bold; margin-bottom: 2px;\">Liquidity Damages:</div>\n                    Liquidity damages shall be applied at 2.5% of the order value for every day of delay.\n                </li>\n                <li>\n                    <div style=\"font-weight: bold; margin-bottom: 2px;\">Termination/Cancellation:</div>\n                    If Nirmaan reasonably determines that it can no longer continue business with the vendor in accordance with applicable legal, regulatory, or professional obligations, Nirmaan shall have the right to terminate/cancel this PO immediately.\n                </li>\n                <li>\n                    <div style=\"font-weight: bold; margin-bottom: 2px;\">Other General Conditions:</div>\n                     <ol type=\"a\">\n                        <li>Insurance: All required insurance including, but not limited to, Contractors' All Risk (CAR) Policy, FLEXA cover, and Workmen's Compensation (WC) policy are in the vendor's scope. Nirmaan in any case shall not be made liable for providing these insurance. All required insurances are required prior to the commencement of the work at the site.</li>\n                        <li>Safety: The safety and security of all men deployed and materials placed by the Vendor or its agents for the project shall be at the risk and responsibility of the Vendor. Vendor shall ensure compliance with all safety norms at the site. Nirmaan shall have no obligation or responsibility on any safety, security & compensation related matters for the resources & material deployed by the Vendor or its agent.</li>\n                        <li>Notice: Any notice or other communication required or authorized under this PO shall be in writing and given to the party for whom it is intended at the address given in this PO or such other address as shall have been notified to the other party for that purpose, through registered post, courier, facsimile or electronic mail.</li>\n                        <li>Force Majeure: Neither party shall be liable for any delay or failure to perform if such delay or failure arises from an act of God or of the public enemy, an act of civil disobedience, epidemic, war, insurrection, labor action, or governmental action.</li>\n                        <li>Name use: Vendor shall not use, or permit the use of, the name, trade name, service marks, trademarks, or logo of Nirmaan in any form of publicity, press release, advertisement, or otherwise without Nirmaan's prior written consent.</li>\n                        <li>Arbitration: Any dispute arising out of or in connection with the order shall be settled by Arbitration in accordance with the Arbitration and Conciliation Act,1996 (As amended in 2015). The arbitration proceedings shall be conducted in English in Bangalore by the sole arbitrator appointed by the Purchaser.</li>\n                        <li>The law governing: All disputes shall be governed as per the laws of India and subject to the exclusive jurisdiction of the court in Karnataka.</li>\n                     </ol>\n                </li>\n            </ol>\n        </div>\n    </div>\n\n    <div class=\"footer-notes\">\n        This is a computer-generated Work Order.\n    </div>\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2026-01-12 20:19:38.204801",
  "module": "Nirmaan Stack",
  "name": "Work Orders",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Projects",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!-- \n    PRINT FORMAT: Work Plan (Fixed - Grouped by Zone, Specific Labels, Dates Top)\n-->\n\n<!-- 1. DATA & CONFIG -->\n{%- set start_param = frappe.form_dict.start_date or frappe.request.args.start_date -%}\n{%- set end_param = frappe.form_dict.end_date or frappe.request.args.end_date -%}\n{%- set zone_param = frappe.form_dict.zone or frappe.request.args.zone -%}\n\n{# --- LOGIC: Handle 'All' Parameter & Column Visibility --- #}\n{# Default to All if no zone is provided #}\n{%- set show_all_zones = (not zone_param) or (zone_param|string|lower == 'all') or (zone_param|string|lower == 'none') -%}\n\n{# --- LOGIC: ALL TIME vs DATE RANGE --- #}\n{%- set is_all_time = false -%}\n{%- set start_date = None -%}\n{%- set end_date = None -%}\n\n{%- if start_param and end_param -%}\n    {%- set start_date = start_param -%}\n    {%- set end_date = end_param -%}\n{%- else -%}\n    {%- set is_all_time = true -%}\n{%- endif -%}\n\n{# --- LOGIC: COMPANY ADDRESS --- #}\n{%- set nirmaan_gst_map = {\n    \"29ABFCS9095N1Z9\": {\"state\": \"Karnataka\", \"address\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\"},\n    \"06ABFCS9095N1ZH\": {\"state\": \"Haryana\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram - 122002, Haryana\"},\n    \"09ABFCS9095N1ZB\": {\"state\": \"Uttar Pradesh\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"}\n} -%}\n{%- set default_gst = \"29ABFCS9095N1Z9\" -%}\n{%- set final_gst = default_gst -%}\n\n{%- if doc.project_gst_number -%}\n    {%- set raw_gst = doc.project_gst_number -%}\n    {%- if raw_gst is string -%} \n        {# Simple check: if it looks like JSON, parse it. Otherwise ignore. #}\n        {%- if raw_gst.startswith('{') -%}\n            {%- set gst_data = json.loads(raw_gst) -%}\n        {%- else -%}\n            {%- set gst_data = {} -%}\n        {%- endif -%}\n    {%- else -%} \n        {%- set gst_data = raw_gst -%} \n    {%- endif -%}\n    \n    {%- if gst_data and gst_data is mapping and gst_data.get('list') -%}\n        {%- set extracted_gst = gst_data.list[0].gst -%}\n        {%- if extracted_gst in nirmaan_gst_map -%} {%- set final_gst = extracted_gst -%} {%- endif -%}\n    {%- endif -%}\n{%- endif -%}\n\n{%- set company_info = nirmaan_gst_map[final_gst] -%}\n{%- set company_name = \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\" -%}\n{%- set logo_url = \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" -%}\n\n\n{# --- API CALL --- #}\n{%- set api_call = frappe.call(\"nirmaan_stack.api.seven_days_planning.work_plan_api.get_work_plan\", project=doc.name, start_date=start_date, end_date=end_date) -%}\n{%- set raw_response = api_call.message if api_call.message is defined else api_call -%}\n{%- set data = raw_response.get('data') if raw_response and raw_response.get('data') else {} -%}\n{%- set api_reason = raw_response.get('reason') if raw_response else \"No response from API\" -%}\n\n\n{# --- GRAND TOTAL CALCULATION --- #}\n{%- set global_ns = namespace(grand_total=0) -%}\n{%- if data and data is mapping -%}\n    {%- for header, milestones in data.items() -%}\n        {%- for m in milestones -%}\n            {# Robust Zone Matching: Lowercase and Strip #}\n            {%- set m_zone_safe = (m.zone or \"\")|string|lower|trim -%}\n            {%- set p_zone_safe = (zone_param or \"\")|string|lower|trim -%}\n            \n            {%- if show_all_zones or (m_zone_safe == p_zone_safe) -%}\n                {%- if m.work_plan_doc -%}\n                    {%- set global_ns.grand_total = global_ns.grand_total + ((m.work_plan_doc or [])|length) -%}\n                {%- endif -%}\n            {%- endif -%}\n        {%- endfor -%}\n    {%- endfor -%}\n{%- endif -%}\n\n\n<!-- 2. MACRO DEFINITION -->\n{% macro render_milestone_card(item) %}\n    <!-- MILESTONE HEADER TABLE -->\n    <table class=\"ms-head-table\">\n        <tr>\n            <!-- DYNAMIC WIDTH: 60% if showing zone column, 75% if hidden -->\n            <td class=\"ms-head-td\" width=\"{{ '60%' if show_all_zones else '75%' }}\">\n                <span class=\"lbl\">Work</span>\n                <div class=\"val-main\">{{ item.work_milestone_name }}</div>\n            </td>\n\n            <!-- CONDITIONAL ZONE COLUMN (15%) -->\n            <!--{% if show_all_zones %}-->\n            <!--    <td class=\"ms-head-td\" width=\"15%\" align=\"center\">-->\n            <!--        <span class=\"lbl\">Zone</span>-->\n            <!--        <span class=\"badge-zone\">{{ item.zone or \"Default\" }}</span>-->\n            <!--    </td>-->\n            <!--{% endif %}-->\n            \n            <!-- STATUS COLUMN (15%) -->\n            <td class=\"ms-head-td\" width=\"15%\" align=\"center\">\n                <span class=\"lbl\">Status</span>\n                {% set m_stat = item.status or 'Not Started' %}\n                {% if m_stat == 'Not Started' %} \n                    {% set m_cls = 'st-not-started' %}\n                    {% set p_txt_cls = 'txt-red' %}\n                {% elif m_stat == 'Completed' %} \n                    {% set m_cls = 'st-completed' %}\n                    {% set p_txt_cls = 'txt-green' %}\n                {% else %} \n                    {% set m_cls = 'st-yellow' %}\n                    {% set p_txt_cls = 'txt-yellow' %}\n                {% endif %}\n                <span class=\"badge-status {{ m_cls }}\">{{ m_stat }}</span>\n            </td>\n\n            <!-- PROGRESS COLUMN (10%) - TEXT ONLY -->\n            <td class=\"ms-head-td\" width=\"10%\" align=\"center\">\n                <span class=\"lbl\">Progress</span>\n                <div class=\"prog-text {{ p_txt_cls }}\">{{ (item.progress or 0)|int }}%</div>\n            </td>\n        </tr>\n    </table>\n\n    <!-- BLUE STRIP -->\n    <div class=\"blue-strip\">\n        Planned Activities <span class=\"count-circle\">{{ (item.work_plan_doc or [])|length }}</span>\n    </div>\n\n    <!-- TASKS -->\n    <div class=\"task-container-div\">\n        {% for task in (item.work_plan_doc or []) %}\n            <table class=\"task-card-table\">\n                <tr>\n                    <td class=\"tc-left\">\n                        <div class=\"t-title\">{{ task.wp_title }}</div>\n                        {% if task.wp_description %}\n                            {% if 'Note:' in task.wp_description or 'note' in task.wp_description|lower %}\n                                <div class=\"t-desc\">{{ task.wp_description }}</div>\n                            {% else %}\n                                <div class=\"t-desc-norm\">{{ task.wp_description }}</div>\n                            {% endif %}\n                        {% endif %}\n                    </td>\n                    <td class=\"tc-right\">\n                        \n                        <!-- LINE 1: START & END DATES -->\n                        <div style=\"margin-bottom: 6px; white-space: nowrap;\">\n                            <div class=\"date-box\">\n                                <span class=\"d-lbl\">PLAN START DATE :</span> \n                                {{ frappe.utils.formatdate(task.wp_start_date, \"dd/MM/yyyy\") if task.wp_start_date else \"-\" }}\n                            </div>\n                            <div class=\"date-box\">\n                                <span class=\"d-lbl\">PlAN END DATE :</span> \n                                {{ frappe.utils.formatdate(task.wp_end_date, \"dd/MM/yyyy\") if task.wp_end_date else \"-\" }}\n                            </div>\n                        </div>\n\n                        <!-- LINE 2: STATUS, PROGRESS, ECD -->\n                        <div style=\"white-space: nowrap;\">\n                            {% set t_stat = task.wp_status or 'Pending' %}\n                            {% if t_stat == 'Not Started' %} {% set t_cls = 'st-not-started' %}\n                            {% elif t_stat == 'Completed' %} {% set t_cls = 'st-completed' %}\n                            {% else %} {% set t_cls = 'st-yellow' %}\n                            {% endif %}\n                            \n                            <!-- STATUS -->\n                            <span class=\"tc-pill {{ t_cls }}\">{{ t_stat }}</span>\n                            \n                            <!-- TASK PROGRESS -->\n                            <span class=\"tc-pill\" style=\"background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; margin-left: 4px;\">\n                                {{ (task.wp_progress or 0)|int }}%\n                            </span>\n\n                            <!-- ESTIMATED COMPLETION DATE (Safe Check) -->\n                            {% if task.wp_estimate_completion_date %}\n                                <div class=\"date-box\" style=\"margin-left: 4px; display: inline-block;\">\n                                    <span class=\"d-lbl\">EST. COMPL DATE:</span> \n                                    {{ frappe.utils.formatdate(task.wp_estimate_completion_date, \"dd/MM/yyyy\") }}\n                                </div>\n                            {% endif %}\n                        </div>\n\n                    </td>\n                </tr>\n            </table>\n        {% endfor %}\n    </div>\n{% endmacro %}\n\n<!-- 3. STYLES -->\n<style>\n    @page { size: A4 landscape; margin: 10mm; }\n    html, body { font-family: 'Helvetica', Arial, sans-serif; font-size: 11px; color: #111; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; background-color: #fff; }\n    table { width: 100%; border-collapse: collapse; border-spacing: 0; }\n    td { vertical-align: top; padding: 5px; }\n    \n    .header-wrapper { width: 100%; margin-bottom: 20px; }\n    .logo-img { height: 40px; display: block; margin-bottom: 8px; }\n    .company-name-lg { font-size: 14px; font-weight: bold; color: #000; margin-bottom: 4px; }\n    .company-addr-lg { font-size: 10px; color: #555; margin-bottom: 12px; }\n    .header-border { border-bottom: 3px solid #000; margin-bottom: 15px; }\n    \n    .report-meta-table { width: 100%; margin-bottom: 10px; border-bottom: 1px solid #e5e7eb; }\n    .report-title-lg { font-size: 18px; font-weight: bold; color: #000; padding-bottom: 8px; }\n    .report-date-lg { font-size: 11px; font-weight: bold; color: #000; text-align: right; padding-bottom: 8px; text-transform: uppercase; }\n    \n    .info-card-table { width: 100%; border: 1px solid #e5e7eb; margin-bottom: 30px; table-layout: fixed; }\n    .info-card-td { padding: 12px 15px; border-right: 1px solid #e5e7eb; vertical-align: top; }\n    .info-card-td:last-child { border-right: none; }\n    .card-label { font-size: 10px; font-weight: bold; color: #6b7280; text-transform: uppercase; margin-bottom: 5px; display: block; }\n    .card-value { font-size: 13px; font-weight: bold; color: #111; display: block; }\n    .badge-round-lg { display: inline-block; background-color: #1d4ed8; color: #fff; width: 26px; height: 26px; line-height: 26px; border-radius: 50%; text-align: center; font-weight: bold; font-size: 11px; }\n\n    .section-wrapper { page-break-inside: avoid; margin-bottom: 25px; }\n    /* REMOVED BOTTOM MARGIN FOR LAST SECTION */\n    .section-wrapper:last-child { margin-bottom: 0; }\n\n    .sec-header-table { margin-bottom: 12px; page-break-after: avoid; }\n    .sec-title-td { border-left: 5px solid #E63946; padding-left: 10px; vertical-align: middle; padding-top: 8px; padding-bottom: 8px; }\n    .sec-title-text { font-size: 16px; font-weight: 800; color: #0f172a; display: inline-block; margin-right: 8px; vertical-align: middle; }\n    .sec-count-circle { display: inline-block; background-color: #1d4ed8; color: #ffffff; width: 24px; height: 24px; line-height: 24px; border-radius: 50%; text-align: center; font-size: 12px; font-weight: bold; vertical-align: middle; }\n    \n    /* NEW ZONE SUB-HEADER STYLE */\n    .zone-sub-header {\n        background-color: #f3f4f6;\n        color: #111827;\n        font-weight: bold;\n        font-size: 12px;\n        padding: 6px 10px;\n        border-left: 4px solid #9ca3af;\n        margin-bottom: 10px;\n        margin-top: 5px;\n        text-transform: uppercase;\n        border-radius: 2px;\n    }\n\n    .milestone-container { border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 15px; overflow: hidden; page-break-inside: avoid; }\n    /* REMOVED BOTTOM MARGIN FOR LAST MILESTONE CARD */\n    .milestone-container:last-child { margin-bottom: 0; }\n\n    .ms-head-table { width: 100%; background-color: #fcfcfc; }\n    .ms-head-td { padding: 10px 12px; vertical-align: middle; border-bottom: 1px solid #f0f0f0; }\n    .lbl { display: block; font-size: 8px; color: #999; text-transform: uppercase; font-weight: bold; margin-bottom: 3px; }\n    .val-main { font-weight: bold; font-size: 12px; color: #000; }\n    .badge-zone { border: 1px dashed #9ca3af; background: #f3f4f6; padding: 3px 6px; border-radius: 4px; font-size: 10px; color: #374151; }\n    \n    .badge-status { padding: 4px 10px; border-radius: 12px; font-size: 10px; font-weight: bold; display: inline-block; }\n    .st-not-started { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; } \n    .st-completed { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }\n    .st-yellow { background: #fef9c3; color: #854d0e; border: 1px solid #fef08a; }\n\n    /* Text Progress Styles */\n    .prog-text { font-size: 12px; font-weight: bold; padding: 2px 0; }\n    .txt-red { color: #dc2626; }\n    .txt-green { color: #166534; }\n    .txt-yellow { color: #854d0e; }\n\n    .blue-strip { background-color: #eff6ff; color: #1e40af; font-weight: bold; font-size: 11px; padding: 8px 15px; border-top: 1px solid #dbeafe; border-bottom: 1px solid #dbeafe; }\n    .count-circle { background: #1e40af; color: #fff; padding: 1px 6px; border-radius: 10px; font-size: 9px; margin-left: 5px; }\n    .task-container-div { padding: 12px; background-color: #fff; }\n    .task-card-table { border: 1px solid #e5e7eb; border-radius: 5px; margin-bottom: 8px; background: #fff; width: 100%; }\n    \n    /* Modified Column Widths: 55/45 to accommodate dates better */\n    .tc-left { padding: 10px; vertical-align: top; width: 55%; }\n    .tc-right { padding: 10px; vertical-align: top; width: 45%; text-align: right; }\n    \n    .t-title { font-weight: bold; font-size: 11px; color: #111; margin-bottom: 4px; }\n    .t-desc { font-style: italic; font-size: 10px; color: #f97316; } \n    .t-desc-norm { font-size: 10px; color: #6b7280; }\n    \n    /* Pill and Date Box Styling */\n    .tc-pill { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 9px; font-weight: bold; vertical-align: middle; }\n    .date-box { display: inline-block; border: 1px solid #e5e7eb; background: #f9fafb; padding: 4px 8px; border-radius: 4px; font-size: 9px; color: #374151; margin-right: 2px; vertical-align: middle; }\n    .d-lbl { font-size: 7px; text-transform: uppercase; color: #aaa; margin-right: 2px; }\n</style>\n\n<div class=\"print-format\">\n\n    <!-- 1. HEADER SECTION -->\n    <div class=\"header-wrapper\">\n        <img src=\"{{ logo_url }}\" class=\"logo-img\">\n        <div class=\"company-name-lg\">{{ company_name }}</div>\n        <div class=\"company-addr-lg\">{{ company_info.address }}</div>\n        <div class=\"header-border\"></div>\n    </div>\n\n    <!-- 2. REPORT TITLE & DATE -->\n    <table class=\"report-meta-table\">\n        <tr>\n            <td class=\"report-title-lg\">Work Plan</td>\n            <td class=\"report-date-lg\">REPORT DATE : {{ frappe.utils.formatdate(frappe.utils.nowdate(), \"dd-MM-yyyy\") }}</td>\n        </tr>\n    </table>\n\n    <!-- 3. INFO CARD -->\n    <table class=\"info-card-table\">\n        <tr>\n            <td class=\"info-card-td\" style=\"width: 35%;\">\n                <span class=\"card-label\">PROJECT NAME</span>\n                <span class=\"card-value\">{{ doc.project_name }}</span>\n            </td>\n            <td class=\"info-card-td\" style=\"width: 15%; text-align: center;\">\n                <span class=\"card-label\" style=\"text-align: center;\">TOTAL ACT.</span>\n                <span class=\"badge-round-lg\">{{ global_ns.grand_total }}</span>\n            </td>\n            <td class=\"info-card-td\" style=\"width: 25%;\">\n                <span class=\"card-label\">DATE RANGE</span>\n                <span class=\"card-value\">\n                    {% if is_all_time %}\n                        ALL TIME\n                    {% else %}\n                        {{ frappe.utils.formatdate(start_date, \"dd-MM-yyyy\") }} \n                        <br/>to<br/>\n                        {{ frappe.utils.formatdate(end_date, \"dd-MM-yyyy\") }}\n                    {% endif %}\n                </span>\n            </td>\n            <td class=\"info-card-td\" style=\"width: 25%;\">\n                <span class=\"card-label\">ZONE</span>\n                <span class=\"card-value\">\n                    {{ \"ALL ZONES\" if show_all_zones else zone_param }}\n                </span>\n            </td>\n        </tr>\n    </table>\n\n    <!-- 4. CONTENT -->\n    {% if not data or (data is mapping and data|length == 0) %}\n        <div style=\"text-align:center; padding:50px; border:2px dashed #e5e7eb; margin-top:20px; color:#9ca3af; font-size: 14px;\">\n            {% if api_reason %}\n                <span style=\"color: #ef4444; font-weight: bold;\">{{ api_reason }}</span>\n            {% else %}\n                No planned activities found for the selected period.\n            {% endif %}\n        </div>\n    {% else %}\n\n        {% for header, milestones in data.items() %}\n            {# Filter milestones with tasks AND match Zone safely #}\n            {% set valid_milestones = [] %}\n            {% set ns = namespace(total_tasks=0) %}\n            \n            {% for m in milestones %}\n                {%- set m_zone_safe = (m.zone or \"\")|string|lower|trim -%}\n                {%- set p_zone_safe = (zone_param or \"\")|string|lower|trim -%}\n                \n                {% if show_all_zones or (m_zone_safe == p_zone_safe) %}\n                    {% if m.work_plan_doc and m.work_plan_doc|length > 0 %}\n                        {% set _ = valid_milestones.append(m) %}\n                        {% set ns.total_tasks = ns.total_tasks + (m.work_plan_doc|length) %}\n                    {% endif %}\n                {% endif %}\n            {% endfor %}\n\n            {# Only render section if there are valid milestones #}\n            {% if valid_milestones|length > 0 %}\n                <div class=\"section-wrapper\">\n                    <!-- Section Header -->\n                    <table class=\"sec-header-table\" width=\"100%\">\n                        <tr>\n                            <td class=\"sec-title-td\">\n                                <span class=\"sec-title-text\">{{ header }}</span>\n                                <span class=\"sec-count-circle\">{{ ns.total_tasks }}</span>\n                            </td>\n                        </tr>\n                    </table>\n\n                    {# --- LOGIC FOR GROUPING BY ZONE IF 'ALL ZONES' IS SELECTED --- #}\n                    {% if show_all_zones %}\n                        \n                        {# 1. Collect Unique Zones within this header's valid milestones #}\n                        {% set found_zones = [] %}\n                        {% for m in valid_milestones %}\n                             {% set z_val = m.zone or \"General\" %}\n                             {% if z_val not in found_zones %}\n                                 {% set _ = found_zones.append(z_val) %}\n                             {% endif %}\n                        {% endfor %}\n                        \n                        {# 2. Loop through Unique Zones and Render Sub-Headers #}\n                        {% for z_key in found_zones %}\n                             <!-- ZONE HEADER -->\n                             <div class=\"zone-sub-header\">Zone : {{ z_key }}</div>\n                             \n                             <!-- Render Milestones for this Zone -->\n                             {% for item in valid_milestones %}\n                                 {% set m_z = item.zone or \"General\" %}\n                                 {% if m_z == z_key %}\n                                      <div class=\"milestone-container\">\n                                          {{ render_milestone_card(item) }}\n                                      </div>\n                                 {% endif %}\n                             {% endfor %}\n                        {% endfor %}\n\n                    {% else %}\n                        {# --- NORMAL RENDERING (Specific Zone Selected) --- #}\n                        {% for item in valid_milestones %}\n                            <div class=\"milestone-container\">\n                                {{ render_milestone_card(item) }}\n                            </div>\n                        {% endfor %}\n                    {% endif %}\n\n                </div>\n            {% endif %}\n\n        {% endfor %}\n\n    {% endif %}\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2026-01-12 19:58:06.153155",
  "module": "Nirmaan Stack",
  "name": "Project Work Plan",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Projects",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!-- \n    PRINT FORMAT: Material Delivery Plan (Final Fixed Header & Text Wrap)\n    Features:\n    - HEADER FIX: Increased Title to 24px to match 'Work Plan'.\n    - TEXT FIX: Pills allow text wrapping (no cut-off).\n-->\n\n<!-- ========================================== -->\n<!-- 1. SERVER-SIDE DATA LOGIC                  -->\n<!-- ========================================== -->\n\n<!-- Get Date Parameters from URL/Form -->\n{%- set start_param = frappe.form_dict.start_date -%}\n{%- set end_param = frappe.form_dict.end_date -%}\n{%- set is_all_time = false -%}\n{%- set start_date = None -%}\n{%- set end_date = None -%}\n\n<!-- Apply Filters -->\n{%- if start_param and end_param -%}\n    {%- set start_date = start_param -%}\n    {%- set end_date = end_param -%}\n    {%- set filters = {\"project\": doc.name, \"delivery_date\": [\"between\", [start_date, end_date]]} -%}\n{%- else -%}\n    {%- set is_all_time = true -%}\n    {%- set filters = {\"project\": doc.name} -%}\n{%- endif -%}\n\n<!-- Fetch Plans from Database -->\n{%- set plans = frappe.get_all(\"Material Delivery Plan\", \n    filters=filters, \n    fields=[\"name\", \"package_name\", \"po_link\", \"po_type\", \"delivery_date\", \"mp_items\", \"creation\"],\n    order_by=\"creation desc\"\n) -%}\n{%- set total_count = plans|length -%}\n\n<!-- Company & GST Configuration -->\n{%- set nirmaan_gst_map = {\n    \"29ABFCS9095N1Z9\": {\"state\": \"Karnataka\", \"address\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\"},\n    \"06ABFCS9095N1ZH\": {\"state\": \"Haryana\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram - 122002, Haryana\"},\n    \"09ABFCS9095N1ZB\": {\"state\": \"Uttar Pradesh\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"}\n} -%}\n{%- set default_gst = \"29ABFCS9095N1Z9\" -%}\n{%- set final_gst = default_gst -%}\n\n<!-- Logic to pick address based on Project GST -->\n{%- if doc.project_gst_number -%}\n    {%- set raw_gst = doc.project_gst_number -%}\n    {%- if raw_gst is string -%}\n        {%- set gst_data = json.loads(raw_gst) -%}\n    {%- else -%}\n        {%- set gst_data = raw_gst -%}\n    {%- endif -%}\n    {%- if gst_data and gst_data.list and gst_data.list|length > 0 -%}\n        {%- set extracted_gst = gst_data.list[0].gst -%}\n        {%- if extracted_gst in nirmaan_gst_map -%}\n            {%- set final_gst = extracted_gst -%}\n        {%- endif -%}\n    {%- endif -%}\n{%- endif -%}\n\n{%- set company_info = nirmaan_gst_map[final_gst] -%}\n{%- set company_name = \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\" -%}\n{%- set logo_url = \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" -%}\n\n\n<!-- ========================================== -->\n<!-- 2. CSS STYLING                             -->\n<!-- ========================================== -->\n<style>\n    @page { size: A4 portrait; margin: 10mm; }\n    \n    html, body {\n        font-family: 'Helvetica', Arial, sans-serif;\n        font-size: 10px;\n        color: #111;\n        background-color: #fff;\n        -webkit-print-color-adjust: exact !important; \n        print-color-adjust: exact !important;\n    }\n\n     /* --- HEADER STYLES --- */\n    .header-wrapper { width: 100%; margin-bottom: 20px; }\n    .logo-img { height: 40px; display: block; margin-bottom: 8px; }\n    .company-name-lg { font-size: 14px; font-weight: bold; color: #000; margin-bottom: 4px; }\n    .company-addr-lg { font-size: 10px; color: #555; margin-bottom: 12px; }\n    .header-border { border-bottom: 3px solid #000; margin-bottom: 15px; }\n    \n    /* --- REPORT META --- */\n    .report-meta-table { width: 100%; margin-bottom: 10px; border-bottom: 1px solid #e5e7eb; }\n    .report-title-lg { font-size: 18px; font-weight: bold; color: #000; padding-bottom: 8px; }\n    .report-date-lg { font-size: 11px; font-weight: bold; color: #000; text-align: right; padding-bottom: 8px; text-transform: uppercase; }\n\n    /* INFO CARD (Summary Box) */\n    .info-card { width: 100%; border: 1px solid #ddd; margin-bottom: 20px; table-layout: fixed; border-collapse: collapse; }\n    .info-td { padding: 8px 10px; border-right: 1px solid #ddd; vertical-align: top; }\n    .info-td:last-child { border-right: none; }\n    .info-lbl { font-size: 9px; color: #777; font-weight: bold; text-transform: uppercase; display: block; margin-bottom: 2px; }\n    .info-val { font-size: 12px; color: #000; font-weight: bold; }\n    \n    .circle-badge {\n        display: inline-block; background-color: #1d4ed8; color: #fff;\n        width: 22px; height: 22px; line-height: 22px; border-radius: 50%;\n        text-align: center; font-size: 10px; font-weight: bold; margin-top: 2px;\n    }\n\n    /* PLAN CARD CONTAINER */\n    .card {\n        border: 1px solid #e5e7eb;\n        border-radius: 6px;\n        margin-bottom: 10px;\n        page-break-inside: avoid;\n        background: #fff;\n    }\n\n    /* CARD LAYOUT TABLE (Left Icon | Divider | Right Content) */\n    .card-layout { width: 100%; border-collapse: collapse; }\n    \n    /* LEFT COL: Icon & Plan # */\n    .col-left {\n        width: 60px; text-align: center; vertical-align: top; padding: 15px 5px; color: #111;\n    }\n    .plan-icon { width: 18px; height: 18px; color: #374151; margin-bottom: 2px; display: block; margin: 0 auto; }\n    .plan-txt { font-size: 11px; font-weight: 800; line-height: 1.1; }\n\n    /* RED DIVIDER */\n    .col-div { width: 5px; vertical-align: top; padding-top: 15px; }\n    .red-bar { width: 3px; height: 35px; background: #ef4444; border-radius: 2px; }\n\n    /* RIGHT CONTENT */\n    .col-right { vertical-align: top; padding: 0; }\n\n    /* METADATA TABLE (Inside Right Content) */\n    .meta-table { width: 100%; border-collapse: collapse; }\n    .meta-td { padding: 8px 10px 6px 10px; vertical-align: top; }\n    \n    /* Labels & Values */\n    .lbl { font-size: 8px; color: #6b7280; font-weight: 800; text-transform: uppercase; margin-bottom: 3px; display: block; }\n    .val { font-size: 11px; color: #111; font-weight: 500; }\n    .val-bold { font-size: 12px; color: #000; font-weight: 800; }\n    \n    /* Items Count Badge */\n    .items-badge {\n        background: #fff; border: 1px solid #ddd; border-radius: 10px; padding: 1px 6px;\n        font-size: 9px; font-weight: 700; color: #444;\n    }\n\n    /* MATERIALS ROW (The <tr> containing materials) */\n    .mat-row-td {\n        border-top: 1px solid #f3f4f6; /* Horizontal Line */\n        padding: 5px 10px 8px 10px;    /* Compact Padding */\n    }\n    \n    /* Inner Table for Label/Items alignment */\n    .inner-mat-table { width: 100%; border-collapse: collapse; }\n    \n    .mat-label-cell {\n        width: 100px; /* Fixed width for \"Materials (X):\" label */\n        font-size: 10px; font-weight: 800; color: #000;\n        vertical-align: top;\n        padding-top: 5px;\n    }\n    .mat-items-cell {\n        vertical-align: top;\n    }\n\n    /* PILL STYLE - WITH WRAP SUPPORT */\n    .pill {\n        display: inline-block;\n        background-color: #EEF2FF; /* Lavender/Indigo-50 */\n        color: #312E81;            /* Indigo-900 */\n        font-size: 10px; font-weight: 700;\n        padding: 3px 6px;\n        border-radius: 4px;\n        margin-right: 3px;\n        margin-bottom: 4px;\n        \n        /* Forces text to wrap instead of hiding */\n        white-space: normal;       \n        word-wrap: break-word;     \n        line-height: 1.4;          \n        max-width: 100%;           \n    }\n\n</style>\n\n<!-- ========================================== -->\n<!-- 3. HTML CONTENT                            -->\n<!-- ========================================== -->\n<div class=\"print-format\">\n\n    <!-- 1. HEADER Section (Nirmaan Logo & Address) -->\n    <div class=\"header-wrapper\">\n        <img src=\"{{ logo_url }}\" class=\"logo-img\">\n        <div class=\"company-name-lg\">{{ company_name }}</div>\n        <div class=\"company-addr-lg\">{{ company_info.address }}</div>\n        <div class=\"header-border\"></div>\n    </div>\n\n    <!-- 2. TITLE & DATE (Larger Font to match Work Plan) -->\n    <table class=\"report-meta-table\">\n        <tr>\n            <td class=\"report-title-lg\">Material Plan</td>\n            <td class=\"report-date-lg\">REPORT DATE : {{ frappe.utils.formatdate(frappe.utils.nowdate(), \"dd-MM-yyyy\") }}</td>\n        </tr>\n    </table> \n\n    <!-- 3. Info Card (Project Summary) -->\n    <table class=\"info-card\">\n        <tr>\n            <td class=\"info-td\" style=\"width: 40%;\">\n                <span class=\"info-lbl\">PROJECT NAME</span>\n                <span class=\"info-val\">{{ doc.project_name }}</span>\n            </td>\n            <td class=\"info-td\" style=\"width: 20%; text-align: center;\">\n                <span class=\"info-lbl\">TOTAL PLANS</span>\n                <span class=\"circle-badge\">{{ total_count }}</span>\n            </td>\n            <td class=\"info-td\" style=\"width: 40%;\">\n                <span class=\"info-lbl\">DATE RANGE</span>\n                <span class=\"info-val\">\n                    {% if is_all_time %}\n                        ALL TIME\n                    {% else %}\n                        {{ frappe.utils.formatdate(start_date, \"dd-MM-yyyy\") }} - {{ frappe.utils.formatdate(end_date, \"dd-MM-yyyy\") }}\n                    {% endif %}\n                </span>\n            </td>\n        </tr>\n    </table>\n\n    <!-- No Plans Found State -->\n    {% if not plans %}\n        <div style=\"text-align:center; padding:40px; color:#888; border:1px dashed #ddd; font-size:12px;\">\n            No Material Delivery Plans found.\n        </div>\n    {% else %}\n        \n        <!-- Loop Through Each Plan -->\n        {% for plan in plans %}\n            \n            <!-- Logic to parse Items List safely -->\n            {% set items_list = [] %}\n            {% if plan.mp_items %}\n                {% if plan.mp_items is string %}\n                    {% set parsed = json.loads(plan.mp_items) %}\n                {% else %}\n                    {% set parsed = plan.mp_items %}\n                {% endif %}\n                \n                {% if parsed and parsed is mapping and parsed.list %}\n                    {% set items_list = parsed.list %}\n                {% elif parsed and parsed is iterable and parsed is not string and parsed is not mapping %}\n                    {% set items_list = parsed %}\n                {% endif %}\n            {% endif %}\n            {% set items_count = items_list|length %}\n            \n            <!-- Calculate Plan Number (Reverse Order) -->\n            {% set plan_num = plans|length - loop.index0 %}\n\n            <!-- Plan Card -->\n            <div class=\"card\">\n                <table class=\"card-layout\">\n                    <tr>\n                        <!-- LEFT COL: Icon & Plan ID -->\n                        <td class=\"col-left\">\n                            <svg class=\"plan-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                                <path d=\"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\"></path>\n                                <polyline points=\"3.27 6.96 12 12.01 20.73 6.96\"></polyline>\n                                <line x1=\"12\" y1=\"22.08\" x2=\"12\" y2=\"12\"></line>\n                            </svg>\n                            <div class=\"plan-txt\">Plan<br>{{ plan_num }}</div>\n                        </td>\n\n                        <!-- DIVIDER: Red Line -->\n                        <td class=\"col-div\">\n                            <div class=\"red-bar\"></div>\n                        </td>\n\n                        <!-- RIGHT COL: Content -->\n                        <td class=\"col-right\">\n                            <table class=\"meta-table\">\n                                <!-- ROW 1: Metadata (Work Package, PO, Dates) -->\n                                <tr>\n                                    <td class=\"meta-td\" style=\"width: 25%;\">\n                                        <span class=\"lbl\">WORK PACKAGE</span>\n                                        <span class=\"val-bold\">{{ plan.package_name }}</span>\n                                    </td>\n                                    <td class=\"meta-td\" style=\"width: 25%;\">\n                                        <span class=\"lbl\">PO ID</span>\n                                        <span class=\"val\">{{ plan.po_link or \"--\" }}</span>\n                                    </td>\n                                    <td class=\"meta-td\" style=\"width: 15%;\">\n                                        <span class=\"lbl\">PO TYPE</span>\n                                        <span class=\"val\">{{ plan.po_type }}</span>\n                                    </td>\n                                    <td class=\"meta-td\" style=\"width: 15%;\">\n                                        <span class=\"lbl\">MATERIALS</span>\n                                        <span class=\"items-badge\">{{ items_count }} Items</span>\n                                    </td>\n                                    <td class=\"meta-td\" style=\"width: 20%;\">\n                                        <span class=\"lbl\">DELIVERY DATE</span>\n                                        <span class=\"val-bold\">\n                                            {{ frappe.utils.formatdate(plan.delivery_date, \"dd/MM/yyyy\") if plan.delivery_date else \"-\" }}\n                                        </span>\n                                    </td>\n                                </tr>\n\n                                <!-- ROW 2: Materials (Nested Loop) -->\n                                \n                            </table>\n                        </td>\n                        \n                    </tr>\n                    {% if items_list %}\n                                <tr>\n                                    <td colspan=\"5\" class=\"mat-row-td\">\n                                        <!-- Nested Table for specific layout -->\n                                        <table class=\"inner-mat-table\">\n                                            <tr>\n                                                <td class=\"mat-label-cell\">\n                                                    Materials ({{ items_count }}):\n                                                </td>\n                                                <td class=\"mat-items-cell\">\n                                                    {% for item in items_list %}\n                                                        <span class=\"pill\">{{ item.item_name }}</span>\n                                                    {% endfor %}\n                                                </td>\n                                            </tr>\n                                        </table>\n                                    </td>\n                                </tr>\n                                {% endif %}\n                </table>\n            </div>\n\n        {% endfor %}\n    {% endif %}\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-12-31 13:06:07.119757",
  "module": "Nirmaan Stack",
  "name": "Project Material Plan",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: PO Nirmaan (Non-Commercial / Qty Only)\n    DocType: Procurement Order\n#}\n\n{# --- Company Details --- #}\n{%- set company_details = {\n    \"name\": \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"logo_url\": \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\",\n    \"nirmaan_seal\": \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/NIRMAAN-SEAL-D2HgrCMb.jpeg\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": \"Bengaluru\",\n        \"06ABFCS9095N1ZH\": \"Gurugram\",\n        \"09ABFCS9095N1ZB\": \"Noida\"\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park Cowarking Space, Mehrauli Gurugram Rd, Tower D, Sikanderpur, Gurugram, Haryana - 122002\",\n        \"09ABFCS9095N1ZB\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305\"\n    },\n    \"default_address\": \"Company address details missing or project GST not set.\"\n} -%}\n\n{# Determine current company address and GST #}\n{%- set current_company_gst = doc.project_gst if doc.project_gst in company_details.gst_numbers else None -%}\n{%- set current_company_address = company_details.addresses[current_company_gst] if current_company_gst else company_details.default_address -%}\n\n{# ----------- Macro: Address Formatter --------------------- #}\n{% macro format_address(addr_name) -%}\n    {%- if not addr_name -%}N/A\n    {%- else -%}\n        {%- set ad = frappe.get_doc(\"Address\", addr_name) -%}\n        {%- set parts = [] -%}\n        {%- if ad.address_line1 %}{% set parts = parts + [ad.address_line1] %}{% endif -%}\n        {%- if ad.address_line2 %}{% set parts = parts + [ad.address_line2] %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if ad.city %}{% set csp = csp + [ad.city] %}{% endif -%}\n        {%- if ad.state %}{% set csp = csp + [ad.state] %}{% endif -%}\n        {%- if ad.pincode %}{% set csp = csp + [ad.pincode] %}{% endif -%}\n        {%- if csp %}{% set parts = parts + [csp | join(\" \")] %}{% endif -%}\n        {%- if ad.country %}{% set parts = parts + [ad.country] %}{% endif -%}\n        {{ parts | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{# ----------- Macro: Render Header --------------------- #}\n{% macro render_header() -%}\n  <table style=\"width:100%; font-family:Helvetica,Arial,sans-serif; font-size:9.5px; border-bottom: 4px solid #000; padding-bottom: 8px; margin-bottom: 15px;\">\n    <tr>\n      <td style=\"width:40%; vertical-align:top;\">\n        <img src=\"{{ company_details.logo_url }}\" style=\"max-width:140px; max-height:38px\">\n      </td>\n      <td style=\"text-align:right; font-size:11px; vertical-align:top;\">\n        <strong>{{ company_details.name }}</strong><br>\n        {{ current_company_address }}<br>\n        {% if current_company_gst %}<strong>GSTIN:</strong> {{ current_company_gst }}{% endif %}\n      </td>\n    </tr>\n  </table>\n{%- endmacro %}\n\n{%- set project_doc = frappe.get_doc(\"Projects\", doc.project) if doc.project else None -%}\n{%- set vendor_doc = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n\n{# ----------- Pre-rendered HTML blocks ----------------------- #}\n{% set vendor_address_html  = format_address(vendor_doc.vendor_address) if vendor_doc else \"N/A\" %}\n{% set project_address_html = format_address(project_doc.project_address) if project_doc else \"N/A\" %}\n\n<style>\n    body { font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif; font-size: 10px; color: #333; margin: 0; padding: 0; }\n    \n    @page {\n        size: A4;\n        margin: 10mm 12mm 15mm 12mm;\n    }\n    \n    /* HEADER STYLES */\n    .header img.logo { max-width: 140px; max-height: 40px; margin-bottom: 8px; float: left; }\n    \n    /* New Styles for Top Section Layout */\n    .po-header-wrapper {\n        width: 100%;\n        overflow: hidden;\n        border-bottom: 2px solid #333; \n        padding-bottom: 10px;\n        margin-bottom: 15px;\n        margin-top: 10px;\n    }\n    \n    .po-header-left-title {\n        float: left;\n        width: 50%;\n        font-size: 22px; \n        font-weight: bold; \n        color: #1a1a1a; \n        text-transform: uppercase;\n        padding-top: 5px; \n    }\n    \n    .po-header-right-details {\n        float: right;\n        width: 49%;\n        text-align: right;\n    }\n\n    .po-header-right-details p {\n        margin: 2px 0;\n        line-height: 1.4;\n        font-size: 10px;\n    }\n    \n    /* INFO BLOCKS */\n    .address-block { margin-bottom:15px; overflow:hidden; }\n    .address-block__col { width:48%; float:left; font-size:9.5px; }\n    .address-block__col + .address-block__col { float:right; }\n    .address-block h4 { font-size: 10px; font-weight: bold; text-transform: uppercase; color: #555; margin: 0 0 6px 0; }\n\n    /* ITEMS TABLE */\n    .items-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }\n    .items-table th, .items-table td { border: 1px solid #ddd; padding: 5px 7px; text-align: left; }\n    .items-table th { background-color: #f0f0f0; font-weight: bold; font-size: 9.5px; text-transform: uppercase; }\n    .items-table td { font-size: 9.5px; }\n    .text-right { text-align: right; } .text-center { text-align: center; }\n\n    /* TOTALS SECTION */\n    .totals-section { width: 100%; margin-top: 15px; overflow: hidden; }\n    .notes-terms { width: 100%; font-size: 9.5px; }\n    \n    /* ATTACHMENT DISPLAY */\n    .section-title { font-size: 11px; font-weight: 800; color: #374151; margin-bottom: 5px; text-transform: uppercase; border-bottom: 1px solid #e5e7eb; padding-bottom: 3px; margin-top: 20px; }\n    .converted-image-container { text-align: center; margin-top: 0px; page-break-inside: avoid; }\n    .converted-image-container img { max-width: 100%;display: block; margin: 0 auto; }\n\n    /* FOOTER */\n    .footer-notes { margin-top: 25px; font-size: 8.5px; color: #777; border-top: 1px dashed #ccc; padding-top: 8px; text-align: center; }\n    \n    /* SIGNATURE AREA UPDATED */\n    .signature-area { margin-top: 40px; text-align: right; }\n    .signature-area img.seal { max-width: 90px; max-height: 90px; display: block; margin-left: auto; margin-bottom: 5px; }\n    .signature-area .line { width: 180px; border-top: 1px solid #333; margin-left: auto; margin-bottom: 5px; }\n    .signature-area p { font-size: 9.5px; margin:0; }\n    \n</style>\n\n<div class=\"print-format\">\n\n    {# --- HEADER --- #}\n    {{ render_header() }}\n\n    {# --- PO DETAILS --- #}\n    <div class=\"po-header-wrapper\">\n        <div class=\"po-header-left-title\">Purchase Order</div>\n        <div class=\"po-header-right-details\">\n            <p><strong>PO Number:</strong> {{ doc.name }}</p>\n            <p><strong>PO Date:</strong> {{ frappe.utils.formatdate(doc.creation, \"dd-MM-yyyy\") }}</p>\n        </div>\n    </div>\n\n    <div class=\"address-block\">\n        <div class=\"address-block__col\">\n            <h4>VENDOR DETAILS</h4>\n            <p><strong>{{ vendor_doc.vendor_name if vendor_doc else doc.vendor }}</strong></p>\n            {{ vendor_address_html }}\n            {% if vendor_doc and vendor_doc.vendor_gst %}<p><strong>GSTIN:</strong> {{ vendor_doc.vendor_gst }}</p>{% endif %}\n        </div>\n        <div class=\"address-block__col\">\n            <h4>SHIP-TO / PROJECT DETAILS</h4>\n            <p><strong>{{ project_doc.project_name if project_doc else doc.project }}</strong></p>\n            {{ project_address_html }}\n            {% if doc.delivery_contact %}<p><strong>Site Contact:</strong> {{ doc.delivery_contact }}</p>{% endif %}\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n\n    {# --- ITEMS TABLE (Modified: Rate, Tax, Amount Removed) --- #}\n    <table class=\"items-table\">\n        <thead>\n            <tr>\n                <th style=\"width:5%;\">Sr.</th>\n                <th style=\"width:55%;\">Item Description</th>\n                <th style=\"width:20%;\" class=\"text-center\">Make</th>\n                <th style=\"width:10%;\" class=\"text-center\">Qty</th>\n                <th style=\"width:10%;\" class=\"text-center\">Unit</th>\n            </tr>\n        </thead>\n        <tbody>\n            {% set total_qty = namespace(value=0.0) %}\n\n            {% if doc.items and doc.items | length > 0 %}\n                {% for item in doc.items %}\n                    <tr>\n                        <td class=\"text-center\">{{ loop.index }}</td>\n                        <td>\n                            {{ item.item or item.item_name }}\n                            {% if item.comment %}<br><small><em>Note: {{ item.comment }}</em></small>{% endif %}\n                        </td>\n                        <td class=\"text-center\">{{ item.make or \"-\" }}</td>\n                        {%- set current_item_quantity = (item.quantity | default(0) | float) -%}\n                        <td class=\"text-center\">{{ current_item_quantity | round(2) }}</td>\n                        <td class=\"text-center\">{{ item.unit or \"N/A\" }}</td>\n                        \n                        {%- set total_qty.value = total_qty.value + current_item_quantity -%}\n                    </tr>\n                {% endfor %}\n            {% else %}\n                <tr><td colspan=\"5\" style=\"text-align:center; padding: 20px;\">No items found.</td></tr>\n            {% endif %}\n        </tbody>\n    </table>\n    \n    {# --- BOTTOM SECTION (Modified: Financials Removed) --- #}\n    <div class=\"totals-section\">\n        <div class=\"notes-terms\">\n         \n            \n            {% if doc.notes %}\n            <div style=\"margin-top:10px;\">\n                <h4 style=\"font-size:10px; font-weight:bold; margin-bottom:3px;\">NOTES & TERMS:</h4>\n                <div style=\"font-size:9px; white-space: pre-wrap;\">{{ doc.notes }}</div>\n            </div>\n            {% endif %}\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n    \n    {# --- SIGNATURE AREA --- #}\n    <div class=\"signature-area\">\n        {% if company_details.nirmaan_seal %}\n            <img src=\"{{ company_details.nirmaan_seal }}\" class=\"seal\" alt=\"Seal\">\n        {% endif %}\n        <div class=\"line\"></div>\n        <p>For <strong>{{ company_details.name }}</strong></p>\n        <p>(Authorized Signatory)</p>\n    </div>\n\n    {# --- ATTACHMENT SECTION --- #}\n    \n    <div class=\"footer-notes\">\n        This is a computer-generated Purchase Order.\n    </div>\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2026-01-02 17:20:29.893173",
  "module": "Nirmaan Stack",
  "name": "PO Orders Without Rate",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Projects",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!-- \n    PRINT FORMAT: Work Plan (Buffered + Zone Grouping + Full Labels + Date Range)\n-->\n\n<!-- 1. DATA & CONFIG -->\n{%- set start_param = frappe.form_dict.start_date or frappe.request.args.start_date -%}\n{%- set end_param = frappe.form_dict.end_date or frappe.request.args.end_date -%}\n{%- set zone_param = frappe.form_dict.zone or frappe.request.args.zone -%}\n\n{# --- BUFFER PARAMETERS --- #}\n{%- set raw_buffer_days = frappe.form_dict.buffer_days or frappe.request.args.buffer_days -%}\n{%- set raw_add_start   = frappe.form_dict.add_to_start or frappe.request.args.add_to_start -%}\n{%- set raw_add_end     = frappe.form_dict.add_to_end or frappe.request.args.add_to_end -%}\n\n{# --- CONVERT BUFFER TO INT / BOOLEAN --- #}\n{%- set buffer_days_param = (raw_buffer_days or 0) | int -%}\n{%- set add_to_start_param = true if (raw_add_start|string|lower == 'true') else false -%}\n{%- set add_to_end_param   = true if (raw_add_end|string|lower == 'true') else false -%}\n\n{# --- LOGIC: Handle 'All' Parameter & Column Visibility --- #}\n{# Default to All if no zone is provided #}\n{%- set show_all_zones = (not zone_param) or (zone_param|string|lower == 'all') or (zone_param|string|lower == 'none') -%}\n\n{# --- LOGIC: ALL TIME vs DATE RANGE --- #}\n{%- set is_all_time = false -%}\n{%- set start_date = None -%}\n{%- set end_date = None -%}\n\n{%- if start_param and end_param -%}\n    {%- set start_date = start_param -%}\n    {%- set end_date = end_param -%}\n{%- else -%}\n    {%- set is_all_time = true -%}\n{%- endif -%}\n\n{# --- LOGIC: COMPANY ADDRESS --- #}\n{%- set nirmaan_gst_map = {\n    \"29ABFCS9095N1Z9\": {\"state\": \"Karnataka\", \"address\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\"},\n    \"06ABFCS9095N1ZH\": {\"state\": \"Haryana\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram - 122002, Haryana\"},\n    \"09ABFCS9095N1ZB\": {\"state\": \"Uttar Pradesh\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"}\n} -%}\n{%- set default_gst = \"29ABFCS9095N1Z9\" -%}\n{%- set final_gst = default_gst -%}\n\n{%- if doc.project_gst_number -%}\n    {%- set raw_gst = doc.project_gst_number -%}\n    {%- if raw_gst is string -%} \n        {# Simple check: if it looks like JSON, parse it. Otherwise ignore. #}\n        {%- if raw_gst.startswith('{') -%}\n            {%- set gst_data = json.loads(raw_gst) -%}\n        {%- else -%}\n            {%- set gst_data = {} -%}\n        {%- endif -%}\n    {%- else -%} \n        {%- set gst_data = raw_gst -%} \n    {%- endif -%}\n    \n    {%- if gst_data and gst_data is mapping and gst_data.get('list') -%}\n        {%- set extracted_gst = gst_data.list[0].gst -%}\n        {%- if extracted_gst in nirmaan_gst_map -%} {%- set final_gst = extracted_gst -%} {%- endif -%}\n    {%- endif -%}\n{%- endif -%}\n\n{%- set company_info = nirmaan_gst_map[final_gst] -%}\n{%- set company_name = \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\" -%}\n{%- set logo_url = \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" -%}\n\n\n{# --- API CALL --- #}\n{%- set api_call = frappe.call(\"nirmaan_stack.api.seven_days_planning.work_plan_api.get_work_plan\", project=doc.name, start_date=start_date, end_date=end_date) -%}\n{%- set raw_response = api_call.message if api_call.message is defined else api_call -%}\n{%- set data = raw_response.get('data') if raw_response and raw_response.get('data') else {} -%}\n{%- set api_reason = raw_response.get('reason') if raw_response else \"No response from API\" -%}\n\n\n{# --- GRAND TOTAL CALCULATION --- #}\n{%- set global_ns = namespace(grand_total=0) -%}\n{%- if data and data is mapping -%}\n    {%- for header, milestones in data.items() -%}\n        {%- for m in milestones -%}\n            {# Robust Zone Matching: Lowercase and Strip #}\n            {%- set m_zone_safe = (m.zone or \"\")|string|lower|trim -%}\n            {%- set p_zone_safe = (zone_param or \"\")|string|lower|trim -%}\n            \n            {%- if show_all_zones or (m_zone_safe == p_zone_safe) -%}\n                {%- if m.work_plan_doc -%}\n                    {%- set global_ns.grand_total = global_ns.grand_total + ((m.work_plan_doc or [])|length) -%}\n                {%- endif -%}\n            {%- endif -%}\n        {%- endfor -%}\n    {%- endfor -%}\n{%- endif -%}\n\n\n<!-- 2. MACRO DEFINITION -->\n{% macro render_milestone_card(item) %}\n    <!-- MILESTONE HEADER TABLE -->\n    <table class=\"ms-head-table\">\n        <tr>\n            <!-- DYNAMIC WIDTH: 60% if showing zone column, 75% if hidden -->\n            <td class=\"ms-head-td\" width=\"{{ '60%' if show_all_zones else '75%' }}\">\n                <span class=\"lbl\">Work</span>\n                <div class=\"val-main\">{{ item.work_milestone_name }}</div>\n            </td>\n\n            <!-- CONDITIONAL ZONE COLUMN (15%) -->\n            <!-- Note: Zone is handled by grouping headers, so we hide specific column to save space. -->\n            {% if show_all_zones %}\n               <!-- Kept hidden/commented as per typical grouping layout -->\n            {% endif %}\n            \n            <!-- STATUS COLUMN (15%) -->\n            <td class=\"ms-head-td\" width=\"15%\" align=\"center\">\n                <span class=\"lbl\">Status</span>\n                {% set m_stat = item.status or 'Not Started' %}\n                {% if m_stat == 'Not Started' %} \n                    {% set m_cls = 'st-not-started' %}\n                    {% set p_txt_cls = 'txt-red' %}\n                {% elif m_stat == 'Completed' %} \n                    {% set m_cls = 'st-completed' %}\n                    {% set p_txt_cls = 'txt-green' %}\n                {% else %} \n                    {% set m_cls = 'st-yellow' %}\n                    {% set p_txt_cls = 'txt-yellow' %}\n                {% endif %}\n                <span class=\"badge-status {{ m_cls }}\">{{ m_stat }}</span>\n            </td>\n\n            <!-- PROGRESS COLUMN (10%) - TEXT ONLY -->\n            <td class=\"ms-head-td\" width=\"10%\" align=\"center\">\n                <span class=\"lbl\">Progress</span>\n                <div class=\"prog-text {{ p_txt_cls }}\">{{ (item.progress or 0)|int }}%</div>\n            </td>\n        </tr>\n    </table>\n\n    <!-- BLUE STRIP -->\n    <div class=\"blue-strip\">\n        Planned Activities <span class=\"count-circle\">{{ (item.work_plan_doc or [])|length }}</span>\n    </div>\n\n    <!-- TASKS -->\n    <div class=\"task-container-div\">\n        {% for task in (item.work_plan_doc or []) %}\n            <table class=\"task-card-table\">\n                <tr>\n                    <td class=\"tc-left\">\n                        <div class=\"t-title\">{{ task.wp_title }}</div>\n                        {% if task.wp_description %}\n                            {% if 'Note:' in task.wp_description or 'note' in task.wp_description|lower %}\n                                <div class=\"t-desc\">{{ task.wp_description }}</div>\n                            {% else %}\n                                <div class=\"t-desc-norm\">{{ task.wp_description }}</div>\n                            {% endif %}\n                        {% endif %}\n                    </td>\n                    <td class=\"tc-right\">\n                        \n                        {# --- BUFFER LOGIC --- #}\n                        {%- set buffer = (buffer_days_param or 0) | int -%}\n\n                        {# Calculate Start Date #}\n                        {%- if add_to_start_param -%}\n                            {%- set display_start_date = frappe.utils.add_days(task.wp_start_date, buffer) -%}\n                        {%- else -%}\n                            {%- set display_start_date = task.wp_start_date -%}\n                        {%- endif -%}\n\n                        {# Calculate End Date #}\n                        {%- if add_to_end_param -%}\n                            {%- set display_end_date = frappe.utils.add_days(task.wp_end_date, buffer) -%}\n                        {%- else -%}\n                            {%- set display_end_date = task.wp_end_date -%}\n                        {%- endif -%}\n\n                        <!-- LINE 1: START & END DATES (Calculated) -->\n                        <div style=\"margin-bottom: 6px; white-space: nowrap;\">\n                            <div class=\"date-box\">\n                                <span class=\"d-lbl\">PLAN START DATE :</span> \n                                {{ frappe.utils.formatdate(display_start_date, \"dd/MM/yyyy\") if display_start_date else \"-\" }}\n                            </div>\n                            <div class=\"date-box\">\n                                <span class=\"d-lbl\">PLAN END DATE :</span> \n                                {{ frappe.utils.formatdate(display_end_date, \"dd/MM/yyyy\") if display_end_date else \"-\" }}\n                            </div>\n                        </div>\n\n                        <!-- LINE 2: STATUS, PROGRESS, ECD -->\n                        <div style=\"white-space: nowrap;\">\n                            {% set t_stat = task.wp_status or 'Pending' %}\n                            {% if t_stat == 'Not Started' %} {% set t_cls = 'st-not-started' %}\n                            {% elif t_stat == 'Completed' %} {% set t_cls = 'st-completed' %}\n                            {% else %} {% set t_cls = 'st-yellow' %}\n                            {% endif %}\n                            \n                            <!-- STATUS -->\n                            <span class=\"tc-pill {{ t_cls }}\">{{ t_stat }}</span>\n                            \n                            <!-- TASK PROGRESS -->\n                            <span class=\"tc-pill\" style=\"background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; margin-left: 4px;\">\n                                {{ (task.wp_progress or 0)|int }}%\n                            </span>\n\n                            <!-- ESTIMATED COMPLETION DATE (Safe Check) -->\n                            {% if task.wp_estimate_completion_date %}\n                                <div class=\"date-box\" style=\"margin-left: 4px; display: inline-block;\">\n                                    <span class=\"d-lbl\">EST. COMPL DATE:</span> \n                                    {{ frappe.utils.formatdate(task.wp_estimate_completion_date, \"dd/MM/yyyy\") }}\n                                </div>\n                            {% endif %}\n                        </div>\n\n                    </td>\n                </tr>\n            </table>\n        {% endfor %}\n    </div>\n{% endmacro %}\n\n<!-- 3. STYLES -->\n<style>\n    @page { size: A4 landscape; margin: 10mm; }\n    html, body { font-family: 'Helvetica', Arial, sans-serif; font-size: 11px; color: #111; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; background-color: #fff; }\n    table { width: 100%; border-collapse: collapse; border-spacing: 0; }\n    td { vertical-align: top; padding: 5px; }\n    \n    .header-wrapper { width: 100%; margin-bottom: 20px; }\n    .logo-img { height: 40px; display: block; margin-bottom: 8px; }\n    .company-name-lg { font-size: 14px; font-weight: bold; color: #000; margin-bottom: 4px; }\n    .company-addr-lg { font-size: 10px; color: #555; margin-bottom: 12px; }\n    .header-border { border-bottom: 3px solid #000; margin-bottom: 15px; }\n    \n    .report-meta-table { width: 100%; margin-bottom: 10px; border-bottom: 1px solid #e5e7eb; }\n    .report-title-lg { font-size: 18px; font-weight: bold; color: #000; padding-bottom: 8px; }\n    .report-date-lg { font-size: 11px; font-weight: bold; color: #000; text-align: right; padding-bottom: 8px; text-transform: uppercase; }\n    \n    .info-card-table { width: 100%; border: 1px solid #e5e7eb; margin-bottom: 30px; table-layout: fixed; }\n    .info-card-td { padding: 12px 15px; border-right: 1px solid #e5e7eb; vertical-align: top; }\n    .info-card-td:last-child { border-right: none; }\n    .card-label { font-size: 10px; font-weight: bold; color: #6b7280; text-transform: uppercase; margin-bottom: 5px; display: block; }\n    .card-value { font-size: 13px; font-weight: bold; color: #111; display: block; }\n    .badge-round-lg { display: inline-block; background-color: #1d4ed8; color: #fff; width: 26px; height: 26px; line-height: 26px; border-radius: 50%; text-align: center; font-weight: bold; font-size: 11px; }\n\n    .section-wrapper { page-break-inside: avoid; margin-bottom: 25px; }\n    /* REMOVED BOTTOM MARGIN FOR LAST SECTION */\n    .section-wrapper:last-child { margin-bottom: 0; }\n\n    .sec-header-table { margin-bottom: 12px; page-break-after: avoid; }\n    .sec-title-td { border-left: 5px solid #E63946; padding-left: 10px; vertical-align: middle; padding-top: 8px; padding-bottom: 8px; }\n    .sec-title-text { font-size: 16px; font-weight: 800; color: #0f172a; display: inline-block; margin-right: 8px; vertical-align: middle; }\n    .sec-count-circle { display: inline-block; background-color: #1d4ed8; color: #ffffff; width: 24px; height: 24px; line-height: 24px; border-radius: 50%; text-align: center; font-size: 12px; font-weight: bold; vertical-align: middle; }\n    \n    /* NEW ZONE SUB-HEADER STYLE */\n    .zone-sub-header {\n        background-color: #f3f4f6;\n        color: #111827;\n        font-weight: bold;\n        font-size: 12px;\n        padding: 6px 10px;\n        border-left: 4px solid #9ca3af;\n        margin-bottom: 10px;\n        margin-top: 5px;\n        text-transform: uppercase;\n        border-radius: 2px;\n    }\n\n    .milestone-container { border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 15px; overflow: hidden; page-break-inside: avoid; }\n    /* REMOVED BOTTOM MARGIN FOR LAST MILESTONE CARD */\n    .milestone-container:last-child { margin-bottom: 0; }\n\n    .ms-head-table { width: 100%; background-color: #fcfcfc; }\n    .ms-head-td { padding: 10px 12px; vertical-align: middle; border-bottom: 1px solid #f0f0f0; }\n    .lbl { display: block; font-size: 8px; color: #999; text-transform: uppercase; font-weight: bold; margin-bottom: 3px; }\n    .val-main { font-weight: bold; font-size: 12px; color: #000; }\n    .badge-zone { border: 1px dashed #9ca3af; background: #f3f4f6; padding: 3px 6px; border-radius: 4px; font-size: 10px; color: #374151; }\n    \n    .badge-status { padding: 4px 10px; border-radius: 12px; font-size: 10px; font-weight: bold; display: inline-block; }\n    .st-not-started { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; } \n    .st-completed { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }\n    .st-yellow { background: #fef9c3; color: #854d0e; border: 1px solid #fef08a; }\n\n    /* Text Progress Styles */\n    .prog-text { font-size: 12px; font-weight: bold; padding: 2px 0; }\n    .txt-red { color: #dc2626; }\n    .txt-green { color: #166534; }\n    .txt-yellow { color: #854d0e; }\n\n    .blue-strip { background-color: #eff6ff; color: #1e40af; font-weight: bold; font-size: 11px; padding: 8px 15px; border-top: 1px solid #dbeafe; border-bottom: 1px solid #dbeafe; }\n    .count-circle { background: #1e40af; color: #fff; padding: 1px 6px; border-radius: 10px; font-size: 9px; margin-left: 5px; }\n    .task-container-div { padding: 12px; background-color: #fff; }\n    .task-card-table { border: 1px solid #e5e7eb; border-radius: 5px; margin-bottom: 8px; background: #fff; width: 100%; }\n    \n    /* Modified Column Widths: 55/45 to accommodate dates better */\n    .tc-left { padding: 10px; vertical-align: top; width: 55%; }\n    .tc-right { padding: 10px; vertical-align: top; width: 45%; text-align: right; }\n    \n    .t-title { font-weight: bold; font-size: 11px; color: #111; margin-bottom: 4px; }\n    .t-desc { font-style: italic; font-size: 10px; color: #f97316; } \n    .t-desc-norm { font-size: 10px; color: #6b7280; }\n    \n    /* Pill and Date Box Styling */\n    .tc-pill { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 9px; font-weight: bold; vertical-align: middle; }\n    .date-box { display: inline-block; border: 1px solid #e5e7eb; background: #f9fafb; padding: 4px 8px; border-radius: 4px; font-size: 9px; color: #374151; margin-right: 2px; vertical-align: middle; }\n    .d-lbl { font-size: 7px; text-transform: uppercase; color: #aaa; margin-right: 2px; }\n</style>\n\n<div class=\"print-format\">\n\n    <!-- 1. HEADER SECTION -->\n    <div class=\"header-wrapper\">\n        <img src=\"{{ logo_url }}\" class=\"logo-img\">\n        <div class=\"company-name-lg\">{{ company_name }}</div>\n        <div class=\"company-addr-lg\">{{ company_info.address }}</div>\n        <div class=\"header-border\"></div>\n    </div>\n\n    <!-- 2. REPORT TITLE & DATE -->\n    <table class=\"report-meta-table\">\n        <tr>\n            <td class=\"report-title-lg\">Work Plan</td>\n            <td class=\"report-date-lg\">REPORT DATE : {{ frappe.utils.formatdate(frappe.utils.nowdate(), \"dd-MM-yyyy\") }}</td>\n        </tr>\n    </table>\n\n    <!-- 3. INFO CARD -->\n    <table class=\"info-card-table\">\n        <tr>\n            <td class=\"info-card-td\" style=\"width: 25%;\">\n                <span class=\"card-label\">PROJECT NAME</span>\n                <span class=\"card-value\">{{ doc.project_name }}</span>\n            </td>\n            <td class=\"info-card-td\" style=\"width: 10%; text-align: center;\">\n                <span class=\"card-label\" style=\"text-align: center;\">TOTAL</span>\n                <span class=\"badge-round-lg\">{{ global_ns.grand_total }}</span>\n            </td>\n            <td class=\"info-card-td\" style=\"width: 25%;\">\n                <span class=\"card-label\">DATE RANGE</span>\n                <span class=\"card-value\">\n                    {% if is_all_time %}\n                        ALL TIME\n                    {% else %}\n                        {{ frappe.utils.formatdate(start_date, \"dd-MM-yyyy\") }} \n                        <br/>to<br/>\n                        {{ frappe.utils.formatdate(end_date, \"dd-MM-yyyy\") }}\n                    {% endif %}\n                </span>\n            </td>\n             <td class=\"info-card-td\" style=\"width: 20%;\">\n                <span class=\"card-label\">ZONE</span>\n                <span class=\"card-value\">\n                    {{ \"ALL ZONES\" if show_all_zones else zone_param }}\n                </span>\n            </td>\n            <!--<td class=\"info-card-td\" style=\"width: 20%;\">-->\n            <!--    <span class=\"card-label\">BUFFER</span>-->\n            <!--    <span class=\"card-value\">-->\n            <!--        {{ buffer_days_param }} Days -->\n            <!--        {% if add_to_start_param %}(Start){% endif %}-->\n            <!--        {% if add_to_end_param %}(End){% endif %}-->\n            <!--    </span>-->\n            <!--</td>-->\n        </tr>\n    </table>\n\n    <!-- 4. CONTENT -->\n    {% if not data or (data is mapping and data|length == 0) %}\n        <div style=\"text-align:center; padding:50px; border:2px dashed #e5e7eb; margin-top:20px; color:#9ca3af; font-size: 14px;\">\n            {% if api_reason %}\n                <span style=\"color: #ef4444; font-weight: bold;\">{{ api_reason }}</span>\n            {% else %}\n                No planned activities found for the selected period.\n            {% endif %}\n        </div>\n    {% else %}\n\n        {% for header, milestones in data.items() %}\n            {# Filter milestones with tasks AND match Zone safely #}\n            {% set valid_milestones = [] %}\n            {% set ns = namespace(total_tasks=0) %}\n            \n            {% for m in milestones %}\n                {%- set m_zone_safe = (m.zone or \"\")|string|lower|trim -%}\n                {%- set p_zone_safe = (zone_param or \"\")|string|lower|trim -%}\n                \n                {% if show_all_zones or (m_zone_safe == p_zone_safe) %}\n                    {% if m.work_plan_doc and m.work_plan_doc|length > 0 %}\n                        {% set _ = valid_milestones.append(m) %}\n                        {% set ns.total_tasks = ns.total_tasks + (m.work_plan_doc|length) %}\n                    {% endif %}\n                {% endif %}\n            {% endfor %}\n\n            {# Only render section if there are valid milestones #}\n            {% if valid_milestones|length > 0 %}\n                <div class=\"section-wrapper\">\n                    <!-- Section Header -->\n                    <table class=\"sec-header-table\" width=\"100%\">\n                        <tr>\n                            <td class=\"sec-title-td\">\n                                <span class=\"sec-title-text\">{{ header }}</span>\n                                <span class=\"sec-count-circle\">{{ ns.total_tasks }}</span>\n                            </td>\n                        </tr>\n                    </table>\n\n                    {# --- LOGIC FOR GROUPING BY ZONE IF 'ALL ZONES' IS SELECTED --- #}\n                    {% if show_all_zones %}\n                        \n                        {# 1. Collect Unique Zones within this header's valid milestones #}\n                        {% set found_zones = [] %}\n                        {% for m in valid_milestones %}\n                             {% set z_val = m.zone or \"General\" %}\n                             {% if z_val not in found_zones %}\n                                 {% set _ = found_zones.append(z_val) %}\n                             {% endif %}\n                        {% endfor %}\n                        \n                        {# 2. Loop through Unique Zones and Render Sub-Headers #}\n                        {% for z_key in found_zones %}\n                             <!-- ZONE HEADER -->\n                             <div class=\"zone-sub-header\">Zone : {{ z_key }}</div>\n                             \n                             <!-- Render Milestones for this Zone -->\n                             {% for item in valid_milestones %}\n                                 {% set m_z = item.zone or \"General\" %}\n                                 {% if m_z == z_key %}\n                                      <div class=\"milestone-container\">\n                                          {{ render_milestone_card(item) }}\n                                      </div>\n                                 {% endif %}\n                             {% endfor %}\n                        {% endfor %}\n\n                    {% else %}\n                        {# --- NORMAL RENDERING (Specific Zone Selected) --- #}\n                        {% for item in valid_milestones %}\n                            <div class=\"milestone-container\">\n                                {{ render_milestone_card(item) }}\n                            </div>\n                        {% endfor %}\n                    {% endif %}\n\n                </div>\n            {% endif %}\n\n        {% endfor %}\n\n    {% endif %}\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2026-01-12 20:16:27.828329",
  "module": "Nirmaan Stack",
  "name": "Project Work Plan Buffered",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Asset Master",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "<!-- \n    PRINT FORMAT: Stratos Asset Allocation (Standard Auto-Paging Layout)\n    Method: Standard wkhtmltopdf Header/Footer injection\n-->\n\n{# --- DATA SETUP --- #}\n{%- set company_details = {\n    \"name\": \"STRATOS INFRA TECHNOLOGIES PRIVATE LIMITED\",\n    \"logo_url\": \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\",\n    \"registered_address\": \"Flat 403, Fine Aura Co-operative Housing Society, Marol Military Road, Andheri East, Mumbai, Maharashtra - 400059\",\n    \"corporate_address\": \"No.234, 1st Floor, 9th Main, 16th Cross, 6th Sector, HSR Layout, Bangalore, Karnataka, 560102\",\n    \"cin\": \"U74999MH2021PTC358936\"\n} -%}\n\n{# --- Fetch Assignee --- #}\n{%- set assignee_doc = None -%}\n{%- if doc.current_assignee -%}\n    {%- if frappe.db.exists(\"Nirmaan Users\", doc.current_assignee) -%}\n        {%- set assignee_doc = frappe.get_doc(\"Nirmaan Users\", doc.current_assignee) -%}\n    {%- elif frappe.db.exists(\"Employee\", doc.current_assignee) -%}\n        {%- set assignee_doc = frappe.get_doc(\"Employee\", doc.current_assignee) -%}\n    {%- endif -%}\n{%- endif -%}\n\n<!-- 1. HEADER HTML (Automatically repeats on every page) -->\n<div id=\"header-html\" style=\"display: none;\">\n    <div style=\"width: 100%; border-bottom: 2px solid #000; padding-bottom: 0px; margin-bottom: 0px;\">\n        <table style=\"width: 100%; border-collapse: collapse; border: none;\">\n            <tr>\n                <td style=\"vertical-align: middle; border: none;\">\n                    \n                     <img src=\"{{ company_details.logo_url }}\" style=\"max-width:140px; max-height:35px\">\n                </td>\n                <td style=\"vertical-align: mdle; border: none;\">\n                    <span style=\"font-family: Helvetica, Arial, sans-serif; font-size: 14pt; font-weight: 500; text-transform: uppercase; padding-left: 4px; color: #000;\">\n                        {{ company_details.name }}\n                    </span>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n\n<!-- 2. FOOTER HTML (Automatically repeats on every page) -->\n<div id=\"footer-html\" style=\"display: none;\">\n    <div style=\"width: 100%; text-align: center; font-family: Helvetica, Arial, sans-serif; font-size: 8pt; color: #000; border-top: 1px solid #999; padding-top: 5px;\">\n        Registered Address: {{ company_details.registered_address }}<br>\n        Corporate Address: {{ company_details.corporate_address }}<br>\n        <b>CIN: {{ company_details.cin }}</b>\n    </div>\n</div>\n\n<!-- 3. CSS STYLES -->\n<style>\n    /* Page Setup: Top/Bottom margins reserve space for the fixed Header/Footer */\n    @page {\n        size: A4;\n        margin-top: 35mm;    /* Space for Header */\n        margin-bottom: 25mm; /* Space for Footer */\n        margin-left: 12mm;\n        margin-right: 12mm;\n    }\n\n    body {\n        font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n        font-size: 11pt;\n        color: #000;\n        line-height: 1.3;\n    }\n\n    /* Titles */\n    .doc-title {\n        text-align: center;\n        color: #CE1616; /* Stratos Red */\n        font-weight: bold;\n        font-size: 15pt;\n        text-decoration: underline;\n        text-transform: uppercase;\n        margin-bottom: 20px;\n        margin-top: 10px;\n    }\n\n    .section-head {\n        color: #CE1616;\n        font-weight: bold;\n        text-decoration: underline;\n        font-size: 12pt;\n        margin-top: 20px;\n        margin-bottom: 5px;\n    }\n\n    .date-row {\n        text-align: right;\n        font-weight: bold;\n        font-size: 11pt;\n        margin-bottom: 10px;\n    }\n\n    /* Tables */\n    .form-table {\n        width: 100%;\n        border-collapse: collapse;\n        border: 2px solid #000;\n        margin-bottom: 10px;\n        page-break-inside: avoid;\n    }\n    .form-table td {\n        border: 1px solid #000;\n        padding: 6px 10px;\n        vertical-align: middle;\n        font-size: 10.5pt;\n    }\n    .lbl { width: 30%; font-weight: bold; text-align: center; }\n    .val { width: 70%; height: 30px; }\n\n    /* Signatures */\n    .sig-table {\n        width: 100%;\n        margin-top: 60px;\n        border-collapse: collapse;\n        page-break-inside: avoid;\n    }\n    .sig-table td {\n        border: none;\n        vertical-align: bottom;\n        text-align: center;\n        height: 50px;\n        font-size: 9pt;\n        color: #888;\n    }\n\n    /* Terms List */\n    .terms-ol {\n        padding-left: 20px;\n        margin-top: 5px;\n        font-size: 10pt;\n        text-align: justify;\n    }\n    .terms-ol li {\n        margin-bottom: 8px;\n        line-height: 1.4;\n    }\n    .term-head { font-weight: bold; }\n\n    /* Utility */\n    .page-break { page-break-after: always; }\n</style>\n\n<!-- 4. MAIN CONTENT FLOW -->\n<div class=\"print-format\">\n\n    <!-- ================= PAGE 1 CONTENT ================= -->\n    <div class=\"doc-title\">ASSET ALLOCATION FORM</div>\n\n    <div class=\"date-row\">\n        Date: <span style=\"border-bottom: 2px solid #000; display: inline-block; width: 140px; text-align: center;\">\n            {{ frappe.utils.formatdate(doc.transaction_date or frappe.utils.nowdate(), \"dd-MM-yyyy\") }}\n        </span>\n    </div>\n\n    <!-- Employee Table -->\n    <div class=\"section-head\">Employee Details:</div>\n    <table class=\"form-table\">\n        <tr>\n            <td class=\"lbl\">Name :</td>\n            <td class=\"val\">{{ assignee_doc.full_name or assignee_doc.employee_name or doc.current_assignee or '' }}</td>\n        </tr>\n        <tr>\n            <td class=\"lbl\">Employee ID :</td>\n            <td class=\"val\">{{ assignee_doc.name or assignee_doc.employee or '' }}</td>\n        </tr>\n        <tr>\n            <td class=\"lbl\">Department :</td>\n            <td class=\"val\">{{ assignee_doc.department or '' }}</td>\n        </tr>\n        <tr>\n            <td class=\"lbl\">Email Address :</td>\n            <td class=\"val\">{{ assignee_doc.email or assignee_doc.company_email or '' }}</td>\n        </tr>\n        <tr>\n            <td class=\"lbl\">Phone Number :</td>\n            <td class=\"val\">{{ assignee_doc.cell_number or assignee_doc.mobile_no or '' }}</td>\n        </tr>\n    </table>\n\n    <!-- Asset Table -->\n    <div class=\"section-head\">Asset Details:</div>\n    <table class=\"form-table\">\n        <tr>\n            <td class=\"lbl\">Asset Type :</td>\n            <td class=\"val\">{{ doc.asset_category or '' }}</td>\n        </tr>\n        <tr>\n        <td class=\"lbl\">Model /<br>Specification :</td>\n        <td class=\"val\">\n            {{ doc.item_name or doc.asset_name or '' }}\n            {% if doc.asset_description %} \n                 /<br> {{ doc.asset_description }} \n            {% endif %}\n        </td>\n    </tr>\n        <tr>\n            <td class=\"lbl\">Serial Number :</td>\n            <td class=\"val\">{{ doc.serial_no or doc.asset_serial_number or '' }}</td>\n        </tr>\n        <tr>\n            <td class=\"lbl\">Asset Condition :</td>\n            <td class=\"val\">{{ doc.asset_condition or 'New' }}</td>\n        </tr>\n        <tr>\n            <td class=\"lbl\">Asset Value:</td>\n            <td class=\"val\">\n                {% if doc.asset_value %}\n                    {{ frappe.format(doc.asset_value, {'fieldtype': 'Currency', 'currency': 'INR'}) }}\n                {% endif %}\n            </td>\n        </tr>\n    </table>\n\n    <div style=\"margin-top: 20px; font-size: 10.5pt; color: #333;\">\n        I acknowledge that I have received the above-mentioned IT Asset in good condition.\n    </div>\n\n    <table class=\"sig-table\">\n        <tr>\n            <td width=\"33%\">(Employee Signature)</td>\n            <td width=\"33%\">(HR Signature)</td>\n            <td width=\"33%\">(IT Admin Signature)</td>\n        </tr>\n    </table>\n\n    <!-- Force Page 2 -->\n    <div class=\"page-break\"></div>\n\n    <!-- ================= PAGE 2 CONTENT ================= -->\n    \n    <div class=\"section-head\" style=\"margin-top: 0; text-transform: uppercase;\">TERMS & CONDITIONS</div>\n\n    <ol class=\"terms-ol\">\n        <li>\n            <span class=\"term-head\">Asset Responsibility:</span> The employee acknowledges receipt of the above-mentioned IT asset and accepts full responsibility for its safekeeping and proper usage during the period of allocation.\n        </li>\n        <li>\n            <span class=\"term-head\">Damage & Loss:</span> In the event of any damage (beyond normal wear and tear), loss, or theft of the allocated asset, the employee shall be liable to compensate the company. The cost of repair or replacement will be recovered from the employee's salary/payroll as per company policy.\n        </li>\n        <li>\n            <span class=\"term-head\">Usage Policy:</span> The asset must be used solely for official business purposes. Personal use should be minimal and must not interfere with work responsibilities or violate company policies.\n        </li>\n        <li>\n            <span class=\"term-head\">Data Security:</span> The employee is responsible for maintaining the security and confidentiality of all company data stored on or accessible through the asset. This includes using strong passwords, enabling encryption, and following all company IT security policies.\n        </li>\n        <li>\n            <span class=\"term-head\">Software & Updates:</span> Only authorized and licensed software should be installed. The employee must ensure timely installation of security updates and patches as mandated by the IT department.\n        </li>\n        <li>\n            <span class=\"term-head\">Reporting Issues:</span> Any malfunction, damage, loss, or theft must be reported immediately to the IT department and HR within 24 hours of occurrence.\n        </li>\n        <li>\n            <span class=\"term-head\">Return of Asset:</span> Upon termination of employment, resignation, or request by the company, the employee must return the asset in good working condition (normal wear and tear excepted) within the specified timeline.\n        </li>\n        <li>\n            <span class=\"term-head\">Maintenance:</span> The employee should handle the asset with reasonable care and report any maintenance needs promptly. Unauthorized repairs or modifications are strictly prohibited.\n        </li>\n        <li>\n            <span class=\"term-head\">Inspection Rights:</span> The company reserves the right to inspect the asset at any time to ensure compliance with company policies and to verify its condition.\n        </li>\n    </ol>\n\n    <div class=\"section-head\" style=\"margin-top: 30px; text-transform: uppercase;\">EMPLOYEE DECLARATION & AGREEMENT</div>\n\n    <div style=\"text-align: justify; font-size: 10pt; line-height: 1.5; margin-bottom: 20px;\">\n        I hereby acknowledge that I have received the above-mentioned IT asset in good working condition.\n        I have read, understood, and agree to abide by all the terms and conditions mentioned above. I\n        understand that any violation of these terms or damage/loss to the asset may result in recovery of\n        costs from my salary/payroll and/or disciplinary action as per company policy.\n    </div>\n\n    <table class=\"sig-table\" style=\"margin-top: 50px;\">\n        <tr>\n            <td width=\"33%\">(Employee Signature)</td>\n            <td width=\"33%\">(HR Signature)</td>\n            <td width=\"33%\">(IT Admin Signature)</td>\n        </tr>\n    </table>\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2026-01-13 20:14:09.796120",
  "module": "Nirmaan Stack",
  "name": "Asset Master Form",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Project TDS Setting",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: Project TDS Report\n    DocType: Project TDS Setting\n    \n    Page 1: Stakeholder cards\n    Page 2: TDS Summary table\n    Page 3+: Individual TDS Approval Forms for each item\n#}\n\n{%- set raw_data = frappe.form_dict.data or \"{}\" -%}\n{%- set parsed_data = json.loads(raw_data) if raw_data and raw_data != \"{}\" else {} -%}\n{%- set settings = parsed_data.get('settings', {}) if parsed_data else {} -%}\n{%- set history = parsed_data.get('history', []) if parsed_data else [] -%}\n\n{%- set company_details = {\n    \"name\": \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"logo_url\": \"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\"\n} -%}\n\n<style>\n    @page { size: A4; margin: 10mm; }\n    body { \n        font-family: Arial, sans-serif; \n        font-size: 11px; \n        color: #000; \n        margin: 0; \n        -webkit-print-color-adjust: exact !important; \n        print-color-adjust: exact !important;\n    }\n    \n    .page-break { page-break-before: always; }\n    \n    /* Page 1 & 2 Styles */\n    .header-wrapper { width: 100%; margin-bottom: 20px; text-align: center; }\n    .logo-img { height: 45px; display: block; margin: 0 auto 10px auto; }\n    .header-border { border-bottom: 3px solid #dc2626; margin-top: 10px; }\n    \n    .cards-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\n    .cards-table td { padding: 8px; vertical-align: top; width: 50%; }\n    \n    .stakeholder-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); height: 220px; display: flex; flex-direction: column; overflow: hidden; }\n    .card-header { background: #fafafa; padding: 12px 16px; border-bottom: 1px solid #f0f0f0; border-radius: 10px 10px 0 0; text-align: center; flex-shrink: 0; }\n    .card-header svg { vertical-align: middle; margin-right: 8px; }\n    .card-label { font-size: 11px; font-weight: 700; color: #374151; text-transform: uppercase; vertical-align: middle; }\n    .card-body { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden; }\n    .stakeholder-logo { max-width: 100%; max-height: 180px; width: auto; height: auto; object-fit: contain; display: block; margin: 0 auto 10px auto; }\n    .stakeholder-name { font-size: 12px; font-weight: 600; color: #111; margin-top: 10px; }\n    .no-logo-placeholder { width: 100%; height: 80px; background: #f3f4f6; border-radius: 4px; border: 1px dashed #d1d5db; }\n    \n    .section-title { font-size: 16px; font-weight: 700; color: #111; margin-bottom: 15px; border-bottom: 3px solid #dc2626; padding-bottom: 8px; }\n    .history-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }\n    .history-table th { background-color: #f9fafb; border: 1px solid #e5e7eb; padding: 10px 8px; font-size: 9px; font-weight: 700; text-transform: uppercase; color: #374151; text-align: left; }\n    .history-table td { border: 1px solid #e5e7eb; padding: 8px; font-size: 10px; vertical-align: top; }\n    .history-table tr:nth-child(even) { background-color: #fafafa; }\n    .tds-id { color: #dc2626; font-weight: 600; }\n    .text-center { text-align: center; }\n    .footer-notes { margin-top: 25px; font-size: 9px; color: #777; border-top: 1px dashed #ccc; padding-top: 10px; text-align: center; }\n    \n    /* TDS Approval Form Styles - UPDATED */\n    .form-page { page-break-before: always; padding: 5px; }\n    .main-table { width: 100%; border-collapse: collapse; border: 2px solid #000; }\n    .main-table td, .main-table th { border: 1px solid #000; padding: 8px; vertical-align: middle; }\n    .header-row td { text-align: center; font-weight: bold; font-size: 12px; background: #fff; }\n    .logo-cell { height: 100px; text-align: center; vertical-align: middle; padding: 5px; }\n    .logo-cell img { max-height: 90px; max-width: 140px; object-fit: contain; }\n    .form-section-title { font-weight: bold; font-size: 13px; text-align: center; background: #fff; padding: 10px; }\n    .form-label { font-weight: bold; text-align: center; padding: 10px 8px; }\n    .form-value { text-align: center; font-weight: bold; padding: 15px 8px; font-size: 13px; color: #374151; }\n    .description-box {height: 50px; padding: 15px; font-size: 12px; }\n    .comments-box { height: 50px; padding: 15px; }\n    .status-table { width: 100%; border-collapse: collapse; }\n    .status-table td { border: 2px solid #000; padding: 10px; text-align: center; width: 33%; }\n    .status-header { font-weight: bold; font-size: 11px; }\n    .status-checkbox { height: 30px; font-size: 18px; }\n    .signature-table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n    .signature-header td { border: 1px solid #000; text-align: center; padding: 5px; font-size: 10px; font-weight: bold; width: 16.66%; }\n    .signature-spacer td { border: 1px solid #000; height: 100px; }\n\n</style>\n\n<div class=\"print-format\">\n\n    <!-- PAGE 1: STAKEHOLDER CARDS -->\n    <div class=\"header-wrapper\">\n        <img src=\"{{ company_details.logo_url }}\" class=\"logo-img\">\n        <div class=\"header-border\"></div>\n    </div>\n\n    <table class=\"cards-table\">\n        <tr>\n            <td>\n                <div class=\"stakeholder-card\">\n                    <div class=\"card-header\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#dc2626\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"/><path d=\"M16 3.128a4 4 0 0 1 0 7.744\"/><path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"/><circle cx=\"9\" cy=\"7\" r=\"4\"/></svg>\n                        <span class=\"card-label\">CLIENT</span>\n                    </div>\n                    <div class=\"card-body\">\n                        {% if settings.get('client') and settings.get('client').get('logo') %}\n                            <img src=\"{{ settings.client.logo }}\" class=\"stakeholder-logo\">\n                        {% else %}\n                            <div class=\"stakeholder-name\" style=\"font-size: 14px;\">{{ settings.get('client', {}).get('name', '-') }}</div>\n                        {% endif %}\n                    </div>\n                </div>\n            </td>\n            <td>\n                <div class=\"stakeholder-card\">\n                    <div class=\"card-header\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#dc2626\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 12h.01\"/><path d=\"M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2\"/><path d=\"M22 13a18.15 18.15 0 0 1-20 0\"/><rect width=\"20\" height=\"14\" x=\"2\" y=\"6\" rx=\"2\"/></svg>\n                        <span class=\"card-label\">PROJECT MANAGER</span>\n                    </div>\n                    <div class=\"card-body\">\n                        {% if settings.get('projectManager') and settings.get('projectManager').get('logo') %}\n                            <img src=\"{{ settings.projectManager.logo }}\" class=\"stakeholder-logo\">\n                        {% else %}\n                            <div class=\"stakeholder-name\" style=\"font-size: 14px;\">{{ settings.get('projectManager', {}).get('name', '-') }}</div>\n                        {% endif %}\n                    </div>\n                </div>\n            </td>\n        </tr>\n        <tr>\n            <td>\n                <div class=\"stakeholder-card\">\n                    <div class=\"card-header\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#dc2626\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"16\" y=\"16\" width=\"6\" height=\"6\" rx=\"1\"/><rect x=\"2\" y=\"16\" width=\"6\" height=\"6\" rx=\"1\"/><rect x=\"9\" y=\"2\" width=\"6\" height=\"6\" rx=\"1\"/><path d=\"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3\"/><path d=\"M12 12V8\"/></svg>\n                        <span class=\"card-label\">CONSULTANT</span>\n                    </div>\n                    <div class=\"card-body\">\n                        {% if settings.get('consultant') and settings.get('consultant').get('logo') %}\n                            <img src=\"{{ settings.consultant.logo }}\" class=\"stakeholder-logo\">\n                        {% else %}\n                            <div class=\"stakeholder-name\" style=\"font-size: 14px;\">{{ settings.get('consultant', {}).get('name', '-') }}</div>\n                        {% endif %}\n                    </div>\n                </div>\n            </td>\n            <td>\n                <div class=\"stakeholder-card\">\n                    <div class=\"card-header\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#dc2626\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M13 7 8.7 2.7a2.41 2.41 0 0 0-3.4 0L2.7 5.3a2.41 2.41 0 0 0 0 3.4L7 13\"/><path d=\"m8 6 2-2\"/><path d=\"m18 16 2-2\"/><path d=\"m17 11 4.3 4.3c.94.94.94 2.46 0 3.4l-2.6 2.6c-.94.94-2.46.94-3.4 0L11 17\"/><path d=\"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z\"/><path d=\"m15 5 4 4\"/></svg>\n                        <span class=\"card-label\">ARCHITECT</span>\n                    </div>\n                    <div class=\"card-body\">\n                        {% if settings.get('architect') and settings.get('architect').get('logo') %}\n                            <img src=\"{{ settings.architect.logo }}\" class=\"stakeholder-logo\">\n                        {% else %}\n                            <div class=\"stakeholder-name\" style=\"font-size: 14px;\">{{ settings.get('architect', {}).get('name', '-') }}</div>\n                        {% endif %}\n                    </div>\n                </div>\n            </td>\n        </tr>\n        <tr>\n            <td>\n                <div class=\"stakeholder-card\">\n                    <div class=\"card-header\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#dc2626\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M2 21a8 8 0 0 1 10.821-7.487\"/><path d=\"M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z\"/><circle cx=\"10\" cy=\"8\" r=\"5\"/></svg>\n                        <span class=\"card-label\">GC CONTRACTOR</span>\n                    </div>\n                    <div class=\"card-body\">\n                        {% if settings.get('gcContractor') and settings.get('gcContractor').get('logo') %}\n                            <img src=\"{{ settings.gcContractor.logo }}\" class=\"stakeholder-logo\">\n                        {% else %}\n                            <div class=\"stakeholder-name\" style=\"font-size: 14px;\">{{ settings.get('gcContractor', {}).get('name', '-') }}</div>\n                        {% endif %}\n                    </div>\n                </div>\n            </td>\n            <td>\n                <div class=\"stakeholder-card\">\n                    <div class=\"card-header\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#dc2626\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M10 12h4\"/><path d=\"M10 8h4\"/><path d=\"M14 21v-3a2 2 0 0 0-4 0v3\"/><path d=\"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2\"/><path d=\"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16\"/></svg>\n                        <span class=\"card-label\">MEP CONTRACTOR</span>\n                    </div>\n                    <div class=\"card-body\">\n                        {% if settings.get('mepContractor') and settings.get('mepContractor').get('logo') %}\n                            <img src=\"{{ settings.mepContractor.logo }}\" class=\"stakeholder-logo\">\n                        {% else %}\n                            <img src=\"{{ company_details.logo_url }}\" class=\"stakeholder-logo\">\n                        {% endif %}\n                    </div>\n                </div>\n            </td>\n        </tr>\n    </table>\n\n    <!-- PAGE 2: TDS SUMMARY TABLE -->\n    <div class=\"page-break\">\n        <div class=\"header-wrapper\">\n            <img src=\"{{ company_details.logo_url }}\" class=\"logo-img\">\n            <div class=\"header-border\"></div>\n        </div>\n\n        <div class=\"section-title\">INDEX</div>\n        \n        {% if history and history|length > 0 %}\n            <table class=\"history-table\">\n                <thead>\n                    <tr>\n                        <th style=\"width:20%;\">RQ ID</th>\n                        <th style=\"width:70%;\">Item Name</th>\n                        <th style=\"width:10%;\">S.No</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {% for item in history %}\n                    <tr>\n                        <td class=\"tds-id\">{{ item.tds_request_id or '-' }}</td>\n                        <td>{{ item.tds_item_name or '-' }}</td>\n                        <td class=\"text-center\">{{ loop.index }}</td>\n                    </tr>\n                    {% endfor %}\n                </tbody>\n            </table>\n        {% else %}\n            <div style=\"text-align:center; padding:40px; border:2px dashed #e5e7eb; color:#9ca3af;\">No TDS submissions found.</div>\n        {% endif %}\n\n        <div class=\"footer-notes\">Computer-generated TDS Report | {{ frappe.utils.formatdate(frappe.utils.nowdate(), \"dd-MMM-yyyy\") }}</div>\n    </div>\n\n    <!-- PAGE 3+: INDIVIDUAL TDS APPROVAL FORMS -->\n    {% for item in history %}\n    <div class=\"form-page\">\n        <table class=\"main-table\">\n            <tr class=\"header-row\">\n                <td style=\"width:33%;\">Client</td>\n                <td style=\"width:34%;\">Project Manager</td>\n                <td style=\"width:33%;\">Architect</td>\n            </tr>\n            <tr>\n                <td class=\"logo-cell\">\n                    {% if settings.get('client') and settings.get('client').get('logo') %}\n                        <img src=\"{{ settings.client.logo }}\">\n                    {% else %}\n                        {{ settings.get('client', {}).get('name', '-') }}\n                    {% endif %}\n                </td>\n                <td class=\"logo-cell\">\n                    {% if settings.get('projectManager') and settings.get('projectManager').get('logo') %}\n                        <img src=\"{{ settings.projectManager.logo }}\">\n                    {% else %}\n                        {{ settings.get('projectManager', {}).get('name', '-') }}\n                    {% endif %}\n                </td>\n                <td class=\"logo-cell\">\n                    {% if settings.get('architect') and settings.get('architect').get('logo') %}\n                        <img src=\"{{ settings.architect.logo }}\">\n                    {% else %}\n                        {{ settings.get('architect', {}).get('name', '-') }}\n                    {% endif %}\n                </td>\n            </tr>\n            <tr class=\"header-row\">\n                <td>Consultant</td>\n                <td>GC Contractor</td>\n                <td>MEP Contractor</td>\n            </tr>\n            <tr>\n                <td class=\"logo-cell\">\n                    {% if settings.get('consultant') and settings.get('consultant').get('logo') %}\n                        <img src=\"{{ settings.consultant.logo }}\">\n                    {% else %}\n                        {{ settings.get('consultant', {}).get('name', '-') }}\n                    {% endif %}\n                </td>\n                <td class=\"logo-cell\">\n                    {% if settings.get('gcContractor') and settings.get('gcContractor').get('logo') %}\n                        <img src=\"{{ settings.gcContractor.logo }}\">\n                    {% else %}\n                        {{ settings.get('gcContractor', {}).get('name', '-') }}\n                    {% endif %}\n                </td>\n                <td class=\"logo-cell\">\n                    {% if settings.get('mepContractor') and settings.get('mepContractor').get('logo') %}\n                        <img src=\"{{ settings.mepContractor.logo }}\">\n                    {% else %}\n                        <img src=\"{{ company_details.logo_url }}\">\n                    {% endif %}\n                </td>\n            </tr>\n            <tr><td colspan=\"3\" class=\"form-section-title\">TDS APPROVAL FORM</td></tr>\n            <tr>\n                <td class=\"form-label\">Package</td>\n                <td class=\"form-label\">Submission Date</td>\n                <td class=\"form-label\">Submittal No.</td>\n            </tr>\n            <tr>\n                <td class=\"form-value\">{{ item.tds_work_package or '-' }}</td>\n                <td class=\"form-value\">{{ frappe.utils.formatdate(item.creation, \"dd.MM.yyyy\") if item.creation else '-' }}</td>\n                <td class=\"form-value\">{{ item.tds_request_id or '-' }}</td>\n            </tr>\n            <tr>\n                <td class=\"form-label\">Submittal Name</td>\n                <td class=\"form-label\">Make</td>\n                <td class=\"form-label\">Model No.</td>\n            </tr>\n            <tr>\n                <td class=\"form-value\">{{ item.tds_item_name or '-' }}</td>\n                <td class=\"form-value\">{{ item.tds_make or '-' }}</td>\n                <td class=\"form-value\">{{ item.tds_category or '-' }}</td>\n            </tr>\n            <tr><td colspan=\"3\" class=\"form-section-title\">Sample Description</td></tr>\n            <tr><td colspan=\"3\" class=\"description-box\"><strong>{{ item.tds_item_name or '' }}:</strong> {{ item.tds_description or '' }}</td></tr>\n            <tr><td colspan=\"3\" style=\"padding:10px;\"><strong>COMMENTS:</strong></td></tr>\n            <tr><td colspan=\"3\" class=\"comments-box\"></td></tr>\n            <tr><td colspan=\"3\" style=\"padding:10px;\"><strong>TDS STATUS</strong></td></tr>\n            <tr>\n                <td colspan=\"3\" style=\"padding:0;\">\n                    <!-- <table class=\"status-table\"> -->\n                        <tr>\n                            <td class=\"status-header\">Approved</td>\n                            <td class=\"status-header\">Not Approved</td>\n                            <td class=\"status-header\">Approved with comments</td>\n                        </tr>\n                        <tr>\n                            <td class=\"status-checkbox\">{% if item.tds_status == 'Approved' %}✓{% endif %}</td>\n                            <td class=\"status-checkbox\">{% if item.tds_status == 'Rejected' %}✓{% endif %}</td>\n                            <td class=\"status-checkbox\"></td>\n                        </tr>\n                    <!-- </table> -->\n                </td>\n            </tr>\n        </table>\n        \n        <table class=\"signature-table\">\n            <tr class=\"signature-header\">\n                <td class=\"status-header\">MEP Contractor</td>\n                <td class=\"status-header\">GC Contractor</td>\n                <td class=\"status-header\">Consultant</td>\n                <td class=\"status-header\">Architect</td>\n                <td class=\"status-header\">Project Manager</td>\n                <td class=\"status-header\">Client</td>\n            </tr>\n            <tr class=\"signature-spacer\">\n                <td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>\n            </tr>\n        </table>\n    </div>\n    {% endfor %}\n\n</div>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2026-01-17 14:19:00.932624",
  "module": "Nirmaan Stack",
  "name": "Project TDS Report",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Projects",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: Overall Milestones Report\n    DocType: Projects\n    Features:\n    - Comparison of progress across 3 time periods (Current, 7 Days, 14 Days)\n    - Manpower comparison table\n    - Work Progress by Work Header with overall progress calculation\n    - Client/Clearance Issues (Drawing & Site remarks with photos)\n    - Work Images (filtered by attach_type='Work')\n    - Sorted work headers and milestones\n    - Weightage-based progress calculation\n#}\n\n{# LANDSCAPE ORIENTATION - This meta tag tells wkhtmltopdf to use landscape #}\n<meta name=\"pdfkit-orientation\" content=\"Landscape\"/>\n\n{# --- 1. FETCH PARAMETERS --- #}\n{%- set selected_zone = frappe.form_dict.zone or frappe.request.args.zone or \"\" -%}\n{%- set show_header = (frappe.form_dict.show_header != '0') -%}\n\n{# --- 2. CONFIG: ADDRESS MAP --- #}\n{%- set nirmaan_gst_map = {\n    \"29ABFCS9095N1Z9\": {\"state\": \"Karnataka\", \"code\": \"29\", \"address\": \"First floor, 234, 9th Main, 16th Cross Rd, Sector 6, HSR Layout, Bengaluru, Karnataka 560102\"},\n    \"06ABFCS9095N1ZH\": {\"state\": \"Haryana\",   \"code\": \"06\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\"},\n    \"09ABFCS9095N1ZB\": {\"state\": \"Uttar Pradesh\", \"code\":\"09\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305\"}\n} -%}\n\n{# --- 3. ROBUST GST EXTRACTION --- #}\n{%- set default_gst = \"29ABFCS9095N1Z9\" -%}\n{%- set final_gst = default_gst -%}\n{%- if doc.project_gst_number -%}\n    {%- set raw_gst = doc.project_gst_number -%}\n    {%- if raw_gst is string -%}{%- set gst_data = json.loads(raw_gst) -%}{%- else -%}{%- set gst_data = raw_gst -%}{%- endif -%}\n    {%- if gst_data and gst_data.list and gst_data.list|length > 0 -%}\n        {%- set extracted_gst = gst_data.list[0].gst -%}\n        {%- if extracted_gst in nirmaan_gst_map -%}{%- set final_gst = extracted_gst -%}{%- endif -%}\n    {%- endif -%}\n{%- endif -%}\n{%- set company_info = nirmaan_gst_map[final_gst] -%}\n\n{# --- 4. FETCH COMPARISON DATA VIA API --- #}\n{# In Jinja, frappe.call returns the result directly, not wrapped in .message #}\n{%- set report_zone_param = selected_zone if selected_zone else \"\" -%}\n{%- set reports_data = frappe.call(\"nirmaan_stack.api.get_project_reports.get_project_progress_reports_comparison\", project=doc.name, report_zone=report_zone_param) -%}\n\n{# Handle both cases: direct return or wrapped in message #}\n{%- if reports_data is mapping -%}\n    {%- if reports_data.message is defined -%}\n        {%- set reports_data = reports_data.message -%}\n    {%- endif -%}\n{%- endif -%}\n\n{%- set current_report = reports_data.current if (reports_data and reports_data.current) else none -%}\n{%- set seven_days_report = reports_data.seven_days if (reports_data and reports_data.seven_days) else none -%}\n{%- set fourteen_days_report = reports_data.fourteen_days if (reports_data and reports_data.fourteen_days) else none -%}\n\n{# --- 5. FETCH WORK MILESTONES FOR ORDERING & WEIGHTAGE --- #}\n{%- set milestone_list = frappe.get_all(\"Work Milestones\", fields=[\"work_milestone_name\", \"work_milestone_order\", \"work_header\", \"weightage\"]) -%}\n{%- set milestone_order_map = {} -%}\n{%- set milestone_weightage_map = {} -%}\n{%- for m in milestone_list -%}\n    {%- set key = (m.work_milestone_name or \"\")|trim|lower -%}\n    {%- set m_order = m.work_milestone_order if m.work_milestone_order is not none else 9999 -%}\n    {%- set _ = milestone_order_map.update({key: m_order | int}) -%}\n    {%- set _ = milestone_weightage_map.update({key: m.weightage|float if m.weightage else 1.0}) -%}\n{%- endfor -%}\n\n{# --- 6. FETCH HEADER ORDER --- #}\n{%- set header_list = frappe.get_all(\"Work Headers\", fields=[\"name\", \"order\"]) -%}\n{%- set header_order_map = {} -%}\n{%- for h in header_list -%}\n    {%- set h_order = h.order if h.order is not none else 999 -%}\n    {%- set _ = header_order_map.update({(h.name or \"\")|trim: h_order | int}) -%}\n{%- endfor -%}\n\n{# --- 7. OWNER DATA --- #}\n{%- set owner_doc = none -%}\n{%- if current_report and current_report.owner -%}\n    {%- if frappe.db.exists(\"Nirmaan Users\", current_report.owner) -%}\n        {%- set owner_doc = frappe.get_doc(\"Nirmaan Users\", current_report.owner) -%}\n    {%- endif -%}\n{%- endif -%}\n\n{# --- 8. CATEGORIZE PHOTOS --- #}\n{%- set attachment_list = current_report.attachments if (current_report and current_report.attachments) else [] -%}\n{%- set drawing_photos = [] -%}\n{%- set site_photos = [] -%}\n{%- set work_photos = [] -%}\n\n{%- for att in attachment_list -%}\n    {%- if att.attach_type == 'Drawing' -%}\n        {%- set _ = drawing_photos.append(att) -%}\n    {%- elif att.attach_type == 'Site' -%}\n        {%- set _ = site_photos.append(att) -%}\n    {%- elif att.attach_type == 'Work' -%}\n        {%- set _ = work_photos.append(att) -%}\n    {%- endif -%}\n{%- endfor -%}\n\n{# ==================== MACROS ==================== #}\n\n{% macro header_block() %}\n    <div class=\"nirmaan-header\">\n        <div class=\"brand-row\">\n            <img class=\"logo\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" alt=\"Nirmaan Logo\">\n        </div>\n        <div class=\"legal-name\">Nirmaan(Stratos Infra Technologies Pvt. Ltd.)</div>\n        <div class=\"address-line\">{{ company_info.address }}</div>\n        <div class=\"header-divider\"></div>\n    </div>\n{% endmacro %}\n\n{% macro render_status_badge(status) %}\n    {%- set badge_class = \"bg-gy\" -%}\n    {%- if status == \"Completed\" -%}{%- set badge_class = \"bg-g\" -%}\n    {%- elif status == \"WIP\" -%}{%- set badge_class = \"bg-y\" -%}\n    {%- elif status == \"Not Started\" -%}{%- set badge_class = \"bg-r\" -%}\n    {%- endif -%}\n    <span class=\"badge {{ badge_class }}\">{{ status }}</span>\n{% endmacro %}\n\n{% macro render_progress_text(progress, show_percent=true) %}\n    {%- set p = progress|int if progress else 0 -%}\n    {%- set color = \"#16a34a\" if p >= 100 else (\"#d97706\" if p >= 50 else \"#dc2626\") -%}\n    <span style=\"font-weight:700; font-size:12px; color:{{ color }};\">{{ p }}{% if show_percent %}%{% endif %}</span>\n{% endmacro %}\n\n{% macro render_photos(photo_list) %}\n    {% if photo_list %}\n        <div class=\"image-grid\">\n            {% for att in photo_list %}\n                <div class=\"image-item\">\n                    {% set img_url = frappe.call(\"nirmaan_stack.api.frappe_s3_attachment.get_s3_temp_url\", file_url=(att.file_url or att.image_link or att.image)) %}\n                    {% if img_url %}\n                        <div class=\"image-container\">\n                            <img src=\"{{ img_url }}\" class=\"image-actual\" alt=\"Photo\">\n                        </div>\n                        <div class=\"image-meta\">\n                            {% set loc_text = att.location_name or att.location or att.site_location or \"\" %}\n                            {% if loc_text %}\n                                <div class=\"image-loc\">\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" fill=\"#dc2626\" style=\"vertical-align: middle; margin-right: 4px;\">\n                                      <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/>\n                                    </svg>\n                                    {{ loc_text }}\n                                </div>\n                            {% endif %}\n                            {% set rem_text = att.remarks or att.description or att.note or \"\" %}\n                            {% if rem_text %}\n                                <div class=\"image-rem\">{{ rem_text }}</div>\n                            {% endif %}\n                        </div>\n                    {% else %}\n                        <div style=\"padding:40px; text-align:center; color:#999; font-size:10px;\">Img N/A</div>\n                    {% endif %}\n                </div>\n            {% endfor %}\n        </div>\n    {% endif %}\n{% endmacro %}\n\n{# --- HELPER: Calculate Header Average with Weightage --- #}\n{% macro calculate_header_average(milestones, target_report, header) %}\n    {# This macro is kept for reference but logic is implemented inline below for main loops #}\n    0\n{% endmacro %}\n\n\n<style>\n    /* GLOBAL SETTINGS */\n    * { box-sizing: border-box; -webkit-box-sizing: border-box; }\n    body { font-family: \"Inter\", Helvetica, Arial, sans-serif; font-size: 10px; color: #1f2937; line-height: 1.35; margin: 0; padding: 0; }\n    @media print {\n        @page { size: A4 landscape; margin: 8mm; }\n        .page-break-before { page-break-before: always; }\n        .avoid-break { page-break-inside: avoid !important; }\n        * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }\n        thead { display: table-header-group; }\n    }\n    \n    .w-100 { width: 100%; } .text-right { text-align: right; } .text-center { text-align: center; } .text-left { text-align: left; }\n    .mb-5 { margin-bottom: 5px; } .mb-10 { margin-bottom: 10px; } .mb-15 { margin-bottom: 15px; } .mt-10 { margin-top: 10px; }\n    \n    /* Header */\n    .nirmaan-header { width: 100%; margin-bottom: 12px; }\n    .brand-row { margin-bottom: 4px; display: block; } \n    .logo { height: 32px; vertical-align: middle; margin-right: 8px; }\n    .legal-name { font-size: 14px; font-weight: 800; color: #000; margin-bottom: 2px; }\n    .address-line { font-size: 10px; color: #6B7280; margin-bottom: 5px; }\n    .header-divider { border-bottom: 2px solid #000; width: 100%; margin-top: 5px; margin-bottom: 15px; }\n    \n    /* Info Table */\n    .info-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; } \n    .info-table td { padding: 3px 0; font-size: 11px; vertical-align: top; }\n    \n    /* Section Title */\n    .section-title { font-size: 13px; font-weight: 800; color: #374151; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #e5e7eb; padding-bottom: 3px; }\n    \n    /* Data Tables */\n    .data-table { width: 100%; border-collapse: collapse; } \n    .data-table th { background-color: #f9fafb; border: 1px solid #e5e7eb; padding: 6px 8px; font-size: 9px; font-weight: 700; text-transform: uppercase; color: #374151; } \n    .data-table td { border: 1px solid #e5e7eb; padding: 6px 8px; vertical-align: middle; font-size: 10px; }\n    .data-table tr:nth-child(even) { background-color: #f9fafb; }\n    \n    /* Sub-header Row */\n    .group-header-row { background-color: #e5e7eb !important; }\n    .group-header-row td { font-weight: 700; font-size: 11px; color: #111; }\n    \n    /* Badges */\n    .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 9px; font-weight: 600; min-width: 60px; text-align: center; }\n    .bg-g { background-color: #d1fae5; color: #065f46; } \n    .bg-y { background-color: #fef3c7; color: #d97706; } \n    .bg-r { background-color: #fef2f2; color: #dc2626; } \n    .bg-gy { background-color: #f3f4f6; color: #4b5563; }\n    \n    /* Client Issues Cards */\n    .issues-card { background: #fff; padding: 12px; border-radius: 8px; margin-bottom: 15px; }\n    .issues-card-orange { border: 1px solid #fed7aa; border-left: 4px solid #f97316; }\n    .issues-card-red { border: 1px solid #fecaca; border-left: 4px solid #ef4444; }\n    .issues-title { font-weight: 700; font-size: 11px; display: block; margin-bottom: 8px; }\n    .issues-title-orange { color: #c2410c; }\n    .issues-title-red { color: #dc2626; }\n    .issues-list { margin: 0; padding-left: 18px; font-size: 10px; color: #333; }\n    .issues-list li { margin-bottom: 3px; }\n    \n    /* Image Grid Styling (DIV Based) */\n    .image-grid { font-size: 0; width: 100%; }\n    .image-item { \n        display: inline-block; \n        width: 48%; \n        border: 1px solid #e5e7eb; \n        background: #fff; \n        vertical-align: top; \n        border-radius: 6px;\n        overflow: hidden;\n        page-break-inside: avoid;\n        break-inside: avoid;\n        margin-bottom: 12px;\n        font-size: 11px; /* Reset font size */\n    }\n    .image-item:nth-child(odd) { margin-right: 2%; }\n    .image-item:nth-last-child(-n+2) { margin-bottom: 0; }\n    \n    .image-container { \n        height: 200px; \n        width: 100%; \n        background-color: #fff;\n        text-align: center; \n        overflow: hidden; \n        display: block;\n        border-bottom: 1px solid #f3f4f6;\n    }\n    .image-actual { \n        width: 100%; \n        height: 100%; \n        object-fit: contain;\n        vertical-align: middle; \n    }\n    .image-meta { padding: 8px 10px; min-height: 40px; }\n    .image-loc { margin-bottom: 4px; font-weight: 600; font-size: 10px; color: #111; word-wrap: break-word; }\n    .image-rem { \n        padding: 4px 6px; \n        font-size: 9px; \n        color: #4b5563; \n        background-color: #f9fafb; \n        border: 1px solid #e5e7eb; \n        border-radius: 4px; \n        line-height: 1.3; \n        word-wrap: break-word; \n    }\n    \n    /* Remarks */\n    .remarks-cell { font-size: 9px; color: #555; max-width: 150px; word-wrap: break-word; }\n    \n    /* Empty State */\n    .empty-state { text-align: center; padding: 40px; color: #999; font-size: 12px; }\n</style>\n\n\n<div class=\"main-container\">\n\n    {# ==================== CHECK FOR DATA ==================== #}\n    {% if not current_report %}\n    <div class=\"empty-state\">\n        <p><strong>No Reports Available</strong></p>\n        <p>No project reports found for comparison. Please create at least one project report to see the comparison data.</p>\n    </div>\n    {% else %}\n\n    {# ==================== PAGE 1: HEADER & OVERVIEW ==================== #}\n    <div>\n        {% if show_header %}{{ header_block() }}{% else %}<div style=\"height:20px;\"></div>{% endif %}\n        \n        {# Project Info #}\n        <table class=\"info-table\">\n            <tr>\n                <td style=\"width:15%; font-weight:700;\">Project {{ \"+ Zone\" if selected_zone else \"\" }}:</td>\n                <td style=\"width:35%;\">{{ doc.project_name }}{{ \" (\" ~ selected_zone ~ \")\" if selected_zone else \"\" }}</td>\n                <td style=\"width:15%; font-weight:700;\">Last Updated By:</td>\n                <td style=\"width:35%;\">{{ owner_doc.full_name if owner_doc else (current_report.owner or \"--\") }}</td>\n            </tr>\n            <tr>\n                <td style=\"font-weight:700;\">Start Date:</td>\n                <td>{{ frappe.utils.formatdate(doc.project_start_date, \"dd-MMM-yyyy\") if doc.project_start_date else \"--\" }}</td>\n                <td style=\"font-weight:700;\">Latest Report Date:</td>\n                <td>{{ frappe.utils.formatdate(current_report.report_date, \"dd-MMM-yyyy\") if current_report.report_date else \"--\" }}</td>\n            </tr>\n        </table>\n    </div>\n\n    {# ==================== MANPOWER COMPARISON ==================== #}\n    {% if current_report.manpower and current_report.manpower|length > 0 %}\n        {# Collect all unique manpower labels from all reports #}\n        {%- set all_mp_labels = [] -%}\n        {%- for mp in current_report.manpower -%}\n            {%- if mp.label not in all_mp_labels -%}\n                {%- set _ = all_mp_labels.append(mp.label) -%}\n            {%- endif -%}\n        {%- endfor -%}\n        {%- if seven_days_report and seven_days_report.manpower -%}\n            {%- for mp in seven_days_report.manpower -%}\n                {%- if mp.label not in all_mp_labels -%}\n                    {%- set _ = all_mp_labels.append(mp.label) -%}\n                {%- endif -%}\n            {%- endfor -%}\n        {%- endif -%}\n        {%- if fourteen_days_report and fourteen_days_report.manpower -%}\n            {%- for mp in fourteen_days_report.manpower -%}\n                {%- if mp.label not in all_mp_labels -%}\n                    {%- set _ = all_mp_labels.append(mp.label) -%}\n                {%- endif -%}\n            {%- endfor -%}\n        {%- endif -%}\n        \n        {# Build manpower data list with all counts - using namespace for proper scoping #}\n        {%- set manpower_rows = [] -%}\n        {%- for label in all_mp_labels -%}\n            {%- set ns = namespace(cur=0, sev=0, four=0) -%}\n            {%- for mp in current_report.manpower -%}\n                {%- if mp.label == label -%}\n                    {%- set ns.cur = mp.count|int -%}\n                {%- endif -%}\n            {%- endfor -%}\n            {%- if seven_days_report and seven_days_report.manpower -%}\n                {%- for mp in seven_days_report.manpower -%}\n                    {%- if mp.label == label -%}\n                        {%- set ns.sev = mp.count|int -%}\n                    {%- endif -%}\n                {%- endfor -%}\n            {%- endif -%}\n            {%- if fourteen_days_report and fourteen_days_report.manpower -%}\n                {%- for mp in fourteen_days_report.manpower -%}\n                    {%- if mp.label == label -%}\n                        {%- set ns.four = mp.count|int -%}\n                    {%- endif -%}\n                {%- endfor -%}\n            {%- endif -%}\n            {# Only add if at least one count is > 0 #}\n            {%- if ns.cur > 0 or ns.sev > 0 or ns.four > 0 -%}\n                {%- set _ = manpower_rows.append({'label': label, 'cur': ns.cur, 'sev': ns.sev, 'four': ns.four}) -%}\n            {%- endif -%}\n        {%- endfor -%}\n        \n        {% if manpower_rows|length > 0 %}\n        <div class=\"avoid-break mb-15\">\n            <div class=\"section-title\">Manpower Comparison</div>\n            <table class=\"data-table\">\n                <thead>\n                    <tr>\n                        <th style=\"width:25%; text-align:left;\">Manpower Type</th>\n                        <th style=\"width:25%; text-align:center;\">\n                            Current<br>\n                            <span style=\"font-weight:normal; font-size:8px;\">{{ frappe.utils.formatdate(current_report.report_date, \"dd MMM\") if current_report.report_date else \"--\" }}</span>\n                        </th>\n                        <th style=\"width:25%; text-align:center;\">\n                            7 Days Ago<br>\n                            <span style=\"font-weight:normal; font-size:8px;\">{{ frappe.utils.formatdate(seven_days_report.report_date, \"dd MMM\") if seven_days_report and seven_days_report.report_date else \"--\" }}</span>\n                        </th>\n                        <th style=\"width:25%; text-align:center;\">\n                            14 Days Ago<br>\n                            <span style=\"font-weight:normal; font-size:8px;\">{{ frappe.utils.formatdate(fourteen_days_report.report_date, \"dd MMM\") if fourteen_days_report and fourteen_days_report.report_date else \"--\" }}</span>\n                        </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {% for row in manpower_rows %}\n                    <tr>\n                        <td style=\"font-weight:600;\">{{ row.label }}</td>\n                        <td class=\"text-center\" style=\"font-weight:700;\">{{ row.cur }}</td>\n                        <td class=\"text-center\">{{ row.sev if seven_days_report else \"--\" }}</td>\n                        <td class=\"text-center\">{{ row.four if fourteen_days_report else \"--\" }}</td>\n                    </tr>\n                    {% endfor %}\n                </tbody>\n            </table>\n        </div>\n        {% endif %}\n    {% endif %}\n\n    {# ==================== CLIENT / CLEARANCE ISSUES ==================== #}\n    {% if current_report.drawing_remarks or current_report.site_remarks or drawing_photos|length > 0 or site_photos|length > 0 %}\n    <div class=\"avoid-break mb-15\">\n        <div class=\"section-title\">Client / Clearance Issues</div>\n        \n        {# Drawing Remarks & Photos #}\n        {% if current_report.drawing_remarks or drawing_photos|length > 0 %}\n        <div class=\"issues-card issues-card-orange mb-10\">\n            <span class=\"issues-title issues-title-orange\">Drawing Remarks</span>\n            {% if current_report.drawing_remarks and current_report.drawing_remarks|trim != \"\" %}\n                {% set drawing_items = current_report.drawing_remarks.split('$#,,,') %}\n                <ul class=\"issues-list\">\n                    {% for item in drawing_items %}{% if item and item|trim|length > 0 %}<li>{{ item|trim }}</li>{% endif %}{% endfor %}\n                </ul>\n            {% else %}\n                <p style=\"color:#999; font-size:10px; font-style:italic;\">No drawing issues reported</p>\n            {% endif %}\n            \n            {% if drawing_photos|length > 0 %}\n                <div style=\"margin-top:10px; border-top:1px solid #fed7aa; padding-top:10px;\">\n                    <p style=\"font-size:9px; font-weight:600; color:#666; text-transform:uppercase; margin-bottom:5px;\">Attached Photos</p>\n                    {{ render_photos(drawing_photos) }}\n                </div>\n            {% endif %}\n        </div>\n        {% endif %}\n        \n        {# Site Remarks & Photos #}\n        {% if current_report.site_remarks or site_photos|length > 0 %}\n        <div class=\"issues-card issues-card-red\">\n            <span class=\"issues-title issues-title-red\">Site Remarks</span>\n            {% if current_report.site_remarks and current_report.site_remarks|trim != \"\" %}\n                {% set site_items = current_report.site_remarks.split('$#,,,') %}\n                <ul class=\"issues-list\">\n                    {% for item in site_items %}{% if item and item|trim|length > 0 %}<li>{{ item|trim }}</li>{% endif %}{% endfor %}\n                </ul>\n            {% else %}\n                <p style=\"color:#999; font-size:10px; font-style:italic;\">No site issues reported</p>\n            {% endif %}\n            \n            {% if site_photos|length > 0 %}\n                <div style=\"margin-top:10px; border-top:1px solid #fecaca; padding-top:10px;\">\n                    <p style=\"font-size:9px; font-weight:600; color:#666; text-transform:uppercase; margin-bottom:5px;\">Attached Photos</p>\n                    {{ render_photos(site_photos) }}\n                </div>\n            {% endif %}\n        </div>\n        {% endif %}\n    </div>\n    {% endif %}\n\n    {# ==================== WORK PROGRESS COMPARISON ==================== #}\n    {% if current_report.milestones and current_report.milestones|length > 0 %}\n        {# Group milestones by work_header #}\n        {%- set grouped_milestones = {} -%}\n        {%- for m in current_report.milestones -%}\n            {%- if m.status and m.status != \"Not Applicable\" -%}\n                {%- set h = (m.work_header or \"General\")|trim -%}\n                {%- if h not in grouped_milestones -%}{%- set _ = grouped_milestones.update({h: []}) -%}{%- endif -%}\n                {%- set _ = grouped_milestones[h].append(m) -%}\n            {%- endif -%}\n        {%- endfor -%}\n        \n        {% if grouped_milestones|length > 0 %}\n        <div class=\"page-break-before\">\n            {% if show_header %}{{ header_block() }}{% endif %}\n            <div class=\"section-title mt-10\">Work Progress Comparison</div>\n            \n            <table class=\"data-table\">\n                <thead>\n                    <tr>\n                        <th style=\"width:20%; text-align:left;\" rowspan=\"2\">Work</th>\n                        <th style=\"width:27%; text-align:center;\" colspan=\"3\">\n                            Current ({{ frappe.utils.formatdate(current_report.report_date, \"dd MMM\") if current_report.report_date else \"--\" }})\n                        </th>\n                        <th style=\"width:27%; text-align:center;\" colspan=\"3\">\n                            7 Days Ago ({{ frappe.utils.formatdate(seven_days_report.report_date, \"dd MMM\") if seven_days_report and seven_days_report.report_date else \"--\" }})\n                        </th>\n                        <th style=\"width:26%; text-align:center;\" colspan=\"3\">\n                            14 Days Ago ({{ frappe.utils.formatdate(fourteen_days_report.report_date, \"dd MMM\") if fourteen_days_report and fourteen_days_report.report_date else \"--\" }})\n                        </th>\n                    </tr>\n                    <tr>\n                        <th style=\"text-align:center;\">Status</th>\n                        <th style=\"text-align:center;\">Done %</th>\n                        <th style=\"text-align:center;\">Remarks</th>\n                        <th style=\"text-align:center;\">Status</th>\n                        <th style=\"text-align:center;\">Done %</th>\n                        <th style=\"text-align:center;\">Remarks</th>\n                        <th style=\"text-align:center;\">Status</th>\n                        <th style=\"text-align:center;\">Done %</th>\n                        <th style=\"text-align:center;\">Remarks</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {# Sort headers by order #}\n                    {%- set sorted_headers = [] -%}\n                    {%- for h_name in grouped_milestones -%}\n                        {%- set _ = sorted_headers.append({'name': h_name, 'order': header_order_map.get(h_name, 9999)}) -%}\n                    {%- endfor -%}\n                    \n                    {% for h_obj in sorted_headers | sort(attribute='order') %}\n                        {% set header = h_obj.name %}\n                        {% set milestones = grouped_milestones[header] %}\n                        \n                        {# Sort milestones within header #}\n                        {%- set sorted_ms = [] -%}\n                        {%- for m in milestones -%}\n                            {%- set key = (m.work_milestone_name or \"\")|trim|lower -%}\n                            {%- set _ = sorted_ms.append({'data': m, 'order': milestone_order_map.get(key, 9999)}) -%}\n                        {%- endfor -%}\n                        \n                        {# Calculate Header Averages (WEIGHTED) #}\n                        {%- set cur_avg = 0 -%}\n                        {%- set sev_avg = 0 -%}\n                        {%- set four_avg = 0 -%}\n                        \n                        {# Current Weighted Avg #}\n                        {%- set ns_cur = namespace(progress=0, weight=0) -%}\n                        \n                        {%- for m in milestones -%}\n                            {%- set key = (m.work_milestone_name or \"\")|trim|lower -%}\n                            {%- set w = milestone_weightage_map.get(key, 1.0)|float -%}\n                            {# Consider weightage if not NA #}\n                            {%- if m.status != \"Not Applicable\" -%}\n                                {%- set ns_cur.weight = ns_cur.weight + w -%}\n                                {%- set p_raw = m.progress | string | replace(\"%\", \"\") | trim -%}\n                                {%- set p_val = p_raw | float if p_raw else 0 -%}\n                                {%- set ns_cur.progress = ns_cur.progress + (p_val * w) -%}\n                            {%- endif -%}\n                        {%- endfor -%}\n                        {%- set cur_avg = (ns_cur.progress / ns_cur.weight)|round|int if ns_cur.weight > 0 else 0 -%}\n                        \n                        {# 7 Days Weighted Avg #}\n                        {%- if seven_days_report -%}\n                            {%- set ns_sev = namespace(progress=0, weight=0) -%}\n                            \n                            {%- for m in milestones -%}\n                                {%- set key = (m.work_milestone_name or \"\")|trim|lower -%}\n                                {%- set w = milestone_weightage_map.get(key, 1.0)|float -%}\n                                \n                                {%- if m.status != \"Not Applicable\" -%}\n                                    {%- set ns_sev.weight = ns_sev.weight + w -%}\n                                    \n                                    {%- set past_prog = 0 -%}\n                                    {%- if seven_days_report.milestones -%}\n                                        {%- for tm in seven_days_report.milestones -%}\n                                            {%- if tm.work_milestone_name == m.work_milestone_name and tm.work_header == m.work_header -%}\n                                                 {%- set p_raw = tm.progress | string | replace(\"%\", \"\") | trim -%}\n                                                 {%- set past_prog = p_raw | float if p_raw else 0 -%}\n                                            {%- endif -%}\n                                        {%- endfor -%}\n                                    {%- endif -%}\n                                    \n                                    {%- set ns_sev.progress = ns_sev.progress + (past_prog * w) -%}\n                                {%- endif -%}\n                            {%- endfor -%}\n                            {%- set sev_avg = (ns_sev.progress / ns_sev.weight)|round|int if ns_sev.weight > 0 else 0 -%}\n                        {%- endif -%}\n                        \n                        {# 14 Days Weighted Avg #}\n                        {%- if fourteen_days_report -%}\n                            {%- set ns_four = namespace(progress=0, weight=0) -%}\n                            \n                            {%- for m in milestones -%}\n                                {%- set key = (m.work_milestone_name or \"\")|trim|lower -%}\n                                {%- set w = milestone_weightage_map.get(key, 1.0)|float -%}\n                                \n                                {%- if m.status != \"Not Applicable\" -%}\n                                    {%- set ns_four.weight = ns_four.weight + w -%}\n                                    \n                                    {%- set past_prog = 0 -%}\n                                    {%- if fourteen_days_report.milestones -%}\n                                        {%- for tm in fourteen_days_report.milestones -%}\n                                            {%- if tm.work_milestone_name == m.work_milestone_name and tm.work_header == m.work_header -%}\n                                                 {%- set p_raw = tm.progress | string | replace(\"%\", \"\") | trim -%}\n                                                 {%- set past_prog = p_raw | float if p_raw else 0 -%}\n                                            {%- endif -%}\n                                        {%- endfor -%}\n                                    {%- endif -%}\n                                    \n                                    {%- set ns_four.progress = ns_four.progress + (past_prog * w) -%}\n                                {%- endif -%}\n                            {%- endfor -%}\n                            {%- set four_avg = (ns_four.progress / ns_four.weight)|round|int if ns_four.weight > 0 else 0 -%}\n                        {%- endif -%}\n                        \n                        {# Group Header Row #}\n                        <tr class=\"group-header-row\">\n                            <td>{{ header }} ({{ milestones|length }})</td>\n                            <td colspan=\"3\" class=\"text-center\">\n                                <span style=\"font-size:10px; font-weight:700;\">Overall: </span>\n                                {{ render_progress_text(cur_avg) }}\n                            </td>\n                            <td colspan=\"3\" class=\"text-center\">\n                                <span style=\"font-size:10px; font-weight:700;\">Overall: </span>\n                                {{ render_progress_text(sev_avg) }}\n                            </td>\n                            <td colspan=\"3\" class=\"text-center\">\n                                <span style=\"font-size:10px; font-weight:700;\">Overall: </span>\n                                {{ render_progress_text(four_avg) }}\n                            </td>\n                        </tr>\n                        \n                        {# Milestone Rows #}\n                        {% for wrapper in sorted_ms | sort(attribute='order') %}\n                            {% set m = wrapper.data %}\n                            \n                            {# Get data for 7 days ago #}\n                            {%- set sev_status = \"N/A\" -%}\n                            {%- set sev_progress = \"N/A\" -%}\n                            {%- set sev_remarks = \"\" -%}\n                            {%- if seven_days_report and seven_days_report.milestones -%}\n                                {%- for tm in seven_days_report.milestones if tm.work_milestone_name == m.work_milestone_name and tm.work_header == m.work_header -%}\n                                    {%- set sev_status = tm.status or \"N/A\" -%}\n                                    {%- set sev_progress = tm.progress -%}\n                                    {%- set sev_remarks = tm.remarks or \"\" -%}\n                                {%- endfor -%}\n                            {%- endif -%}\n                            \n                            {# Get data for 14 days ago #}\n                            {%- set four_status = \"N/A\" -%}\n                            {%- set four_progress = \"N/A\" -%}\n                            {%- set four_remarks = \"\" -%}\n                            {%- if fourteen_days_report and fourteen_days_report.milestones -%}\n                                {%- for tm in fourteen_days_report.milestones if tm.work_milestone_name == m.work_milestone_name and tm.work_header == m.work_header -%}\n                                    {%- set four_status = tm.status or \"N/A\" -%}\n                                    {%- set four_progress = tm.progress -%}\n                                    {%- set four_remarks = tm.remarks or \"\" -%}\n                                {%- endfor -%}\n                            {%- endif -%}\n                            \n                        <tr class=\"avoid-break\">\n                            <td style=\"font-weight:600;\">{{ loop.index }}. {{ m.work_milestone_name }}</td>\n                            \n                            {# Current #}\n                            <td class=\"text-center\">{{ render_status_badge(m.status or \"N/A\") }}</td>\n                            <td class=\"text-center\">{{ render_progress_text(m.progress) }}</td>\n                            <td class=\"remarks-cell\">{{ m.remarks if m.remarks else \"--\" }}</td>\n                            \n                            {# 7 Days Ago #}\n                            <td class=\"text-center\">\n                                {% if seven_days_report %}{{ render_status_badge(sev_status) }}{% else %}<span style=\"color:#999;\">N/A</span>{% endif %}\n                            </td>\n                            <td class=\"text-center\">\n                                {% if seven_days_report %}{{ render_progress_text(sev_progress) }}{% else %}<span style=\"color:#999;\">N/A</span>{% endif %}\n                            </td>\n                            <td class=\"remarks-cell\">{{ sev_remarks if sev_remarks else \"--\" }}</td>\n                            \n                            {# 14 Days Ago #}\n                            <td class=\"text-center\">\n                                {% if fourteen_days_report %}{{ render_status_badge(four_status) }}{% else %}<span style=\"color:#999;\">N/A</span>{% endif %}\n                            </td>\n                            <td class=\"text-center\">\n                                {% if fourteen_days_report %}{{ render_progress_text(four_progress) }}{% else %}<span style=\"color:#999;\">N/A</span>{% endif %}\n                            </td>\n                            <td class=\"remarks-cell\">{{ four_remarks if four_remarks else \"--\" }}</td>\n                        </tr>\n                        {% endfor %}\n                    {% endfor %}\n                </tbody>\n            </table>\n        </div>\n        {% endif %}\n    {% endif %}\n\n    {# ==================== WORK IMAGES ==================== #}\n    {% if work_photos|length > 0 %}\n    <div class=\"page-break-before\">\n        {% if show_header %}{{ header_block() }}{% endif %}\n        <div class=\"section-title mt-10\">Most Recent Work Images</div>\n        {{ render_photos(work_photos) }}\n    </div>\n    {% endif %}\n\n    {% endif %} {# End of if current_report #}\n\n</div>\n",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2026-01-19 13:59:49.538064",
  "module": "Nirmaan Stack",
  "name": "Overall Milestones Report",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 }
]