[
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 0,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": null,
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-02-19 13:15:13.143402",
  "module": "Nirmaan Stack",
  "name": "Test Format",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 0,
  "default_print_language": null,
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": "{\"header\":\"<div class=\\\"document-header\\\">\\n\\t<h3>Procurement Orders</h3>\\n\\t<p>{{ doc.name }}</p>\\n</div>\",\"sections\":[{\"label\":\"Links\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Project\",\"fieldname\":\"project\",\"fieldtype\":\"Link\",\"options\":\"Projects\"},{\"label\":\"Vendor\",\"fieldname\":\"vendor\",\"fieldtype\":\"Link\",\"options\":\"Vendors\"},{\"label\":\"Procurement Request\",\"fieldname\":\"procurement_request\",\"fieldtype\":\"Link\",\"options\":\"Procurement Requests\"},{\"label\":\"Category\",\"fieldname\":\"category\",\"fieldtype\":\"Link\",\"options\":\"Category\"},{\"label\":\"Merged\",\"fieldname\":\"merged\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true},{\"label\":\"Procurement Order Details\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Attachment\",\"fieldname\":\"attachment\",\"fieldtype\":\"Data\"},{\"label\":\"Project Name\",\"fieldname\":\"project_name\",\"fieldtype\":\"Data\"},{\"label\":\"Project Address\",\"fieldname\":\"project_address\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor Name\",\"fieldname\":\"vendor_name\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor Address\",\"fieldname\":\"vendor_address\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor GST\",\"fieldname\":\"vendor_gst\",\"fieldtype\":\"Data\"},{\"label\":\"Order List\",\"fieldname\":\"order_list\",\"fieldtype\":\"JSON\"},{\"label\":\"Category List\",\"fieldname\":\"category_list\",\"fieldtype\":\"JSON\",\"options\":\"Category\"}]}],\"has_fields\":true},{\"label\":\"Payment Details \",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Advance\",\"fieldname\":\"advance\",\"fieldtype\":\"Data\"},{\"label\":\"Loading Charges\",\"fieldname\":\"loading_charges\",\"fieldtype\":\"Data\"},{\"label\":\"Freight Charges\",\"fieldname\":\"freight_charges\",\"fieldtype\":\"Data\"},{\"label\":\"Notes\",\"fieldname\":\"notes\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true},{\"label\":\"Tracking Details\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Status\",\"fieldname\":\"status\",\"fieldtype\":\"Data\"},{\"label\":\"Delivery Contact\",\"fieldname\":\"delivery_contact\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true}]}",
  "html": null,
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-02-19 13:15:41.095080",
  "module": "Nirmaan Stack",
  "name": "Test 2",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 1,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: PO Nirmaan (Revised)\n    DocType: Procurement Order\n#}\n\n{# --- Company Details (Customized) --- #}\n{%- set company_details = {\n    \"name\": \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"logo_url\": \"https://s3.ap-south-1.amazonaws.com/nirmaan-stack-test-bucket/test/2025/05/19/File/Z3C3GD6J_logo-svg.svg\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": \"Bengaluru\",\n        \"06ABFCS9095N1ZH\": \"Gurugram\"\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park Cowarking Space, Mehrauli Gurugram Rd, Tower D, Sikanderpur, Gurugram, Haryana - 122002\"\n    },\n    \"default_address\": \"Company address details missing or project GST not set.\",\n    \"phone_no\": \"YOUR_COMPANY_PHONE\",\n    \"email\": \"YOUR_COMPANY_EMAIL\",\n    \"website\": \"YOUR_COMPANY_WEBSITE\"\n} -%}\n\n{# Determine current company address and GST based on PO's project_gst #}\n{%- set current_company_gst = doc.project_gst if doc.project_gst in company_details.gst_numbers else None -%}\n{%- set current_company_address = company_details.addresses[current_company_gst] if current_company_gst else company_details.default_address -%}\n{%- set currency_symbol = \"₹\" -%}\n{# {%- set company_currency = frappe.db.get_default(\"currency\") or \"INR\" -%} #}\n{# {%- set currency_symbol  = frappe.utils.get_currency_symbol(company_currency) -%} #}\n\n{# ----------- 1. Macro – Address formatter --------------------- #}\n{% macro format_address(addr_name) -%}\n    {%- if not addr_name -%}N/A\n    {%- else -%}\n        {%- set ad = frappe.get_doc(\"Address\", addr_name) -%}\n        {%- set parts = [] -%}\n        {%- if ad.address_line1        %}{% set parts = parts + [ad.address_line1]        %}{% endif -%}\n        {%- if ad.address_line2        %}{% set parts = parts + [ad.address_line2]        %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if ad.city                 %}{% set csp = csp + [ad.city]                     %}{% endif -%}\n        {%- if ad.state                %}{% set csp = csp + [ad.state]                    %}{% endif -%}\n        {%- if ad.pincode              %}{% set csp = csp + [ad.pincode]                  %}{% endif -%}\n        {%- if csp                     %}{% set parts = parts + [csp | join(\" \")]         %}{% endif -%}\n        {%- if ad.country              %}{% set parts = parts + [ad.country]              %}{% endif -%}\n        {{ parts | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{%- set project_doc = frappe.get_doc(\"Projects\", doc.project) if doc.project else None -%}\n{%- set vendor_doc = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n\n{# ----------- 3. Pre-rendered HTML blocks ----------------------- #}\n{% set vendor_address_html  = format_address(vendor_doc.vendor_address)\n                                  if vendor_doc else \"N/A\" %}\n{% set project_address_html = format_address(project_doc.project_address)\n                                  if project_doc else \"N/A\" %}\n\n{# Helper to parse the first value from the advance string #}\n{%- macro get_first_advance_value(advance_string) -%}\n    {%- if advance_string and advance_string is string -%}\n        {%- set parts = advance_string.split(',') -%}\n        {%- if parts and parts[0] -%}\n            {{- (parts[0] | trim | float) if parts[0] | trim else 0 -}}\n        {%- else -%}\n            0\n        {%- endif -%}\n    {%- else -%}\n        {{- (advance_string | float) if advance_string is number else 0 -}} {# Handle if it's already a number or None #}\n    {%- endif -%}\n{%- endmacro -%}\n{%- set advance_paid_value = get_first_advance_value(doc.advance) -%}\n\n\n<style>\n    body { font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif; font-size: 10px; color: #333; margin: 0; padding: 0; }\n    /*.invoice-container { width: 100%; max-width: 800px; margin: 0 auto; padding: 0 15px 15px 15px; }*/\n    \n    @page {\n        size: A4;\n        margin: 45mm 12mm 20mm 12mm;   /* top, right, bottom, left */\n    }\n    \n    .header img.logo { max-width: 140px; max-height: 40px; margin-bottom: 8px; float: left; }\n    .company-info-header { float: right; text-align: right; }\n    .company-info-header p { margin: 0 0 2px 0; font-size: 9.5px; }\n    .document-title {\n        font-size: 20px; font-weight: bold; color: #1a1a1a; text-transform: uppercase;\n        margin-bottom: 15px; text-align: center; clear: both; padding-top: 10px;\n        border-bottom: 2px solid #333; padding-bottom: 10px;\n    }\n    .po-details { margin-bottom: 15px; overflow: hidden; }\n    .po-details .left, .po-details .right { width: 49%; float: left; font-size: 9.5px; }\n    .po-details .right { float: right; text-align: right; }\n    .po-details p, .address-section p { margin: 0 0 3px 0; line-height: 1.4; }\n    .address-section { margin-bottom: 15px; overflow: hidden; }\n    .address-section .billed-to, .address-section .shipped-to {\n        width: 49%; float: left; min-height: 80px; font-size: 9.5px;\n    }\n    .address-section .shipped-to { float: right; }\n    .address-section h4 {\n        font-size: 10px; font-weight: bold; text-transform: uppercase; color: #555;\n        margin-top: 0; margin-bottom: 6px;\n    }\n    .address-block       { margin-bottom:15px; overflow:hidden; }\n    .address-block__col  { width:48%; float:left; font-size:9.5px; }\n    .address-block__col + .address-block__col { float:right; }\n    .items-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }\n    .items-table th, .items-table td { border: 1px solid #ddd; padding: 5px 7px; text-align: left; }\n    .items-table th { background-color: #f0f0f0; font-weight: bold; font-size: 9.5px; text-transform: uppercase; }\n    .items-table td { font-size: 9.5px; }\n    .items-table .text-right { text-align: right; }\n    .items-table .text-center { text-align: center; }\n    .totals-section { width: 100%; margin-top: 15px; overflow: hidden; }\n    .totals-section .notes-terms { width: 58%; float: left; font-size: 9.5px; }\n    .totals-section .summary { width: 40%; float: right; }\n    .totals-section .summary table { width: 100%; font-size: 9.5px; }\n    .totals-section .summary td { padding: 3px 0; }\n    .totals-section .summary td:first-child { font-weight: bold; color: #444; }\n    .totals-section .summary .grand-total td {\n        font-weight: bold; font-size: 11px; border-top: 1px solid #333; border-bottom: 1px solid #333;\n        padding-top: 6px; padding-bottom: 6px;\n    }\n    .footer-notes {\n        margin-top: 25px; font-size: 8.5px; color: #777; border-top: 1px dashed #ccc;\n        padding-top: 8px; text-align: center;\n    }\n    .signature-area { margin-top: 40px; text-align: right; }\n    .signature-area .line { width: 180px; border-top: 1px solid #333; margin-left: auto; margin-bottom: 5px; }\n    .signature-area p { font-size: 9.5px; margin:0; }\n</style>\n\n{# -----------------  HEADER – will repeat on every page  ----------------- #}\n<div id=\"header-html\" style=\"display: none\">       {# must be OUTSIDE .print-format #}\n  <table style=\"width:100%; font-family:Helvetica,Arial,sans-serif; font-size:9.5px\">\n    <tr>\n      <td style=\"width:40%\">\n        <img src=\"{{ company_details.logo_url }}\" style=\"max-width:140px; max-height:38px\">\n      </td>\n      <td style=\"text-align:right; font-size:11px\">\n        <strong>{{ company_details.name }}</strong><br>\n        {{ current_company_address }}<br>\n        {% if current_company_gst %}\n          <strong>GSTIN:</strong> {{ current_company_gst }}\n        {% endif %}\n      </td>\n    </tr>\n  </table>\n</div>\n\n{# -------------  FOOTER (optional) – also repeats on every page --------- #}\n<div id=\"footer-html\" style=\"display:none\">\n  <div style=\"width:100%; text-align:center; font-size:8.5px;\">\n    Page <span class=\"page\"></span> of <span class=\"topage\"></span>\n  </div>\n</div>\n    \n<div class=\"print-format\">\n\n<!--<div class=\"invoice-container\">-->\n    <div class=\"document-title\">Purchase Order</div>\n    <!--<h2 style=\"text-align:center; margin:0 0 12px 0;\">Purchase Order</h2>-->\n    <div class=\"po-details\">\n        <div class=\"left\">\n            <p><strong>PO Number:</strong> {{ doc.name }}</p>\n            <p><strong>PO Date:</strong> {{ frappe.utils.formatdate(doc.creation, \"dd-MM-yyyy\") }}</p>\n            {% if doc.procurement_request %}\n            <p><strong>PR Reference:</strong> {{ doc.procurement_request }}</p>\n            {% endif %}\n        </div>\n        <div class=\"right\">\n            <p><strong>Status:</strong> <span style=\"font-weight:bold; color: #007bff;\">{{ doc.status }}</span></p>\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n\n    {# In the address display section: #}\n    <div class=\"address-block\">\n      <div class=\"address-block__col\">\n          <h4>VENDOR DETAILS</h4>\n          <p><strong>{{ vendor_doc.vendor_name if vendor_doc else doc.vendor }}</strong></p>\n          {{ vendor_address_html }}\n          {% if vendor_doc and vendor_doc.vendor_gst %}\n            <p><strong>GSTIN:</strong> {{ vendor_doc.vendor_gst }}</p>\n          {% endif %}\n      </div>\n\n      <div class=\"address-block__col\">\n          <h4>SHIP-TO / PROJECT DETAILS</h4>\n          <p><strong>{{ project_doc.project_name if project_doc else doc.project }}</strong></p>\n          {{ project_address_html }}\n          {% if doc.delivery_contact %}\n            <p><strong>Site Contact:</strong> {{ doc.delivery_contact }}</p>\n          {% endif %}\n      </div>\n  </div>\n<div style=\"clear:both;\"></div>\n\n<table class=\"items-table\">\n    <thead>\n        <tr>\n            <th style=\"width:5%;\">Sr.</th>\n            <th style=\"width:35%;\">Item Description</th>\n            <th style=\"width:10%;\" class=\"text-center\">Make</th>\n            <th style=\"width:8%;\" class=\"text-center\">Qty</th>\n            <th style=\"width:8%;\" class=\"text-center\">Unit</th>\n            <th style=\"width:12%;\" class=\"text-right\">Rate ({{ currency_symbol }})</th>\n            <th style=\"width:10%;\" class=\"text-right\">Tax %</th>\n            <th style=\"width:12%;\" class=\"text-right\">Amount ({{ currency_symbol }})</th>\n        </tr>\n    </thead>\n    <tbody>\n        {% set total_qty = namespace(value=0.0) %}\n        {% set subtotal = namespace(value=0.0) %}\n        {% set total_tax_amount_on_items = namespace(value=0.0) %}\n\n        {# Initialize items_to_loop variable #}\n        {% set items_to_loop = [] %}\n\n        {# Attempt to parse if doc.order_list is a string #}\n        {% if doc.order_list and doc.order_list is string %}\n            {% set parsed_data = json.loads(doc.order_list) %}\n            {% if parsed_data is mapping and parsed_data.list is defined and parsed_data.list is iterable %}\n                {% set items_to_loop = parsed_data.list %}\n            {% endif %}\n        {# Else, if it's already a dictionary with a list #}\n        {% elif doc.order_list is mapping and doc.order_list.list is defined and doc.order_list.list is iterable %}\n            {% set items_to_loop = doc.order_list.list %}\n        {% endif %}\n\n        {% if items_to_loop | length > 0 %}\n            {% for item in items_to_loop %}\n                {% if item is mapping %}\n                    <tr>\n                        <td class=\"text-center\">{{ loop.index }}</td>\n                        <td>\n                            {{ item.get(\"item\", \"N/A\") }}\n                            {% if item.get(\"comment\") %}<br><small><em>Note: {{ item.get(\"comment\") }}</em></small>{% endif %}\n                        </td>\n                        <td class=\"text-center\">{{ item.get(\"make\", \"-\") }}</td>\n                        {%- set current_item_quantity = (item.get(\"quantity\") | float(0)) -%}\n                        <td class=\"text-center\">{{ current_item_quantity | round(2) }}</td>\n                        {%- set total_qty.value = total_qty.value + current_item_quantity -%}\n                        <td class=\"text-center\">{{ item.get(\"unit\", \"N/A\") }}</td>\n                        {%- set current_item_quote = (item.get(\"quote\") | float(0)) -%}\n                        <td class=\"text-right\">{{ \"%.2f\" | format(current_item_quote) }}</td>\n                        {%- set current_item_tax_percent = (item.get(\"tax\") | float(0)) if item.get(\"tax\") is not none else 0.0 -%}\n                        <td class=\"text-right\">{{ current_item_tax_percent }}%</td>\n\n                        {%- set item_base_amount = current_item_quantity * current_item_quote -%}\n                        {%- set current_item_tax_amount = item_base_amount * current_item_tax_percent / 100.0 -%}\n                        {%- set item_total_amount = item_base_amount + current_item_tax_amount -%}\n                        <td class=\"text-right\">{{ \"%.2f\" | format(item_total_amount | float ) }}</td>\n\n                        {%- set subtotal.value = subtotal.value + item_base_amount -%}\n                        {%- set total_tax_amount_on_items.value = total_tax_amount_on_items.value + current_item_tax_amount -%}\n                    </tr>\n                {% else %}\n                    <tr><td colspan=\"8\" style=\"color:red; text-align:center;\">Malformed item data found in order_list (item not a dict)</td></tr>\n                {% endif %}\n            {% endfor %}\n        {% else %}\n            <tr><td colspan=\"8\" style=\"text-align:center; padding: 20px;\">No items found in this order or order_list is invalid.</td></tr>\n        {% endif %}\n    </tbody>\n</table>\n\n    <div class=\"totals-section\">\n        <div class=\"notes-terms\">\n            <p><strong>Total Quantity:</strong> {{ (total_qty.value | float) | round(2) }}</p>\n            <br>\n            {# Corrected all values in final_grand_total calculation to use | float #}\n            {% set final_grand_total = (subtotal.value | float) + (total_tax_amount_on_items.value | float) + ((doc.loading_charges or 0) | float) + ((doc.freight_charges or 0) | float) - (advance_paid_value | float(0)) %}\n            <p><strong>Amount in Words:</strong><br>\n                {{ frappe.utils.money_in_words(final_grand_total, \"INR\") }} {# Assuming INR or use system default #}\n            </p>\n            {% if doc.notes %}\n            <div style=\"margin-top:10px;\">\n                <h4 style=\"font-size:10px; font-weight:bold; margin-bottom:3px;\">NOTES & TERMS:</h4>\n                <div style=\"font-size:9px; white-space: pre-wrap;\">{{ doc.notes }}</div>\n            </div>\n            {% endif %}\n        </div>\n\n        <div class=\"summary\">\n            <table>\n                <tr>\n                    <td>Subtotal:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(subtotal.value | float) }}</td>\n                </tr>\n                <tr>\n                    <td>Total Item Tax:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(total_tax_amount_on_items.value | float) }}</td>\n                </tr>\n                {% if doc.loading_charges and (doc.loading_charges | string | trim != \"\") and ((doc.loading_charges or 0) | float) > 0 %}\n                <tr>\n                    <td>Loading Charges:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format((doc.loading_charges or 0) | float) }}</td>\n                </tr>\n                {% endif %}\n                {% if doc.freight_charges and (doc.freight_charges | string | trim != \"\") and ((doc.freight_charges or 0) | float) > 0 %}\n                <tr>\n                    <td>Freight Charges:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format((doc.freight_charges or 0) | float) }}</td>\n                </tr>\n                {% endif %}\n                {% if (advance_paid_value | float(0)) > 0 %}\n                <tr>\n                    <td>Advance Paid:</td>\n                    <td class=\"text-right\" style=\"color:green;\">- {{ currency_symbol }} {{ \"%.2f\" | format(advance_paid_value | float) }}</td>\n                </tr>\n                {% endif %}\n                <tr class=\"grand-total\">\n                    <td>GRAND TOTAL:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(final_grand_total | float) }}</td>\n                </tr>\n            </table>\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n\n    <div class=\"footer-notes\">\n        This is a computer-generated Purchase Order.\n        <p>For detailed terms and conditions, please visit our website or refer to the master agreement.</p>\n    </div>\n\n    <div class=\"signature-area\">\n        <div class=\"line\"></div>\n        <p>For <strong>{{ company_details.name }}</strong></p>\n        <p>(Authorized Signatory)</p>\n    </div>\n</div>\n<!--</div>-->",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-05-20 13:46:48.216386",
  "module": "Nirmaan Stack",
  "name": "PO Invoice",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Service Requests",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format : SR Tax Invoice – single-line grid, no background\n    DocType      : Service Requests\n#}\n\n{# ──────────────────────────────────────────────────────────────\n   0 . Company / project / customer / vendor variables\n   ────────────────────────────────────────────────────────────── #}\n{%- set nirmaan_company_details = {\n    \"name\"      : \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": {\"name\": \"Karnataka\", \"code\": \"29\"},\n        \"06ABFCS9095N1ZH\": {\"name\": \"Haryana\",   \"code\": \"06\"},\n        \"09ABFCS9095N1ZB\": {\"name\": \"Noida\", \"code\":\"09\"}\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru 560102\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\",\n        \"09ABFCS9095N1ZB\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"\n    },\n    \"default_address\": \"Nirmaan address not set\"\n} -%}\n\n{%- set n_key         = doc.project_gst if doc.project_gst in nirmaan_company_details.gst_numbers else None -%}\n{%- set n_addr        = nirmaan_company_details.addresses.get(n_key, nirmaan_company_details.default_address) -%}\n{%- set n_gstin       = n_key -%}\n{%- set n_state_name  = nirmaan_company_details.gst_numbers[n_key].name if n_key else \"N/A\" -%}\n{%- set n_state_code  = nirmaan_company_details.gst_numbers[n_key].code if n_key else \"N/A\" -%}\n\n{%- set project_doc   = frappe.get_doc(\"Projects\",  doc.project)  if doc.project else None -%}\n{%- set vendor_doc    = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n{%- set customer_doc  = frappe.get_doc(\"Customers\", project_doc.customer) if project_doc and project_doc.customer else None -%}\n\n{%- set is_gst_applicable = doc.gst == \"true\" -%}\n{%- set gst_rate = 18.0 -%}\n\n{% macro format_address(addr) -%}\n    {%- if not addr -%}N/A{%- else -%}\n        {%- set a = frappe.get_doc(\"Address\", addr) -%}\n        {%- set p = [] -%}\n        {%- if a.address_line1 %}{% set p = p + [a.address_line1] %}{% endif -%}\n        {%- if a.address_line2 %}{% set p = p + [a.address_line2] %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if a.city    %}{% set csp = csp + [a.city]    %}{% endif -%}\n        {%- if a.state   %}{% set csp = csp + [a.state]   %}{% endif -%}\n        {%- if a.pincode %}{% set csp = csp + [a.pincode] %}{% endif -%}\n        {%- if csp %}{% set p = p + [csp | join(\" \")] %}{% endif -%}\n        {%- if a.country %}{% set p = p + [a.country] %}{% endif -%}\n        {{ p | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{%- set project_addr_html = format_address(project_doc.project_address) if project_doc and project_doc.project_address else \"N/A\" -%}\n{%- set vendor_addr_html = format_address(vendor_doc.vendor_address) if vendor_doc and vendor_doc.vendor_address else \"N/A\" -%}\n{%- set vendor_gstin = vendor_doc.vendor_gst if vendor_doc else \"N/A\" -%}\n{%- set vendor_state_name = frappe.get_doc(\"Address\", vendor_doc.vendor_address).state if vendor_doc and vendor_doc.vendor_address else \"N/A\" -%}\n{%- set vendor_state_code = vendor_gstin[0:2] if vendor_gstin and vendor_gstin != \"N/A\" else \"N/A\" -%}\n{%- set currency_symbol= \"₹\" -%}\n\n{# ──────────────────────────────────────────────────────────────\n   1 . Styles (unified 1-px grid, no colour fills)\n   ────────────────────────────────────────────────────────────── #}\n<style>\n    body      { font-family:\"Roboto\",Arial,sans-serif; font-size:8.5pt; margin:0; color:#000; }\n    table     { width:100%; border-collapse:collapse; }\n    tr        { page-break-inside:avoid; }\n    td,th     { border:1px solid #555; padding:2px 3px; vertical-align:top; font-size:8.5pt; }\n    th        { font-weight:bold; text-align:center; }\n\n    .w-50     { width:50%; }\n\n    /* outer grids */\n    .section-table td { padding:2px 3px; }\n\n    /* nested info-table : inner lines only */\n    /* .info-table        { width:100%; border-collapse:collapse; }\n    .info-table td     { border:1px solid #555; padding:1.5px 3px; }\n    .info-table        { border:none; }\n    .info-table tr:first-child  td { border-top:0; }\n    .info-table tr:last-child   td { border-bottom:0; }\n    .info-table tr td:first-child{ border-left:0; }\n    .info-table tr td:last-child { border-right:0; } */\n\n    .info-table td { border:1px solid #555; padding:1.5px 3px; font-size:7.5pt; vertical-align: top;}\n    .info-table { border:none; } /* Remove outer border of the nested table */\n    .info-table tr:first-child td  { border-top:0; }\n    .info-table tr:last-child td   { border-bottom:0; }\n    .info-table tr td:first-child  { border-left:0; }\n    .info-table tr td:last-child   { border-right:0; }\n\n    /* .label-cell { width:50%; font-weight:normal; border-bottom:0; padding-bottom:0; }\n    .value-cell { width:50%; font-weight:bold;   border-top:0;   padding-top:.5px; }\n    .terms-cell { border-top:1px solid #555; } */\n\n    .label-cell { width:50%; font-weight:normal; border-bottom:0; padding-bottom:0; text-align:left; }\n    .value-cell { width:50%; font-weight:bold;   border-top:0;   padding-top:.5px; text-align:left; min-height: 10px; word-wrap: break-word; }\n\n    .text-center{ text-align:center; }\n    .text-right { text-align:right;  }\n    .font-bold  { font-weight:bold;  }\n    .font-small { font-size: 7pt; } /* For labels like \"Buyer (Bill to)\" */\n\n    @page { size:A4; margin:30mm 8mm 18mm 8mm; }\n\n    #header-html h2 { margin:0 0 12px 0; text-align:center; }\n    #footer-html    { font-size:7.5pt; text-align:center; font-family:\"Roboto\",Arial,sans-serif; }\n</style>\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Header / Footer\n   ────────────────────────────────────────────────────────────── #}\n<div id=\"header-html\" style=\"display:none;\">\n    <h2>Tax Invoice</h2>\n</div>\n\n<div id=\"footer-html\" style=\"display:none;\">\n    This is a Computer Generated Invoice  |  Page <span class=\"page\"></span> of <span class=\"topage\"></span>\n</div>\n\n{# ──────────────────────────────────────────────────────────────\n   3 . Main document\n   ────────────────────────────────────────────────────────────── #}\n<div class=\"print-format\">\n\n<!-- SECTION 1 : Vendor vs Invoice quick info -->\n<table class=\"section-table\">\n  <tr>\n    <td class=\"w-50\">\n        <p class=\"font-bold\" style=\"font-size:9.5pt;\">\n            {{ vendor_doc.vendor_name if vendor_doc else \"Vendor N/A\" }}\n        </p>\n        {{ vendor_addr_html }}<br>\n        <!-- {% if vendor_gstin and vendor_gstin != \"N/A\" %}\n           <strong>GSTIN/UIN:</strong> {{ vendor_gstin }}<br>\n        {% endif %}\n        State Name : {{ vendor_state_name }}, Code : {{ vendor_state_code }} -->\n    </td>\n\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Invoice No.</td><td class=\"label-cell\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ doc.invoice_no if doc.invoice_no else \"-\" }}</td><td class=\"value-cell\">{{ frappe.utils.formatdate(doc.invoice_date,\"dd-MMM-yy\") if doc.invoice_date else \"-\" }}</td></tr>\n\n            <!-- <tr><td class=\"label-cell\">Delivery Note</td><td class=\"label-cell\">Mode/Terms of Payment</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_delivery_note_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_payment_terms\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\">Reference No. & Date</td><td class=\"label-cell\">Other References</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_reference_no_date\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_other_references\") or \"-\" }}</td></tr> -->\n        </table>\n    </td>\n  </tr>\n</table>\n\n<!-- SECTION 2 : Consignee / Buyer / Dispatch -->\n<table style=\"margin-top:3px;\">\n  <!-- <tr>\n    <td class=\"w-50\">\n        <span style=\"font-size:7.5pt;\">Consignee (Ship to)</span><br>\n        <span class=\"font-bold\">{{ project_doc.project_name if project_doc else \"Project N/A\" }}</span><br>\n        {{ project_addr_html }}<br>\n        {% if project_doc and project_doc.project_city %}\n          City : {{ project_doc.project_city }}<br>\n        {% endif %}\n        {% if project_doc and project_doc.project_state %}\n          State : {{ project_doc.project_state }}\n        {% endif %}\n    </td>\n\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td><td class=\"label-cell\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_buyers_order_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_buyers_order_date\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\">Dispatch Doc No.</td><td class=\"label-cell\">Delivery Note Date</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_dispatch_doc_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_delivery_note_date\") or \"-\" }}</td></tr>\n        </table>\n    </td>\n  </tr> -->\n\n  <tr>\n    <td class=\"w-50\">\n        <span style=\"font-size:7.5pt;\">Buyer (Bill to)</span><br>\n        <span class=\"font-bold\">{{ nirmaan_company_details.name }}</span><br>\n        {{ n_addr }}<br>\n        {% if n_gstin %}\n          <strong>GSTIN/UIN:</strong> {{ n_gstin }}<br>\n          State Name : {{ n_state_name }}, Code : {{ n_state_code }}\n        {% endif %}\n    </td>\n\n    <!-- <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Dispatched through</td><td class=\"label-cell\">Destination</td></tr>\n            <tr>\n                <td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_dispatched_through\") or \"-\" }}</td>\n                <td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_destination\") or project_doc.project_city if project_doc and project_doc.project_city else '-' }}</td>\n            </tr>\n\n                        <tr><td colspan=\"2\" class=\"label-cell terms-cell\">Terms of Delivery</td></tr>\n            <tr><td colspan=\"2\" class=\"value-cell\" style=\"border-top:0;\">{{ frappe.form_dict.get(\"custom_terms_of_delivery\") or \"-\" }}</td></tr>\n        </table>\n    </td> -->\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td><td class=\"label-cell\">Project</td></tr>\n            <tr><td class=\"value-cell\">{{ doc.name or \"-\" }}</td><td class=\"value-cell\">{{ project_doc.project_name if project_doc else \"-\" }}</td></tr>\n\n            <!--<tr><td class=\"label-cell\">Project</td></tr>-->\n            <!--<tr><td class=\"value-cell\">{{ project_doc.project_name if project_doc else \"-\" }}</td></tr>-->\n        </table>\n    </td>\n    <!-- <td class=\"w-50\"> {# Buyer's Order No & Date (from client input if provided) #}\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td></tr>\n            <tr><td class=\"value-cell\" style=\"padding-bottom:5px;\">{{ frappe.form_dict.get(\"custom_buyers_order_no\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\" style=\"border-top:1px solid #555;\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.utils.formatdate(project_doc.project_start_date,\"dd-MMM-yy\") if project_doc and project_doc.expected_start_date else \"-\" }}</td></tr>\n        </table>\n    </td> -->\n  </tr>\n</table>\n\n <!--SECTION 3 : Item grid -->\n<table style=\"margin-top:3px;\">\n   <thead>\n     <tr>\n       <th style=\"width:5%;\">Sl&nbsp;No.</th>\n       <th style=\"width:{% if is_gst_applicable %}48%{% else %}58%{% endif %};\">Particulars</th>\n       <th style=\"width:8%;\" class=\"text-center\">Quantity</th>\n       <th style=\"width:8%;\" class=\"text-center\">Rate&nbsp;per</th>\n       {% if is_gst_applicable %}\n       <th style=\"width:8%;\" class=\"text-center\">GST</th>\n       {% endif %}\n       <th style=\"width:{% if is_gst_applicable %}23%{% else %}21%{% endif %};\" class=\"text-right\">Amount</th>\n     </tr>\n   </thead>\n   <tbody>\n     {% set subtotal = namespace(value=0.0) %}\n     {% set total_tax = namespace(value=0.0) %}\n     {% set grand_total = namespace(value=0.0) %}\n\n     {# build items array the same way you did earlier #}\n     {% set items = [] %}\n     {% if doc.service_order_list and doc.service_order_list is string %}\n         {% set parsed = json.loads(doc.service_order_list) %}\n         {% if parsed is mapping and parsed.list is defined %}{% set items = parsed.list %}{% endif %}\n     {% elif doc.service_order_list is mapping and doc.service_order_list.list is defined %}\n         {% set items = doc.service_order_list.list %}\n     {% endif %}\n\n     {% if items|length %}\n       {% for it in items %}\n         {% set qty   = (it.quantity  or 0)|float %}\n         {% set rate  = (it.rate      or 0)|float %}\n         {% set amt   = qty * rate %}\n         {% set subtotal.value = subtotal.value + amt %}\n         \n         {% if is_gst_applicable %}\n             {% set tax_amount = amt * (gst_rate / 100) %}\n             {% set total_tax.value = total_tax.value + tax_amount %}\n             {% set item_total = amt + tax_amount %}\n         {% else %}\n             {% set item_total = amt %}\n         {% endif %}\n         \n         {% set grand_total.value = grand_total.value + item_total %}\n         <tr>\n           <td class=\"text-center\">{{ loop.index }}</td>\n           <td>{{ it.description }}</td>\n           <td class=\"text-center\">{{ qty if qty else \"-\" }} {{ it.uom if qty else \"\" }}</td>\n           <td class=\"text-right\">{{ rate and ('%.2f'|format(rate)) or '-' }}</td>\n           {% if is_gst_applicable %}\n           <td class=\"text-center\">{{ gst_rate }}%</td>\n           {% endif %}\n           <td class=\"text-right\">{{ currency_symbol }} {{ '%.2f'|format(amt) }}</td>\n         </tr>\n       {% endfor %}\n     {% else %}\n       <tr><td colspan=\"{{ 6 if is_gst_applicable else 5 }}\" class=\"text-center\" style=\"padding:12px;\">No service items found</td></tr>\n     {% endif %}\n\n     <tr>\n        <td colspan=\"{% if is_gst_applicable %}4{% else %}3{% endif %}\" class=\"font-bold text-right\">Total</td>\n        <td {% if is_gst_applicable %}{% else %}colspan=\"1\"{% endif %}></td>\n        <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(subtotal.value) }}</td>\n     </tr>\n\n     {% if is_gst_applicable %}\n        <tr>\n            <td colspan=\"4\" class=\"font-bold text-right\">Add: GST @ {{ gst_rate }}%</td>\n            <td></td>\n            <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(total_tax.value) }}</td>\n        </tr>\n     {% endif %}\n\n     <tr>\n        <td colspan=\"{% if is_gst_applicable %}4{% else %}3{% endif %}\" class=\"font-bold text-right\">Grand Total</td>\n        <td {% if is_gst_applicable %}{% else %}colspan=\"1\"{% endif %}></td>\n        <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(grand_total.value) }}</td>\n     </tr>\n   </tbody>\n</table>\n\n<!-- SECTION 4 : Amount in words / taxable summary -->\n<table style=\"margin-top:3px;\">\n  <tr>\n    <td style=\"width:70%; border-right:0;\">\n        Amount Chargeable (in words)<br>\n        <span class=\"font-bold\">\n           {{ frappe.utils.money_in_words(grand_total.value,\"INR\") if grand_total.value else \"INR Zero Only\" }}\n        </span>\n    </td>\n\n    <td style=\"width:30%; border-left:0;\">\n        <table class=\"info-table\">\n             <tr>\n              <td class=\"label-cell\" style=\"border-top:0;\"></td>\n              <td class=\"label-cell\" style=\"border-top:0; text-align:right;\">Taxable Value</td>\n              {% if is_gst_applicable %}\n              <td class=\"label-cell\" style=\"border-top:0; text-align:right;\">Tax Amount</td>\n              {% endif %}\n          </tr>\n          \n          <tr>\n              <td class=\"value-cell\"></td>\n              <td class=\"value-cell text-right\">{{ '%.2f'|format(subtotal.value) }}</td>\n              {% if is_gst_applicable %}\n              <td class=\"value-cell text-right\">{{ '%.2f'|format(total_tax.value) }}</td>\n              {% endif %}\n          </tr>\n          \n          <tr>\n              <td class=\"font-bold\">Total</td>\n              <td class=\"font-bold text-right\">{{ currency_symbol }} {{ '%.2f'|format(subtotal.value) }}</td>\n              {% if is_gst_applicable %}\n              <td class=\"font-bold text-right\">{{ currency_symbol }} {{ '%.2f'|format(total_tax.value) }}</td>\n              {% endif %}\n          </tr>\n        </table>\n    </td>\n  </tr>\n\n  <!--<tr>-->\n  <!--  <td colspan=\"2\" style=\"border-right:0;\">-->\n  <!--      Tax Amount (in words) : -->\n  <!--      <span class=\"font-bold\">-->\n  <!--          {% if is_gst_applicable and total_tax.value > 0 %}-->\n  <!--          {{ frappe.utils.money_in_words(total_tax.value,\"INR\") }}-->\n  <!--          {% else %}-->\n  <!--          NIL-->\n  <!--          {% endif %}-->\n  <!--      </span>-->\n  <!--  </td>-->\n  <!--</tr>-->\n\n  <tr>\n    <td colspan=\"2\" style=\"font-size:7pt; text-align:right; border-left:0; border-bottom:0;\">\n        E. &amp; O.E\n    </td>\n  </tr>\n</table>\n\n<!-- SECTION 5 : Signature -->\n<table style=\"margin-top:25px; height:50px;\">\n  <tr>\n     <td style=\"width:60%; vertical-align:bottom;\">Customer's Seal and Signature</td>\n     <td style=\"width:40%; text-align:center; vertical-align:bottom;\" class=\"font-bold\">\n         for {{ vendor_doc.vendor_name if vendor_doc else \"Vendor\" }}\n         <br><br><br>\n         Authorised Signatory\n     </td>\n  </tr>\n</table>\n\n</div> ",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-10-14 18:29:52.529101",
  "module": "Nirmaan Stack",
  "name": "SR Invoice",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Project Payments",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format : Payments - Simple Voucher with Authorization (Final)\n    DocType      : Project Payments\n#}\n\n{# MACRO REMOVED: Rely on direct frappe.get_doc calls to prevent 'str object' error #}\n\n{# ──────────────────────────────────────────────────────────────\n   0 . Dynamic Variables\n   ────────────────────────────────────────────────────────────── #}\n{%- set nirmaan_company_details = {\n    \"name\"      : \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": {\"name\": \"Karnataka\", \"code\": \"29\", \"address\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru 560102\"},\n        \"06ABFCS9095N1ZH\": {\"name\": \"Haryana\",   \"code\": \"06\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\"},\n        \"09ABFCS9095N1ZB\": {\"name\": \"Noida\", \"code\":\"09\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"}\n    }\n} -%}\n\n{# --------------------------------------------------------------------------------- #}\n{# FIX 1: Robust Document Retrieval Logic #}\n{%- set source_doc = frappe.get_doc(doc.document_type, doc.document_name) if doc.document_type and doc.document_name else none -%}\n{%- set project_id_to_fetch = source_doc.project if source_doc and source_doc.project else doc.project or None -%}\n{%- set vendor_id_to_fetch  = source_doc.vendor if source_doc and source_doc.vendor else doc.vendor or None -%}\n{%- set project_doc   = frappe.get_doc(\"Projects\", project_id_to_fetch) if project_id_to_fetch else none -%}\n{%- set vendor_doc    = frappe.get_doc(\"Vendors\", vendor_id_to_fetch) if vendor_id_to_fetch else none -%}\n{# --------------------------------------------------------------------------------- #}\n\n\n{# Nirmaan Details #}\n{%- set n_key         = project_doc.project_gst if project_doc and project_doc.project_gst in nirmaan_company_details.gst_numbers else \"29ABFCS9095N1Z9\" -%}\n{%- set n_info        = nirmaan_company_details.gst_numbers.get(n_key, nirmaan_company_details.gst_numbers['29ABFCS9095N1Z9']) -%}\n{%- set n_reg_address = n_info.address -%}\n{%- set n_gstin       = n_key -%}\n{%- set n_state_name  = n_info.name -%}\n{%- set n_state_code  = n_info.code -%}\n\n{%- set currency_symbol= \"₹\" -%}\n{%- set paid_amount = (doc.amount or 0) | float -%}\n\n{# ──────────────────────────────────────────────────────────────\n   1 . Styles\n   ────────────────────────────────────────────────────────────── #}\n<style>\n    /* RESET/GENERAL STYLES */\n    body { \n        font-family: 'Arial', sans-serif; \n        font-size: 10pt; \n        line-height: 1.5; \n        color: #333; \n        margin: 0;\n    }\n    table { width: 100%; border-collapse: collapse; }\n    \n    /* MAIN CONTAINER: FIX: Removed min-height to prevent extra page */\n    .print-format {\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n        /* min-height removed */\n    }\n    \n    .content-wrapper {\n        flex-grow: 1;\n        padding: 0 5mm; \n        position: relative; /* ADDED FOR WATERMARK POSITIONING */\n    }\n    .watermark {\n        position: absolute;\n        top: 35%;\n        left: 50%;\n        /* Changed rotation to 45deg for bottom-left to top-right orientation */\n        \n        /* ADDED VENDOR PREFIXES FOR MAX COMPATIBILITY IN PRINT/PDF ENGINES */\n        -webkit-transform: translate(-50%, -50%) rotate(-45deg); /* WebKit (for PDF engines) */\n        -ms-transform: translate(-50%, -50%) rotate(-45deg);     /* IE */\n        transform: translate(-50%, -50%) rotate(-45deg);         /* Standard */\n        \n        /* Font size slightly reduced for better fitting on the page */\n        font-size: 120pt; \n        font-weight: 900;\n        /* Changed to Green color with 5% opacity (very light) */\n        color: rgba(0, 128, 0, 0.03); \n        pointer-events: none; /* Allows text selection underneath */\n        z-index: 10; /* Ensures it's above normal content but below anything crucial */\n        text-transform: uppercase;\n    }\n\n    /* HEADER FIX: Use float for top row, clear for title/subtitle */\n    .header {\n        margin-bottom: 20px;\n        border-bottom: 2px solid #000; \n        padding-bottom: 10px; \n    }\n    \n    .header-top-row {\n        overflow: auto; /* Clears floats */\n        margin-bottom: 5px;\n        width: 100%;\n        display: block; /* Ensure block behaviour for print */\n    }\n\n    .company-info-left {\n        float: left;\n        text-align: left;\n        font-size: 14pt; \n        font-weight: bold; \n        color: #CC0000; \n        padding-top: 5px; /* Aligns with logo's top/center */\n    }\n\n    .logo-right {\n        float: right;\n        text-align: right;\n    }\n\n    .logo { \n        max-height: 50px; \n        max-width: 180px; \n        display: block;\n    } \n    .seal-container {\n       display: inline-block; \n       \n    }\n    .company-seal {\n    max-width: 120px; /* Size of the seal */\n    max-height: 120px;\n    margin-left:50px;\n    \n    }\n\n    .title { \n        clear: both; /* Ensures title goes below floats */\n        font-size: 20pt; \n        font-weight: 800; \n        color: #000; \n        text-align: center;\n        margin-top: 15px; /* Space after logo row */\n    }\n    .subtitle { \n        font-size: 10pt; \n        color: #000; \n        text-align: center;\n        margin-bottom: 5px; \n    }\n\n    /* DATA TABLE - PROFESSIONAL STYLE */\n    .data-table { border: 1px solid #000; margin-bottom: 20px; }\n    .data-table td { padding: 8px 10px; border: 1px solid #000; }\n    .data-label { \n        width: 30%; \n        font-weight: bold; \n        color: #333; \n        background-color: transparent;\n        border-right: 1px solid #000;\n    }\n    .data-value { width: 70%; }\n\n    /* TERMS */\n    .terms-heading { font-weight: bold; margin-top: 15px; margin-bottom: 5px; }\n    .terms-list { margin-left: 15px; padding-left: 0; font-size: 9pt; }\n    .terms-list li { margin-bottom: 3px; }\n\n    /* AUTHORIZATION - IMAGE MATCH LOOK */\n    .auth-table { \n        width: 100%; \n        margin-top: 200px; \n        border-collapse: collapse;\n        border: 1px solid #000; /* Outer border for the whole block */\n    }\n    .auth-table td { \n        height: 120px; \n        border: none;\n        padding: 15px; \n        vertical-align: top; \n        font-size: 10pt;\n        font-weight: normal;\n        position: relative; \n    }\n\n    .vendor-sig-cell {\n        width: 40%;\n        border-right: 1px solid #000; \n    }\n\n    .nirmaan-text-top {\n        font-size: 10pt;\n        text-align: center;\n        margin-top: 0;\n    }\n\n    .sig-container {\n        position: absolute; \n        bottom: 15px; \n        width: calc(100% - 30px); \n        left: 60px;\n        text-align: center;\n    }\n\n    .sig-line {\n        border-top: 1px solid #000;\n        width: 75%; /* Line width */\n        margin: 0 auto; \n    }\n\n    .sig-label {\n        padding-top: 5px;\n        font-weight: bold;\n        font-size: 9pt;\n    }\n\n    /* FOOTER (Pushed to bottom) */\n    .footer-address { \n        padding: 10px 0; \n        border-top: 2px solid #000; \n        font-size: 8pt; \n        text-align: center; \n        color: #666; \n        width: 100%;\n        margin-top: 0mm; /* Increased margin to push further down */\n    }\n    .footer-address span { font-weight: bold; color: #333; }\n\n    @page { \n        size:A4; \n        margin: 15mm 15mm 15mm 15mm; \n    }\n</style>\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Header / Footer\n   ────────────────────────────────────────────────────────────── #}\n<div id=\"header-html\" style=\"display:none;\">\n    <div class=\"header\">\n            <div class=\"header-top-row\">\n                {# LEFT SIDE: Company Name (The Payer) #}\n                <div class=\"company-info-left\">\n                    <img class=\"logo\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" alt=\"Nirmaan Logo\">\n                    <div class=\"\" style=\"color: #CC0008;\">Stratos Infra Technologies Pvt.Ltd</div>\n                </div>\n                \n                {# RIGHT SIDE: Logo #}\n                <div class=\"logo-right\">\n                   \n                    <!---->\n                </div>\n            </div>\n            \n            {# TITLE BLOCK (Clear float and center) #}\n            <div class=\"title\">PAYMENT VOUCHER</div>\n            <div class=\"subtitle\">Here is the payment voucher with details</div>\n        </div>\n</div>\n\n<div id=\"footer-html\" style=\"display:none;\">\n    <div class=\"footer-address\">\n        Regd. Office: <span>{{ nirmaan_company_details.name }}</span>, {{ n_reg_address }}<br>\n        <span>GSTN:</span> {{ n_gstin }} | <span>State:</span> {{ n_state_name }} | <span>Code:</span> {{ n_state_code }}\n    </div>\n</div>\n\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Main Content\n   ────────────────────────────────────────────────────────────── #}\n<div class=\"print-format\">\n    <div class=\"content-wrapper\">\n        \n       <div class=\"watermark\">PAID</div>\n        <table class=\"data-table\">\n            <tr>\n                <td class=\"data-label\">Payment ID</td>\n                <td class=\"data-value\">{{ doc.name or 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Vendor Name</td>\n                <td class=\"data-value\">{{ vendor_doc.vendor_name if vendor_doc else 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Project Name</td>\n                <td class=\"data-value\">{{ project_doc.project_name if project_doc else 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">{{ doc.document_type or 'Ref Doc Type' }} No.</td>\n                <td class=\"data-value\">{{ doc.document_name or 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Payment date</td>\n                <td class=\"data-value\">{{ frappe.utils.formatdate(doc.payment_date, \"dd-MMM-yyyy\") if doc.payment_date else 'N/A' }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Payment mode</td>\n                <td class=\"data-value\">\n                    {{ doc.mode_of_payment or 'Online' }}\n                </td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">Paid Amount (INR)</td>\n                <td class=\"data-value\">{{ currency_symbol }} {{ \"%.2f\"|format(paid_amount) }}</td>\n            </tr>\n            <tr>\n                <td class=\"data-label\">UTR No.</td>\n                <td class=\"data-value\">{{ doc.utr or doc.reference_no or 'N/A' }}</td>\n            </tr>\n        </table>\n\n        <!--<div class=\"terms-heading\">Terms and Conditions</div>-->\n        <!--<ul class=\"terms-list\">-->\n        <!--    <li>Payment posting to your account is subject to credit settlement by your bank and will get the same posted within next 2-working days (maximum).</li>-->\n        <!--    <li>The above amount is inclusive of applicable taxes.</li>-->\n        <!--    <li>All claims subject to exclusive jurisdiction of courts as per registered office location.</li>-->\n        <!--</ul>-->\n\n        <table class=\"auth-table\">\n            <tr>\n                {# LEFT CELL: Vendor Signature/Seal (Header Left, Line/Label Centered Low) #}\n                <td class=\"vendor-sig-cell\">\n                    <span style=\"font-weight: bold;\">{{ vendor_doc.vendor_name if vendor_doc else 'N/A' }} (Received by)</span>\n                    \n                    <div class=\"sig-container\">\n                        <div class=\"sig-line\"></div>\n                        <div class=\"sig-label\">Vendor Signature</div>\n                    </div>\n                </td>\n                \n                {# RIGHT CELL: Nirmaan Authorised Signatory (Header Centered/Wrapped, Line/Label Centered Low) #}\n                <td class=\"nirmaan-sig-cell\">\n                    <span style=\"font-weight: bold;\">\n                        Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\n                    </span>\n                     <div class=\"seal-container\">\n                        <img class=\"company-seal\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/NIRMAAN-SEAL-D2HgrCMb.jpeg\" alt=\"Company Seal\">\n                    </div>\n                    \n                    <div class=\"sig-container\">\n                        <div class=\"sig-line\"></div>\n                        <div class=\"sig-label\">Authorised Signatory</div>\n                    </div>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    \n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-10-15 17:51:33.988658",
  "module": "Nirmaan Stack",
  "name": "SR Payment",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Project Progress Reports",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format : Milestone Report - Voucher Style\n    DocType      : Project Progress Reports\n    REVISION: FINAL - Hardcoded 'http://localhost:8080' prefix for image links (RISKY).\n#}\n\n{%- set nirmaan_company_details = {\n    \"name\"      : \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": {\"name\": \"Karnataka\", \"code\": \"29\", \"address\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru 560102\"},\n        \"06ABFCS9095N1ZH\": {\"name\": \"Haryana\",   \"code\": \"06\", \"address\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\"},\n        \"09ABFCS9095N1ZB\": {\"name\": \"Noida\", \"code\":\"09\", \"address\": \"MR1, Plot no. 21 & 21A, AltF 142 Noida, Sector 142, Noida - 201305, Uttar Pradesh\"}\n    }\n} -%}\n\n{# --------------------------------------------------------------------------------- #}\n{%- set project_id_to_fetch = doc.project or None -%}\n{%- set project_doc   = frappe.get_doc(\"Projects\", project_id_to_fetch) if project_id_to_fetch else none -%}\n{%- set owner_doc     = frappe.get_doc(\"User\", doc.owner) if doc.owner else none -%}\n{# --------------------------------------------------------------------------------- #}\n\n\n{# Nirmaan Details #}\n{%- set n_key         = project_doc.project_gst if project_doc and project_doc.project_gst in nirmaan_company_details.gst_numbers else \"29ABFCS9095N1Z9\" -%}\n{%- set n_info        = nirmaan_company_details.gst_numbers.get(n_key, nirmaan_company_details.gst_numbers['29ABFCS9095N1Z9']) -%}\n{%- set n_reg_address = n_info.address -%}\n{%- set n_gstin       = n_key -%}\n{%- set n_state_name  = n_info.name -%}\n{%- set n_state_code  = n_info.code -%}\n\n{# ──────────────────────────────────────────────────────────────\n   1 . Styles\n   ────────────────────────────────────────────────────────────── #}\n<style>\n    /* RESET/GENERAL STYLES */\n    body { \n        font-family: 'Arial', sans-serif; \n        font-size: 10pt; \n        line-height: 1.5; \n        color: #333; \n        margin: 0;\n    }\n    table { width: 100%; border-collapse: collapse; table-layout: fixed; }\n    \n    .print-format {\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n    }\n    \n    .content-wrapper {\n        flex-grow: 1;\n        padding: 0 5mm; \n        position: relative;\n    }\n    .watermark {\n        position: absolute;\n        top: 35%;\n        left: 50%;\n        -webkit-transform: translate(-50%, -50%) rotate(-45deg);\n        -ms-transform: translate(-50%, -50%) rotate(-45deg);\n        transform: translate(-50%, -50%) rotate(-45deg);\n        font-size: 120pt; \n        font-weight: 900;\n        color: rgba(0, 0, 200, 0.03); \n        pointer-events: none;\n        z-index: 10;\n        text-transform: uppercase;\n    }\n\n    /* HEADER - Voucher Style */\n    .header {\n        margin-bottom: 20px;\n        border-bottom: 2px solid #000; \n        padding-bottom: 10px; \n    }\n    .header-top-row {\n        overflow: auto; \n        margin-bottom: 5px;\n        width: 100%;\n        display: block;\n    }\n    .company-info-left {\n        float: left;\n        text-align: left;\n        padding-top: 5px; \n    }\n    .logo-img { \n        max-height: 50px; \n        max-width: 180px; \n        display: block;\n    } \n    .company-name-text {\n        font-size: 14pt; \n        font-weight: bold; \n        color: #CC0000; \n    }\n    .logo-right {\n        float: right;\n        text-align: right;\n    }\n    .title { \n        clear: both;\n        font-size: 20pt; \n        font-weight: 800; \n        color: #000; \n        text-align: center;\n        margin-top: 15px;\n    }\n    .subtitle { \n        font-size: 10pt; \n        color: #000; \n        text-align: center;\n        margin-bottom: 5px; \n    }\n\n    /* DATA TABLE - PROFESSIONAL STYLE (VOUCHER) */\n    .data-table { border: 1px solid #000; margin-bottom: 20px; }\n    .data-table th, .data-table td { padding: 8px 10px; border: 1px solid #000; vertical-align: top;}\n    .data-label { \n        width: 30%; \n        font-weight: bold; \n        color: #333; \n        background-color: #f7f7f7;\n    }\n    .data-value { width: 70%; background-color: white;}\n\n    /* SUMMARY / MANPOWER STYLES */\n    .report-summary-box {\n        background-color: #fee2e2;\n        border: 1px solid #fecaca;\n        padding: 15px;\n        border-radius: 5px;\n        margin-top: 15px;\n        margin-bottom: 20px;\n    }\n    .summary-metric {\n        background-color: white;\n        padding: 10px;\n        border-radius: 5px;\n        border: 1px solid #eee;\n        text-align: center;\n        width: 33%;\n    }\n    .metric-value { font-size: 16pt; font-weight: bold; }\n    .text-green { color: #10B981; }\n    .text-red { color: #f87171; }\n    .manpower-item {\n        display: flex; \n        justify-content: space-between; \n        padding: 10px; \n        background-color: #f7f7f7; \n        border-radius: 4px; \n        border: 1px solid #eee;\n        font-size: 9pt;\n    }\n\n\n    /* WORK PROGRESS STYLES */\n    .milestone-header-group {\n        border-left: 4px solid #dc2626;\n        background-color: #f3f4f6;\n        padding: 10px;\n        margin-bottom: 5px;\n        font-weight: bold;\n        font-size: 10pt;\n    }\n    .status-badge {\n        display: inline-block;\n        padding: 3px 8px;\n        border-radius: 4px;\n        font-size: 8pt;\n        font-weight: 600;\n        text-align: center;\n    }\n    .remarks-box {\n        display: flex;\n        align-items: flex-start;\n        background-color: #fef3c7;\n        color: #92400e;\n        padding: 5px;\n        border-radius: 4px;\n        margin-top: 5px;\n        font-size: 8pt;\n    }\n    .remarks-box svg {\n        width: 12px;\n        height: 12px;\n        margin-right: 4px;\n        flex-shrink: 0;\n    }\n    \n    /* PROGRESS BAR STYLES (Simple/Reliable) */\n    .progress-display {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        min-height: 40px; \n    }\n    .progress-bar-container {\n        width: 80%;\n        max-width: 100px;\n        height: 6px;\n        background-color: #eee;\n        border-radius: 3px;\n        overflow: hidden;\n        margin: 5px auto 0;\n    }\n    .progress-bar {\n        height: 100%;\n        border-radius: 3px;\n    }\n\n    /* TEXT COLOR CLASSES */\n    .text-black { color: #000000; }\n    .text-red { color: #dc2626; } /* Red-600 */\n    .text-yellow { color: #ca8a04; } /* Yellow-600 */\n    .text-green { color: #16a34a; } /* Green-600 */\n    .text-gray { color: #6b7280; } /* Gray-500 */\n    \n    /* IMAGE STYLES */\n    .image-card {\n        border: 1px solid #ddd;\n        border-radius: 5px;\n        overflow: hidden;\n        margin-bottom: 15px;\n        display: flex;\n    }\n    .image-container {\n        width: 50%;\n        flex-shrink: 0;\n    }\n    .image-container img {\n        width: 100%;\n        height: 120px;\n        object-fit: cover;\n        display: block;\n    }\n    .image-details {\n        width: 50%;\n        padding: 10px;\n        display: flex;\n        flex-direction: column;\n        justify-content: space-between;\n    }\n    .location-text {\n        font-size: 8pt;\n        color: #666;\n        margin-bottom: 5px;\n    }\n    .image-remarks {\n        background-color: #fef3c7;\n        color: #92400e;\n        padding: 5px;\n        border-radius: 4px;\n        font-size: 7pt;\n        margin-top: 5px;\n    }\n\n    /* PRINT RULES */\n    @media print {\n        @page { \n            size:A4; \n            margin: 15mm 15mm 15mm 15mm; \n        }\n        .avoid-break { page-break-inside: avoid !important; }\n        .page-break-before { page-break-before: always; }\n        thead { display: table-header-group !important; }\n        table tr { page-break-inside: avoid !important; }\n    }\n</style>\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Header / Footer Blocks (For Repeating Headers)\n   ────────────────────────────────────────────────────────────── #}\n{% block header %}\n<div class=\"header\">\n    <div class=\"header-top-row\">\n        {# LEFT SIDE: Company Name - Using your specific absolute internal path #}\n        <div class=\"company-info-left\">\n            <img class=\"logo-img\" src=\"https://stack.nirmaan.app/assets/nirmaan_stack/frontend/assets/logo-svg-BptBZTzQ.svg\" alt=\"Nirmaan Logo\">\n            <div class=\"company-name-text\">Stratos Infra Technologies Pvt.Ltd</div>\n        </div>\n        \n        {# RIGHT SIDE: Empty for Voucher look #}\n        <div class=\"logo-right\"></div>\n    </div>\n    \n    {# TITLE BLOCK (Clear float and center) #}\n    <div class=\"title\">MILESTONE REPORT</div>\n    <div class=\"subtitle\">Project Progress Report as of {{ frappe.utils.formatdate(doc.report_date) }}</div>\n</div>\n{% endblock %}\n\n{% block footer %}\n<div class=\"footer-address\">\n    Regd. Office: <span style=\"font-weight: bold; color: #333;\">{{ nirmaan_company_details.name }}</span>, {{ n_reg_address }}<br>\n    <span style=\"font-weight: bold; color: #333;\">GSTN:</span> {{ n_gstin }} | <span style=\"font-weight: bold; color: #333;\">State:</span> {{ n_state_name }} | <span style=\"font-weight: bold; color: #333;\">Code:</span> {{ n_state_code }}\n</div>\n{% endblock %}\n\n\n{# ──────────────────────────────────────────────────────────────\n   3 . Main Content\n   ────────────────────────────────────────────────────────────── #}\n{% block content %}\n<div class=\"print-format\">\n    <div class=\"content-wrapper\">\n        \n       <div class=\"watermark\">REPORT DRAFT</div>\n        \n        {# --------------------------- PROJECT INFO (Voucher Style Data Table) --------------------------- #}\n        <h3 style=\"font-size: 14pt; font-weight: bold; color: #333; margin-top: 0; margin-bottom: 10px;\">PROJECT INFORMATION</h3>\n        <table class=\"data-table\">\n            <tbody>\n                <tr class=\"avoid-break\">\n                    <td class=\"data-label\" style=\"width: 25%;\">Project Name</td>\n                    <td class=\"data-value\" style=\"width: 25%;\">{{ project_doc.project_name if project_doc else 'N/A' }}</td>\n                    <td class=\"data-label\" style=\"width: 25%;\">Report ID</td>\n                    <td class=\"data-value\" style=\"width: 25%;\">{{ doc.name or 'N/A' }}</td>\n                </tr>\n                <tr class=\"avoid-break\">\n                    <td class=\"data-label\">Project Manager</td>\n                    <td class=\"data-value\">{{ owner_doc.full_name if owner_doc else doc.owner or 'N/A' }}</td>\n                    <td class=\"data-label\">Report Date</td>\n                    <td class=\"data-value\">{{ frappe.utils.formatdate(doc.report_date, \"dd-MMM-yyyy\") or 'N/A' }}</td>\n                </tr>\n                <tr class=\"avoid-break\">\n                    <td class=\"data-label\">Project Start Date</td>\n                    <td class=\"data-value\">{{ frappe.utils.formatdate(project_doc.project_start_date) if project_doc and project_doc.project_start_date else 'N/A' }}</td>\n                    <td class=\"data-label\">Total Milestones</td>\n                    <td class=\"data-value\">{{ doc.milestones | length if doc.milestones else 0 }}</td>\n                </tr>\n            </tbody>\n        </table>\n\n        {# --------------------------- SUMMARY METRICS --------------------------- #}\n        {% set total_works = doc.milestones | length if doc.milestones else 0 %}\n        {% set completed_works = doc.milestones | selectattr('status', '==', 'Completed') | list | length if doc.milestones else 0 %}\n        \n        {# FIX: Manpower Summation - Ensure mp.count is cast to int before addition #}\n        {% set total_manpower = 0 %}\n        {% for mp in doc.manpower %}\n            {% set total_manpower = total_manpower + (mp.count | int) %}\n        {% endfor %}\n\n        <div class=\"report-summary-box avoid-break\">\n            <h3 style=\"font-size: 12pt; font-weight: bold; margin-top: 0; color: #b91c1c;\">REPORT SUMMARY</h3>\n            <div style=\"display: flex; justify-content: space-between; gap: 10px;\">\n                <div class=\"summary-metric\">\n                    <p style=\"font-size: 8pt; margin: 0 0 5px;\">TOTAL WORKS</p>\n                    <p class=\"metric-value text-red\">{{ \"{:02d}\".format(total_works) }}</p>\n                </div>\n                <div class=\"summary-metric\">\n                    <p style=\"font-size: 8pt; margin: 0 0 5px;\">COMPLETED</p>\n                    <p class=\"metric-value text-green\">{{ \"{:02d}\".format(completed_works) }}</p>\n                </div>\n                <div class=\"summary-metric\">\n                    <p class=\"metric-value text-red\" style=\"font-size: 8pt; margin: 0 0 5px;\">MANPOWER</p>\n                    <p class=\"metric-value text-red\">{{ \"{:02d}\".format(total_manpower) }}</p>\n                </div>\n            </div>\n        </div>\n\n        {# --------------------------- MANPOWER DETAILS --------------------------- #}\n        {# FIX: Create a temporary array to filter manpower where count > 0, explicitly casting to int #}\n        {% set active_manpower = [] %}\n        {% for mp in doc.manpower %}\n            {% if (mp.count | int) > 0 %}\n                {% set _ = active_manpower.append(mp) %}\n            {% endif %}\n        {% endfor %}\n\n        {% if active_manpower %}\n        <div class=\"avoid-break\" style=\"margin-bottom: 20px;\">\n            <h3 style=\"font-size: 14pt; font-weight: bold; margin-top: 0; color: #333;\">MANPOWER DETAILS</h3>\n            <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 10px;\">\n                \n                {% for mp in active_manpower %} \n                <div class=\"manpower-item\">\n                    <span style=\"font-weight: 500;\">{{ mp.label }}</span>\n                    <span style=\"font-weight: bold;\">{{ \"{:02d}\".format(mp.count | int) }}</span>\n                </div>\n                {% endfor %}\n            </div>\n            {% if doc.manpower_remarks %}\n            <div style=\"margin-top: 10px;\">\n                <p style=\"font-size: 8pt; color: #666; margin-bottom: 2px;\">Remarks</p>\n                <div style=\"padding: 10px; border-radius: 4px; background-color: #f7f7f7; border: 1px solid #eee; font-size: 9pt; white-space: pre-wrap;\">\n                    {{ doc.manpower_remarks }}\n                </div>\n            </div>\n            {% endif %}\n        </div>\n        {% endif %}\n\n        {# --------------------------- WORK PROGRESS (With Reliable Progress Bar) --------------------------- #}\n        {% if doc.milestones %}\n        <div class=\"page-break-before\">\n            <h3 style=\"font-size: 14pt; font-weight: bold; margin-top: 0; color: #333;\">WORK PROGRESS</h3>\n\n            {% set grouped_milestones = doc.milestones | groupby('work_header') %}\n            \n            {% for header, milestones in grouped_milestones %}\n            <div class=\"avoid-break\" style=\"margin-bottom: 20px;\">\n                <div class=\"milestone-header-group\">\n                    {{ header }} ({{ milestones | length }})\n                </div>\n\n                <table class=\"data-table\">\n                    <thead>\n                        <tr style=\"background-color: #e5e7eb;\">\n                            <th style=\"width: 45%;\">WORK</th>\n                            <th style=\"width: 15%;\">STATUS</th>\n                            <th style=\"width: 20%;\">PROGRESS</th>\n                            <th style=\"width: 20%;\">Excepted Starting/Completion Date</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {% for milestone in milestones %}\n                            <tr class=\"avoid-break\">\n                                <td style=\"width: 45%; vertical-align: top;\">\n                                    {{ milestone.work_milestone_name }}\n                                    {% if milestone.remarks %}\n                                    <div class=\"remarks-box\">\n                                        {# SVG for MessagesSquare icon #}\n                                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path></svg>\n                                        <span>{{ milestone.remarks }}</span>\n                                    </div>\n                                    {% endif %}\n                                </td>\n                                \n                                {# --- Status Color Lookup for Badge --- #}\n                                {% set status_color_hex = '#EF4444' %}\n                                {% if milestone.status == \"Completed\" %}\n                                    {% set status_color_hex = '#10B981' %}\n                                {% elif milestone.status == \"WIP\" %}\n                                    {% set status_color_hex = '#F59E0B' %}\n                                {% elif milestone.status == \"N/A\" %}\n                                    {% set status_color_hex = '#6B7280' %}\n                                {% endif %}\n                                <td style=\"width: 15%; text-align: center;\">\n                                    <span class=\"status-badge\" style=\"background-color: {{ status_color_hex }}20; color: {{ status_color_hex }};\">\n                                        {{ milestone.status }}\n                                    </span>\n                                </td>\n                                \n                                <td style=\"width: 20%; text-align: center;\">\n                                    {# --- Inline Progress Bar Logic --- #}\n                                    \n                                    {% set progress_val = milestone.progress | int or 0 %}\n                                    {% set text_class = \"text-gray\" %}\n                                    {% set bar_color_hex = \"#6b7280\" %} \n\n                                    {# Progress Color Assignment (Directly inline) #}\n                                    {% if milestone.status == \"Not Applicable\" or milestone.progress == \"N/A\" %}\n                                        {# Handled below in N/A block #}\n                                    {% elif progress_val == 0 %}\n                                        {% set text_class = \"text-black\" %}\n                                        {% set bar_color_hex = \"#000000\" %}\n                                    {% elif progress_val < 50 %}\n                                        {% set text_class = \"text-red\" %}\n                                        {% set bar_color_hex = \"#dc2626\" %} \n                                    {% elif progress_val < 75 %}\n                                        {% set text_class = \"text-yellow\" %}\n                                        {% set bar_color_hex = \"#ca8a04\" %} \n                                    {% elif progress_val < 100 %}\n                                        {% set text_class = \"text-green\" %}\n                                        {% set bar_color_hex = \"#16a34a\" %} \n                                    {% else %}\n                                        {% set text_class = \"text-green\" %}\n                                        {% set bar_color_hex = \"#22c55e\" %} \n                                    {% endif %}\n\n\n                                    {% if milestone.status == \"Not Applicable\" or milestone.progress == \"N/A\" %}\n                                        <div class=\"progress-display text-gray\">N/A</div>\n                                    {% else %}\n                                        <div class=\"progress-display\">\n                                            <span class=\"progress-value-text {{ text_class }}\" style=\"font-weight: bold; font-size: 10pt;\">{{ progress_val }}%</span>\n                                            <div class=\"progress-bar-container\">\n                                                <div \n                                                    class=\"progress-bar\" \n                                                    style=\"width: {{ progress_val }}%; background-color: {{ bar_color_hex }};\"\n                                                ></div>\n                                            </div>\n                                        </div>\n                                    {% endif %}\n                                </td>\n                                <td style=\"width: 20%; text-align: center; font-weight: 500;\">\n                                    {% if milestone.status == \"Not Started\" %}\n                                        <span style=\"color: #dc2626;\">\n                                            {{ frappe.utils.formatdate(milestone.expected_starting_date) or 'N/A' }}\n                                        </span>\n                                    {% else %}\n                                        <span style=\"color: #10b981;\">\n                                            {{ frappe.utils.formatdate(milestone.expected_completion_date) or 'N/A' }}\n                                        </span>\n                                    {% endif %}\n                                </td>\n                            </tr>\n                        {% endfor %}\n                    </tbody>\n                </table>\n            </div>\n            {% endfor %}\n        </div>\n        {% endif %}\n\n        {# --------------------------- WORK IMAGES --------------------------- #}\n        {% if doc.attachments %}\n        \n        {# !! WARNING: THIS HARDCODES THE LOCALHOST URL !! #}\n        {% set HARDCODED_BASE_URL = \"http://localhost:8080\" %}\n        \n        <div class=\"page-break-before\">\n            <h3 style=\"font-size: 14pt; font-weight: bold; margin-top: 0; color: #333; page-break-after: avoid;\">WORK IMAGES</h3>\n            \n            <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 15px;\">\n            {% for attachment in doc.attachments %}\n              \n                {# CONCATENATE: Use the cleaned path directly with the BASE_URL #}\n                {% set final_image_url = HARDCODED_BASE_URL ~ cleaned_path %}\n                \n                <div class=\"image-card avoid-break\">\n                    \n                    <div class=\"image-container\">\n                        {# Final Image Source with hardcoded prefix #}\n                     \n                            <img src=\"{{ final_image_url }}\" alt=\"Work Image\" />\n\n                    </div>\n                    \n                    <div class=\"image-details\">\n                        <div style=\"margin-bottom: 5px;\">\n                            <div class=\"location-text\" style=\"display: flex; align-items: center;\">\n                                {# SVG for MapPin icon #}\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" style=\"width: 10px; height: 10px; color: #ef4444; margin-right: 3px;\"><path d=\"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0z\"></path><circle cx=\"12\" cy=\"10\" r=\"3\"></circle></svg>\n                                <span>{{ attachment.location or \"Lat: \" ~ (attachment.latitude | round(2)) ~ \", Lon: \" ~ (attachment.longitude | round(2)) }}</span>\n                            </div>\n                        </div>\n                        <p class=\"image-remarks\">\n                            {{ attachment.remarks or \"No remarks provided.\" }}\n                        </p>\n                    </div>\n                </div>\n            {% endfor %}\n            </div>\n        </div>\n        {% endif %}\n        \n        {# --------------------------- AUTHORIZATION SECTION IS REMOVED --------------------------- #}\n\n    </div>\n</div>\n{% endblock %}",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-11-06 15:57:48.277269",
  "module": "Nirmaan Stack",
  "name": "Milestone Report",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 }
]