[
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 0,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": null,
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-02-19 13:15:13.143402",
  "module": "Nirmaan Stack",
  "name": "Test Format",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 0,
  "default_print_language": null,
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": "{\"header\":\"<div class=\\\"document-header\\\">\\n\\t<h3>Procurement Orders</h3>\\n\\t<p>{{ doc.name }}</p>\\n</div>\",\"sections\":[{\"label\":\"Links\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Project\",\"fieldname\":\"project\",\"fieldtype\":\"Link\",\"options\":\"Projects\"},{\"label\":\"Vendor\",\"fieldname\":\"vendor\",\"fieldtype\":\"Link\",\"options\":\"Vendors\"},{\"label\":\"Procurement Request\",\"fieldname\":\"procurement_request\",\"fieldtype\":\"Link\",\"options\":\"Procurement Requests\"},{\"label\":\"Category\",\"fieldname\":\"category\",\"fieldtype\":\"Link\",\"options\":\"Category\"},{\"label\":\"Merged\",\"fieldname\":\"merged\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true},{\"label\":\"Procurement Order Details\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Attachment\",\"fieldname\":\"attachment\",\"fieldtype\":\"Data\"},{\"label\":\"Project Name\",\"fieldname\":\"project_name\",\"fieldtype\":\"Data\"},{\"label\":\"Project Address\",\"fieldname\":\"project_address\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor Name\",\"fieldname\":\"vendor_name\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor Address\",\"fieldname\":\"vendor_address\",\"fieldtype\":\"Data\"},{\"label\":\"Vendor GST\",\"fieldname\":\"vendor_gst\",\"fieldtype\":\"Data\"},{\"label\":\"Order List\",\"fieldname\":\"order_list\",\"fieldtype\":\"JSON\"},{\"label\":\"Category List\",\"fieldname\":\"category_list\",\"fieldtype\":\"JSON\",\"options\":\"Category\"}]}],\"has_fields\":true},{\"label\":\"Payment Details \",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Advance\",\"fieldname\":\"advance\",\"fieldtype\":\"Data\"},{\"label\":\"Loading Charges\",\"fieldname\":\"loading_charges\",\"fieldtype\":\"Data\"},{\"label\":\"Freight Charges\",\"fieldname\":\"freight_charges\",\"fieldtype\":\"Data\"},{\"label\":\"Notes\",\"fieldname\":\"notes\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true},{\"label\":\"Tracking Details\",\"columns\":[{\"label\":\"\",\"fields\":[{\"label\":\"Status\",\"fieldname\":\"status\",\"fieldtype\":\"Data\"},{\"label\":\"Delivery Contact\",\"fieldname\":\"delivery_contact\",\"fieldtype\":\"Data\"}]}],\"has_fields\":true}]}",
  "html": null,
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-02-19 13:15:41.095080",
  "module": "Nirmaan Stack",
  "name": "Test 2",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 1,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Procurement Orders",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format: PO Nirmaan (Revised)\n    DocType: Procurement Order\n#}\n\n{# --- Company Details (Customized) --- #}\n{%- set company_details = {\n    \"name\": \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"logo_url\": \"https://s3.ap-south-1.amazonaws.com/nirmaan-stack-test-bucket/test/2025/05/19/File/Z3C3GD6J_logo-svg.svg\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": \"Bengaluru\",\n        \"06ABFCS9095N1ZH\": \"Gurugram\"\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru - 560102, Karnataka\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park Cowarking Space, Mehrauli Gurugram Rd, Tower D, Sikanderpur, Gurugram, Haryana - 122002\"\n    },\n    \"default_address\": \"Company address details missing or project GST not set.\",\n    \"phone_no\": \"YOUR_COMPANY_PHONE\",\n    \"email\": \"YOUR_COMPANY_EMAIL\",\n    \"website\": \"YOUR_COMPANY_WEBSITE\"\n} -%}\n\n{# Determine current company address and GST based on PO's project_gst #}\n{%- set current_company_gst = doc.project_gst if doc.project_gst in company_details.gst_numbers else None -%}\n{%- set current_company_address = company_details.addresses[current_company_gst] if current_company_gst else company_details.default_address -%}\n{%- set currency_symbol = \"₹\" -%}\n{# {%- set company_currency = frappe.db.get_default(\"currency\") or \"INR\" -%} #}\n{# {%- set currency_symbol  = frappe.utils.get_currency_symbol(company_currency) -%} #}\n\n{# ----------- 1. Macro – Address formatter --------------------- #}\n{% macro format_address(addr_name) -%}\n    {%- if not addr_name -%}N/A\n    {%- else -%}\n        {%- set ad = frappe.get_doc(\"Address\", addr_name) -%}\n        {%- set parts = [] -%}\n        {%- if ad.address_line1        %}{% set parts = parts + [ad.address_line1]        %}{% endif -%}\n        {%- if ad.address_line2        %}{% set parts = parts + [ad.address_line2]        %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if ad.city                 %}{% set csp = csp + [ad.city]                     %}{% endif -%}\n        {%- if ad.state                %}{% set csp = csp + [ad.state]                    %}{% endif -%}\n        {%- if ad.pincode              %}{% set csp = csp + [ad.pincode]                  %}{% endif -%}\n        {%- if csp                     %}{% set parts = parts + [csp | join(\" \")]         %}{% endif -%}\n        {%- if ad.country              %}{% set parts = parts + [ad.country]              %}{% endif -%}\n        {{ parts | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{%- set project_doc = frappe.get_doc(\"Projects\", doc.project) if doc.project else None -%}\n{%- set vendor_doc = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n\n{# ----------- 3. Pre-rendered HTML blocks ----------------------- #}\n{% set vendor_address_html  = format_address(vendor_doc.vendor_address)\n                                  if vendor_doc else \"N/A\" %}\n{% set project_address_html = format_address(project_doc.project_address)\n                                  if project_doc else \"N/A\" %}\n\n{# Helper to parse the first value from the advance string #}\n{%- macro get_first_advance_value(advance_string) -%}\n    {%- if advance_string and advance_string is string -%}\n        {%- set parts = advance_string.split(',') -%}\n        {%- if parts and parts[0] -%}\n            {{- (parts[0] | trim | float) if parts[0] | trim else 0 -}}\n        {%- else -%}\n            0\n        {%- endif -%}\n    {%- else -%}\n        {{- (advance_string | float) if advance_string is number else 0 -}} {# Handle if it's already a number or None #}\n    {%- endif -%}\n{%- endmacro -%}\n{%- set advance_paid_value = get_first_advance_value(doc.advance) -%}\n\n\n<style>\n    body { font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif; font-size: 10px; color: #333; margin: 0; padding: 0; }\n    /*.invoice-container { width: 100%; max-width: 800px; margin: 0 auto; padding: 0 15px 15px 15px; }*/\n    \n    @page {\n        size: A4;\n        margin: 45mm 12mm 20mm 12mm;   /* top, right, bottom, left */\n    }\n    \n    .header img.logo { max-width: 140px; max-height: 40px; margin-bottom: 8px; float: left; }\n    .company-info-header { float: right; text-align: right; }\n    .company-info-header p { margin: 0 0 2px 0; font-size: 9.5px; }\n    .document-title {\n        font-size: 20px; font-weight: bold; color: #1a1a1a; text-transform: uppercase;\n        margin-bottom: 15px; text-align: center; clear: both; padding-top: 10px;\n        border-bottom: 2px solid #333; padding-bottom: 10px;\n    }\n    .po-details { margin-bottom: 15px; overflow: hidden; }\n    .po-details .left, .po-details .right { width: 49%; float: left; font-size: 9.5px; }\n    .po-details .right { float: right; text-align: right; }\n    .po-details p, .address-section p { margin: 0 0 3px 0; line-height: 1.4; }\n    .address-section { margin-bottom: 15px; overflow: hidden; }\n    .address-section .billed-to, .address-section .shipped-to {\n        width: 49%; float: left; min-height: 80px; font-size: 9.5px;\n    }\n    .address-section .shipped-to { float: right; }\n    .address-section h4 {\n        font-size: 10px; font-weight: bold; text-transform: uppercase; color: #555;\n        margin-top: 0; margin-bottom: 6px;\n    }\n    .address-block       { margin-bottom:15px; overflow:hidden; }\n    .address-block__col  { width:48%; float:left; font-size:9.5px; }\n    .address-block__col + .address-block__col { float:right; }\n    .items-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }\n    .items-table th, .items-table td { border: 1px solid #ddd; padding: 5px 7px; text-align: left; }\n    .items-table th { background-color: #f0f0f0; font-weight: bold; font-size: 9.5px; text-transform: uppercase; }\n    .items-table td { font-size: 9.5px; }\n    .items-table .text-right { text-align: right; }\n    .items-table .text-center { text-align: center; }\n    .totals-section { width: 100%; margin-top: 15px; overflow: hidden; }\n    .totals-section .notes-terms { width: 58%; float: left; font-size: 9.5px; }\n    .totals-section .summary { width: 40%; float: right; }\n    .totals-section .summary table { width: 100%; font-size: 9.5px; }\n    .totals-section .summary td { padding: 3px 0; }\n    .totals-section .summary td:first-child { font-weight: bold; color: #444; }\n    .totals-section .summary .grand-total td {\n        font-weight: bold; font-size: 11px; border-top: 1px solid #333; border-bottom: 1px solid #333;\n        padding-top: 6px; padding-bottom: 6px;\n    }\n    .footer-notes {\n        margin-top: 25px; font-size: 8.5px; color: #777; border-top: 1px dashed #ccc;\n        padding-top: 8px; text-align: center;\n    }\n    .signature-area { margin-top: 40px; text-align: right; }\n    .signature-area .line { width: 180px; border-top: 1px solid #333; margin-left: auto; margin-bottom: 5px; }\n    .signature-area p { font-size: 9.5px; margin:0; }\n</style>\n\n{# -----------------  HEADER – will repeat on every page  ----------------- #}\n<div id=\"header-html\" style=\"display: none\">       {# must be OUTSIDE .print-format #}\n  <table style=\"width:100%; font-family:Helvetica,Arial,sans-serif; font-size:9.5px\">\n    <tr>\n      <td style=\"width:40%\">\n        <img src=\"{{ company_details.logo_url }}\" style=\"max-width:140px; max-height:38px\">\n      </td>\n      <td style=\"text-align:right; font-size:11px\">\n        <strong>{{ company_details.name }}</strong><br>\n        {{ current_company_address }}<br>\n        {% if current_company_gst %}\n          <strong>GSTIN:</strong> {{ current_company_gst }}\n        {% endif %}\n      </td>\n    </tr>\n  </table>\n</div>\n\n{# -------------  FOOTER (optional) – also repeats on every page --------- #}\n<div id=\"footer-html\" style=\"display:none\">\n  <div style=\"width:100%; text-align:center; font-size:8.5px;\">\n    Page <span class=\"page\"></span> of <span class=\"topage\"></span>\n  </div>\n</div>\n    \n<div class=\"print-format\">\n\n<!--<div class=\"invoice-container\">-->\n    <div class=\"document-title\">Purchase Order</div>\n    <!--<h2 style=\"text-align:center; margin:0 0 12px 0;\">Purchase Order</h2>-->\n    <div class=\"po-details\">\n        <div class=\"left\">\n            <p><strong>PO Number:</strong> {{ doc.name }}</p>\n            <p><strong>PO Date:</strong> {{ frappe.utils.formatdate(doc.creation, \"dd-MM-yyyy\") }}</p>\n            {% if doc.procurement_request %}\n            <p><strong>PR Reference:</strong> {{ doc.procurement_request }}</p>\n            {% endif %}\n        </div>\n        <div class=\"right\">\n            <p><strong>Status:</strong> <span style=\"font-weight:bold; color: #007bff;\">{{ doc.status }}</span></p>\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n\n    {# In the address display section: #}\n    <div class=\"address-block\">\n      <div class=\"address-block__col\">\n          <h4>VENDOR DETAILS</h4>\n          <p><strong>{{ vendor_doc.vendor_name if vendor_doc else doc.vendor }}</strong></p>\n          {{ vendor_address_html }}\n          {% if vendor_doc and vendor_doc.vendor_gst %}\n            <p><strong>GSTIN:</strong> {{ vendor_doc.vendor_gst }}</p>\n          {% endif %}\n      </div>\n\n      <div class=\"address-block__col\">\n          <h4>SHIP-TO / PROJECT DETAILS</h4>\n          <p><strong>{{ project_doc.project_name if project_doc else doc.project }}</strong></p>\n          {{ project_address_html }}\n          {% if doc.delivery_contact %}\n            <p><strong>Site Contact:</strong> {{ doc.delivery_contact }}</p>\n          {% endif %}\n      </div>\n  </div>\n<div style=\"clear:both;\"></div>\n\n<table class=\"items-table\">\n    <thead>\n        <tr>\n            <th style=\"width:5%;\">Sr.</th>\n            <th style=\"width:35%;\">Item Description</th>\n            <th style=\"width:10%;\" class=\"text-center\">Make</th>\n            <th style=\"width:8%;\" class=\"text-center\">Qty</th>\n            <th style=\"width:8%;\" class=\"text-center\">Unit</th>\n            <th style=\"width:12%;\" class=\"text-right\">Rate ({{ currency_symbol }})</th>\n            <th style=\"width:10%;\" class=\"text-right\">Tax %</th>\n            <th style=\"width:12%;\" class=\"text-right\">Amount ({{ currency_symbol }})</th>\n        </tr>\n    </thead>\n    <tbody>\n        {% set total_qty = namespace(value=0.0) %}\n        {% set subtotal = namespace(value=0.0) %}\n        {% set total_tax_amount_on_items = namespace(value=0.0) %}\n\n        {# Initialize items_to_loop variable #}\n        {% set items_to_loop = [] %}\n\n        {# Attempt to parse if doc.order_list is a string #}\n        {% if doc.order_list and doc.order_list is string %}\n            {% set parsed_data = json.loads(doc.order_list) %}\n            {% if parsed_data is mapping and parsed_data.list is defined and parsed_data.list is iterable %}\n                {% set items_to_loop = parsed_data.list %}\n            {% endif %}\n        {# Else, if it's already a dictionary with a list #}\n        {% elif doc.order_list is mapping and doc.order_list.list is defined and doc.order_list.list is iterable %}\n            {% set items_to_loop = doc.order_list.list %}\n        {% endif %}\n\n        {% if items_to_loop | length > 0 %}\n            {% for item in items_to_loop %}\n                {% if item is mapping %}\n                    <tr>\n                        <td class=\"text-center\">{{ loop.index }}</td>\n                        <td>\n                            {{ item.get(\"item\", \"N/A\") }}\n                            {% if item.get(\"comment\") %}<br><small><em>Note: {{ item.get(\"comment\") }}</em></small>{% endif %}\n                        </td>\n                        <td class=\"text-center\">{{ item.get(\"make\", \"-\") }}</td>\n                        {%- set current_item_quantity = (item.get(\"quantity\") | float(0)) -%}\n                        <td class=\"text-center\">{{ current_item_quantity | round(2) }}</td>\n                        {%- set total_qty.value = total_qty.value + current_item_quantity -%}\n                        <td class=\"text-center\">{{ item.get(\"unit\", \"N/A\") }}</td>\n                        {%- set current_item_quote = (item.get(\"quote\") | float(0)) -%}\n                        <td class=\"text-right\">{{ \"%.2f\" | format(current_item_quote) }}</td>\n                        {%- set current_item_tax_percent = (item.get(\"tax\") | float(0)) if item.get(\"tax\") is not none else 0.0 -%}\n                        <td class=\"text-right\">{{ current_item_tax_percent }}%</td>\n\n                        {%- set item_base_amount = current_item_quantity * current_item_quote -%}\n                        {%- set current_item_tax_amount = item_base_amount * current_item_tax_percent / 100.0 -%}\n                        {%- set item_total_amount = item_base_amount + current_item_tax_amount -%}\n                        <td class=\"text-right\">{{ \"%.2f\" | format(item_total_amount | float ) }}</td>\n\n                        {%- set subtotal.value = subtotal.value + item_base_amount -%}\n                        {%- set total_tax_amount_on_items.value = total_tax_amount_on_items.value + current_item_tax_amount -%}\n                    </tr>\n                {% else %}\n                    <tr><td colspan=\"8\" style=\"color:red; text-align:center;\">Malformed item data found in order_list (item not a dict)</td></tr>\n                {% endif %}\n            {% endfor %}\n        {% else %}\n            <tr><td colspan=\"8\" style=\"text-align:center; padding: 20px;\">No items found in this order or order_list is invalid.</td></tr>\n        {% endif %}\n    </tbody>\n</table>\n\n    <div class=\"totals-section\">\n        <div class=\"notes-terms\">\n            <p><strong>Total Quantity:</strong> {{ (total_qty.value | float) | round(2) }}</p>\n            <br>\n            {# Corrected all values in final_grand_total calculation to use | float #}\n            {% set final_grand_total = (subtotal.value | float) + (total_tax_amount_on_items.value | float) + ((doc.loading_charges or 0) | float) + ((doc.freight_charges or 0) | float) - (advance_paid_value | float(0)) %}\n            <p><strong>Amount in Words:</strong><br>\n                {{ frappe.utils.money_in_words(final_grand_total, \"INR\") }} {# Assuming INR or use system default #}\n            </p>\n            {% if doc.notes %}\n            <div style=\"margin-top:10px;\">\n                <h4 style=\"font-size:10px; font-weight:bold; margin-bottom:3px;\">NOTES & TERMS:</h4>\n                <div style=\"font-size:9px; white-space: pre-wrap;\">{{ doc.notes }}</div>\n            </div>\n            {% endif %}\n        </div>\n\n        <div class=\"summary\">\n            <table>\n                <tr>\n                    <td>Subtotal:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(subtotal.value | float) }}</td>\n                </tr>\n                <tr>\n                    <td>Total Item Tax:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(total_tax_amount_on_items.value | float) }}</td>\n                </tr>\n                {% if doc.loading_charges and (doc.loading_charges | string | trim != \"\") and ((doc.loading_charges or 0) | float) > 0 %}\n                <tr>\n                    <td>Loading Charges:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format((doc.loading_charges or 0) | float) }}</td>\n                </tr>\n                {% endif %}\n                {% if doc.freight_charges and (doc.freight_charges | string | trim != \"\") and ((doc.freight_charges or 0) | float) > 0 %}\n                <tr>\n                    <td>Freight Charges:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format((doc.freight_charges or 0) | float) }}</td>\n                </tr>\n                {% endif %}\n                {% if (advance_paid_value | float(0)) > 0 %}\n                <tr>\n                    <td>Advance Paid:</td>\n                    <td class=\"text-right\" style=\"color:green;\">- {{ currency_symbol }} {{ \"%.2f\" | format(advance_paid_value | float) }}</td>\n                </tr>\n                {% endif %}\n                <tr class=\"grand-total\">\n                    <td>GRAND TOTAL:</td>\n                    <td class=\"text-right\">{{ currency_symbol }} {{ \"%.2f\" | format(final_grand_total | float) }}</td>\n                </tr>\n            </table>\n        </div>\n    </div>\n    <div style=\"clear:both;\"></div>\n\n    <div class=\"footer-notes\">\n        This is a computer-generated Purchase Order.\n        <p>For detailed terms and conditions, please visit our website or refer to the master agreement.</p>\n    </div>\n\n    <div class=\"signature-area\">\n        <div class=\"line\"></div>\n        <p>For <strong>{{ company_details.name }}</strong></p>\n        <p>(Authorized Signatory)</p>\n    </div>\n</div>\n<!--</div>-->",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-05-20 13:46:48.216386",
  "module": "Nirmaan Stack",
  "name": "PO Invoice",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 },
 {
  "absolute_value": 0,
  "align_labels_right": 0,
  "css": null,
  "custom_format": 1,
  "default_print_language": "en",
  "disabled": 0,
  "doc_type": "Service Requests",
  "docstatus": 0,
  "doctype": "Print Format",
  "font": null,
  "font_size": 14,
  "format_data": null,
  "html": "{#\n    Print Format : SR Tax Invoice – single-line grid, no background\n    DocType      : Service Requests\n#}\n\n{# ──────────────────────────────────────────────────────────────\n   0 . Company / project / customer / vendor variables\n   ────────────────────────────────────────────────────────────── #}\n{%- set nirmaan_company_details = {\n    \"name\"      : \"Nirmaan (Stratos Infra Technologies Pvt. Ltd.)\",\n    \"gst_numbers\": {\n        \"29ABFCS9095N1Z9\": {\"name\": \"Karnataka\", \"code\": \"29\"},\n        \"06ABFCS9095N1ZH\": {\"name\": \"Haryana\",   \"code\": \"06\"}\n    },\n    \"addresses\": {\n        \"29ABFCS9095N1Z9\": \"1st Floor, 234, 9th Main, 16th Cross, Sector 6, HSR Layout, Bengaluru 560102\",\n        \"06ABFCS9095N1ZH\": \"7th Floor, MR1, ALTF Global Business Park, Mehrauli–Gurugram Rd, Tower D, Gurugram 122002\"\n    },\n    \"default_address\": \"Nirmaan address not set\"\n} -%}\n\n{%- set n_key         = doc.project_gst if doc.project_gst in nirmaan_company_details.gst_numbers else None -%}\n{%- set n_addr        = nirmaan_company_details.addresses.get(n_key, nirmaan_company_details.default_address) -%}\n{%- set n_gstin       = n_key -%}\n{%- set n_state_name  = nirmaan_company_details.gst_numbers[n_key].name if n_key else \"N/A\" -%}\n{%- set n_state_code  = nirmaan_company_details.gst_numbers[n_key].code if n_key else \"N/A\" -%}\n\n{%- set project_doc   = frappe.get_doc(\"Projects\",  doc.project)  if doc.project else None -%}\n{%- set vendor_doc    = frappe.get_doc(\"Vendors\", doc.vendor) if doc.vendor else None -%}\n{%- set customer_doc  = frappe.get_doc(\"Customers\", project_doc.customer) if project_doc and project_doc.customer else None -%}\n\n{%- set is_gst_applicable = doc.gst == \"true\" -%}\n{%- set gst_rate = 18.0 -%}\n\n{% macro format_address(addr) -%}\n    {%- if not addr -%}N/A{%- else -%}\n        {%- set a = frappe.get_doc(\"Address\", addr) -%}\n        {%- set p = [] -%}\n        {%- if a.address_line1 %}{% set p = p + [a.address_line1] %}{% endif -%}\n        {%- if a.address_line2 %}{% set p = p + [a.address_line2] %}{% endif -%}\n        {%- set csp = [] -%}\n        {%- if a.city    %}{% set csp = csp + [a.city]    %}{% endif -%}\n        {%- if a.state   %}{% set csp = csp + [a.state]   %}{% endif -%}\n        {%- if a.pincode %}{% set csp = csp + [a.pincode] %}{% endif -%}\n        {%- if csp %}{% set p = p + [csp | join(\" \")] %}{% endif -%}\n        {%- if a.country %}{% set p = p + [a.country] %}{% endif -%}\n        {{ p | join(\"<br>\") | safe }}\n    {%- endif -%}\n{%- endmacro %}\n\n{%- set project_addr_html = format_address(project_doc.project_address) if project_doc and project_doc.project_address else \"N/A\" -%}\n{%- set vendor_addr_html = format_address(vendor_doc.vendor_address) if vendor_doc and vendor_doc.vendor_address else \"N/A\" -%}\n{%- set vendor_gstin = vendor_doc.vendor_gst if vendor_doc else \"N/A\" -%}\n{%- set vendor_state_name = frappe.get_doc(\"Address\", vendor_doc.vendor_address).state if vendor_doc and vendor_doc.vendor_address else \"N/A\" -%}\n{%- set vendor_state_code = vendor_gstin[0:2] if vendor_gstin and vendor_gstin != \"N/A\" else \"N/A\" -%}\n{%- set currency_symbol= \"₹\" -%}\n\n{# ──────────────────────────────────────────────────────────────\n   1 . Styles (unified 1-px grid, no colour fills)\n   ────────────────────────────────────────────────────────────── #}\n<style>\n    body      { font-family:\"Roboto\",Arial,sans-serif; font-size:8.5pt; margin:0; color:#000; }\n    table     { width:100%; border-collapse:collapse; }\n    tr        { page-break-inside:avoid; }\n    td,th     { border:1px solid #555; padding:2px 3px; vertical-align:top; font-size:8.5pt; }\n    th        { font-weight:bold; text-align:center; }\n\n    .w-50     { width:50%; }\n\n    /* outer grids */\n    .section-table td { padding:2px 3px; }\n\n    /* nested info-table : inner lines only */\n    /* .info-table        { width:100%; border-collapse:collapse; }\n    .info-table td     { border:1px solid #555; padding:1.5px 3px; }\n    .info-table        { border:none; }\n    .info-table tr:first-child  td { border-top:0; }\n    .info-table tr:last-child   td { border-bottom:0; }\n    .info-table tr td:first-child{ border-left:0; }\n    .info-table tr td:last-child { border-right:0; } */\n\n    .info-table td { border:1px solid #555; padding:1.5px 3px; font-size:7.5pt; vertical-align: top;}\n    .info-table { border:none; } /* Remove outer border of the nested table */\n    .info-table tr:first-child td  { border-top:0; }\n    .info-table tr:last-child td   { border-bottom:0; }\n    .info-table tr td:first-child  { border-left:0; }\n    .info-table tr td:last-child   { border-right:0; }\n\n    /* .label-cell { width:50%; font-weight:normal; border-bottom:0; padding-bottom:0; }\n    .value-cell { width:50%; font-weight:bold;   border-top:0;   padding-top:.5px; }\n    .terms-cell { border-top:1px solid #555; } */\n\n    .label-cell { width:50%; font-weight:normal; border-bottom:0; padding-bottom:0; text-align:left; }\n    .value-cell { width:50%; font-weight:bold;   border-top:0;   padding-top:.5px; text-align:left; min-height: 10px; word-wrap: break-word; }\n\n    .text-center{ text-align:center; }\n    .text-right { text-align:right;  }\n    .font-bold  { font-weight:bold;  }\n    .font-small { font-size: 7pt; } /* For labels like \"Buyer (Bill to)\" */\n\n    @page { size:A4; margin:30mm 8mm 18mm 8mm; }\n\n    #header-html h2 { margin:0 0 12px 0; text-align:center; }\n    #footer-html    { font-size:7.5pt; text-align:center; font-family:\"Roboto\",Arial,sans-serif; }\n</style>\n\n{# ──────────────────────────────────────────────────────────────\n   2 . Header / Footer\n   ────────────────────────────────────────────────────────────── #}\n<div id=\"header-html\" style=\"display:none;\">\n    <h2>Tax Invoice</h2>\n</div>\n\n<div id=\"footer-html\" style=\"display:none;\">\n    This is a Computer Generated Invoice  |  Page <span class=\"page\"></span> of <span class=\"topage\"></span>\n</div>\n\n{# ──────────────────────────────────────────────────────────────\n   3 . Main document\n   ────────────────────────────────────────────────────────────── #}\n<div class=\"print-format\">\n\n<!-- SECTION 1 : Vendor vs Invoice quick info -->\n<table class=\"section-table\">\n  <tr>\n    <td class=\"w-50\">\n        <p class=\"font-bold\" style=\"font-size:9.5pt;\">\n            {{ vendor_doc.vendor_name if vendor_doc else \"Vendor N/A\" }}\n        </p>\n        {{ vendor_addr_html }}<br>\n        <!-- {% if vendor_gstin and vendor_gstin != \"N/A\" %}\n           <strong>GSTIN/UIN:</strong> {{ vendor_gstin }}<br>\n        {% endif %}\n        State Name : {{ vendor_state_name }}, Code : {{ vendor_state_code }} -->\n    </td>\n\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Invoice No.</td><td class=\"label-cell\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ doc.invoice_no if doc.invoice_no else \"-\" }}</td><td class=\"value-cell\">{{ frappe.utils.formatdate(doc.invoice_date,\"dd-MMM-yy\") if doc.invoice_date else \"-\" }}</td></tr>\n\n            <!-- <tr><td class=\"label-cell\">Delivery Note</td><td class=\"label-cell\">Mode/Terms of Payment</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_delivery_note_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_payment_terms\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\">Reference No. & Date</td><td class=\"label-cell\">Other References</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_reference_no_date\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_other_references\") or \"-\" }}</td></tr> -->\n        </table>\n    </td>\n  </tr>\n</table>\n\n<!-- SECTION 2 : Consignee / Buyer / Dispatch -->\n<table style=\"margin-top:3px;\">\n  <!-- <tr>\n    <td class=\"w-50\">\n        <span style=\"font-size:7.5pt;\">Consignee (Ship to)</span><br>\n        <span class=\"font-bold\">{{ project_doc.project_name if project_doc else \"Project N/A\" }}</span><br>\n        {{ project_addr_html }}<br>\n        {% if project_doc and project_doc.project_city %}\n          City : {{ project_doc.project_city }}<br>\n        {% endif %}\n        {% if project_doc and project_doc.project_state %}\n          State : {{ project_doc.project_state }}\n        {% endif %}\n    </td>\n\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td><td class=\"label-cell\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_buyers_order_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_buyers_order_date\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\">Dispatch Doc No.</td><td class=\"label-cell\">Delivery Note Date</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_dispatch_doc_no\") or \"-\" }}</td><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_delivery_note_date\") or \"-\" }}</td></tr>\n        </table>\n    </td>\n  </tr> -->\n\n  <tr>\n    <td class=\"w-50\">\n        <span style=\"font-size:7.5pt;\">Buyer (Bill to)</span><br>\n        <span class=\"font-bold\">{{ nirmaan_company_details.name }}</span><br>\n        {{ n_addr }}<br>\n        {% if n_gstin %}\n          <strong>GSTIN/UIN:</strong> {{ n_gstin }}<br>\n          State Name : {{ n_state_name }}, Code : {{ n_state_code }}\n        {% endif %}\n    </td>\n\n    <!-- <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Dispatched through</td><td class=\"label-cell\">Destination</td></tr>\n            <tr>\n                <td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_dispatched_through\") or \"-\" }}</td>\n                <td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_destination\") or project_doc.project_city if project_doc and project_doc.project_city else '-' }}</td>\n            </tr>\n\n                        <tr><td colspan=\"2\" class=\"label-cell terms-cell\">Terms of Delivery</td></tr>\n            <tr><td colspan=\"2\" class=\"value-cell\" style=\"border-top:0;\">{{ frappe.form_dict.get(\"custom_terms_of_delivery\") or \"-\" }}</td></tr>\n        </table>\n    </td> -->\n    <td class=\"w-50\">\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td><td class=\"label-cell\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ doc.name or \"-\" }}</td><td class=\"value-cell\">{{ frappe.utils.formatdate(doc.creation,\"dd-MMM-yy\") }}</td></tr>\n\n            <tr><td class=\"label-cell\">Project</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.form_dict.get(\"custom_project_name\") or \"-\" }}</td></tr>\n        </table>\n    </td>\n    <!-- <td class=\"w-50\"> {# Buyer's Order No & Date (from client input if provided) #}\n        <table class=\"info-table\">\n            <tr><td class=\"label-cell\">Buyer's Order No.</td></tr>\n            <tr><td class=\"value-cell\" style=\"padding-bottom:5px;\">{{ frappe.form_dict.get(\"custom_buyers_order_no\") or \"-\" }}</td></tr>\n\n            <tr><td class=\"label-cell\" style=\"border-top:1px solid #555;\">Dated</td></tr>\n            <tr><td class=\"value-cell\">{{ frappe.utils.formatdate(frappe.form_dict.get(\"custom_buyers_order_date\")) if frappe.form_dict.get(\"custom_buyers_order_date\") else \"-\" }}</td></tr>\n        </table>\n    </td> -->\n  </tr>\n</table>\n\n<!-- SECTION 3 : Item grid -->\n<table style=\"margin-top:3px;\">\n   <thead>\n     <tr>\n       <th style=\"width:5%;\">Sl&nbsp;No.</th>\n       <th style=\"width:{% if is_gst_applicable %}40%{% else %}50%{% endif %};\">Particulars</th>\n       <th style=\"width:8%;\">HSN/SAC</th>\n       <th style=\"width:8%;\" class=\"text-center\">Quantity</th>\n       <th style=\"width:8%;\" class=\"text-center\">Rate&nbsp;per</th>\n       {% if is_gst_applicable %}\n       <th style=\"width:8%;\" class=\"text-center\">GST</th>\n       {% endif %}\n       <th style=\"width:{% if is_gst_applicable %}23%{% else %}21%{% endif %};\" class=\"text-right\">Amount</th>\n     </tr>\n   </thead>\n   <tbody>\n     {% set subtotal = namespace(value=0.0) %}\n     {% set total_tax = namespace(value=0.0) %}\n     {% set grand_total = namespace(value=0.0) %}\n\n     {# build items array the same way you did earlier #}\n     {% set items = [] %}\n     {% if doc.service_order_list and doc.service_order_list is string %}\n         {% set parsed = json.loads(doc.service_order_list) %}\n         {% if parsed is mapping and parsed.list is defined %}{% set items = parsed.list %}{% endif %}\n     {% elif doc.service_order_list is mapping and doc.service_order_list.list is defined %}\n         {% set items = doc.service_order_list.list %}\n     {% endif %}\n\n     {% if items|length %}\n       {% for it in items %}\n         {% set qty   = (it.quantity  or 0)|float %}\n         {% set rate  = (it.rate      or 0)|float %}\n         {% set amt   = qty * rate %}\n         {% set subtotal.value = subtotal.value + amt %}\n         \n         {% if is_gst_applicable %}\n             {% set tax_amount = amt * (gst_rate / 100) %}\n             {% set total_tax.value = total_tax.value + tax_amount %}\n             {% set item_total = amt + tax_amount %}\n         {% else %}\n             {% set item_total = amt %}\n         {% endif %}\n         \n         {% set grand_total.value = grand_total.value + item_total %}\n         <tr>\n           <td class=\"text-center\">{{ loop.index }}</td>\n           <td>{{ it.description }}</td>\n           <td>{{ it.hsn_sac_code or \"\" }}</td>\n           <td class=\"text-center\">{{ qty if qty else \"-\" }} {{ it.uom if qty else \"\" }}</td>\n           <td class=\"text-right\">{{ rate and ('%.2f'|format(rate)) or '-' }}</td>\n           {% if is_gst_applicable %}\n           <td class=\"text-center\">{{ gst_rate }}%</td>\n           {% endif %}\n           <td class=\"text-right\">{{ currency_symbol }} {{ '%.2f'|format(amt) }}</td>\n         </tr>\n       {% endfor %}\n     {% else %}\n       <tr><td colspan=\"{{ 7 if is_gst_applicable else 6 }}\" class=\"text-center\" style=\"padding:12px;\">No service items found</td></tr>\n     {% endif %}\n\n     <tr>\n        <td colspan=\"{% if is_gst_applicable %}5{% else %}4{% endif %}\" class=\"font-bold text-right\">Total</td>\n        <td {% if is_gst_applicable %}{% else %}colspan=\"1\"{% endif %}></td>\n        <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(subtotal.value) }}</td>\n     </tr>\n\n     {% if is_gst_applicable %}\n        <tr>\n            <td colspan=\"5\" class=\"font-bold text-right\">Add: GST @ {{ gst_rate }}%</td>\n            <td></td>\n            <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(total_tax.value) }}</td>\n        </tr>\n     {% endif %}\n\n     <tr>\n        <td colspan=\"{% if is_gst_applicable %}5{% else %}4{% endif %}\" class=\"font-bold text-right\">Grand Total</td>\n        <td {% if is_gst_applicable %}{% else %}colspan=\"1\"{% endif %}></td>\n        <td class=\"font-bold text-right\">{{ currency_symbol }} {{ \"%.2f\"|format(grand_total.value) }}</td>\n     </tr>\n   </tbody>\n</table>\n\n<!-- SECTION 4 : Amount in words / taxable summary -->\n<table style=\"margin-top:3px;\">\n  <tr>\n    <td style=\"width:70%; border-right:0;\">\n        Amount Chargeable (in words)<br>\n        <span class=\"font-bold\">\n           {{ frappe.utils.money_in_words(grand_total.value,\"INR\") if grand_total.value else \"INR Zero Only\" }}\n        </span>\n    </td>\n\n    <td style=\"width:30%; border-left:0;\">\n        <table class=\"info-table\">\n          <tr>\n              <td class=\"label-cell\" style=\"border-top:0;\">HSN/SAC</td>\n              <td class=\"label-cell\" style=\"border-top:0; text-align:right;\">Taxable Value</td>\n              {% if is_gst_applicable %}\n              <td class=\"label-cell\" style=\"border-top:0; text-align:right;\">Tax Amount</td>\n              {% endif %}\n          </tr>\n          \n          <tr>\n              <td class=\"value-cell\"></td>\n              <td class=\"value-cell text-right\">{{ '%.2f'|format(subtotal.value) }}</td>\n              {% if is_gst_applicable %}\n              <td class=\"value-cell text-right\">{{ '%.2f'|format(total_tax.value) }}</td>\n              {% endif %}\n          </tr>\n          \n          <tr>\n              <td class=\"font-bold\">Total</td>\n              <td class=\"font-bold text-right\">{{ currency_symbol }} {{ '%.2f'|format(subtotal.value) }}</td>\n              {% if is_gst_applicable %}\n              <td class=\"font-bold text-right\">{{ currency_symbol }} {{ '%.2f'|format(total_tax.value) }}</td>\n              {% endif %}\n          </tr>\n        </table>\n    </td>\n  </tr>\n\n  <!--<tr>-->\n  <!--  <td colspan=\"2\" style=\"border-right:0;\">-->\n  <!--      Tax Amount (in words) : -->\n  <!--      <span class=\"font-bold\">-->\n  <!--          {% if is_gst_applicable and total_tax.value > 0 %}-->\n  <!--          {{ frappe.utils.money_in_words(total_tax.value,\"INR\") }}-->\n  <!--          {% else %}-->\n  <!--          NIL-->\n  <!--          {% endif %}-->\n  <!--      </span>-->\n  <!--  </td>-->\n  <!--</tr>-->\n\n  <tr>\n    <td colspan=\"2\" style=\"font-size:7pt; text-align:right; border-left:0; border-bottom:0;\">\n        E. &amp; O.E\n    </td>\n  </tr>\n</table>\n\n<!-- SECTION 5 : Signature -->\n<table style=\"margin-top:25px; height:50px;\">\n  <tr>\n     <td style=\"width:60%; vertical-align:bottom;\">Customer's Seal and Signature</td>\n     <td style=\"width:40%; text-align:center; vertical-align:bottom;\" class=\"font-bold\">\n         for {{ vendor_doc.vendor_name if vendor_doc else \"Vendor\" }}\n         <br><br><br>\n         Authorised Signatory\n     </td>\n  </tr>\n</table>\n\n</div>",
  "line_breaks": 0,
  "margin_bottom": 15.0,
  "margin_left": 15.0,
  "margin_right": 15.0,
  "margin_top": 15.0,
  "modified": "2025-05-29 17:25:02.981331",
  "module": "Nirmaan Stack",
  "name": "SR Invoice",
  "page_number": "Hide",
  "pdf_generator": "wkhtmltopdf",
  "print_format_builder": 0,
  "print_format_builder_beta": 0,
  "print_format_type": "Jinja",
  "raw_commands": null,
  "raw_printing": 0,
  "show_section_headings": 0,
  "standard": "No"
 }
]